"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[9060],{5098(e,n,a){a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"providers/doctrine/schema","title":"Schema Management","description":"Create and manage audit tables in your database","source":"@site/docs/auditor/providers/doctrine/schema.md","sourceDirName":"providers/doctrine","slug":"/providers/doctrine/schema","permalink":"/auditor-docs/auditor/providers/doctrine/schema","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"DoctrineProvider Configuration","permalink":"/auditor-docs/auditor/providers/doctrine/configuration"},"next":{"title":"Attributes Reference","permalink":"/auditor-docs/auditor/providers/doctrine/attributes"}}');var s=a(4848),t=a(8453);const d={},r="Schema Management",l={},c=[{value:"\ud83d\udd0d Overview",id:"-overview",level:2},{value:"\ud83c\udfd7\ufe0f Audit Table Structure",id:"\ufe0f-audit-table-structure",level:2},{value:"Column Details",id:"column-details",level:3},{value:"\ud83d\udee0\ufe0f Using SchemaManager",id:"\ufe0f-using-schemamanager",level:2},{value:"Creating the Schema Manager",id:"creating-the-schema-manager",level:3},{value:"Getting SQL Statements",id:"getting-sql-statements",level:3},{value:"Updating the Schema",id:"updating-the-schema",level:3},{value:"\ud83d\udcbb Console Commands",id:"-console-commands",level:2},{value:"Update Schema Command",id:"update-schema-command",level:3},{value:"Clean Audit Logs Command",id:"clean-audit-logs-command",level:3},{value:"\ud83d\udcdb Table Naming",id:"-table-naming",level:2},{value:"Default Naming",id:"default-naming",level:3},{value:"Custom Prefix/Suffix",id:"custom-prefixsuffix",level:3},{value:"Schema/Namespace Support",id:"schemanamespace-support",level:3},{value:"\ud83d\udd04 Schema Changes",id:"-schema-changes",level:2},{value:"Adding New Audited Entity",id:"adding-new-audited-entity",level:3},{value:"Removing Audited Entity",id:"removing-audited-entity",level:3},{value:"Modifying Entity Fields",id:"modifying-entity-fields",level:3},{value:"\ud83d\udcbb Programmatic Schema Operations",id:"-programmatic-schema-operations",level:2},{value:"Create a Single Audit Table",id:"create-a-single-audit-table",level:3},{value:"Update a Single Audit Table",id:"update-a-single-audit-table",level:3},{value:"Get Auditable Tables",id:"get-auditable-tables",level:3},{value:"Collect Auditable Entities",id:"collect-auditable-entities",level:3},{value:"\ud83d\uddc4\ufe0f Database-Specific Notes",id:"\ufe0f-database-specific-notes",level:2},{value:"MySQL/MariaDB",id:"mysqlmariadb",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"SQLite",id:"sqlite",level:3},{value:"\u26a1 Performance Considerations",id:"-performance-considerations",level:2},{value:"\ud83d\udd27 Troubleshooting",id:"-troubleshooting",level:2},{value:"&quot;Table already exists&quot;",id:"table-already-exists",level:3},{value:"Column Type Mismatch",id:"column-type-mismatch",level:3},{value:"Missing Indices",id:"missing-indices",level:3},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"schema-management",children:"Schema Management"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create and manage audit tables in your database"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This guide covers how to create and manage audit tables in your database."}),"\n",(0,s.jsx)(n.h2,{id:"-overview",children:"\ud83d\udd0d Overview"}),"\n",(0,s.jsxs)(n.p,{children:["For each audited entity, auditor creates a corresponding audit table to store the change history. The ",(0,s.jsx)(n.code,{children:"SchemaManager"})," class handles all schema operations."]}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-audit-table-structure",children:"\ud83c\udfd7\ufe0f Audit Table Structure"}),"\n",(0,s.jsx)(n.p,{children:"Each audit table has the following structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users_audit (\n    id                  INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\n    type                VARCHAR(10)   NOT NULL,\n    object_id           VARCHAR(255)  NOT NULL,\n    discriminator       VARCHAR(255)  NULL,\n    transaction_hash    VARCHAR(40)   NULL,\n    diffs               JSON          NULL,\n    blame_id            VARCHAR(255)  NULL,\n    blame_user          VARCHAR(255)  NULL,\n    blame_user_fqdn     VARCHAR(255)  NULL,\n    blame_user_firewall VARCHAR(100)  NULL,\n    ip                  VARCHAR(45)   NULL,\n    created_at          DATETIME(6)   NOT NULL,\n    \n    INDEX idx_type_xxx           (type),\n    INDEX idx_object_id_xxx      (object_id),\n    INDEX idx_discriminator_xxx  (discriminator),\n    INDEX idx_transaction_xxx    (transaction_hash),\n    INDEX idx_blame_id_xxx       (blame_id),\n    INDEX idx_created_at_xxx     (created_at)\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"column-details",children:"Column Details"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Column"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"id"})}),(0,s.jsx)(n.td,{children:"INT (PK)"}),(0,s.jsx)(n.td,{children:"Auto-increment primary key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"type"})}),(0,s.jsx)(n.td,{children:"VARCHAR(10)"}),(0,s.jsx)(n.td,{children:"Action type: insert, update, remove, associate, dissociate"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"The ID of the audited entity"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"discriminator"})}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Entity class for single-table inheritance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"transaction_hash"})}),(0,s.jsx)(n.td,{children:"VARCHAR(40)"}),(0,s.jsx)(n.td,{children:"Groups changes from the same flush()"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"diffs"})}),(0,s.jsx)(n.td,{children:"JSON/TEXT"}),(0,s.jsx)(n.td,{children:"JSON-encoded change data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blame_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"User identifier who made the change"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blame_user"})}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Username/display name"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blame_user_fqdn"})}),(0,s.jsx)(n.td,{children:"VARCHAR(255)"}),(0,s.jsx)(n.td,{children:"Full class name of the user object"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blame_user_firewall"})}),(0,s.jsx)(n.td,{children:"VARCHAR(100)"}),(0,s.jsx)(n.td,{children:"Symfony firewall name"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ip"})}),(0,s.jsx)(n.td,{children:"VARCHAR(45)"}),(0,s.jsx)(n.td,{children:"Client IP address (IPv4 or IPv6)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"created_at"})}),(0,s.jsx)(n.td,{children:"DATETIME"}),(0,s.jsx)(n.td,{children:"When the audit entry was created"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-using-schemamanager",children:"\ud83d\udee0\ufe0f Using SchemaManager"}),"\n",(0,s.jsx)(n.h3,{id:"creating-the-schema-manager",children:"Creating the Schema Manager"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Schema\\SchemaManager;\n\n$schemaManager = new SchemaManager($provider);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"getting-sql-statements",children:"Getting SQL Statements"}),"\n",(0,s.jsx)(n.p,{children:"Preview the SQL that would be executed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Get all SQL statements needed to create/update audit tables\n$sqls = $schemaManager->getUpdateAuditSchemaSql();\n\n// Returns: ['storage_name' => ['CREATE TABLE...', 'CREATE INDEX...', ...], ...]\nforeach ($sqls as $storageName => $queries) {\n    echo \"Storage: $storageName\\n\";\n    foreach ($queries as $sql) {\n        echo \"  $sql\\n\";\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updating-the-schema",children:"Updating the Schema"}),"\n",(0,s.jsx)(n.p,{children:"Execute the SQL statements:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Update all audit tables\n$schemaManager->updateAuditSchema();\n\n// With progress callback\n$schemaManager->updateAuditSchema(null, function (array $progress) {\n    echo sprintf(\"Progress: %d/%d\\n\", $progress['current'], $progress['total']);\n});\n\n// With custom SQL (preview first, then execute)\n$sqls = $schemaManager->getUpdateAuditSchemaSql();\n// ... review SQLs ...\n$schemaManager->updateAuditSchema($sqls);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-console-commands",children:"\ud83d\udcbb Console Commands"}),"\n",(0,s.jsx)(n.p,{children:"When using auditor-bundle, two commands are available:"}),"\n",(0,s.jsx)(n.h3,{id:"update-schema-command",children:"Update Schema Command"}),"\n",(0,s.jsx)(n.p,{children:"Creates or updates audit tables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Preview SQL statements (no changes)\nphp bin/console audit:schema:update --dump-sql\n\n# Execute the changes\nphp bin/console audit:schema:update --force\n\n# Both: show SQL and execute\nphp bin/console audit:schema:update --dump-sql --force\n"})}),"\n",(0,s.jsx)(n.h3,{id:"clean-audit-logs-command",children:"Clean Audit Logs Command"}),"\n",(0,s.jsx)(n.p,{children:"Removes old audit entries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Remove audits older than 12 months (default)\nphp bin/console audit:clean\n\n# Remove audits older than 6 months\nphp bin/console audit:clean P6M\n\n# Remove audits older than 30 days\nphp bin/console audit:clean P30D\n\n# Remove audits before a specific date\nphp bin/console audit:clean --date=2024-01-01\n\n# Preview only (dry run)\nphp bin/console audit:clean --dry-run\n\n# Skip confirmation\nphp bin/console audit:clean --no-confirm\n\n# Show SQL statements\nphp bin/console audit:clean --dump-sql\n\n# Include/exclude specific entities\nphp bin/console audit:clean --include=App\\\\Entity\\\\Post\nphp bin/console audit:clean --exclude=App\\\\Entity\\\\User\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-table-naming",children:"\ud83d\udcdb Table Naming"}),"\n",(0,s.jsx)(n.h3,{id:"default-naming",children:"Default Naming"}),"\n",(0,s.jsxs)(n.p,{children:["By default, audit tables are named: ",(0,s.jsx)(n.code,{children:"{entity_table}_audit"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Entity Table"}),(0,s.jsx)(n.th,{children:"Audit Table"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"users"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"users_audit"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blog_posts"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"blog_posts_audit"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"custom-prefixsuffix",children:"Custom Prefix/Suffix"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Configuration;\n\n// Prefix only: audit_users\n$config = new Configuration([\n    'table_prefix' => 'audit_',\n    'table_suffix' => '',\n]);\n\n// Suffix only: users_history\n$config = new Configuration([\n    'table_prefix' => '',\n    'table_suffix' => '_history',\n]);\n\n// Both: audit_users_log\n$config = new Configuration([\n    'table_prefix' => 'audit_',\n    'table_suffix' => '_log',\n]);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"schemanamespace-support",children:"Schema/Namespace Support"}),"\n",(0,s.jsx)(n.p,{children:"For databases with schema support (PostgreSQL):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Entity in schema: myschema.users\n// Audit table: myschema.users_audit\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-schema-changes",children:"\ud83d\udd04 Schema Changes"}),"\n",(0,s.jsx)(n.h3,{id:"adding-new-audited-entity",children:"Adding New Audited Entity"}),"\n",(0,s.jsxs)(n.p,{children:["When you add ",(0,s.jsx)(n.code,{children:"#[Auditable]"})," to a new entity:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"audit:schema:update --dump-sql"})," to preview"]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"audit:schema:update --force"})," to create the table"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"removing-audited-entity",children:"Removing Audited Entity"}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,s.jsxs)(n.p,{children:["When you remove ",(0,s.jsx)(n.code,{children:"#[Auditable]"})," from an entity, the audit table is ",(0,s.jsx)(n.strong,{children:"not"})," automatically deleted. Historical data is preserved. Manually drop the table if needed."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"modifying-entity-fields",children:"Modifying Entity Fields"}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,s.jsxs)(n.p,{children:["Adding or removing fields from an entity requires ",(0,s.jsx)(n.strong,{children:"no schema changes"}),". Diffs are stored as JSON, so new fields will appear in future audits and removed fields won't appear in new audits. Historical audits retain their original data."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-programmatic-schema-operations",children:"\ud83d\udcbb Programmatic Schema Operations"}),"\n",(0,s.jsx)(n.h3,{id:"create-a-single-audit-table",children:"Create a Single Audit Table"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Doctrine\\DBAL\\Schema\\Schema;\n\n// Create audit table for a specific entity\n$schema = $schemaManager->createAuditTable(User::class);\n\n// Or with an existing schema\n$existingSchema = $connection->createSchemaManager()->introspectSchema();\n$schema = $schemaManager->createAuditTable(User::class, $existingSchema);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"update-a-single-audit-table",children:"Update a Single Audit Table"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Ensure an existing audit table has the correct structure\n$schema = $schemaManager->updateAuditTable(User::class);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"get-auditable-tables",children:"Get Auditable Tables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Get all auditable entity tables for an EntityManager\n$tables = $schemaManager->getAuditableTableNames($entityManager);\n// Returns: ['App\\Entity\\User' => 'users', 'App\\Entity\\Post' => 'posts', ...]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"collect-auditable-entities",children:"Collect Auditable Entities"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Group auditable entities by storage service\n$repository = $schemaManager->collectAuditableEntities();\n// Returns: ['storage_name' => ['App\\Entity\\User' => 'users', ...], ...]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-database-specific-notes",children:"\ud83d\uddc4\ufe0f Database-Specific Notes"}),"\n",(0,s.jsx)(n.h3,{id:"mysqlmariadb",children:"MySQL/MariaDB"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["JSON column type used for ",(0,s.jsx)(n.code,{children:"diffs"})]}),"\n",(0,s.jsx)(n.li,{children:"InnoDB engine recommended for transactions"}),"\n",(0,s.jsxs)(n.li,{children:["Consider ",(0,s.jsx)(n.code,{children:"ROW_FORMAT=DYNAMIC"})," for large diffs"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Native JSON/JSONB support"}),"\n",(0,s.jsx)(n.li,{children:"Schema (namespace) support"}),"\n",(0,s.jsx)(n.li,{children:"Consider using JSONB for better performance"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"sqlite",children:"SQLite"}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,s.jsxs)(n.p,{children:["SQLite stores ",(0,s.jsx)(n.code,{children:"diffs"})," as TEXT (no native JSON). It's useful for development/testing but not recommended for production with high audit volume."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-performance-considerations",children:"\u26a1 Performance Considerations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index usage"})," - All common query columns are indexed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"JSON storage"})," - Use native JSON types when available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Partitioning"})," - Consider table partitioning for very large audit logs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Archiving"})," - Use ",(0,s.jsx)(n.code,{children:"audit:clean"})," or implement custom archiving"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Separate database"})," - Consider storing audits in a dedicated database"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83d\udd27 Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"table-already-exists",children:'"Table already exists"'}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,s.jsxs)(n.p,{children:["The schema manager checks for existing tables before creating. If you get conflicts, drop the audit table manually, then run ",(0,s.jsx)(n.code,{children:"audit:schema:update --force"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"column-type-mismatch",children:"Column Type Mismatch"}),"\n",(0,s.jsx)(n.p,{children:"If column types don't match (e.g., TEXT vs JSON):"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Back up your data"}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"audit:schema:update --force"})," to update column types"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"missing-indices",children:"Missing Indices"}),"\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"audit:schema:update --force"})," to add missing indices."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd0d ",(0,s.jsx)(n.a,{href:"/auditor-docs/auditor/querying/",children:"Querying Audits"})]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udcbb ",(0,s.jsx)(n.a,{href:"/auditor-docs/auditor/commands/",children:"Console Commands"})]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\uddc4\ufe0f ",(0,s.jsx)(n.a,{href:"/auditor-docs/auditor/providers/doctrine/multi-database",children:"Multi-Database Setup"})]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,n,a){a.d(n,{R:()=>d,x:()=>r});var i=a(6540);const s={},t=i.createContext(s);function d(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);