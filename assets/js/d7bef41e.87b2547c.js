"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[8375],{4318(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"querying/index","title":"Querying Audits","description":"Read and query audit entries with the powerful Reader and Query APIs","source":"@site/docs/auditor/querying/index.md","sourceDirName":"querying","slug":"/querying/","permalink":"/auditor-docs/auditor/querying/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Multi-Database Configuration","permalink":"/auditor-docs/auditor/providers/doctrine/multi-database"},"next":{"title":"Entry Model Reference","permalink":"/auditor-docs/auditor/querying/entry"}}');var t=r(4848),s=r(8453);const a={},d="Querying Audits",l={},c=[{value:"\ud83d\udd0d Overview",id:"-overview",level:2},{value:"\ud83d\udcd6 The Reader Class",id:"-the-reader-class",level:2},{value:"Creating a Reader",id:"creating-a-reader",level:3},{value:"Creating a Query",id:"creating-a-query",level:3},{value:"Query Options",id:"query-options",level:3},{value:"\ud83d\udcdd Basic Queries",id:"-basic-queries",level:2},{value:"Get All Audits for an Entity",id:"get-all-audits-for-an-entity",level:3},{value:"Get Audits for a Specific Entity",id:"get-audits-for-a-specific-entity",level:3},{value:"Get Audits by Type",id:"get-audits-by-type",level:3},{value:"Get Audits by User",id:"get-audits-by-user",level:3},{value:"Get Audits by Transaction",id:"get-audits-by-transaction",level:3},{value:"\ud83d\udd27 The Query Class",id:"-the-query-class",level:2},{value:"Resetting Query Parts",id:"resetting-query-parts",level:3},{value:"Query Constants",id:"query-constants",level:3},{value:"\ud83c\udfaf Filters",id:"-filters",level:2},{value:"SimpleFilter",id:"simplefilter",level:3},{value:"DateRangeFilter",id:"daterangefilter",level:3},{value:"RangeFilter",id:"rangefilter",level:3},{value:"\ud83d\udcc4 Pagination",id:"-pagination",level:2},{value:"Using Query Options",id:"using-query-options",level:3},{value:"Using the Paginate Method",id:"using-the-paginate-method",level:3},{value:"Disable Pagination",id:"disable-pagination",level:3},{value:"\ud83d\udd22 Counting Results",id:"-counting-results",level:2},{value:"\ud83d\udce6 The Entry Model",id:"-the-entry-model",level:2},{value:"\ud83d\udcca Reading Diffs",id:"-reading-diffs",level:2},{value:"Insert Diffs",id:"insert-diffs",level:3},{value:"Update Diffs",id:"update-diffs",level:3},{value:"Association Diffs",id:"association-diffs",level:3},{value:"\ud83d\udd27 Utility Methods",id:"-utility-methods",level:2},{value:"Get Entity Table Names",id:"get-entity-table-names",level:3},{value:"\u26a0\ufe0f Error Handling",id:"\ufe0f-error-handling",level:2},{value:"AccessDeniedException",id:"accessdeniedexception",level:3},{value:"InvalidArgumentException",id:"invalidargumentexception",level:3},{value:"\ud83d\udcc4 Complete Example",id:"-complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"querying-audits",children:"Querying Audits"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Read and query audit entries with the powerful Reader and Query APIs"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This guide covers how to read and query audit entries using the Reader and Query APIs."}),"\n",(0,t.jsx)(n.h2,{id:"-overview",children:"\ud83d\udd0d Overview"}),"\n",(0,t.jsx)(n.p,{children:"The DoctrineProvider includes a powerful querying system:"}),"\n",(0,t.jsx)(n.mermaid,{value:'flowchart LR\n    R["Reader"] --\x3e Q["Query"]\n    Q --\x3e F["Filters"]\n    Q --\x3e E["Entry[]"]'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reader"})," - Factory for creating queries and utilities"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Query"})," - Builds and executes audit queries"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Filters"})," - Filter results by various criteria"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Entry"})," - Represents a single audit log entry"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"-the-reader-class",children:"\ud83d\udcd6 The Reader Class"}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-reader",children:"Creating a Reader"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader;\n\n$reader = new Reader($doctrineProvider);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-query",children:"Creating a Query"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Simple query for all audits of an entity\n$query = $reader->createQuery(User::class);\n$audits = $query->execute();\n\n// Query with options\n$query = $reader->createQuery(User::class, [\n    'object_id' => 123,        // Specific entity ID\n    'type' => 'update',        // Action type\n    'page' => 1,               // Pagination\n    'page_size' => 20,\n]);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-options",children:"Query Options"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"object_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int|string|array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:"Filter by entity ID(s)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"type"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string|array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:"Filter by action type(s)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"blame_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int|string|array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:"Filter by user ID(s) who made changes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"user_id"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int|string|array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsxs)(n.td,{children:["Alias for ",(0,t.jsx)(n.code,{children:"blame_id"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"transaction_hash"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string|array"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:"Filter by transaction hash(es)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"page"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int|null"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1"})}),(0,t.jsx)(n.td,{children:"Page number (1-based)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"page_size"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int|null"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"50"})}),(0,t.jsx)(n.td,{children:"Results per page"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"strict"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bool"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})}),(0,t.jsx)(n.td,{children:"Use discriminator for inheritance"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-basic-queries",children:"\ud83d\udcdd Basic Queries"}),"\n",(0,t.jsx)(n.h3,{id:"get-all-audits-for-an-entity",children:"Get All Audits for an Entity"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class);\n$audits = $query->execute();\n\nforeach ($audits as $entry) {\n    echo sprintf(\n        \"[%s] %s on User #%s by %s\\n\",\n        $entry->getCreatedAt()->format('Y-m-d H:i:s'),\n        $entry->getType(),\n        $entry->getObjectId(),\n        $entry->getUsername() ?? 'unknown'\n    );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-audits-for-a-specific-entity",children:"Get Audits for a Specific Entity"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class, [\n    'object_id' => 123,\n]);\n$audits = $query->execute();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-audits-by-type",children:"Get Audits by Type"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Only updates\n$query = $reader->createQuery(User::class, [\n    'type' => 'update',\n]);\n\n// Multiple types\n$query = $reader->createQuery(User::class, [\n    'type' => ['insert', 'update'],\n]);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-audits-by-user",children:"Get Audits by User"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Changes made by a specific user\n$query = $reader->createQuery(User::class, [\n    'blame_id' => 42,\n]);\n\n// Changes by multiple users\n$query = $reader->createQuery(User::class, [\n    'blame_id' => [42, 43, 44],\n]);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-audits-by-transaction",children:"Get Audits by Transaction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// All changes from a single transaction\n$query = $reader->createQuery(User::class, [\n    'transaction_hash' => 'abc123def456...',\n]);\n\n// Or across all entities\n$audits = $reader->getAuditsByTransactionHash('abc123def456...');\n// Returns: ['App\\Entity\\User' => [...], 'App\\Entity\\Post' => [...]]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-the-query-class",children:"\ud83d\udd27 The Query Class"}),"\n",(0,t.jsx)(n.p,{children:"For more control, work directly with the Query object:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class);\n\n// Add custom ordering\n$query->resetOrderBy();\n$query->addOrderBy(Query::CREATED_AT, 'ASC');\n$query->addOrderBy(Query::ID, 'ASC');\n\n// Add custom limit\n$query->limit(100, 0);  // limit, offset\n\n$audits = $query->execute();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"resetting-query-parts",children:"Resetting Query Parts"}),"\n",(0,t.jsxs)(n.p,{children:["You can reset specific parts of a query using ",(0,t.jsx)(n.code,{children:"resetQueryPart()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class);\n\n// Reset order by clauses\n$query->resetQueryPart('orderBy');\n\n// Reset limit and offset\n$query->resetQueryPart('limit');\n\n// Reset all filters\n$query->resetQueryPart('filters');\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Part"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"orderBy"})}),(0,t.jsx)(n.td,{children:"Resets all ORDER BY clauses"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"limit"})}),(0,t.jsx)(n.td,{children:"Resets LIMIT and OFFSET to 0"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"filters"})}),(0,t.jsx)(n.td,{children:"Resets all filters to empty arrays"})]})]})]}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,t.jsxs)(n.p,{children:["You can also use the shorthand ",(0,t.jsx)(n.code,{children:"resetOrderBy()"})," method which is equivalent to ",(0,t.jsx)(n.code,{children:"resetQueryPart('orderBy')"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"query-constants",children:"Query Constants"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\n\nQuery::TYPE              // 'type'\nQuery::OBJECT_ID         // 'object_id'\nQuery::DISCRIMINATOR     // 'discriminator'\nQuery::TRANSACTION_HASH  // 'transaction_hash'\nQuery::USER_ID           // 'blame_id'\nQuery::CREATED_AT        // 'created_at'\nQuery::ID                // 'id'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-filters",children:"\ud83c\udfaf Filters"}),"\n",(0,t.jsx)(n.h3,{id:"simplefilter",children:"SimpleFilter"}),"\n",(0,t.jsx)(n.p,{children:"For exact value matching:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter;\n\n$query = $reader->createQuery(User::class);\n\n// Single value\n$query->addFilter(new SimpleFilter(Query::TYPE, 'update'));\n\n// Multiple values (OR condition)\n$query->addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));\n"})}),"\n",(0,t.jsx)(n.h3,{id:"daterangefilter",children:"DateRangeFilter"}),"\n",(0,t.jsx)(n.p,{children:"For filtering by date range:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Audits from the last 30 days\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('-30 days'),\n    new \\DateTime('now')\n));\n\n// Audits since a specific date\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('2024-01-01'),\n    null  // No upper bound\n));\n\n// Audits until a specific date\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    null,  // No lower bound\n    new \\DateTime('2024-06-30')\n));\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rangefilter",children:"RangeFilter"}),"\n",(0,t.jsx)(n.p,{children:"For numeric ranges:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Audits for IDs between 100 and 200\n$query->addFilter(new RangeFilter(Query::ID, 100, 200));\n\n// Audits with ID >= 500\n$query->addFilter(new RangeFilter(Query::ID, 500, null));\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-pagination",children:"\ud83d\udcc4 Pagination"}),"\n",(0,t.jsx)(n.h3,{id:"using-query-options",children:"Using Query Options"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class, [\n    'page' => 1,\n    'page_size' => 20,\n]);\n$audits = $query->execute();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"using-the-paginate-method",children:"Using the Paginate Method"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class);\n$result = $reader->paginate($query, $page = 1, $pageSize = 20);\n\n// Result structure\n[\n    'results' => ArrayIterator,      // The audit entries\n    'currentPage' => 1,\n    'hasPreviousPage' => false,\n    'hasNextPage' => true,\n    'previousPage' => null,\n    'nextPage' => 2,\n    'numPages' => 5,\n    'haveToPaginate' => true,\n    'numResults' => 100,\n    'pageSize' => 20,\n]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"disable-pagination",children:"Disable Pagination"}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,t.jsxs)(n.p,{children:["Set both ",(0,t.jsx)(n.code,{children:"page"})," and ",(0,t.jsx)(n.code,{children:"page_size"})," to ",(0,t.jsx)(n.code,{children:"null"})," to get all results without pagination."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Get all results without pagination\n$query = $reader->createQuery(User::class, [\n    'page' => null,\n    'page_size' => null,\n]);\n$allAudits = $query->execute();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-counting-results",children:"\ud83d\udd22 Counting Results"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class);\n$count = $query->count();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-the-entry-model",children:"\ud83d\udce6 The Entry Model"}),"\n",(0,t.jsxs)(n.p,{children:["Each audit result is an ",(0,t.jsx)(n.code,{children:"Entry"})," object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"/** @var Entry $entry */\nforeach ($audits as $entry) {\n    // Basic info\n    $entry->getId();              // int - Audit entry ID\n    $entry->getType();            // string - insert, update, remove, etc.\n    $entry->getObjectId();        // string - Entity ID\n    $entry->getCreatedAt();       // DateTimeImmutable\n    \n    // Transaction\n    $entry->getTransactionHash(); // string|null\n    $entry->getDiscriminator();   // string|null - For inheritance\n    \n    // Changes\n    $entry->getDiffs();           // array - The actual changes\n    $entry->getDiffs(true);       // array - Including @source metadata\n    \n    // User attribution\n    $entry->getUserId();          // int|string|null - blame_id\n    $entry->getUsername();        // string|null - blame_user\n    $entry->getUserFqdn();        // string|null - User class\n    $entry->getUserFirewall();    // string|null - Firewall name\n    $entry->getIp();              // string|null - Client IP\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-reading-diffs",children:"\ud83d\udcca Reading Diffs"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"getDiffs()"})," method returns the changes:"]}),"\n",(0,t.jsx)(n.h3,{id:"insert-diffs",children:"Insert Diffs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// For insert operations:\n[\n    'email' => [\n        'new' => 'john@example.com',\n        'old' => null,\n    ],\n    'name' => [\n        'new' => 'John Doe',\n        'old' => null,\n    ],\n]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"update-diffs",children:"Update Diffs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// For update operations:\n[\n    'email' => [\n        'new' => 'jane@example.com',\n        'old' => 'john@example.com',\n    ],\n]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"association-diffs",children:"Association Diffs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// For associate/dissociate operations:\n[\n    'source' => [\n        'class' => 'App\\\\Entity\\\\Post',\n        'id' => 1,\n        'label' => 'My Post',\n        'field' => 'tags',\n    ],\n    'target' => [\n        'class' => 'App\\\\Entity\\\\Tag',\n        'id' => 5,\n        'label' => 'PHP',\n        'field' => 'posts',\n    ],\n    'is_owning_side' => true,\n    'table' => 'post_tag',  // Join table\n]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-utility-methods",children:"\ud83d\udd27 Utility Methods"}),"\n",(0,t.jsx)(n.h3,{id:"get-entity-table-names",children:"Get Entity Table Names"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Get the source entity table name\n$tableName = $reader->getEntityTableName(User::class);\n// Returns: 'users'\n\n// Get the audit table name\n$auditTableName = $reader->getEntityAuditTableName(User::class);\n// Returns: 'users_audit'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-error-handling",children:"\u26a0\ufe0f Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"accessdeniedexception",children:"AccessDeniedException"}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,t.jsx)(n.p,{children:"Thrown when the role checker denies access to view audits for an entity."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Exception\\AccessDeniedException;\n\ntry {\n    $query = $reader->createQuery(SensitiveEntity::class);\n    $audits = $query->execute();\n} catch (AccessDeniedException $e) {\n    // Handle access denied\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"invalidargumentexception",children:"InvalidArgumentException"}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"CAUTION"]}),"\n",(0,t.jsx)(n.p,{children:"Thrown when querying non-auditable entities."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Exception\\InvalidArgumentException;\n\ntry {\n    $query = $reader->createQuery(NonAuditableEntity::class);\n} catch (InvalidArgumentException $e) {\n    // Entity App\\Entity\\NonAuditableEntity is not auditable.\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-complete-example",children:"\ud83d\udcc4 Complete Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter;\n\n$reader = new Reader($provider);\n\n// Build a complex query\n$query = $reader->createQuery(User::class, [\n    'page' => null,\n    'page_size' => null,\n]);\n\n// Add filters\n$query->addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('-7 days'),\n    new \\DateTime('now')\n));\n\n// Custom ordering\n$query->resetOrderBy();\n$query->addOrderBy(Query::CREATED_AT, 'DESC');\n\n// Limit results\n$query->limit(100);\n\n// Execute and process\n$audits = $query->execute();\n\nforeach ($audits as $entry) {\n    $diffs = $entry->getDiffs();\n    \n    echo sprintf(\n        \"[%s] %s #%s by %s from %s\\n\",\n        $entry->getCreatedAt()->format('Y-m-d H:i:s'),\n        $entry->getType(),\n        $entry->getObjectId(),\n        $entry->getUsername() ?? 'system',\n        $entry->getIp() ?? 'unknown'\n    );\n    \n    foreach ($diffs as $field => $change) {\n        echo sprintf(\"  - %s: %s \u2192 %s\\n\",\n            $field,\n            json_encode($change['old'] ?? null),\n            json_encode($change['new'] ?? null)\n        );\n    }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,t.jsx)(n.a,{href:"/auditor-docs/auditor/querying/filters",children:"Filters Reference"})]}),"\n",(0,t.jsxs)(n.li,{children:["\ud83d\udce6 ",(0,t.jsx)(n.a,{href:"/auditor-docs/auditor/querying/entry",children:"Entry Model Reference"})]}),"\n",(0,t.jsxs)(n.li,{children:["\ud83d\udee1\ufe0f ",(0,t.jsx)(n.a,{href:"/auditor-docs/auditor/configuration/role-checker",children:"Security & Access Control"})]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453(e,n,r){r.d(n,{R:()=>a,x:()=>d});var i=r(6540);const t={},s=i.createContext(t);function a(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);