"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[8706],{60421(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"upgrade/v4","title":"Upgrading to 4.x from 3.x","description":"PHP 8.4+ modernization and new features","source":"@site/docs/auditor/upgrade/v4.md","sourceDirName":"upgrade","slug":"/upgrade/v4","permalink":"/auditor-docs/auditor/upgrade/v4","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Upgrading to 3.x from 2.x","permalink":"/auditor-docs/auditor/upgrade/v3"}}');var i=r(74848),t=r(28453);const d={},c="Upgrading to 4.x from 3.x",a={},l=[{value:"\u26a0\ufe0f Requirements Changes",id:"\ufe0f-requirements-changes",level:2},{value:"PHP Version",id:"php-version",level:3},{value:"Symfony Version",id:"symfony-version",level:3},{value:"Doctrine Versions",id:"doctrine-versions",level:3},{value:"PHPUnit Version",id:"phpunit-version",level:3},{value:"\ud83d\uddd1\ufe0f Removed Methods",id:"\ufe0f-removed-methods",level:2},{value:"DoctrineHelper",id:"doctrinehelper",level:3},{value:"\ud83d\udce6 Namespace Changes",id:"-namespace-changes",level:2},{value:"Annotation \u2192 Attribute",id:"annotation--attribute",level:3},{value:"\ud83d\udcca Model Changes",id:"-model-changes",level:2},{value:"Entry Model - Property Hooks (PHP 8.4+)",id:"entry-model---property-hooks-php-84",level:3},{value:"Configuration - Asymmetric Visibility (PHP 8.4+)",id:"configuration---asymmetric-visibility-php-84",level:3},{value:"User Model - Property Hooks (PHP 8.4+)",id:"user-model---property-hooks-php-84",level:3},{value:"\ud83d\udd21 UTF-8 Conversion Now Opt-In",id:"-utf-8-conversion-now-opt-in",level:2},{value:"What Changed",id:"what-changed",level:3},{value:"Who Is Affected",id:"who-is-affected",level:3},{value:"How to Fix",id:"how-to-fix",level:3},{value:"Why the Default Is <code>false</code>",id:"why-the-default-is-false",level:3},{value:"\ud83c\udd95 New <code>extra_data</code> Column",id:"-new-extra_data-column",level:2},{value:"Schema Change",id:"schema-change",level:3},{value:"Two ways to populate <code>extra_data</code>",id:"two-ways-to-populate-extra_data",level:3},{value:"\ud83d\udd22 TransactionType Enum",id:"-transactiontype-enum",level:2},{value:"\ud83c\udfb5 Symfony Attributes",id:"-symfony-attributes",level:2},{value:"Commands",id:"commands",level:3},{value:"Event Listeners",id:"event-listeners",level:3},{value:"\ud83d\udd04 Migration Example: getMigrateToSql",id:"-migration-example-getmigratetosql",level:2},{value:"DoctrineHelper::getRealClassName()",id:"doctrinehelpergetrealclassname",level:3},{value:"Composer Scripts Changes",id:"composer-scripts-changes",level:2},{value:"Internal Changes",id:"internal-changes",level:2},{value:"DoctrineHelper::setPrimaryKey()",id:"doctrinehelpersetprimarykey",level:3},{value:"DoctrineHelper::getReflectionPropertyValue()",id:"doctrinehelpergetreflectionpropertyvalue",level:3},{value:"PlatformHelper::getServerVersion()",id:"platformhelpergetserverversion",level:3},{value:"\ud83d\ude80 PHP 8.4+ Modernization Changes",id:"-php-84-modernization-changes",level:2},{value:"TransactionType Enum",id:"transactiontype-enum",level:3},{value:"Entry Model - Property Hooks",id:"entry-model---property-hooks",level:3},{value:"User Interface - Property Hooks",id:"user-interface---property-hooks",level:3},{value:"Configuration - Asymmetric Visibility",id:"configuration---asymmetric-visibility",level:3},{value:"Attribute Namespace Rename",id:"attribute-namespace-rename",level:3},{value:"Event Subscribers \u2192 Event Listeners",id:"event-subscribers--event-listeners",level:3},{value:"Console Commands with <code>#[AsCommand]</code>",id:"console-commands-with-ascommand",level:3},{value:"\ud83d\udccb Migration Steps",id:"-migration-steps",level:2},{value:"1\ufe0f\u20e3 Update PHP Version",id:"1\ufe0f\u20e3-update-php-version",level:3},{value:"2\ufe0f\u20e3 Update Symfony Dependencies",id:"2\ufe0f\u20e3-update-symfony-dependencies",level:3},{value:"3\ufe0f\u20e3 Update Doctrine Dependencies",id:"3\ufe0f\u20e3-update-doctrine-dependencies",level:3},{value:"4\ufe0f\u20e3 Update auditor",id:"4\ufe0f\u20e3-update-auditor",level:3},{value:"5\ufe0f\u20e3 Update Your Code",id:"5\ufe0f\u20e3-update-your-code",level:3},{value:"6\ufe0f\u20e3 Run Tests",id:"6\ufe0f\u20e3-run-tests",level:3},{value:"7\ufe0f\u20e3 Update Audit Schema",id:"7\ufe0f\u20e3-update-audit-schema",level:3},{value:"\ud83d\udd27 Troubleshooting",id:"-troubleshooting",level:2},{value:"&quot;Class not found&quot; errors",id:"class-not-found-errors",level:3},{value:"Schema issues",id:"schema-issues",level:3},{value:"Test failures",id:"test-failures",level:3},{value:"\u2753 Need Help?",id:"-need-help",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"upgrading-to-4x-from-3x",children:"Upgrading to 4.x from 3.x"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"PHP 8.4+ modernization and new features"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This document describes the backward incompatible changes introduced in auditor 4.0 and how to adapt your code."}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-requirements-changes",children:"\u26a0\ufe0f Requirements Changes"}),"\n",(0,i.jsx)(n.h3,{id:"php-version",children:"PHP Version"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Minimum PHP version is now 8.4"})," (was 8.2 in 3.x)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This is required by Symfony 8.0 and leverages PHP 8.4 features."}),"\n",(0,i.jsx)(n.h3,{id:"symfony-version",children:"Symfony Version"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Minimum Symfony version is now 8.0"})," (was 5.4 in 3.x)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Support for Symfony 5.4, 6.4, and 7.x has been dropped."}),"\n",(0,i.jsx)(n.h3,{id:"doctrine-versions",children:"Doctrine Versions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Package"}),(0,i.jsx)(n.th,{children:"3.x Version"}),(0,i.jsx)(n.th,{children:"4.x Version"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Doctrine DBAL"}),(0,i.jsx)(n.td,{children:">= 3.2"}),(0,i.jsx)(n.td,{children:">= 4.0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Doctrine ORM"}),(0,i.jsx)(n.td,{children:">= 2.13"}),(0,i.jsx)(n.td,{children:">= 3.2"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"phpunit-version",children:"PHPUnit Version"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"PHPUnit minimum version is now 12.0"})," (was 11.0 in 3.x)"]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-removed-methods",children:"\ud83d\uddd1\ufe0f Removed Methods"}),"\n",(0,i.jsx)(n.h3,{id:"doctrinehelper",children:"DoctrineHelper"}),"\n",(0,i.jsxs)(n.p,{children:["The following methods have been removed from ",(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Persistence\\Helper\\DoctrineHelper"}),":"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Removed Method"}),(0,i.jsx)(n.th,{children:"Replacement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DoctrineHelper::createSchemaManager()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$connection->createSchemaManager()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DoctrineHelper::introspectSchema()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$schemaManager->introspectSchema()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DoctrineHelper::getMigrateToSql()"})}),(0,i.jsx)(n.td,{children:"See migration example below"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"These methods were compatibility shims for older Doctrine DBAL versions that are no longer needed."}),"\n",(0,i.jsx)(n.h2,{id:"-namespace-changes",children:"\ud83d\udce6 Namespace Changes"}),"\n",(0,i.jsx)(n.h3,{id:"annotation--attribute",children:"Annotation \u2192 Attribute"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Annotation"})," namespace has been renamed to ",(0,i.jsx)(n.code,{children:"Attribute"})," to align with PHP 8+ terminology."]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\AnnotationLoader"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\AttributeLoader"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\n\n#[Audit\\Auditable]\nclass MyEntity\n{\n    #[Audit\\Ignore]\n    private string $ignoredField;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit;\n\n#[Audit\\Auditable]\nclass MyEntity\n{\n    #[Audit\\Ignore]\n    private string $ignoredField;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-model-changes",children:"\ud83d\udcca Model Changes"}),"\n",(0,i.jsx)(n.h3,{id:"entry-model---property-hooks-php-84",children:"Entry Model - Property Hooks (PHP 8.4+)"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Entry"})," model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access."]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->id"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getType()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->type"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getObjectId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->objectId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getDiscriminator()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->discriminator"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getTransactionHash()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->transactionHash"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUsername()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->username"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserFqdn()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userFqdn"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserFirewall()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userFirewall"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getIp()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->ip"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getCreatedAt()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->createdAt"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"(new)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->extraData"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," ",(0,i.jsx)(n.code,{children:"getDiffs()"})," and ",(0,i.jsx)(n.code,{children:"getExtraData()"})," methods remain as they contain business logic. ",(0,i.jsx)(n.code,{children:"extraData"})," is also available as a virtual property."]}),"\n",(0,i.jsx)(n.h3,{id:"configuration---asymmetric-visibility-php-84",children:"Configuration - Asymmetric Visibility (PHP 8.4+)"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Configuration"})," class now uses PHP 8.4 asymmetric visibility:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->isEnabled()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->enabled"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->getTimezone()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->timezone"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"user-model---property-hooks-php-84",children:"User Model - Property Hooks (PHP 8.4+)"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"UserInterface"})," now uses PHP 8.4 property hooks:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$user->getIdentifier()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$user->identifier"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$user->getUsername()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$user->username"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["If you have custom ",(0,i.jsx)(n.code,{children:"UserInterface"})," implementations, update them:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\User\\UserInterface;\n\nclass MyUser implements UserInterface\n{\n    public function getIdentifier(): ?string { return $this->id; }\n    public function getUsername(): ?string { return $this->name; }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\User\\UserInterface;\n\nclass MyUser implements UserInterface\n{\n    public ?string $identifier { get => $this->id; }\n    public ?string $username { get => $this->name; }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-utf-8-conversion-now-opt-in",children:"\ud83d\udd21 UTF-8 Conversion Now Opt-In"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsx)(n.p,{children:"The automatic UTF-8 re-encoding of audit diffs has been removed from the default path."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"what-changed",children:"What Changed"}),"\n",(0,i.jsxs)(n.p,{children:["Previously, auditor always called ",(0,i.jsx)(n.code,{children:"mb_convert_encoding()"})," recursively on the entire diff array before persisting each audit entry. This guaranteed that any non-UTF-8 byte sequence in entity field values would be sanitized before being stored."]}),"\n",(0,i.jsxs)(n.p,{children:["This pass now only runs when the ",(0,i.jsx)(n.code,{children:"utf8_convert"})," option is explicitly enabled."]}),"\n",(0,i.jsx)(n.h3,{id:"who-is-affected",children:"Who Is Affected"}),"\n",(0,i.jsx)(n.p,{children:"You are affected if your application:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses a database connection that was ",(0,i.jsx)(n.strong,{children:"not"})," explicitly configured as UTF-8, ",(0,i.jsx)(n.strong,{children:"and"})]}),"\n",(0,i.jsx)(n.li,{children:"Persists entity fields that may contain non-UTF-8 strings (e.g. data imported from ISO-8859-1 sources, legacy BLOBs, etc.)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Applications running on a modern stack (DBAL 4 + PHP 8.4 + UTF-8 database charset) are ",(0,i.jsx)(n.strong,{children:"not"})," affected \u2014 the conversion was already a no-op for them."]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-fix",children:"How to Fix"}),"\n",(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:"'utf8_convert' => true"})," to your ",(0,i.jsx)(n.code,{children:"DoctrineProvider"})," configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Configuration;\n\n$configuration = new Configuration([\n    // ... other options ...\n    'utf8_convert' => true,\n]);\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"why-the-default-is-false",children:["Why the Default Is ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"DBAL 4 mandates PHP 8.4+ and enforces UTF-8 database connections. Traversing and re-encoding every diff array on every flush was unnecessary overhead for the vast majority of users. The option is preserved for applications that still process legacy non-UTF-8 data."}),"\n",(0,i.jsxs)(n.h2,{id:"-new-extra_data-column",children:["\ud83c\udd95 New ",(0,i.jsx)(n.code,{children:"extra_data"})," Column"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-change",children:"Schema Change"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:["A new nullable JSON column ",(0,i.jsx)(n.code,{children:"extra_data"})," has been added to all audit tables. Run the schema update command after upgrading."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"php bin/console audit:schema:update --dump-sql   # Preview\nphp bin/console audit:schema:update --force       # Apply\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"two-ways-to-populate-extra_data",children:["Two ways to populate ",(0,i.jsx)(n.code,{children:"extra_data"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Option 1 \u2014 Global provider (new in 4.0):"})," set a callable on ",(0,i.jsx)(n.code,{children:"Configuration"})," once and it runs automatically for every audit entry produced during a flush:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$configuration->setExtraDataProvider(function (): ?array {\n    return [\n        'ip'   => $this->requestStack->getCurrentRequest()?->getClientIp(),\n        'role' => $this->security->getUser()?->getRoles(),\n    ];\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Option 2 \u2014 Per-entity listener:"})," ",(0,i.jsx)(n.code,{children:"LifecycleEvent"})," now exposes ",(0,i.jsx)(n.code,{children:"$event->entity"})," (the audited object), allowing listeners to add entity-specific context:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"#[AsEventListener(event: LifecycleEvent::class, priority: 10)]\nfinal class AuditExtraDataListener\n{\n    public function __invoke(LifecycleEvent $event): void\n    {\n        $payload = $event->getPayload();\n\n        if ($payload['entity'] === User::class && null !== $event->entity) {\n            $payload['extra_data'] = json_encode([\n                'department' => $event->entity->getDepartment(),\n            ], JSON_THROW_ON_ERROR);\n            $event->setPayload($payload);\n        }\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The provider runs first; the listener can override or extend its output. See the ",(0,i.jsx)(n.a,{href:"/auditor-docs/auditor/extra-data",children:"Extra Data guide"})," for precedence rules, merging strategies, and caveats."]}),"\n",(0,i.jsx)(n.h2,{id:"-transactiontype-enum",children:"\ud83d\udd22 TransactionType Enum"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsx)(n.p,{children:"Transaction type constants have been replaced by a backed enum for better type safety."}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Transaction::INSERT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TransactionType::Insert->value"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Transaction::UPDATE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TransactionType::Update->value"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Transaction::REMOVE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TransactionType::Remove->value"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Transaction::ASSOCIATE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TransactionType::Associate->value"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Transaction::DISSOCIATE"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TransactionType::Dissociate->value"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Model\\Transaction;\n\nif ($entry->getType() === Transaction::INSERT) {\n    // ...\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Model\\TransactionType;\n\nif ($entry->type === TransactionType::Insert->value) {\n    // ...\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-symfony-attributes",children:"\ud83c\udfb5 Symfony Attributes"}),"\n",(0,i.jsx)(n.h3,{id:"commands",children:"Commands"}),"\n",(0,i.jsxs)(n.p,{children:["Console commands now use ",(0,i.jsx)(n.code,{children:"#[AsCommand]"})," attribute:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"#[AsCommand(\n    name: 'audit:schema:update',\n    description: 'Update audit tables structure',\n)]\nfinal class UpdateSchemaCommand extends Command\n"})}),"\n",(0,i.jsx)(n.h3,{id:"event-listeners",children:"Event Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["Event subscriber has been replaced by event listeners using ",(0,i.jsx)(n.code,{children:"#[AsEventListener]"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class AuditEventSubscriber implements EventSubscriberInterface\n{\n    public static function getSubscribedEvents(): array\n    {\n        return [LifecycleEvent::class => 'onAuditEvent'];\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"#[AsEventListener(event: LifecycleEvent::class, method: 'onAuditEvent')]\nfinal class AuditEventSubscriber\n{\n    public function onAuditEvent(LifecycleEvent $event): void { }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-migration-example-getmigratetosql",children:"\ud83d\udd04 Migration Example: getMigrateToSql"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Helper\\DoctrineHelper;\n\n$sqls = DoctrineHelper::getMigrateToSql($connection, $fromSchema, $toSchema);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Doctrine\\DBAL\\Schema\\Comparator;\n\n$platform = $connection->getDatabasePlatform();\n$sqls = $platform->getAlterSchemaSQL(\n    (new Comparator($platform))->compareSchemas($fromSchema, $toSchema)\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"doctrinehelpergetrealclassname",children:"DoctrineHelper::getRealClassName()"}),"\n",(0,i.jsxs)(n.p,{children:["This method now only handles ",(0,i.jsx)(n.code,{children:"__CG__"})," proxies (Doctrine Common Gateway marker)."]}),"\n",(0,i.jsx)(n.p,{children:"With PHP 8.4+, Doctrine ORM uses native lazy objects instead of proxy classes, so the previous proxy handling logic has been simplified."}),"\n",(0,i.jsx)(n.h2,{id:"composer-scripts-changes",children:"Composer Scripts Changes"}),"\n",(0,i.jsx)(n.p,{children:"The following composer scripts have been removed:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Removed Script"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"setup5"})}),(0,i.jsx)(n.td,{children:"Symfony 5.4 setup"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"setup6"})}),(0,i.jsx)(n.td,{children:"Symfony 6.4 setup"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"setup7"})}),(0,i.jsx)(n.td,{children:"Symfony 7.x setup"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Use the new unified ",(0,i.jsx)(n.code,{children:"setup"})," script instead:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer setup\n"})}),"\n",(0,i.jsx)(n.h2,{id:"internal-changes",children:"Internal Changes"}),"\n",(0,i.jsx)(n.p,{children:"These changes are internal and should not affect most users, but are documented for completeness:"}),"\n",(0,i.jsx)(n.h3,{id:"doctrinehelpersetprimarykey",children:"DoctrineHelper::setPrimaryKey()"}),"\n",(0,i.jsxs)(n.p,{children:["Now uses ",(0,i.jsx)(n.code,{children:"PrimaryKeyConstraint"})," directly without fallback to deprecated ",(0,i.jsx)(n.code,{children:"setPrimaryKey()"})," method."]}),"\n",(0,i.jsx)(n.h3,{id:"doctrinehelpergetreflectionpropertyvalue",children:"DoctrineHelper::getReflectionPropertyValue()"}),"\n",(0,i.jsxs)(n.p,{children:["Now uses ",(0,i.jsx)(n.code,{children:"getPropertyAccessor()"})," directly without fallback to deprecated ",(0,i.jsx)(n.code,{children:"getReflectionProperty()"})," method."]}),"\n",(0,i.jsx)(n.h3,{id:"platformhelpergetserverversion",children:"PlatformHelper::getServerVersion()"}),"\n",(0,i.jsxs)(n.p,{children:["Simplified to use ",(0,i.jsx)(n.code,{children:"getNativeConnection()"})," directly. The ",(0,i.jsx)(n.code,{children:"getWrappedConnection()"})," fallback has been removed."]}),"\n",(0,i.jsx)(n.h2,{id:"-php-84-modernization-changes",children:"\ud83d\ude80 PHP 8.4+ Modernization Changes"}),"\n",(0,i.jsx)(n.h3,{id:"transactiontype-enum",children:"TransactionType Enum"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["Transaction type constants have been moved from ",(0,i.jsx)(n.code,{children:"Transaction"})," model to a native PHP enum ",(0,i.jsx)(n.code,{children:"TransactionType"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Model\\Transaction;\n\n$type = Transaction::INSERT;\n$type = Transaction::UPDATE;\n$type = Transaction::REMOVE;\n$type = Transaction::ASSOCIATE;\n$type = Transaction::DISSOCIATE;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Model\\TransactionType;\n\n// Using constants (recommended - backward compatible syntax)\n$type = TransactionType::INSERT;\n$type = TransactionType::UPDATE;\n$type = TransactionType::REMOVE;\n$type = TransactionType::ASSOCIATE;\n$type = TransactionType::DISSOCIATE;\n\n// Or using enum cases (when you need the enum instance)\n$type = TransactionType::Insert;\n$type = TransactionType::Update;\n// etc.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"entry-model---property-hooks",children:"Entry Model - Property Hooks"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Entry"})," model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->id"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getType()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->type"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getObjectId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->objectId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getDiscriminator()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->discriminator"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getTransactionHash()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->transactionHash"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserId()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userId"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUsername()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->username"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserFqdn()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userFqdn"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getUserFirewall()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->userFirewall"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getIp()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->ip"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->getCreatedAt()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$entry->createdAt"})})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," ",(0,i.jsx)(n.code,{children:"getDiffs()"})," method is preserved as it contains business logic."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"user-interface---property-hooks",children:"User Interface - Property Hooks"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"UserInterface"})," now uses PHP 8.4 interface properties."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"interface UserInterface\n{\n    public function getIdentifier(): ?string;\n    public function getUsername(): ?string;\n}\n\n// Usage\n$user->getIdentifier();\n$user->getUsername();\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"interface UserInterface\n{\n    public ?string $identifier { get; }\n    public ?string $username { get; }\n}\n\n// Usage\n$user->identifier;\n$user->username;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration---asymmetric-visibility",children:"Configuration - Asymmetric Visibility"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Configuration"})," class now uses asymmetric visibility for some properties."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (3.x)"}),(0,i.jsx)(n.th,{children:"After (4.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->isEnabled()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->enabled"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->getTimezone()"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$config->timezone"})})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," ",(0,i.jsx)(n.code,{children:"getUserProvider()"}),", ",(0,i.jsx)(n.code,{children:"getSecurityProvider()"}),", and ",(0,i.jsx)(n.code,{children:"getRoleChecker()"})," methods are preserved."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"attribute-namespace-rename",children:"Attribute Namespace Rename"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Annotation"})," namespace has been renamed to ",(0,i.jsx)(n.code,{children:"Attribute"})," to better reflect PHP 8+ native attributes."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\AnnotationLoader;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\AttributeLoader;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"event-subscribers--event-listeners",children:"Event Subscribers \u2192 Event Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["Event subscribers now use Symfony's ",(0,i.jsx)(n.code,{children:"#[AsEventListener]"})," attribute instead of ",(0,i.jsx)(n.code,{children:"EventSubscriberInterface"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\nclass AuditEventSubscriber implements EventSubscriberInterface\n{\n    public static function getSubscribedEvents(): array\n    {\n        return [LifecycleEvent::class => ['onAuditEvent', -1000000]];\n    }\n    \n    public function onAuditEvent(LifecycleEvent $event): LifecycleEvent { /* ... */ }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener;\n\n#[AsEventListener(event: LifecycleEvent::class, priority: -1_000_000)]\nclass AuditEventSubscriber\n{\n    public function __invoke(LifecycleEvent $event): LifecycleEvent { /* ... */ }\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"console-commands-with-ascommand",children:["Console Commands with ",(0,i.jsx)(n.code,{children:"#[AsCommand]"})]}),"\n",(0,i.jsxs)(n.p,{children:["Console commands now use the ",(0,i.jsx)(n.code,{children:"#[AsCommand]"})," attribute for metadata."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (3.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class CleanAuditLogsCommand extends Command\n{\n    protected function configure(): void\n    {\n        $this\n            ->setName('audit:clean')\n            ->setDescription('Cleans audit tables')\n            // ...\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"After (4.0):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"#[AsCommand(name: 'audit:clean', description: 'Cleans audit tables')]\nclass CleanAuditLogsCommand extends Command\n{\n    protected function configure(): void\n    {\n        // Only options and arguments, no setName/setDescription\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-migration-steps",children:"\ud83d\udccb Migration Steps"}),"\n",(0,i.jsx)(n.h3,{id:"1\ufe0f\u20e3-update-php-version",children:"1\ufe0f\u20e3 Update PHP Version"}),"\n",(0,i.jsx)(n.p,{children:"Ensure you're running PHP 8.4 or higher:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"php -v\n# PHP 8.4.x ...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2\ufe0f\u20e3-update-symfony-dependencies",children:"2\ufe0f\u20e3 Update Symfony Dependencies"}),"\n",(0,i.jsxs)(n.p,{children:["Update your ",(0,i.jsx)(n.code,{children:"composer.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "require": {\n        "symfony/framework-bundle": "^8.0"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3\ufe0f\u20e3-update-doctrine-dependencies",children:"3\ufe0f\u20e3 Update Doctrine Dependencies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "require": {\n        "doctrine/dbal": "^4.0",\n        "doctrine/orm": "^3.2"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4\ufe0f\u20e3-update-auditor",children:"4\ufe0f\u20e3 Update auditor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer require damienharper/auditor:^4.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5\ufe0f\u20e3-update-your-code",children:"5\ufe0f\u20e3 Update Your Code"}),"\n",(0,i.jsx)(n.p,{children:"Replace any removed method calls:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before\n$schemaManager = DoctrineHelper::createSchemaManager($connection);\n$schema = DoctrineHelper::introspectSchema($schemaManager);\n\n// After\n$schemaManager = $connection->createSchemaManager();\n$schema = $schemaManager->introspectSchema();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"6\ufe0f\u20e3-run-tests",children:"6\ufe0f\u20e3 Run Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/phpunit\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7\ufe0f\u20e3-update-audit-schema",children:"7\ufe0f\u20e3 Update Audit Schema"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsx)(n.p,{children:"After upgrading, ensure your audit tables are up to date."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"php bin/console audit:schema:update --dump-sql\nphp bin/console audit:schema:update --force\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83d\udd27 Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"class-not-found-errors",children:'"Class not found" errors'}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsxs)(n.p,{children:["Ensure all dependencies are updated by running ",(0,i.jsx)(n.code,{children:"composer update"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-issues",children:"Schema issues"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["Run the schema update command: ",(0,i.jsx)(n.code,{children:"php bin/console audit:schema:update --force"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-failures",children:"Test failures"}),"\n",(0,i.jsx)(n.p,{children:"If tests fail after upgrading:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check PHPUnit version compatibility"}),"\n",(0,i.jsx)(n.li,{children:"Review any mocked classes for API changes"}),"\n",(0,i.jsx)(n.li,{children:"Check for deprecated method usage"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-need-help",children:"\u2753 Need Help?"}),"\n",(0,i.jsx)(n.p,{children:"If you encounter issues during the upgrade:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check the ",(0,i.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor/issues",children:"GitHub Issues"})]}),"\n",(0,i.jsxs)(n.li,{children:["Review the ",(0,i.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor/releases",children:"Release Notes"})]}),"\n",(0,i.jsxs)(n.li,{children:["Open a new issue with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PHP version"}),"\n",(0,i.jsx)(n.li,{children:"Symfony version"}),"\n",(0,i.jsx)(n.li,{children:"Error messages"}),"\n",(0,i.jsx)(n.li,{children:"Steps to reproduce"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453(e,n,r){r.d(n,{R:()=>d,x:()=>c});var s=r(96540);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);