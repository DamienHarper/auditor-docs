"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[6931],{7252(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"customization/extra-data","title":"Extra Data","description":"Store additional contextual information in audit entries","source":"@site/docs/auditor-bundle/customization/extra-data.md","sourceDirName":"customization","slug":"/customization/extra-data","permalink":"/auditor-docs/auditor-bundle/customization/extra-data","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorBundleSidebar","previous":{"title":"Role Checker","permalink":"/auditor-docs/auditor-bundle/customization/role-checker"},"next":{"title":"Audit Viewer","permalink":"/auditor-docs/auditor-bundle/viewer/"}}');var a=t(4848),i=t(8453);const d={},s="Extra Data",o={},l=[{value:"\ud83d\udccb Overview",id:"-overview",level:2},{value:"Approach 1: <code>extra_data_provider</code> Config Option",id:"approach-1-extra_data_provider-config-option",level:2},{value:"Enable the Built-in Provider",id:"enable-the-built-in-provider",level:3},{value:"Use a Custom Provider",id:"use-a-custom-provider",level:3},{value:"When to Use This Approach",id:"when-to-use-this-approach",level:3},{value:"Approach 2: <code>LifecycleEvent</code> Listener",id:"approach-2-lifecycleevent-listener",level:2},{value:"With Service Injection",id:"with-service-injection",level:3},{value:"Merging Provider and Listener Data",id:"merging-provider-and-listener-data",level:3},{value:"When to Use This Approach",id:"when-to-use-this-approach-1",level:3},{value:"\ud83d\udcd6 Reading Extra Data",id:"-reading-extra-data",level:2},{value:"\ud83d\udd0d Filtering by Extra Data (JsonFilter)",id:"-filtering-by-extra-data-jsonfilter",level:2},{value:"Supported Operators",id:"supported-operators",level:3},{value:"\ud83d\uddc4\ufe0f Schema Update",id:"\ufe0f-schema-update",level:2},{value:"\u26a0\ufe0f Important Caveats",id:"\ufe0f-important-caveats",level:2},{value:"JSON Encoding (Listener Only)",id:"json-encoding-listener-only",level:3},{value:"Entity State in <code>remove()</code> Operations",id:"entity-state-in-remove-operations",level:3},{value:"Do Not Write to the Audited EntityManager",id:"do-not-write-to-the-audited-entitymanager",level:3},{value:"\ud83d\udcda Full Documentation",id:"-full-documentation",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"extra-data",children:"Extra Data"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Store additional contextual information in audit entries"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"extra_data"})," feature allows you to attach arbitrary supplementary data to each audit entry. This is useful for capturing contextual information that isn't part of the entity's fields, such as route name, request ID, department, role, or any business-specific information."]}),"\n",(0,a.jsx)(n.h2,{id:"-overview",children:"\ud83d\udccb Overview"}),"\n",(0,a.jsxs)(n.p,{children:["Each audit entry has a nullable JSON ",(0,a.jsx)(n.code,{children:"extra_data"})," column. By default, it is ",(0,a.jsx)(n.code,{children:"NULL"})," (zero overhead when not used)."]}),"\n",(0,a.jsx)(n.p,{children:"There are two complementary approaches to populate it:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Approach"}),(0,a.jsx)(n.th,{children:"Scope"}),(0,a.jsx)(n.th,{children:"Use for"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#approach-1-extra_data_provider-config-option",children:(0,a.jsx)(n.code,{children:"extra_data_provider"})})}),(0,a.jsx)(n.td,{children:"Global \u2014 all entries"}),(0,a.jsx)(n.td,{children:"Request-level context: route, request ID, tenant"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsxs)(n.a,{href:"#approach-2-lifecycleevent-listener",children:[(0,a.jsx)(n.code,{children:"LifecycleEvent"})," listener"]})}),(0,a.jsx)(n.td,{children:"Per-entity \u2014 fine-grained"}),(0,a.jsx)(n.td,{children:"Entity-specific data: department, role, entity properties"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Both can be used simultaneously. When they are, the provider runs first and the listener can enrich or override the result."}),"\n",(0,a.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,a.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,a.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,a.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,a.jsxs)(n.p,{children:["This feature is provided by the ",(0,a.jsx)(n.strong,{children:"auditor"})," library. This page shows Symfony-specific integration. For complete documentation, see the ",(0,a.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor",children:"auditor extra-data documentation"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.h2,{id:"approach-1-extra_data_provider-config-option",children:["Approach 1: ",(0,a.jsx)(n.code,{children:"extra_data_provider"})," Config Option"]}),"\n",(0,a.jsxs)(n.p,{children:["The bundle ships a ready-to-use ",(0,a.jsx)(n.code,{children:"ExtraDataProvider"})," service that captures the ",(0,a.jsx)(n.strong,{children:"current route name"})," and stores it in every audit entry."]}),"\n",(0,a.jsx)(n.h3,{id:"enable-the-built-in-provider",children:"Enable the Built-in Provider"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# config/packages/dh_auditor.yaml\ndh_auditor:\n    extra_data_provider: dh_auditor.extra_data_provider\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This stores ",(0,a.jsx)(n.code,{children:'{"route": "app_order_edit"}'})," in ",(0,a.jsx)(n.code,{children:"extra_data"})," for every audit entry produced during an HTTP request. Outside of an HTTP request (e.g. console commands), ",(0,a.jsx)(n.code,{children:"extra_data"})," remains ",(0,a.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"use-a-custom-provider",children:"Use a Custom Provider"}),"\n",(0,a.jsxs)(n.p,{children:["Create your own service that returns ",(0,a.jsx)(n.code,{children:"?array"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Audit;\n\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\nuse Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;\n\nfinal readonly class MyExtraDataProvider\n{\n    public function __construct(\n        private RequestStack $requestStack,\n        private TokenStorageInterface $tokenStorage,\n    ) {}\n\n    public function __invoke(): ?array\n    {\n        $request = $this->requestStack->getCurrentRequest();\n        if (null === $request) {\n            return null;\n        }\n\n        return [\n            'route'      => $request->attributes->get('_route'),\n            'request_id' => $request->headers->get('X-Request-ID'),\n            'user_agent' => $request->headers->get('User-Agent'),\n        ];\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Then reference it in config:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    extra_data_provider: App\\Audit\\MyExtraDataProvider\n"})}),"\n",(0,a.jsx)(n.p,{children:"Or register it programmatically (e.g. in a test or a non-Symfony context):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$auditor->getConfiguration()->setExtraDataProvider(\n    static fn (): ?array => ['route' => 'app_order_edit']\n);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use-this-approach",children:"When to Use This Approach"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Capture the same contextual information for every audit entry (route, tenant, environment\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Simple, zero-boilerplate setup"}),"\n",(0,a.jsxs)(n.li,{children:["Does ",(0,a.jsx)(n.strong,{children:"not"})," have access to the individual entity being audited"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.h2,{id:"approach-2-lifecycleevent-listener",children:["Approach 2: ",(0,a.jsx)(n.code,{children:"LifecycleEvent"})," Listener"]}),"\n",(0,a.jsxs)(n.p,{children:["Create an event listener using Symfony's ",(0,a.jsx)(n.code,{children:"#[AsEventListener]"})," attribute. The listener receives the full payload ",(0,a.jsx)(n.strong,{children:"and"})," the audited entity object, giving you full control."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\EventListener;\n\nuse App\\Entity\\User;\nuse DH\\Auditor\\Event\\LifecycleEvent;\nuse Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener;\n\n#[AsEventListener(event: LifecycleEvent::class, priority: 10)]\nfinal class AuditExtraDataListener\n{\n    public function __invoke(LifecycleEvent $event): void\n    {\n        $payload = $event->getPayload();\n\n        // Filter by entity class\n        if ($payload['entity'] !== User::class || null === $event->entity) {\n            return;\n        }\n\n        // Attach extra data as a JSON string\n        $payload['extra_data'] = json_encode([\n            'department' => $event->entity->getDepartment(),\n            'role'       => $event->entity->getRole(),\n        ], JSON_THROW_ON_ERROR);\n\n        $event->setPayload($payload);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"with-service-injection",children:"With Service Injection"}),"\n",(0,a.jsx)(n.p,{children:"Since the listener is a standard Symfony service, you can inject any dependency:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\EventListener;\n\nuse App\\Entity\\Order;\nuse DH\\Auditor\\Event\\LifecycleEvent;\nuse Symfony\\Bundle\\SecurityBundle\\Security;\nuse Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener;\nuse Symfony\\Component\\HttpFoundation\\RequestStack;\n\n#[AsEventListener(event: LifecycleEvent::class, priority: 10)]\nfinal class OrderAuditExtraDataListener\n{\n    public function __construct(\n        private readonly Security $security,\n        private readonly RequestStack $requestStack,\n    ) {}\n\n    public function __invoke(LifecycleEvent $event): void\n    {\n        $payload = $event->getPayload();\n\n        if ($payload['entity'] !== Order::class) {\n            return;\n        }\n\n        $request = $this->requestStack->getCurrentRequest();\n\n        $payload['extra_data'] = json_encode([\n            'admin_user' => $this->security->getUser()?->getUserIdentifier(),\n            'route'      => $request?->attributes->get('_route'),\n            'reason'     => $request?->headers->get('X-Audit-Reason'),\n        ], JSON_THROW_ON_ERROR);\n\n        $event->setPayload($payload);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"merging-provider-and-listener-data",children:"Merging Provider and Listener Data"}),"\n",(0,a.jsx)(n.p,{children:"When a global provider is also configured, you can merge its result with entity-specific data in the listener:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"public function __invoke(LifecycleEvent $event): void\n{\n    $payload = $event->getPayload();\n\n    if ($payload['entity'] !== User::class) {\n        return;\n    }\n\n    // Decode what the provider already set (if anything)\n    $existing = null !== $payload['extra_data']\n        ? json_decode($payload['extra_data'], true, 512, JSON_THROW_ON_ERROR)\n        : [];\n\n    // Merge entity-specific data on top\n    $merged = array_merge($existing, [\n        'department' => $event->entity->getDepartment(),\n    ]);\n\n    $payload['extra_data'] = json_encode($merged, JSON_THROW_ON_ERROR);\n    $event->setPayload($payload);\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use-this-approach-1",children:"When to Use This Approach"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Attach entity-specific data (e.g. ",(0,a.jsx)(n.code,{children:"$entity->getDepartment()"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Apply ",(0,a.jsx)(n.code,{children:"extra_data"})," only to certain entity classes"]}),"\n",(0,a.jsxs)(n.li,{children:["Conditionally skip ",(0,a.jsx)(n.code,{children:"extra_data"})," based on entity state"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-reading-extra-data",children:"\ud83d\udcd6 Reading Extra Data"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"Entry"})," model provides access via the ",(0,a.jsx)(n.code,{children:"extraData"})," property or the ",(0,a.jsx)(n.code,{children:"getExtraData()"})," method:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$reader = new Reader($provider);\n$entries = $reader->createQuery(User::class)->execute();\n\nforeach ($entries as $entry) {\n    $extraData = $entry->extraData; // ?array (decoded JSON)\n\n    if (null !== $extraData) {\n        echo sprintf(\n            \"Route: %s, Department: %s\\n\",\n            $extraData['route'] ?? 'N/A',\n            $extraData['department'] ?? 'N/A',\n        );\n    }\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-filtering-by-extra-data-jsonfilter",children:"\ud83d\udd0d Filtering by Extra Data (JsonFilter)"}),"\n",(0,a.jsxs)(n.p,{children:["You can filter audit entries by ",(0,a.jsx)(n.code,{children:"extra_data"})," content using the ",(0,a.jsx)(n.code,{children:"JsonFilter"})," class:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter;\n\n$reader = new Reader($provider);\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Filter by exact value\n$query->addFilter(new JsonFilter('extra_data', 'route', 'app_user_edit'));\n\n// Filter with LIKE pattern\n$query->addFilter(new JsonFilter('extra_data', 'department', 'IT%', 'LIKE'));\n\n// Filter by multiple values (IN)\n$query->addFilter(new JsonFilter('extra_data', 'status', ['active', 'pending'], 'IN'));\n\n// Nested JSON path\n$query->addFilter(new JsonFilter('extra_data', 'user.role', 'admin'));\n\n$entries = $query->execute();\n"})}),"\n",(0,a.jsx)(n.h3,{id:"supported-operators",children:"Supported Operators"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Operator"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Example"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"="})}),(0,a.jsx)(n.td,{children:"Exact match (default)"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', 'IT')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"!="})}),(0,a.jsx)(n.td,{children:"Not equal"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', 'IT', '!=')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"LIKE"})}),(0,a.jsx)(n.td,{children:"Pattern matching"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', 'IT%', 'LIKE')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"NOT LIKE"})}),(0,a.jsx)(n.td,{children:"Negative pattern"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', '%temp%', 'NOT LIKE')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"IN"})}),(0,a.jsx)(n.td,{children:"Multiple values"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', ['IT', 'HR'], 'IN')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"NOT IN"})}),(0,a.jsx)(n.td,{children:"Exclude values"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', ['IT'], 'NOT IN')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"IS NULL"})}),(0,a.jsx)(n.td,{children:"Value is null"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', null, 'IS NULL')"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"IS NOT NULL"})}),(0,a.jsx)(n.td,{children:"Value exists"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"new JsonFilter('extra_data', 'dept', null, 'IS NOT NULL')"})})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-schema-update",children:"\ud83d\uddc4\ufe0f Schema Update"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"extra_data"})," column is added automatically when you run the schema update command:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Preview the SQL that will be executed\nphp bin/console audit:schema:update --dump-sql\n\n# Apply the change\nphp bin/console audit:schema:update --force\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-important-caveats",children:"\u26a0\ufe0f Important Caveats"}),"\n",(0,a.jsx)(n.h3,{id:"json-encoding-listener-only",children:"JSON Encoding (Listener Only)"}),"\n",(0,a.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,a.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,a.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,a.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,a.jsxs)(n.p,{children:["When setting ",(0,a.jsx)(n.code,{children:"extra_data"})," in a ",(0,a.jsx)(n.strong,{children:"listener"}),", the value must be either ",(0,a.jsx)(n.code,{children:"null"})," or a ",(0,a.jsx)(n.strong,{children:"JSON-encoded string"})," (not an array). Always use ",(0,a.jsx)(n.code,{children:"json_encode()"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u2705 Correct\n$payload['extra_data'] = json_encode(['key' => 'value'], JSON_THROW_ON_ERROR);\n\n// \u274c Incorrect - will not be stored properly\n$payload['extra_data'] = ['key' => 'value'];\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"extra_data_provider"})," callable is exempt from this rule \u2014 return a plain ",(0,a.jsx)(n.code,{children:"?array"})," and encoding is handled automatically."]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"entity-state-in-remove-operations",children:["Entity State in ",(0,a.jsx)(n.code,{children:"remove()"})," Operations"]}),"\n",(0,a.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,a.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,a.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,a.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,a.jsxs)(n.p,{children:["During a ",(0,a.jsx)(n.code,{children:"remove"})," operation, the entity object is still in memory but has been ",(0,a.jsx)(n.strong,{children:"detached from the Unit of Work"}),"."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Direct property access works (e.g., ",(0,a.jsx)(n.code,{children:"$entity->getName()"}),")"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Lazy-loaded associations may not be accessible"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"If you need association data during deletions, ensure those associations are eagerly loaded or fetch the data before the flush."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"do-not-write-to-the-audited-entitymanager",children:"Do Not Write to the Audited EntityManager"}),"\n",(0,a.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",dir:"auto",children:["\n",(0,a.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,a.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,a.jsx)(n.path,{d:"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"CAUTION"]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"LifecycleEvent"})," is dispatched ",(0,a.jsx)(n.strong,{children:"during"})," a flush. The listener executes synchronously within the same database transaction."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SELECTs are safe"})," (reading from another entity manager or connection)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"INSERT/UPDATE/DELETE on the audited EntityManager will interfere"})," with the ongoing flush"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"If you need to perform write operations based on audit data, defer them (e.g., using Symfony Messenger)."}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-full-documentation",children:"\ud83d\udcda Full Documentation"}),"\n",(0,a.jsxs)(n.p,{children:["For complete documentation including database-specific indexing strategies, performance considerations, and advanced filtering options, see the ",(0,a.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor",children:"auditor extra-data documentation"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>d,x:()=>s});var r=t(6540);const a={},i=r.createContext(a);function d(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);