"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[5965],{5209(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"usage/schema-manipulation","title":"Schema","description":"Creating audit tables","source":"@site/auditor-bundle_versioned_docs/version-6.x/usage/schema-manipulation.md","sourceDirName":"usage","slug":"/usage/schema-manipulation","permalink":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation","draft":false,"unlisted":false,"tags":[],"version":"6.x","frontMatter":{"title":"Schema"},"sidebar":"docs","previous":{"title":"Querying audits","permalink":"/auditor-docs/auditor-bundle/6.x/usage/querying"},"next":{"title":"Audit viewer","permalink":"/auditor-docs/auditor-bundle/6.x/usage/viewer"}}');var t=s(4848),i=s(8453);const o={title:"Schema"},c=void 0,r={},d=[{value:"Creating audit tables",id:"creating-audit-tables",level:2},{value:"Single storage service setup (most common use case)",id:"single-storage-service-setup-most-common-use-case",level:3},{value:"Using DoctrineMigrationsBundle",id:"using-doctrinemigrationsbundle",level:4},{value:"Using Doctrine Schema",id:"using-doctrine-schema",level:4},{value:"Multiple storage services setup",id:"multiple-storage-services-setup",level:3},{value:"Updating the schema",id:"updating-the-schema",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"creating-audit-tables",children:"Creating audit tables"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,t.jsx)(n.p,{children:"The process of audit table creation differs depending on your current setup:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"single"})," storage service setup: audit tables are stored in the ",(0,t.jsx)(n.strong,{children:"same"})," database than audited ones (most common use case)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"multiple"})," storage services setup: audit tables are stored in a ",(0,t.jsx)(n.strong,{children:"multiple"})," databases"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"single-storage-service-setup-most-common-use-case",children:"Single storage service setup (most common use case)"}),"\n",(0,t.jsx)(n.p,{children:"Open a command console, enter your project directory and execute the\nfollowing command to review the new audit tables in the update schema queue."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console doctrine:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console doctrine:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.h4,{id:"using-doctrinemigrationsbundle",children:"Using DoctrineMigrationsBundle"}),"\n",(0,t.jsxs)(n.p,{children:["see ",(0,t.jsx)(n.a,{href:"http://symfony.com/doc/current/bundles/DoctrineMigrationsBundle/index.html",children:"DoctrineMigrationsBundle"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console doctrine:migrations:diff\napp/console doctrine:migrations:migrate\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console doctrine:migrations:diff\nbin/console doctrine:migrations:migrate\n"})}),"\n",(0,t.jsx)(n.h4,{id:"using-doctrine-schema",children:"Using Doctrine Schema"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console doctrine:schema:update --force\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console doctrine:schema:update --force\n"})}),"\n",(0,t.jsx)(n.h3,{id:"multiple-storage-services-setup",children:"Multiple storage services setup"}),"\n",(0,t.jsxs)(n.p,{children:["Doctrine ",(0,t.jsx)(n.code,{children:"Schema-Tool"})," and ",(0,t.jsx)(n.code,{children:"DoctrineMigrationsBundle"})," are not able to work with more than one\ndatabase at once. To workaround that limitation, this bundle offers a migration command that\nfocuses on audit schema manipulation."]}),"\n",(0,t.jsx)(n.p,{children:"Open a command console, enter your project directory and execute the following command to\nreview the new audit tables in the update schema queue."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console audit:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console audit:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.p,{children:"Once you're done, execute the following command to apply."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console audit:schema:update --force\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console audit:schema:update --force\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"updating-the-schema",children:"Updating the schema"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,t.jsxs)(n.p,{children:["After updating ",(0,t.jsx)(n.code,{children:"auditor"})," library of ",(0,t.jsx)(n.code,{children:"auditor-bundle"}),", the schema might need to be updated,\nyou can do so by using the ",(0,t.jsx)(n.code,{children:"audit:schema:update"})," command."]}),"\n",(0,t.jsx)(n.p,{children:"This ensures that:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"all audit tables are created"}),"\n",(0,t.jsx)(n.li,{children:"all audit tables have the expected structure and updates them if needed"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Open a command console, enter your project directory and execute the following command to\nreview the new audit tables in the update schema queue."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console audit:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console audit:schema:update --dump-sql \n"})}),"\n",(0,t.jsx)(n.p,{children:"Once you're done, execute the following command to apply."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console audit:schema:update --force\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console audit:schema:update --force\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>c});var a=s(6540);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);