"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[1851],{85861(e,n,i){i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>c});const d=JSON.parse('{"id":"upgrading","title":"Upgrading","description":"Jump to the Upgrading from a previous version section","source":"@site/auditor_versioned_docs/version-3.x/upgrading.md","sourceDirName":".","slug":"/upgrading","permalink":"/auditor-docs/auditor/3.x/upgrading","draft":false,"unlisted":false,"tags":[],"version":"3.x","frontMatter":{"title":"Upgrading"},"sidebar":"docs","previous":{"title":"Release Notes","permalink":"/auditor-docs/auditor/3.x/release-notes"}}');var r=i(74848),t=i(28453);const o={title:"Upgrading"},a=void 0,s={},c=[{value:"Upgrading from <code>DoctrineAuditBundle</code>",id:"upgrading-from-doctrineauditbundle",level:2},{value:"1. Configuration file",id:"1-configuration-file",level:3},{value:"2. Add <code>auditor-bundle</code> as a dependency",id:"2-add-auditor-bundle-as-a-dependency",level:3},{value:"3. Fix annotation namespace changes",id:"3-fix-annotation-namespace-changes",level:3},{value:"4. Fix route name changes",id:"4-fix-route-name-changes",level:3},{value:"5. <code>AuditReader</code> deprecation",id:"5-auditreader-deprecation",level:3},{value:"6. Remove <code>DoctrineAuditBundle</code>",id:"6-remove-doctrineauditbundle",level:3},{value:"7. Ensure your schema is up to date",id:"7-ensure-your-schema-is-up-to-date",level:3},{value:"Upgrading from a previous version",id:"upgrading-from-a-previous-version",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Jump to the ",(0,r.jsx)(n.a,{href:"upgrading.html#upgrading-from-a-previous-version",children:"Upgrading from a previous version"})," section\nif you're not upgrading from ",(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})]}),"\n",(0,r.jsxs)(n.h2,{id:"upgrading-from-doctrineauditbundle",children:["Upgrading from ",(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})," is now deprecated since it has been split into two separate packages"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"auditor"})," the core library"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"auditor-bundle"})," a Symfony bundle providing ",(0,r.jsx)(n.code,{children:"auditor"})," integration into Symfony applications"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["So, upgrading from ",(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})," to ",(0,r.jsx)(n.code,{children:"auditor"})," + ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," requires a few steps"]}),"\n",(0,r.jsx)(n.h3,{id:"1-configuration-file",children:"1. Configuration file"}),"\n",(0,r.jsxs)(n.p,{children:["Create a new configuration file ",(0,r.jsx)(n.code,{children:"dh_auditor.yaml"}),"\n(full configuration reference available ",(0,r.jsx)(n.a,{href:"../auditor-bundle/configuration/reference.html",children:"here"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"Minimal config file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    enabled: true\n    providers:\n        doctrine:\n            table_prefix: ~\n            table_suffix: '_audit'\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"2-add-auditor-bundle-as-a-dependency",children:["2. Add ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," as a dependency"]}),"\n",(0,r.jsx)(n.p,{children:"Run the following command in a console"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"composer require damienharper/auditor-bundle ^4.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-fix-annotation-namespace-changes",children:"3. Fix annotation namespace changes"}),"\n",(0,r.jsxs)(n.p,{children:["Replace the ",(0,r.jsx)(n.code,{children:"use"})," statement related to ",(0,r.jsx)(n.code,{children:"Audit"})," annotation to reference the new namespace in your entities."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff-php",children:"- use DH\\DoctrineAuditBundle\\Annotation as Audit;\n+ use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-fix-route-name-changes",children:"4. Fix route name changes"}),"\n",(0,r.jsxs)(n.p,{children:["Reference the new routes in the ",(0,r.jsx)(n.code,{children:"config/routes.yaml"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff-yaml",children:'- dh_doctrine_audit:\n-     resource: "@DHDoctrineAuditBundle/Controller/"\n-     type: annotation\n+ dh_auditor:\n+     resource: "@DHAuditorBundle/Controller/"\n+     type: annotation\n'})}),"\n",(0,r.jsx)(n.p,{children:"Route names have been renamed, change them accordingly in your code.\nYou'll find below a summary of route name changes."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.th,{style:{textAlign:"left"},children:["Before (",(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})," route name)"]}),(0,r.jsxs)(n.th,{style:{textAlign:"left"},children:["After (",(0,r.jsx)(n.code,{children:"auditor-bundle"})," route name)"]})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_doctrine_audit_list_audits"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_auditor_list_audits"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_doctrine_audit_show_transaction"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_auditor_show_transaction"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_doctrine_audit_show_entity_history"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"dh_auditor_show_entity_history"})})]})]})]}),"\n",(0,r.jsxs)(n.h3,{id:"5-auditreader-deprecation",children:["5. ",(0,r.jsx)(n.code,{children:"AuditReader"})," deprecation"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"AuditReader"})," has been replaced by ",(0,r.jsx)(n.code,{children:"Reader"})," and ",(0,r.jsx)(n.code,{children:"Query"})," objects, so if you used it to query\nthe audit logs, dive into the ",(0,r.jsx)(n.a,{href:"../auditor-bundle/usage/querying.html",children:"Querying audits section"})]}),"\n",(0,r.jsxs)(n.h3,{id:"6-remove-doctrineauditbundle",children:["6. Remove ",(0,r.jsx)(n.code,{children:"DoctrineAuditBundle"})]}),"\n",(0,r.jsx)(n.p,{children:"Run the following command in a console"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"composer remove damienharper/doctrine-audit-bundle\n"})}),"\n",(0,r.jsx)(n.h3,{id:"7-ensure-your-schema-is-up-to-date",children:"7. Ensure your schema is up to date"}),"\n",(0,r.jsxs)(n.p,{children:["Check the ",(0,r.jsx)(n.a,{href:"upgrading.html#upgrading-from-a-previous-version",children:"Upgrading from a previous version"}),"\nbelow to ensure your schema is up to date."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"upgrading-from-a-previous-version",children:"Upgrading from a previous version"}),"\n",(0,r.jsx)(n.p,{children:"Once you upgraded the bundle to a newer version, you first have to\nbe sure your current schema is up to date and upgrade it if necessary."}),"\n",(0,r.jsx)(n.p,{children:"The following command does all of this for you:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# symfony < 3.4\napp/console audit:schema:update --force\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# symfony >= 3.4\nbin/console audit:schema:update --force\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453(e,n,i){i.d(n,{R:()=>o,x:()=>a});var d=i(96540);const r={},t=d.createContext(r);function o(e){const n=d.useContext(t);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),d.createElement(t.Provider,{value:n},e.children)}}}]);