"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[7e3],{3380(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"upgrade/v3","title":"Upgrading to 3.x from 2.x","description":"Migrate from annotations to PHP 8 attributes","source":"@site/docs/auditor/upgrade/v3.md","sourceDirName":"upgrade","slug":"/upgrade/v3","permalink":"/auditor-docs/auditor/upgrade/v3","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Upgrade Guide","permalink":"/auditor-docs/auditor/upgrade/"},"next":{"title":"Upgrading to 4.x from 3.x","permalink":"/auditor-docs/auditor/upgrade/v4"}}');var t=i(4848),s=i(8453);const a={},d="Upgrading to 3.x from 2.x",o={},l=[{value:"\u26a0\ufe0f Requirements Changes",id:"\ufe0f-requirements-changes",level:2},{value:"PHP Version",id:"php-version",level:3},{value:"Symfony Version",id:"symfony-version",level:3},{value:"Doctrine Versions",id:"doctrine-versions",level:3},{value:"\ud83d\udd11 Key Changes",id:"-key-changes",level:2},{value:"PHP 8 Attributes",id:"php-8-attributes",level:3},{value:"Type Declarations",id:"type-declarations",level:3},{value:"Read-Only Properties",id:"read-only-properties",level:3},{value:"\ud83d\udccb Migration Steps",id:"-migration-steps",level:2},{value:"1\ufe0f\u20e3 Update PHP Version",id:"1\ufe0f\u20e3-update-php-version",level:3},{value:"2\ufe0f\u20e3 Update Dependencies",id:"2\ufe0f\u20e3-update-dependencies",level:3},{value:"3\ufe0f\u20e3 Convert Annotations to Attributes",id:"3\ufe0f\u20e3-convert-annotations-to-attributes",level:3},{value:"4\ufe0f\u20e3 Update Configuration",id:"4\ufe0f\u20e3-update-configuration",level:3},{value:"5\ufe0f\u20e3 Run Tests",id:"5\ufe0f\u20e3-run-tests",level:3},{value:"\u2753 Need Help?",id:"-need-help",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"upgrading-to-3x-from-2x",children:"Upgrading to 3.x from 2.x"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Migrate from annotations to PHP 8 attributes"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This document describes the changes when upgrading from auditor 2.x to 3.x."}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-requirements-changes",children:"\u26a0\ufe0f Requirements Changes"}),"\n",(0,t.jsx)(n.h3,{id:"php-version",children:"PHP Version"}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Minimum PHP version is 8.2"})," (was 7.4 in 2.x)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"symfony-version",children:"Symfony Version"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Minimum Symfony version is 5.4"})," (was 4.4 in 2.x)"]}),"\n",(0,t.jsx)(n.p,{children:"Symfony 6.x and 7.x are also supported."}),"\n",(0,t.jsx)(n.h3,{id:"doctrine-versions",children:"Doctrine Versions"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Package"}),(0,t.jsx)(n.th,{children:"2.x Version"}),(0,t.jsx)(n.th,{children:"3.x Version"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Doctrine DBAL"}),(0,t.jsx)(n.td,{children:"Mixed"}),(0,t.jsx)(n.td,{children:">= 3.2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Doctrine ORM"}),(0,t.jsx)(n.td,{children:"Mixed"}),(0,t.jsx)(n.td,{children:">= 2.13"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-key-changes",children:"\ud83d\udd11 Key Changes"}),"\n",(0,t.jsx)(n.h3,{id:"php-8-attributes",children:"PHP 8 Attributes"}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,t.jsx)(n.p,{children:"3.x uses native PHP 8 attributes instead of Doctrine annotations."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Before (2.x with annotations):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\n\n/**\n * @Audit\\Auditable\n * @Audit\\Security(view={"ROLE_ADMIN"})\n */\nclass User\n{\n    /**\n     * @Audit\\Ignore\n     */\n    private string $password;\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"After (3.x with attributes):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security;\n\n#[Auditable]\n#[Security(view: ['ROLE_ADMIN'])]\nclass User\n{\n    #[Ignore]\n    private string $password;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"type-declarations",children:"Type Declarations"}),"\n",(0,t.jsx)(n.p,{children:"All classes now use strict type declarations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"declare(strict_types=1);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Method signatures have return types and parameter types."}),"\n",(0,t.jsx)(n.h3,{id:"read-only-properties",children:"Read-Only Properties"}),"\n",(0,t.jsx)(n.p,{children:"Many classes now use PHP 8.1+ readonly properties:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"final readonly class Reader implements ReaderInterface\n{\n    public function __construct(private DoctrineProvider $provider) {}\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-migration-steps",children:"\ud83d\udccb Migration Steps"}),"\n",(0,t.jsx)(n.h3,{id:"1\ufe0f\u20e3-update-php-version",children:"1\ufe0f\u20e3 Update PHP Version"}),"\n",(0,t.jsx)(n.p,{children:"Ensure you're running PHP 8.2 or higher:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"php -v\n# PHP 8.2.x ...\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2\ufe0f\u20e3-update-dependencies",children:"2\ufe0f\u20e3 Update Dependencies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"composer require damienharper/auditor:^3.0\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3\ufe0f\u20e3-convert-annotations-to-attributes",children:"3\ufe0f\u20e3 Convert Annotations to Attributes"}),"\n",(0,t.jsx)(n.p,{children:"Replace all Doctrine annotations with PHP 8 attributes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Find files with old annotations\ngrep -r "@Audit\\\\\\\\" src/Entity/\n'})}),"\n",(0,t.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,t.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,t.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,t.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,t.jsx)(n.p,{children:"Then update each entity to use the new attribute syntax."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"4\ufe0f\u20e3-update-configuration",children:"4\ufe0f\u20e3 Update Configuration"}),"\n",(0,t.jsx)(n.p,{children:"If you have any configuration arrays, ensure they use the current option names."}),"\n",(0,t.jsx)(n.h3,{id:"5\ufe0f\u20e3-run-tests",children:"5\ufe0f\u20e3 Run Tests"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/phpunit\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-need-help",children:"\u2753 Need Help?"}),"\n",(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor",children:"GitHub repository"})," for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Release notes"}),"\n",(0,t.jsx)(n.li,{children:"Open issues"}),"\n",(0,t.jsx)(n.li,{children:"Discussions"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>d});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);