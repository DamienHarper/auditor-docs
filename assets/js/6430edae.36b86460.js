"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[1905],{9398(e,n,r){r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"querying/filters","title":"Filters Reference","description":"Narrow down audit query results with powerful filters","source":"@site/docs/auditor/querying/filters.md","sourceDirName":"querying","slug":"/querying/filters","permalink":"/auditor-docs/auditor/querying/filters","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Entry Model Reference","permalink":"/auditor-docs/auditor/querying/entry"},"next":{"title":"Console Commands","permalink":"/auditor-docs/auditor/commands/"}}');var i=r(4848),l=r(8453);const a={},d="Filters Reference",s={},c=[{value:"\ud83d\udccb Overview",id:"-overview",level:2},{value:"\ud83d\udd0c Filter Interface",id:"-filter-interface",level:2},{value:"\ud83c\udfaf SimpleFilter",id:"-simplefilter",level:2},{value:"Namespace",id:"namespace",level:3},{value:"Constructor",id:"constructor",level:3},{value:"Single Value",id:"single-value",level:3},{value:"Multiple Values (OR)",id:"multiple-values-or",level:3},{value:"Generated SQL",id:"generated-sql",level:3},{value:"Methods",id:"methods",level:3},{value:"\ud83d\udcc5 DateRangeFilter",id:"-daterangefilter",level:2},{value:"Namespace",id:"namespace-1",level:3},{value:"Constructor",id:"constructor-1",level:3},{value:"Both Bounds",id:"both-bounds",level:3},{value:"Lower Bound Only",id:"lower-bound-only",level:3},{value:"Upper Bound Only",id:"upper-bound-only",level:3},{value:"Common Patterns",id:"common-patterns",level:3},{value:"Generated SQL",id:"generated-sql-1",level:3},{value:"Validation",id:"validation",level:3},{value:"Methods",id:"methods-1",level:3},{value:"\ud83d\udd22 RangeFilter",id:"-rangefilter",level:2},{value:"Namespace",id:"namespace-2",level:3},{value:"Constructor",id:"constructor-2",level:3},{value:"Both Bounds",id:"both-bounds-1",level:3},{value:"Lower Bound Only",id:"lower-bound-only-1",level:3},{value:"Upper Bound Only",id:"upper-bound-only-1",level:3},{value:"Validation",id:"validation-1",level:3},{value:"Generated SQL",id:"generated-sql-2",level:3},{value:"Methods",id:"methods-2",level:3},{value:"\ud83d\udeab NullFilter",id:"-nullfilter",level:2},{value:"Namespace",id:"namespace-3",level:3},{value:"Constructor",id:"constructor-3",level:3},{value:"Usage",id:"usage",level:3},{value:"Generated SQL",id:"generated-sql-3",level:3},{value:"Methods",id:"methods-3",level:3},{value:"\ud83d\udd00 Combining Filters",id:"-combining-filters",level:2},{value:"Same Column Multiple Filters",id:"same-column-multiple-filters",level:3},{value:"\ud83d\udccb Supported Filter Columns",id:"-supported-filter-columns",level:2},{value:"\ud83d\udd0e JsonFilter",id:"-jsonfilter",level:2},{value:"Namespace",id:"namespace-4",level:3},{value:"Constructor",id:"constructor-4",level:3},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Supported Operators",id:"supported-operators",level:3},{value:"Nested JSON Paths",id:"nested-json-paths",level:3},{value:"Database Support",id:"database-support",level:3},{value:"Fallback Behavior",id:"fallback-behavior",level:3},{value:"Strict Mode",id:"strict-mode",level:3},{value:"Limitations",id:"limitations",level:3},{value:"Generated SQL Examples",id:"generated-sql-examples",level:3},{value:"\ud83e\udde9 Custom Filter Example",id:"-custom-filter-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"filters-reference",children:"Filters Reference"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Narrow down audit query results with powerful filters"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Filters allow you to narrow down audit query results. This page documents all available filter types."}),"\n",(0,i.jsx)(n.h2,{id:"-overview",children:"\ud83d\udccb Overview"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Filter"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Example Use Case"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SimpleFilter"})}),(0,i.jsx)(n.td,{children:"Exact value matching"}),(0,i.jsx)(n.td,{children:"Filter by type, user, entity ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DateRangeFilter"})}),(0,i.jsx)(n.td,{children:"Date/time range"}),(0,i.jsx)(n.td,{children:"Audits from last week"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RangeFilter"})}),(0,i.jsx)(n.td,{children:"Numeric range"}),(0,i.jsx)(n.td,{children:"Audits with ID >= 1000"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NullFilter"})}),(0,i.jsx)(n.td,{children:"NULL value matching"}),(0,i.jsx)(n.td,{children:"Audits by anonymous users"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"JsonFilter"})}),(0,i.jsx)(n.td,{children:"JSON column content"}),(0,i.jsx)(n.td,{children:"Filter by extra_data values"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-filter-interface",children:"\ud83d\udd0c Filter Interface"}),"\n",(0,i.jsxs)(n.p,{children:["All filters implement ",(0,i.jsx)(n.code,{children:"FilterInterface"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter;\n\ninterface FilterInterface\n{\n    public function getName(): string;\n    \n    public function getSQL(): array;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-simplefilter",children:"\ud83c\udfaf SimpleFilter"}),"\n",(0,i.jsx)(n.p,{children:"The most common filter for exact value matching."}),"\n",(0,i.jsx)(n.h3,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    private readonly string $name,   // Column name\n    private mixed $value             // Value or array of values\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"single-value",children:"Single Value"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Filter by type\n$query->addFilter(new SimpleFilter(Query::TYPE, 'update'));\n\n// Filter by object ID\n$query->addFilter(new SimpleFilter(Query::OBJECT_ID, '123'));\n\n// Filter by user ID\n$query->addFilter(new SimpleFilter(Query::USER_ID, 42));\n\n// Filter by transaction hash\n$query->addFilter(new SimpleFilter(Query::TRANSACTION_HASH, 'abc123...'));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"multiple-values-or",children:"Multiple Values (OR)"}),"\n",(0,i.jsxs)(n.p,{children:["When providing an array, it generates an ",(0,i.jsx)(n.code,{children:"IN"})," clause:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// type IN ('insert', 'update')\n$query->addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));\n\n// object_id IN ('1', '2', '3')\n$query->addFilter(new SimpleFilter(Query::OBJECT_ID, ['1', '2', '3']));\n\n// blame_id IN (10, 20, 30)\n$query->addFilter(new SimpleFilter(Query::USER_ID, [10, 20, 30]));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generated-sql",children:"Generated SQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new SimpleFilter('type', 'update');\n$sql = $filter->getSQL();\n// Returns: ['sql' => 'type = :type', 'params' => ['type' => 'update']]\n\n$filter = new SimpleFilter('type', ['insert', 'update']);\n$sql = $filter->getSQL();\n// Returns: ['sql' => 'type IN (:type)', 'params' => ['type' => ['insert', 'update']]]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"methods",children:"Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new SimpleFilter(Query::TYPE, 'update');\n\n$filter->getName();   // 'type'\n$filter->getValue();  // 'update' or ['insert', 'update']\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-daterangefilter",children:"\ud83d\udcc5 DateRangeFilter"}),"\n",(0,i.jsx)(n.p,{children:"Filter by date/time range."}),"\n",(0,i.jsx)(n.h3,{id:"namespace-1",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor-1",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    private string $name,                    // Column name\n    ?\\DateTimeInterface $minValue,           // Lower bound (inclusive)\n    ?\\DateTimeInterface $maxValue = null     // Upper bound (inclusive)\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"both-bounds",children:"Both Bounds"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Audits between two dates\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('2024-01-01'),\n    new \\DateTime('2024-12-31')\n));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"lower-bound-only",children:"Lower Bound Only"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Audits since January 1st\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('2024-01-01'),\n    null\n));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"upper-bound-only",children:"Upper Bound Only"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Audits before July 1st\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    null,\n    new \\DateTime('2024-07-01')\n));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Last 24 hours\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('-24 hours'),\n    new \\DateTime('now')\n));\n\n// Last 7 days\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('-7 days'),\n    new \\DateTime('now')\n));\n\n// This month\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('first day of this month'),\n    new \\DateTime('last day of this month')\n));\n\n// Specific business hours\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('2024-01-15 09:00:00'),\n    new \\DateTime('2024-01-15 17:00:00')\n));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generated-sql-1",children:"Generated SQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new DateRangeFilter(\n    'created_at',\n    new \\DateTime('2024-01-01'),\n    new \\DateTime('2024-12-31')\n);\n$sql = $filter->getSQL();\n// Returns:\n// [\n//     'sql' => 'created_at >= :min_created_at AND created_at <= :max_created_at',\n//     'params' => [\n//         'min_created_at' => '2024-01-01 00:00:00',\n//         'max_created_at' => '2024-12-31 00:00:00'\n//     ]\n// ]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,i.jsxs)(n.p,{children:["The filter validates that ",(0,i.jsx)(n.code,{children:"minValue"})," is not after ",(0,i.jsx)(n.code,{children:"maxValue"}),". Providing an invalid range will throw an ",(0,i.jsx)(n.code,{children:"InvalidArgumentException"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// This throws InvalidArgumentException\nnew DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('2024-12-31'),  // Later date as min\n    new \\DateTime('2024-01-01')   // Earlier date as max\n);\n// Error: Max bound has to be later than min bound.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"methods-1",children:"Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new DateRangeFilter(Query::CREATED_AT, $min, $max);\n\n$filter->getName();      // 'created_at'\n$filter->getMinValue();  // DateTimeInterface|null\n$filter->getMaxValue();  // DateTimeInterface|null\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-rangefilter",children:"\ud83d\udd22 RangeFilter"}),"\n",(0,i.jsx)(n.p,{children:"Filter by numeric range."}),"\n",(0,i.jsx)(n.h3,{id:"namespace-2",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor-2",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    private string $name,    // Column name\n    mixed $minValue,         // Lower bound (inclusive)\n    mixed $maxValue = null   // Upper bound (inclusive)\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"both-bounds-1",children:"Both Bounds"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Audits with ID between 100 and 200\n$query->addFilter(new RangeFilter(Query::ID, 100, 200));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"lower-bound-only-1",children:"Lower Bound Only"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Audits with ID >= 1000\n$query->addFilter(new RangeFilter(Query::ID, 1000, null));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"upper-bound-only-1",children:"Upper Bound Only"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Audits with ID <= 500\n$query->addFilter(new RangeFilter(Query::ID, null, 500));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"validation-1",children:"Validation"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:["At least one bound must be provided. Providing neither will throw an ",(0,i.jsx)(n.code,{children:"InvalidArgumentException"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// This throws InvalidArgumentException\nnew RangeFilter(Query::ID, null, null);\n// Error: You must provide at least one of the two range bounds.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generated-sql-2",children:"Generated SQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new RangeFilter('id', 100, 200);\n$sql = $filter->getSQL();\n// Returns:\n// [\n//     'sql' => 'id >= :min_id AND id <= :max_id',\n//     'params' => ['min_id' => 100, 'max_id' => 200]\n// ]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"methods-2",children:"Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new RangeFilter(Query::ID, 100, 200);\n\n$filter->getName();      // 'id'\n$filter->getMinValue();  // 100\n$filter->getMaxValue();  // 200\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-nullfilter",children:"\ud83d\udeab NullFilter"}),"\n",(0,i.jsx)(n.p,{children:"Filter for NULL values."}),"\n",(0,i.jsx)(n.h3,{id:"namespace-3",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\NullFilter;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor-3",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    private readonly string $name   // Column name\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\NullFilter;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Filter audits made by anonymous users (no blame_id)\n$query->addFilter(new NullFilter(Query::USER_ID));\n\n// Filter audits without discriminator\n$query->addFilter(new NullFilter(Query::DISCRIMINATOR));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generated-sql-3",children:"Generated SQL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new NullFilter('blame_id');\n$sql = $filter->getSQL();\n// Returns: ['sql' => 'blame_id IS NULL', 'params' => []]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"methods-3",children:"Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$filter = new NullFilter(Query::USER_ID);\n\n$filter->getName();  // 'blame_id'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-combining-filters",children:"\ud83d\udd00 Combining Filters"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsx)(n.p,{children:"You can add multiple filters to a query. Filters are combined with AND."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Type is 'update' AND user is 42 AND in date range\n$query->addFilter(new SimpleFilter(Query::TYPE, 'update'));\n$query->addFilter(new SimpleFilter(Query::USER_ID, 42));\n$query->addFilter(new DateRangeFilter(\n    Query::CREATED_AT,\n    new \\DateTime('-7 days'),\n    new \\DateTime('now')\n));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"same-column-multiple-filters",children:"Same Column Multiple Filters"}),"\n",(0,i.jsx)(n.p,{children:"Multiple filters on the same column are merged:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// These are equivalent:\n$query->addFilter(new SimpleFilter(Query::TYPE, 'insert'));\n$query->addFilter(new SimpleFilter(Query::TYPE, 'update'));\n\n// Becomes: type IN ('insert', 'update')\n\n// Same as:\n$query->addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-supported-filter-columns",children:"\ud83d\udccb Supported Filter Columns"}),"\n",(0,i.jsx)(n.p,{children:"The following columns can be filtered:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Column"}),(0,i.jsx)(n.th,{children:"Constant"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::ID"})}),(0,i.jsx)(n.td,{children:"Audit entry primary key"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::TYPE"})}),(0,i.jsx)(n.td,{children:"Action type"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"object_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::OBJECT_ID"})}),(0,i.jsx)(n.td,{children:"Audited entity ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"discriminator"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::DISCRIMINATOR"})}),(0,i.jsx)(n.td,{children:"Entity class for inheritance"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transaction_hash"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::TRANSACTION_HASH"})}),(0,i.jsx)(n.td,{children:"Transaction identifier"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"blame_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::USER_ID"})}),(0,i.jsx)(n.td,{children:"User ID who made the change"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"created_at"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::CREATED_AT"})}),(0,i.jsx)(n.td,{children:"When the audit was created"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"json"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Query::JSON"})}),(0,i.jsx)(n.td,{children:"JSON column content (extra_data)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-jsonfilter",children:"\ud83d\udd0e JsonFilter"}),"\n",(0,i.jsx)(n.p,{children:"Filter by JSON column content. Generates platform-specific SQL for optimal performance."}),"\n",(0,i.jsx)(n.h3,{id:"namespace-4",children:"Namespace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor-4",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __construct(\n    private readonly string $column,    // JSON column name (e.g., 'extra_data')\n    private readonly string $path,      // JSON path (e.g., 'department' or 'user.role')\n    private readonly mixed $value,      // Value to match\n    private readonly string $operator = '=',  // Comparison operator\n    private readonly bool $strict = false     // Throw exception if JSON not supported\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query;\n\n$query = $reader->createQuery(User::class, ['page_size' => null]);\n\n// Filter by exact value\n$query->addFilter(new JsonFilter('extra_data', 'department', 'IT'));\n\n$entries = $query->execute();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"supported-operators",children:"Supported Operators"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Exact match (default)\nnew JsonFilter('extra_data', 'department', 'IT');\nnew JsonFilter('extra_data', 'department', 'IT', '=');\n\n// Not equal\nnew JsonFilter('extra_data', 'department', 'IT', '!=');\nnew JsonFilter('extra_data', 'department', 'IT', '<>');\n\n// Pattern matching\nnew JsonFilter('extra_data', 'department', 'IT%', 'LIKE');\nnew JsonFilter('extra_data', 'department', '%temp%', 'NOT LIKE');\n\n// Multiple values\nnew JsonFilter('extra_data', 'status', ['active', 'pending'], 'IN');\nnew JsonFilter('extra_data', 'status', ['deleted', 'archived'], 'NOT IN');\n\n// NULL checking\nnew JsonFilter('extra_data', 'deleted_by', null, 'IS NULL');\nnew JsonFilter('extra_data', 'department', null, 'IS NOT NULL');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nested-json-paths",children:"Nested JSON Paths"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Access nested values using dot notation\n$query->addFilter(new JsonFilter('extra_data', 'user.role', 'admin'));\n$query->addFilter(new JsonFilter('extra_data', 'metadata.source.ip', '192.168.1.1'));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"database-support",children:"Database Support"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Database"}),(0,i.jsx)(n.th,{children:"Minimum Version"}),(0,i.jsx)(n.th,{children:"JSON Function"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MySQL"}),(0,i.jsx)(n.td,{children:"5.7.0"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"JSON_UNQUOTE(JSON_EXTRACT())"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MariaDB"}),(0,i.jsx)(n.td,{children:"10.2.3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"JSON_UNQUOTE(JSON_EXTRACT())"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PostgreSQL"}),(0,i.jsx)(n.td,{children:"9.4.0"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"->>"})," operator"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLite"}),(0,i.jsx)(n.td,{children:"3.38.0"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"json_extract()"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"fallback-behavior",children:"Fallback Behavior"}),"\n",(0,i.jsxs)(n.p,{children:["When the database doesn't support JSON functions, the filter falls back to ",(0,i.jsx)(n.code,{children:"LIKE"})," pattern matching:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// On unsupported database, this:\nnew JsonFilter('extra_data', 'department', 'IT');\n\n// Becomes approximately:\n// WHERE extra_data LIKE '%\"department\":\"IT\"%'\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,i.jsxs)(n.p,{children:["The LIKE fallback may produce inaccurate results (false positives). A ",(0,i.jsx)(n.code,{children:"E_USER_WARNING"})," is triggered when this occurs."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,i.jsx)(n.p,{children:"Enable strict mode to throw an exception instead of falling back to LIKE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Throws InvalidArgumentException if JSON is not supported\n$filter = new JsonFilter('extra_data', 'department', 'IT', '=', strict: true);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["Only ",(0,i.jsx)(n.strong,{children:"scalar value extraction"})," is supported in this version. Array/object comparisons (e.g., ",(0,i.jsx)(n.code,{children:"JSON_CONTAINS"}),") are not yet implemented."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"generated-sql-examples",children:"Generated SQL Examples"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// MySQL/MariaDB\n$filter = new JsonFilter('extra_data', 'department', 'IT');\n// SQL: JSON_UNQUOTE(JSON_EXTRACT(extra_data, '$.department')) = :json_department\n\n// PostgreSQL\n// SQL: extra_data->>'department' = :json_department\n\n// SQLite\n// SQL: json_extract(extra_data, '$.department') = :json_department\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-custom-filter-example",children:"\ud83e\udde9 Custom Filter Example"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["You can create custom filters by implementing ",(0,i.jsx)(n.code,{children:"FilterInterface"}),". For NULL value filtering, use the built-in ",(0,i.jsx)(n.code,{children:"NullFilter"})," class."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Audit\\Filter;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\FilterInterface;\n\nfinal class NotNullFilter implements FilterInterface\n{\n    public function __construct(\n        private readonly string $name\n    ) {}\n\n    public function getName(): string\n    {\n        return $this->name;\n    }\n\n    public function getSQL(): array\n    {\n        return [\n            'sql' => sprintf('%s IS NOT NULL', $this->name),\n            'params' => [],\n        ];\n    }\n}\n\n// Usage\n$query->addFilter(new NotNullFilter('blame_id'));\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud83d\udd0d ",(0,i.jsx)(n.a,{href:"/auditor-docs/auditor/querying/",children:"Querying Overview"})]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83d\udce6 ",(0,i.jsx)(n.a,{href:"/auditor-docs/auditor/querying/entry",children:"Entry Model Reference"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>a,x:()=>d});var t=r(6540);const i={},l=t.createContext(i);function a(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);