"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[4007],{4200(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>a});const d=JSON.parse('{"id":"upgrade/v7","title":"Upgrading to 7.0","description":"Migrate from auditor-bundle 6.x to 7.0","source":"@site/docs/auditor-bundle/upgrade/v7.md","sourceDirName":"upgrade","slug":"/upgrade/v7","permalink":"/auditor-docs/auditor-bundle/upgrade/v7","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorBundleSidebar","previous":{"title":"Upgrade Guide","permalink":"/auditor-docs/auditor-bundle/upgrade/"}}');var i=r(4848),s=r(8453);const t={},l="Upgrading to 7.0",c={},a=[{value:"\ud83d\udccb Requirements Changes",id:"-requirements-changes",level:2},{value:"PHP",id:"php",level:3},{value:"Symfony",id:"symfony",level:3},{value:"Doctrine",id:"doctrine",level:3},{value:"auditor Library",id:"auditor-library",level:3},{value:"PHPUnit",id:"phpunit",level:3},{value:"\ud83d\udd27 Bundle Changes",id:"-bundle-changes",level:2},{value:"AbstractBundle Migration",id:"abstractbundle-migration",level:3},{value:"\ud83d\uddd1\ufe0f Removed Classes",id:"\ufe0f-removed-classes",level:3},{value:"\ud83d\uddd1\ufe0f Removed Files",id:"\ufe0f-removed-files",level:3},{value:"Composer Scripts",id:"composer-scripts",level:3},{value:"\ud83d\ude80 Upgrade Steps",id:"-upgrade-steps",level:2},{value:"1\ufe0f\u20e3 Update PHP",id:"1\ufe0f\u20e3-update-php",level:3},{value:"2\ufe0f\u20e3 Update Symfony",id:"2\ufe0f\u20e3-update-symfony",level:3},{value:"3\ufe0f\u20e3 Update Doctrine",id:"3\ufe0f\u20e3-update-doctrine",level:3},{value:"4\ufe0f\u20e3 Update auditor",id:"4\ufe0f\u20e3-update-auditor",level:3},{value:"5\ufe0f\u20e3 Update auditor-bundle",id:"5\ufe0f\u20e3-update-auditor-bundle",level:3},{value:"6\ufe0f\u20e3 Clear Cache",id:"6\ufe0f\u20e3-clear-cache",level:3},{value:"7\ufe0f\u20e3 Check Schema",id:"7\ufe0f\u20e3-check-schema",level:3},{value:"8\ufe0f\u20e3 Run Tests",id:"8\ufe0f\u20e3-run-tests",level:3},{value:"\u2699\ufe0f Configuration",id:"\ufe0f-configuration",level:2},{value:"\u26a0\ufe0f Breaking Changes",id:"\ufe0f-breaking-changes",level:2},{value:"auditor Library Changes",id:"auditor-library-changes",level:3},{value:"Namespace Rename: Annotation \u2192 Attribute",id:"namespace-rename-annotation--attribute",level:4},{value:"<code>utf8_convert</code> is now opt-in",id:"utf8_convert-is-now-opt-in",level:4},{value:"Entry Model - Property Hooks (PHP 8.4)",id:"entry-model---property-hooks-php-84",level:4},{value:"Route Names",id:"route-names",level:3},{value:"ConsoleUserProvider",id:"consoleuserprovider",level:3},{value:"Template Blocks",id:"template-blocks",level:3},{value:"UserProvider",id:"userprovider",level:3},{value:"Custom Providers",id:"custom-providers",level:3},{value:"PHP Attributes Migration",id:"php-attributes-migration",level:3},{value:"\ud83d\udd12 Final Classes",id:"-final-classes",level:3},{value:"ActivityGraphProvider API Changes",id:"activitygraphprovider-api-changes",level:3},{value:"SecurityProvider",id:"securityprovider",level:3},{value:"\ud83d\udd27 Troubleshooting",id:"-troubleshooting",level:2},{value:"Class Not Found",id:"class-not-found",level:3},{value:"Configuration Errors",id:"configuration-errors",level:3},{value:"Schema Issues",id:"schema-issues",level:3},{value:"\u2753 Need Help?",id:"-need-help",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"upgrading-to-70",children:"Upgrading to 7.0"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Migrate from auditor-bundle 6.x to 7.0"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This guide covers upgrading from auditor-bundle 6.x to 7.0."}),"\n",(0,i.jsx)(n.h2,{id:"-requirements-changes",children:"\ud83d\udccb Requirements Changes"}),"\n",(0,i.jsx)(n.h3,{id:"php",children:"PHP"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"6.x"}),(0,i.jsx)(n.th,{children:"7.0"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:">= 8.2"}),(0,i.jsx)(n.td,{children:">= 8.4"})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"symfony",children:"Symfony"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"6.x"}),(0,i.jsx)(n.th,{children:"7.0"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:">= 5.4"}),(0,i.jsx)(n.td,{children:">= 8.0"})]})})]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"CAUTION"]}),"\n",(0,i.jsxs)(n.p,{children:["Symfony 5.4, 6.x, and 7.x are ",(0,i.jsx)(n.strong,{children:"no longer supported"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"doctrine",children:"Doctrine"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Package"}),(0,i.jsx)(n.th,{children:"6.x"}),(0,i.jsx)(n.th,{children:"7.0"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DBAL"}),(0,i.jsx)(n.td,{children:">= 3.2"}),(0,i.jsx)(n.td,{children:">= 4.0"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ORM"}),(0,i.jsx)(n.td,{children:">= 2.13"}),(0,i.jsx)(n.td,{children:">= 3.2"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DoctrineBundle"}),(0,i.jsx)(n.td,{children:">= 2.0"}),(0,i.jsx)(n.td,{children:">= 3.0"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"auditor-library",children:"auditor Library"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"6.x"}),(0,i.jsx)(n.th,{children:"7.0"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:">= 3.0"}),(0,i.jsx)(n.td,{children:">= 4.0"})]})})]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor/blob/master/UPGRADE-4.0.md",children:"auditor upgrade guide"})," for library-specific changes."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"phpunit",children:"PHPUnit"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"6.x"}),(0,i.jsx)(n.th,{children:"7.0"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:">= 11.0"}),(0,i.jsx)(n.td,{children:">= 12.0"})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"-bundle-changes",children:"\ud83d\udd27 Bundle Changes"}),"\n",(0,i.jsx)(n.h3,{id:"abstractbundle-migration",children:"AbstractBundle Migration"}),"\n",(0,i.jsxs)(n.p,{children:["The bundle now extends ",(0,i.jsx)(n.code,{children:"Symfony\\Component\\HttpKernel\\Bundle\\AbstractBundle"})," instead of ",(0,i.jsx)(n.code,{children:"Bundle"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This is an internal change and doesn't affect your configuration."}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-removed-classes",children:"\ud83d\uddd1\ufe0f Removed Classes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Removed Class"}),(0,i.jsx)(n.th,{children:"Reason"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\AuditorBundle\\DependencyInjection\\Configuration"})}),(0,i.jsxs)(n.td,{children:["Merged into ",(0,i.jsx)(n.code,{children:"DHAuditorBundle::configure()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\AuditorBundle\\DependencyInjection\\DHAuditorExtension"})}),(0,i.jsxs)(n.td,{children:["Merged into ",(0,i.jsx)(n.code,{children:"DHAuditorBundle::loadExtension()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\AuditorBundle\\DependencyInjection\\Compiler\\AddProviderCompilerPass"})}),(0,i.jsx)(n.td,{children:"No longer needed with autowiring"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\AuditorBundle\\DependencyInjection\\Compiler\\CustomConfigurationCompilerPass"})}),(0,i.jsx)(n.td,{children:"Merged into bundle"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DH\\AuditorBundle\\DependencyInjection\\Compiler\\DoctrineProviderConfigurationCompilerPass"})}),(0,i.jsxs)(n.td,{children:["Replaced by ",(0,i.jsx)(n.code,{children:"DoctrineMiddlewareCompilerPass"})]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-removed-files",children:"\ud83d\uddd1\ufe0f Removed Files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"src/Resources/config/services.yaml"})," - Services defined programmatically"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"composer-scripts",children:"Composer Scripts"}),"\n",(0,i.jsx)(n.p,{children:"The following composer scripts have been removed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setup5"})," (Symfony 5.4)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setup6"})," (Symfony 6.4)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setup7"})," (Symfony 7.x)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setup8"})," (Symfony 8.0)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use the new unified ",(0,i.jsx)(n.code,{children:"setup"})," script instead:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer setup\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-upgrade-steps",children:"\ud83d\ude80 Upgrade Steps"}),"\n",(0,i.jsx)(n.h3,{id:"1\ufe0f\u20e3-update-php",children:"1\ufe0f\u20e3 Update PHP"}),"\n",(0,i.jsx)(n.p,{children:"Ensure you have PHP 8.4+:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"php -v\n# PHP 8.4.x ...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2\ufe0f\u20e3-update-symfony",children:"2\ufe0f\u20e3 Update Symfony"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer require symfony/framework-bundle:^8.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3\ufe0f\u20e3-update-doctrine",children:"3\ufe0f\u20e3 Update Doctrine"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer require \\\n    doctrine/dbal:^4.0 \\\n    doctrine/orm:^3.2 \\\n    doctrine/doctrine-bundle:^3.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4\ufe0f\u20e3-update-auditor",children:"4\ufe0f\u20e3 Update auditor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer require damienharper/auditor:^4.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5\ufe0f\u20e3-update-auditor-bundle",children:"5\ufe0f\u20e3 Update auditor-bundle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"composer require damienharper/auditor-bundle:^7.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"6\ufe0f\u20e3-clear-cache",children:"6\ufe0f\u20e3 Clear Cache"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/console cache:clear\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7\ufe0f\u20e3-check-schema",children:"7\ufe0f\u20e3 Check Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/console audit:schema:update --dump-sql\n"})}),"\n",(0,i.jsx)(n.h3,{id:"8\ufe0f\u20e3-run-tests",children:"8\ufe0f\u20e3 Run Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/phpunit\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-configuration",children:"\u2699\ufe0f Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["No configuration changes required. Your ",(0,i.jsx)(n.code,{children:"dh_auditor.yaml"})," should work as-is."]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-breaking-changes",children:"\u26a0\ufe0f Breaking Changes"}),"\n",(0,i.jsx)(n.h3,{id:"auditor-library-changes",children:"auditor Library Changes"}),"\n",(0,i.jsxs)(n.p,{children:["This bundle requires ",(0,i.jsx)(n.code,{children:"damienharper/auditor"})," >= 4.0 which introduces several breaking changes."]}),"\n",(0,i.jsx)(n.h4,{id:"namespace-rename-annotation--attribute",children:"Namespace Rename: Annotation \u2192 Attribute"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Annotation"})," namespace has been renamed to ",(0,i.jsx)(n.code,{children:"Attribute"})," to align with PHP 8+ terminology."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before (auditor 3.x)\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore;\n\n// After (auditor 4.0)\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable;\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore;\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"utf8_convert-is-now-opt-in",children:[(0,i.jsx)(n.code,{children:"utf8_convert"})," is now opt-in"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,i.jsxs)(n.p,{children:["The implicit ",(0,i.jsx)(n.code,{children:"mb_convert_encoding()"})," pass that ran on every audit entry has been ",(0,i.jsx)(n.strong,{children:"removed from the default path"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In auditor 3.x, UTF-8 conversion ran automatically. In auditor 4.0 it defaults to ",(0,i.jsx)(n.code,{children:"false"})," because DBAL 4 enforces UTF-8 connections on PHP 8.4+, making the conversion a no-op for virtually all modern applications."]}),"\n",(0,i.jsx)(n.p,{children:"If your application handles data from legacy non-UTF-8 sources, re-enable it explicitly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# config/packages/dh_auditor.yaml\ndh_auditor:\n    providers:\n        doctrine:\n            utf8_convert: true\n"})}),"\n",(0,i.jsx)(n.h4,{id:"entry-model---property-hooks-php-84",children:"Entry Model - Property Hooks (PHP 8.4)"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Entry"})," model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before (auditor 3.x)\n$entry->getId();\n$entry->getType();\n$entry->getObjectId();\n$entry->getUserId();\n$entry->getUsername();\n$entry->getCreatedAt();\n\n// After (auditor 4.0)\n$entry->id;\n$entry->type;\n$entry->objectId;\n$entry->userId;\n$entry->username;\n$entry->createdAt;\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor/blob/master/UPGRADE-4.0.md",children:"auditor UPGRADE-4.0.md"})," for the complete list of changes."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"route-names",children:"Route Names"}),"\n",(0,i.jsx)(n.p,{children:"The viewer route names have been updated for consistency:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (6.x)"}),(0,i.jsx)(n.th,{children:"After (7.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_show_entity_history"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_show_entity_stream"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_show_transaction"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_show_transaction_stream"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Update any route references in your code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before\n$url = $urlGenerator->generate('dh_auditor_show_entity_history', [...]);\n\n// After\n$url = $urlGenerator->generate('dh_auditor_show_entity_stream', [...]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"consoleuserprovider",children:"ConsoleUserProvider"}),"\n",(0,i.jsxs)(n.p,{children:["CLI commands now use the command name as the user identifier instead of a generic ",(0,i.jsx)(n.code,{children:'"command"'})," string:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Before (6.x)"}),(0,i.jsx)(n.th,{children:"After (7.0)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'id: "command"'})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'id: "app:import-users"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'username: "app:import-users"'})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'username: "app:import-users"'})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"This allows filtering audit entries by specific CLI command in the viewer."}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,i.jsxs)(n.p,{children:["Existing audit entries with ",(0,i.jsx)(n.code,{children:'blame_id = "command"'})," will not be automatically migrated."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"template-blocks",children:"Template Blocks"}),"\n",(0,i.jsx)(n.p,{children:"The following Twig blocks have been removed from the base layout:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Removed Block"}),(0,i.jsx)(n.th,{children:"Reason"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"navbar"})}),(0,i.jsx)(n.td,{children:"Replaced by built-in header"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"breadcrumbs"})}),(0,i.jsx)(n.td,{children:"No longer used"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Available blocks in 7.0:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Block"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Available in"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"title"})}),(0,i.jsx)(n.td,{children:"Page title"}),(0,i.jsx)(n.td,{children:"All pages"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"stylesheets"})}),(0,i.jsx)(n.td,{children:"CSS includes"}),(0,i.jsx)(n.td,{children:"All pages"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_content"})}),(0,i.jsx)(n.td,{children:"Main content area"}),(0,i.jsx)(n.td,{children:"All pages"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_header"})}),(0,i.jsx)(n.td,{children:"Sub-header with back link & filters"}),(0,i.jsx)(n.td,{children:"Entity stream, Transaction view"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dh_auditor_pager"})}),(0,i.jsx)(n.td,{children:"Pagination"}),(0,i.jsx)(n.td,{children:"Entity stream"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"javascripts"})}),(0,i.jsx)(n.td,{children:"JavaScript includes"}),(0,i.jsx)(n.td,{children:"All pages"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["If you override ",(0,i.jsx)(n.code,{children:"layout.html.twig"})," and use any of the removed blocks, update your template accordingly."]}),"\n",(0,i.jsx)(n.h3,{id:"userprovider",children:"UserProvider"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"AnonymousToken"})," handling was removed (deprecated in Symfony 6.0)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Before (6.x):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"if ($token instanceof AnonymousToken) {\n    return null;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"After (7.0):"}),"\nAnonymous tokens no longer exist in Symfony 8.0."]}),"\n",(0,i.jsx)(n.h3,{id:"custom-providers",children:"Custom Providers"}),"\n",(0,i.jsx)(n.p,{children:"If you have custom providers extending bundle classes, verify they still work."}),"\n",(0,i.jsxs)(n.p,{children:["The provider interfaces from the ",(0,i.jsx)(n.code,{children:"auditor"})," library haven't changed:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"UserProviderInterface"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SecurityProviderInterface"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RoleCheckerInterface"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"php-attributes-migration",children:"PHP Attributes Migration"}),"\n",(0,i.jsx)(n.p,{children:"The bundle now uses modern PHP 8.4+ and Symfony 8+ attributes for service auto-configuration:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Class"}),(0,i.jsx)(n.th,{children:"Change"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ConsoleEventSubscriber"})}),(0,i.jsxs)(n.td,{children:["Uses ",(0,i.jsx)(n.code,{children:"#[AsEventListener]"})," instead of ",(0,i.jsx)(n.code,{children:"EventSubscriberInterface"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ViewerEventSubscriber"})}),(0,i.jsxs)(n.td,{children:["Uses ",(0,i.jsx)(n.code,{children:"#[AsEventListener]"})," instead of ",(0,i.jsx)(n.code,{children:"EventSubscriberInterface"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ViewerController"})}),(0,i.jsxs)(n.td,{children:["Uses ",(0,i.jsx)(n.code,{children:"#[AsController]"})," attribute"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TimeAgoExtension"})}),(0,i.jsxs)(n.td,{children:["Uses ",(0,i.jsx)(n.code,{children:"#[AsTwigFilter]"})," instead of extending ",(0,i.jsx)(n.code,{children:"AbstractExtension"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RoutingLoader"})}),(0,i.jsxs)(n.td,{children:["Uses ",(0,i.jsx)(n.code,{children:"#[AutoconfigureTag('routing.loader')]"})," attribute"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"-final-classes",children:"\ud83d\udd12 Final Classes"}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",dir:"auto",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,i.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,i.jsx)(n.path,{d:"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"CAUTION"]}),"\n",(0,i.jsxs)(n.p,{children:["The following classes are now ",(0,i.jsx)(n.code,{children:"final"})," and cannot be extended:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// These classes can no longer be extended\nDH\\AuditorBundle\\Event\\ConsoleEventSubscriber\nDH\\AuditorBundle\\Event\\ViewerEventSubscriber\nDH\\AuditorBundle\\Twig\\TimeAgoExtension\nDH\\AuditorBundle\\Routing\\RoutingLoader\nDH\\AuditorBundle\\User\\UserProvider\nDH\\AuditorBundle\\User\\ConsoleUserProvider\nDH\\AuditorBundle\\Security\\SecurityProvider\nDH\\AuditorBundle\\Security\\RoleChecker\nDH\\AuditorBundle\\Viewer\\ActivityGraphProvider\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you were extending any of these classes, you'll need to use composition instead of inheritance."}),"\n",(0,i.jsx)(n.h3,{id:"activitygraphprovider-api-changes",children:"ActivityGraphProvider API Changes"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ActivityGraphProvider"})," now uses PHP 8.4 property hooks with asymmetric visibility:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Before (6.x)\n$days = $provider->getDays();\n$layout = $provider->getLayout();\n\n// After (7.0)\n$days = $provider->days;\n$layout = $provider->layout;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"securityprovider",children:"SecurityProvider"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SecurityProvider"})," now uses ",(0,i.jsx)(n.code,{children:"#[Autowire]"})," attribute for dependency injection. This is an internal change but may affect you if you were manually constructing this service."]}),"\n",(0,i.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83d\udd27 Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"class-not-found",children:"Class Not Found"}),"\n",(0,i.jsx)(n.p,{children:"If you get class not found errors for removed classes, you may have code referencing internal bundle classes. Update to use public APIs only."}),"\n",(0,i.jsx)(n.h3,{id:"configuration-errors",children:"Configuration Errors"}),"\n",(0,i.jsx)(n.p,{children:"Clear cache and warmup:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/console cache:clear\nbin/console cache:warmup\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-issues",children:"Schema Issues"}),"\n",(0,i.jsx)(n.p,{children:"Check and update audit tables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/console audit:schema:update --dump-sql\nbin/console audit:schema:update --force\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-need-help",children:"\u2753 Need Help?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.a,{href:"https://github.com/DamienHarper/auditor-bundle/issues",children:"GitHub Issues"})]}),"\n",(0,i.jsx)(n.li,{children:"Open a new issue with details about your error"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>l});var d=r(6540);const i={},s=d.createContext(i);function t(e){const n=d.useContext(s);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),d.createElement(s.Provider,{value:n},e.children)}}}]);