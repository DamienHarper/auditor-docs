"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[5177],{67502(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"configuration/attributes","title":"Entity Attributes","description":"Configure auditing with PHP 8 attributes","source":"@site/docs/auditor-bundle/configuration/attributes.md","sourceDirName":"configuration","slug":"/configuration/attributes","permalink":"/auditor-docs/auditor-bundle/configuration/attributes","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorBundleSidebar","previous":{"title":"Storage Configuration","permalink":"/auditor-docs/auditor-bundle/configuration/storage"},"next":{"title":"Customization","permalink":"/auditor-docs/auditor-bundle/customization/"}}');var r=t(74848),s=t(28453);const d={},a="Entity Attributes",l={},c=[{value:"\ud83d\udccb Available Attributes",id:"-available-attributes",level:2},{value:"\ud83c\udff7\ufe0f #[Auditable]",id:"\ufe0f-auditable",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Disabled by Default",id:"disabled-by-default",level:3},{value:"\ud83d\udeab #[Ignore]",id:"-ignore",level:2},{value:"\ud83d\udd12 #[Security]",id:"-security",level:2},{value:"Multiple Roles (OR Logic)",id:"multiple-roles-or-logic",level:3},{value:"\ud83d\udcdd Complete Example",id:"-complete-example",level:2},{value:"\ud83d\udd00 Combining with YAML",id:"-combining-with-yaml",level:2},{value:"\ud83d\udcca Precedence Rules",id:"-precedence-rules",level:3},{value:"\u26a0\ufe0f Entity Not in YAML",id:"\ufe0f-entity-not-in-yaml",level:2},{value:"\ud83d\ude80 Next Steps",id:"-next-steps",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"entity-attributes",children:"Entity Attributes"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configure auditing with PHP 8 attributes"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"PHP attributes provide an alternative to YAML configuration for declaring auditable entities."}),"\n",(0,r.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,r.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,r.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,r.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,r.jsx)(n.p,{children:"Attributes take precedence over YAML configuration."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-available-attributes",children:"\ud83d\udccb Available Attributes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Attribute"}),(0,r.jsx)(n.th,{children:"Target"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Auditable]"})}),(0,r.jsx)(n.td,{children:"Class"}),(0,r.jsx)(n.td,{children:"Marks an entity as auditable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Ignore]"})}),(0,r.jsx)(n.td,{children:"Property"}),(0,r.jsx)(n.td,{children:"Excludes a property from auditing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Security]"})}),(0,r.jsx)(n.td,{children:"Class"}),(0,r.jsx)(n.td,{children:"Defines roles required to view audits"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["All attributes are in the ",(0,r.jsx)(n.code,{children:"DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute"})," namespace."]}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-auditable",children:"\ud83c\udff7\ufe0f #[Auditable]"}),"\n",(0,r.jsx)(n.p,{children:"Marks an entity class for auditing."}),"\n",(0,r.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Entity;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\nclass User\n{\n    #[ORM\\Id]\n    #[ORM\\GeneratedValue]\n    #[ORM\\Column]\n    private ?int $id = null;\n\n    #[ORM\\Column(length: 180)]\n    private ?string $email = null;\n    \n    // ...\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"disabled-by-default",children:"Disabled by Default"}),"\n",(0,r.jsx)(n.p,{children:"Create an audit table but don't log until enabled at runtime:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"#[ORM\\Entity]\n#[Audit\\Auditable(enabled: false)]\nclass User\n{\n    // Auditing is OFF by default\n    // Can be enabled at runtime\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-ignore",children:"\ud83d\udeab #[Ignore]"}),"\n",(0,r.jsx)(n.p,{children:"Excludes a property from being audited."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Entity;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\nclass User\n{\n    #[ORM\\Column]\n    private ?string $email = null;\n\n    #[ORM\\Column]\n    #[Audit\\Ignore]\n    private ?string $password = null;  // Not audited\n\n    #[ORM\\Column]\n    #[Audit\\Ignore]\n    private ?\\DateTimeImmutable $lastLoginAt = null;  // Not audited\n}\n"})}),"\n",(0,r.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,r.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,r.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,r.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,r.jsxs)(n.p,{children:["Properties in the global ",(0,r.jsx)(n.code,{children:"ignored_columns"})," configuration don't need ",(0,r.jsx)(n.code,{children:"#[Ignore]"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-security",children:"\ud83d\udd12 #[Security]"}),"\n",(0,r.jsx)(n.p,{children:"Restricts access to view audit logs based on user roles."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Entity;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\n#[Audit\\Security(view: ['ROLE_ADMIN'])]\nclass User\n{\n    // Only users with ROLE_ADMIN can view User audits\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multiple-roles-or-logic",children:"Multiple Roles (OR Logic)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"#[Audit\\Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR'])]\nclass User\n{\n    // Users with ROLE_ADMIN OR ROLE_AUDITOR can view\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-complete-example",children:"\ud83d\udcdd Complete Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Entity;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\n#[Audit\\Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR'])]\nclass User\n{\n    #[ORM\\Id]\n    #[ORM\\GeneratedValue]\n    #[ORM\\Column]\n    private ?int $id = null;\n\n    #[ORM\\Column(length: 180, unique: true)]\n    private ?string $email = null;\n\n    #[ORM\\Column]\n    #[Audit\\Ignore]\n    private ?string $password = null;\n\n    #[ORM\\Column(length: 255)]\n    private ?string $firstName = null;\n\n    #[ORM\\Column(length: 255)]\n    private ?string $lastName = null;\n\n    #[ORM\\Column]\n    #[Audit\\Ignore]\n    private ?\\DateTimeImmutable $lastLoginAt = null;\n\n    // Getters and setters...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-combining-with-yaml",children:"\ud83d\udd00 Combining with YAML"}),"\n",(0,r.jsx)(n.p,{children:"You can use both attributes and YAML configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# config/packages/dh_auditor.yaml\ndh_auditor:\n    providers:\n        doctrine:\n            ignored_columns:\n                - createdAt\n                - updatedAt\n            entities:\n                App\\Entity\\User: ~   # Declares entity is auditable\n                App\\Entity\\Post: ~\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Entity uses attributes for fine-grained control\n#[ORM\\Entity]\n#[Audit\\Auditable]\n#[Audit\\Security(view: ['ROLE_ADMIN'])]\nclass User\n{\n    #[Audit\\Ignore]\n    private ?string $password = null;\n    \n    // createdAt and updatedAt are automatically ignored via YAML\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-precedence-rules",children:"\ud83d\udcca Precedence Rules"}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TD\n    A["Attribute #[Auditable]"] --\x3e|overrides| B["YAML entities.*.enabled"]\n    C["Attribute #[Ignore]"] --\x3e|adds to| D["YAML ignored_columns"]\n    E["Attribute #[Security]"] --\x3e|overrides| F["YAML entities.*.roles"]'}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Attribute"}),(0,r.jsx)(n.th,{children:"Behavior"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Auditable]"})}),(0,r.jsxs)(n.td,{children:["Overrides ",(0,r.jsx)(n.code,{children:"entities.*.enabled"})," from YAML"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Ignore]"})}),(0,r.jsxs)(n.td,{children:["Adds to ",(0,r.jsx)(n.code,{children:"ignored_columns"})," (YAML + attribute)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"#[Security]"})}),(0,r.jsxs)(n.td,{children:["Overrides ",(0,r.jsx)(n.code,{children:"entities.*.roles"})," from YAML"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-entity-not-in-yaml",children:"\u26a0\ufe0f Entity Not in YAML"}),"\n",(0,r.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",dir:"auto",children:["\n",(0,r.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,r.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,r.jsx)(n.path,{d:"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"CAUTION"]}),"\n",(0,r.jsxs)(n.p,{children:["If an entity has ",(0,r.jsx)(n.code,{children:"#[Auditable]"})," but isn't in YAML ",(0,r.jsx)(n.code,{children:"entities"}),", it will ",(0,r.jsx)(n.strong,{children:"not"})," be audited."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# User is NOT listed here\ndh_auditor:\n    providers:\n        doctrine:\n            entities:\n                App\\Entity\\Post: ~\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// This entity will NOT be audited (not in YAML)\n#[Audit\\Auditable]\nclass User {}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Either:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 Add to YAML: ",(0,r.jsx)(n.code,{children:"App\\Entity\\User: ~"})]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Or use YAML-only configuration"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-next-steps",children:"\ud83d\ude80 Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2699\ufe0f ",(0,r.jsx)(n.a,{href:"/auditor-docs/auditor-bundle/configuration/",children:"Configuration Reference"})," - All YAML options"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\uddc4\ufe0f ",(0,r.jsx)(n.a,{href:"/auditor-docs/auditor-bundle/configuration/storage",children:"Storage Configuration"})," - Multi-database setup"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udee1\ufe0f ",(0,r.jsx)(n.a,{href:"/auditor-docs/auditor-bundle/customization/role-checker",children:"Role Checker"})," - Custom access control"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,n,t){t.d(n,{R:()=>d,x:()=>a});var i=t(96540);const r={},s=i.createContext(r);function d(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);