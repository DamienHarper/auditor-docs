"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[5649],{98876(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>c});const d=JSON.parse('{"id":"commands/index","title":"Console Commands","description":"Manage audit data via the command line","source":"@site/docs/auditor/commands/index.md","sourceDirName":"commands","slug":"/commands/","permalink":"/auditor-docs/auditor/commands/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"auditorSidebar","previous":{"title":"Filters Reference","permalink":"/auditor-docs/auditor/querying/filters"},"next":{"title":"API Reference","permalink":"/auditor-docs/auditor/api/"}}');var s=i(74848),a=i(28453);const t={},r="Console Commands",l={},c=[{value:"\ud83d\udccb Available Commands",id:"-available-commands",level:2},{value:"\ud83d\udee0\ufe0f audit:schema",id:"\ufe0f-auditschema",level:2},{value:"Usage",id:"usage",level:3},{value:"Options",id:"options",level:3},{value:"Examples",id:"examples",level:3},{value:"When to Run",id:"when-to-run",level:3},{value:"Exit Codes",id:"exit-codes",level:3},{value:"\ud83e\uddf9 audit",id:"-audit",level:2},{value:"Usage",id:"usage-1",level:3},{value:"Arguments",id:"arguments",level:3},{value:"Options",id:"options-1",level:3},{value:"Retention Period Format",id:"retention-period-format",level:3},{value:"Examples",id:"examples-1",level:3},{value:"Basic Cleanup",id:"basic-cleanup",level:4},{value:"Preview Mode",id:"preview-mode",level:4},{value:"Non-Interactive",id:"non-interactive",level:4},{value:"Custom Date",id:"custom-date",level:4},{value:"Entity Filtering",id:"entity-filtering",level:4},{value:"Output",id:"output",level:3},{value:"Scheduling",id:"scheduling",level:3},{value:"Exit Codes",id:"exit-codes-1",level:3},{value:"\ud83d\udcbb Programmatic Usage",id:"-programmatic-usage",level:2},{value:"Schema Update",id:"schema-update",level:3},{value:"Cleaning Audits",id:"cleaning-audits",level:3},{value:"\ud83d\udd12 Command Locking",id:"-command-locking",level:2},{value:"\ud83d\udce6 Registering Commands (Standalone)",id:"-registering-commands-standalone",level:2},{value:"\u2705 Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udd27 Troubleshooting",id:"-troubleshooting",level:2},{value:"&quot;The command is already running&quot;",id:"the-command-is-already-running",level:3},{value:"Schema update has no changes",id:"schema-update-has-no-changes",level:3},{value:"Permission denied",id:"permission-denied",level:3},{value:"Timeout during large cleanup",id:"timeout-during-large-cleanup",level:3}];function o(e){const n={blockquote:"blockquote",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",path:"path",pre:"pre",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"console-commands",children:"Console Commands"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Manage audit data via the command line"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When using the auditor-bundle or standalone, the library provides console commands for managing audit data."}),"\n",(0,s.jsx)(n.h2,{id:"-available-commands",children:"\ud83d\udccb Available Commands"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Command"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"audit:schema:update"})}),(0,s.jsx)(n.td,{children:"Create or update audit table schemas"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"audit:clean"})}),(0,s.jsx)(n.td,{children:"Remove old audit entries"})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"\ufe0f-auditschema",children:["\ud83d\udee0\ufe0f audit:schema",":update"]}),"\n",(0,s.jsx)(n.p,{children:"Creates new audit tables and updates existing ones to match the current schema."}),"\n",(0,s.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"php bin/console audit:schema:update [options]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Short"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--dump-sql"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Show SQL statements without executing them"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--force"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-f"})}),(0,s.jsx)(n.td,{children:"Execute the SQL statements"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Preview the SQL that would be executed\nphp bin/console audit:schema:update --dump-sql\n\n# Output:\n# The following SQL statements will be executed:\n#\n#     CREATE TABLE users_audit (...);\n#     CREATE INDEX idx_type_xxx ON users_audit (type);\n#     ...\n\n# Execute the changes\nphp bin/console audit:schema:update --force\n\n# Both: show SQL and execute\nphp bin/console audit:schema:update --dump-sql --force\n"})}),"\n",(0,s.jsx)(n.h3,{id:"when-to-run",children:"When to Run"}),"\n",(0,s.jsx)(n.p,{children:"Run this command:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["After adding ",(0,s.jsx)(n.code,{children:"#[Auditable]"})," to a new entity"]}),"\n",(0,s.jsx)(n.li,{children:"After updating auditor to a new version"}),"\n",(0,s.jsx)(n.li,{children:"During deployment to ensure schema is up-to-date"}),"\n"]}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,s.jsx)(n.p,{children:"The command is safe to run multiple times. Existing tables are updated (not recreated), existing data is preserved, and only necessary changes are applied."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"exit-codes",children:"Exit Codes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Code"}),(0,s.jsx)(n.th,{children:"Meaning"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:'Success (including "nothing to update")'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Error or missing required options"})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"-audit",children:["\ud83e\uddf9 audit",":clean"]}),"\n",(0,s.jsx)(n.p,{children:"Removes audit entries older than a specified retention period."}),"\n",(0,s.jsx)(n.h3,{id:"usage-1",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"php bin/console audit:clean [options] [keep]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"arguments",children:"Arguments"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Argument"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"keep"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P12M"})}),(0,s.jsx)(n.td,{children:"Retention period as ISO 8601 duration"})]})})]}),"\n",(0,s.jsx)(n.h3,{id:"options-1",children:"Options"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Short"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--no-confirm"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Skip confirmation prompt"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--dry-run"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Show what would be deleted without executing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--dump-sql"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"Show the SQL statements"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--date"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-d"})}),(0,s.jsx)(n.td,{children:"Clean audits before a specific date"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--exclude"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-x"})}),(0,s.jsx)(n.td,{children:"Exclude specific entities (can be used multiple times)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--include"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"-i"})}),(0,s.jsx)(n.td,{children:"Include only specific entities (can be used multiple times)"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"retention-period-format",children:"Retention Period Format"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"keep"})," argument uses ISO 8601 duration format:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Format"}),(0,s.jsx)(n.th,{children:"Meaning"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P12M"})}),(0,s.jsx)(n.td,{children:"12 months"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P1Y"})}),(0,s.jsx)(n.td,{children:"1 year"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P6M"})}),(0,s.jsx)(n.td,{children:"6 months"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P30D"})}),(0,s.jsx)(n.td,{children:"30 days"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P7D"})}),(0,s.jsx)(n.td,{children:"7 days"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"P1D"})}),(0,s.jsx)(n.td,{children:"1 day"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PT12H"})}),(0,s.jsx)(n.td,{children:"12 hours"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"examples-1",children:"Examples"}),"\n",(0,s.jsx)(n.h4,{id:"basic-cleanup",children:"Basic Cleanup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Keep last 12 months (default)\nphp bin/console audit:clean\n\n# Keep last 6 months\nphp bin/console audit:clean P6M\n\n# Keep last 30 days\nphp bin/console audit:clean P30D\n"})}),"\n",(0,s.jsx)(n.h4,{id:"preview-mode",children:"Preview Mode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# See what would be deleted without actually deleting\nphp bin/console audit:clean P6M --dry-run\n\n# See the SQL statements\nphp bin/console audit:clean P6M --dump-sql\n"})}),"\n",(0,s.jsx)(n.h4,{id:"non-interactive",children:"Non-Interactive"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Skip confirmation (useful for cron jobs)\nphp bin/console audit:clean P12M --no-confirm\n"})}),"\n",(0,s.jsx)(n.h4,{id:"custom-date",children:"Custom Date"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Delete audits before a specific date\nphp bin/console audit:clean --date=2024-01-01\n\n# Combine with no-confirm for scripts\nphp bin/console audit:clean --date=2023-12-31 --no-confirm\n"})}),"\n",(0,s.jsx)(n.h4,{id:"entity-filtering",children:"Entity Filtering"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Exclude specific entities from cleanup\nphp bin/console audit:clean -x App\\\\Entity\\\\User -x App\\\\Entity\\\\Payment\n\n# Include only specific entities\nphp bin/console audit:clean -i App\\\\Entity\\\\Log -i App\\\\Entity\\\\Session\n\n# Long form\nphp bin/console audit:clean --exclude=App\\\\Entity\\\\User --include=App\\\\Entity\\\\Post\n"})}),"\n",(0,s.jsx)(n.h3,{id:"output",children:"Output"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"You are about to clean audits created before 2024-01-15 14:30:45: 12 classes involved.\n Do you want to proceed? (yes/no) [no]:\n > yes\n\nStarting...\nCleaning audit tables... (users_audit)\n 12/12 [============================] 100%\nCleaning audit tables... (done)\n\n [OK] Success.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"scheduling",children:"Scheduling"}),"\n",(0,s.jsx)(n.p,{children:"For automated cleanup, add to your crontab:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Clean up audits older than 12 months, daily at 2 AM\n0 2 * * * /path/to/php /path/to/bin/console audit:clean P12M --no-confirm >> /var/log/audit-clean.log 2>&1\n"})}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"})}),"TIP"]}),"\n",(0,s.jsx)(n.p,{children:"Use Symfony Messenger Scheduler if available for more robust scheduling."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"exit-codes-1",children:"Exit Codes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Code"}),(0,s.jsx)(n.th,{children:"Meaning"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Success or cancelled by user"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Error"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"-programmatic-usage",children:"\ud83d\udcbb Programmatic Usage"}),"\n",(0,s.jsx)(n.p,{children:"Both commands can be used programmatically:"}),"\n",(0,s.jsx)(n.h3,{id:"schema-update",children:"Schema Update"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Schema\\SchemaManager;\n\n$schemaManager = new SchemaManager($provider);\n\n// Get SQL\n$sqls = $schemaManager->getUpdateAuditSchemaSql();\n\n// Execute\n$schemaManager->updateAuditSchema();\n\n// With progress callback\n$schemaManager->updateAuditSchema(null, function (array $progress) {\n    // Handle progress\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cleaning-audits",children:"Cleaning Audits"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Doctrine\\DBAL\\Connection;\n\n/** @var Connection $connection */\n$connection = $storageService->getEntityManager()->getConnection();\n\n$queryBuilder = $connection->createQueryBuilder();\n$queryBuilder\n    ->delete('users_audit')\n    ->where('created_at < :until')\n    ->setParameter('until', (new \\DateTime('-12 months'))->format('Y-m-d H:i:s'))\n;\n\n$deleted = $queryBuilder->executeStatement();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-command-locking",children:"\ud83d\udd12 Command Locking"}),"\n",(0,s.jsx)(n.p,{children:"Both commands use Symfony's Lock component to prevent concurrent execution:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"The command is already running in another process.\n"})}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,s.jsx)(n.p,{children:"This ensures data integrity when running commands in parallel or from cron jobs."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-registering-commands-standalone",children:"\ud83d\udce6 Registering Commands (Standalone)"}),"\n",(0,s.jsx)(n.p,{children:"When not using auditor-bundle, register commands manually:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Command\\CleanAuditLogsCommand;\nuse DH\\Auditor\\Provider\\Doctrine\\Persistence\\Command\\UpdateSchemaCommand;\nuse Symfony\\Component\\Console\\Application;\n\n$application = new Application();\n\n// Schema update command\n$updateCommand = new UpdateSchemaCommand();\n$updateCommand->setAuditor($auditor);\n$application->add($updateCommand);\n\n// Clean command\n$cleanCommand = new CleanAuditLogsCommand();\n$cleanCommand->setAuditor($auditor);\n$application->add($cleanCommand);\n\n$application->run();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-best-practices",children:"\u2705 Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always preview first"})," - Use ",(0,s.jsx)(n.code,{children:"--dump-sql"})," and ",(0,s.jsx)(n.code,{children:"--dry-run"})," before executing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backup before cleanup"})," - Especially for large deletions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Schedule regular cleanups"})," - Prevent unlimited growth"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor disk space"})," - Audit tables can grow quickly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider retention policies"})," - Different entities may need different retention"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test in staging"})," - Verify commands work as expected before production"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83d\udd27 Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"the-command-is-already-running",children:'"The command is already running"'}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-warning",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"WARNING"]}),"\n",(0,s.jsx)(n.p,{children:"Wait for the other instance to finish, or check for stuck processes."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"schema-update-has-no-changes",children:"Schema update has no changes"}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})}),"NOTE"]}),"\n",(0,s.jsx)(n.p,{children:"This means your audit tables are already up-to-date."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"permission-denied",children:"Permission denied"}),"\n",(0,s.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",dir:"auto",children:["\n",(0,s.jsxs)(n.p,{className:"markdown-alert-title",dir:"auto",children:[(0,s.jsx)(n.svg,{className:"octicon",viewBox:"0 0 16 16",width:"16",height:"16","aria-hidden":"true",children:(0,s.jsx)(n.path,{d:"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})}),"IMPORTANT"]}),"\n",(0,s.jsx)(n.p,{children:"Ensure the database user has CREATE TABLE and ALTER TABLE permissions."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"timeout-during-large-cleanup",children:"Timeout during large cleanup"}),"\n",(0,s.jsx)(n.p,{children:"For very large tables, consider:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Running during off-peak hours"}),"\n",(0,s.jsx)(n.li,{children:"Increasing PHP timeout"}),"\n",(0,s.jsx)(n.li,{children:"Breaking into smaller date ranges"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453(e,n,i){i.d(n,{R:()=>t,x:()=>r});var d=i(96540);const s={},a=d.createContext(s);function t(e){const n=d.useContext(a);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),d.createElement(a.Provider,{value:n},e.children)}}}]);