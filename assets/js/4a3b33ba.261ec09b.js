"use strict";(self.webpackChunkauditor_docs=self.webpackChunkauditor_docs||[]).push([[5228],{3153(e,n,i){i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"configuration/auditing","title":"Auditing configuration","description":"Audit configuration can be achieved using the YAML configuration file described in the General configuration section","source":"@site/auditor-bundle_versioned_docs/version-6.x/configuration/auditing.md","sourceDirName":"configuration","slug":"/configuration/auditing","permalink":"/auditor-docs/auditor-bundle/6.x/configuration/auditing","draft":false,"unlisted":false,"tags":[],"version":"6.x","frontMatter":{"title":"Auditing configuration"},"sidebar":"docs","next":{"title":"General configuration","permalink":"/auditor-docs/auditor-bundle/6.x/configuration/general"}}');var r=i(4848),d=i(8453);const a={title:"Auditing configuration"},o=void 0,s={},l=[{value:"Auditing services",id:"auditing-services",level:2},{value:"Audited entities and properties",id:"audited-entities-and-properties",level:2},{value:"Ignoring properties globally",id:"ignoring-properties-globally",level:2},{value:"Example configuration",id:"example-configuration",level:2},{value:"Attributes",id:"attributes",level:2},{value:"#Auditable",id:"auditable",level:3},{value:"#Ignore",id:"ignore",level:3},{value:"#Security",id:"security",level:3},{value:"Example using attributes",id:"example-using-attributes",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Audit configuration can be achieved using the YAML configuration file described in the ",(0,r.jsx)(n.a,{href:"general.html",children:"General"})," configuration section\nand/or using ",(0,r.jsx)(n.a,{href:"auditing.html#attributes",children:"attributes"})," (recommended)."]}),"\n",(0,r.jsx)(n.h2,{id:"auditing-services",children:"Auditing services"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," audits operations coming from Doctrine's default entity manager ",(0,r.jsx)(n.code,{children:"doctrine.orm.default_entity_manager"}),".\nThough, you can configure which entity managers are source of audit events by adding them to the ",(0,r.jsx)(n.code,{children:"auditing_services"})," list."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    providers:\n        doctrine:\n            # auditing entity managers (auditing services)\n            auditing_services:\n                - '@doctrine.orm.default_entity_manager'\n                - '@doctrine.orm.second_entity_manager'\n                - '@doctrine.orm.third_entity_manager'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"audited-entities-and-properties",children:"Audited entities and properties"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," won't audit any entity until you configure which ones have to be audited."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    providers:\n        doctrine:\n            entities:\n                App\\Entity\\MyEntity1: ~\n                App\\Entity\\MyEntity2: ~\n"})}),"\n",(0,r.jsxs)(n.p,{children:["All ",(0,r.jsx)(n.code,{children:"MyEntity1"})," and ",(0,r.jsx)(n.code,{children:"MyEntity2"})," properties will be audited.\nThough it is possible to exclude some of them from the audit process."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    providers:\n        doctrine:\n            entities:\n                App\\Entity\\MyEntity1: ~   # all MyAuditedEntity1 properties are audited\n                App\\Entity\\MyEntity2:\n                    ignored_columns:      # properties ignored by the audit process\n                        - createdAt\n                        - updatedAt\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ignoring-properties-globally",children:"Ignoring properties globally"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," audits every property of entities ",(0,r.jsx)(n.a,{href:"auditing.html#audited-entities-and-properties",children:"declared auditable"}),".\nBut, you can define some properties to be always ignored by the audit process."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    providers:\n        doctrine:\n            # columns ignored from auditing\n            ignored_columns:\n                - createdAt\n                - updatedAt\n"})}),"\n",(0,r.jsx)(n.h2,{id:"example-configuration",children:"Example configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"dh_auditor:\n    timezone: 'Europe/London'\n    providers:\n        doctrine:\n            table_prefix: ''\n            table_suffix: '_audit'\n            ignored_columns:\n                - createdAt\n                - updatedAt\n            entities:\n                MyBundle\\Entity\\MyAuditedEntity1: ~\n                MyBundle\\Entity\\MyAuditedEntity2:\n                   ignored_columns:\n                        - deletedAt\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"attributes",children:"Attributes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"doctrine-provider"})}),"\n",(0,r.jsx)(n.p,{children:"Several attributes are available and let you configure which entities are auditable,\nwhich properties should ignored and even the security requirements (roles) to view audits."}),"\n",(0,r.jsxs)(n.p,{children:["Note\nAttribute take precedence over configuration coming from ",(0,r.jsx)("code",{children:"dh_auditor.yaml"})," file."]}),"\n",(0,r.jsx)(n.h3,{id:"auditable",children:"#Auditable"}),"\n",(0,r.jsxs)(n.p,{children:["This attribute tells ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," to audit an entity. It has to be included in the entity class docblock."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\nclass MyEntity\n{\n    //...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The above example makes ",(0,r.jsx)(n.code,{children:"MyEntity"})," auditable, auditing is ",(0,r.jsx)(n.strong,{children:"enabled"})," by default."]}),"\n",(0,r.jsxs)(n.p,{children:["You can pass an ",(0,r.jsx)(n.code,{children:"enabled"})," (boolean) property to this attribute to instruct the bundle if auditing is\nenabled or not by default for this entity."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable(enabled: false)]\nclass MyEntity\n{\n    //...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The above example makes ",(0,r.jsx)(n.code,{children:"MyEntity"})," auditable, auditing is ",(0,r.jsx)(n.strong,{children:"disabled"})," by default."]}),"\n",(0,r.jsx)(n.h3,{id:"ignore",children:"#Ignore"}),"\n",(0,r.jsxs)(n.p,{children:["This attribute tells ",(0,r.jsx)(n.code,{children:"auditor-bundle"})," to ignore a property (its changes won't be audited).\nIt has to be included in the property docblock."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\nclass MyEntity\n{\n    public ?string $property1 = null;\n\n    #[Audit\\Ignore]\n    public ?string $property2 = null;\n\n    //...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The above example makes ",(0,r.jsx)(n.code,{children:"MyEntity"})," auditable, auditing is ",(0,r.jsx)(n.strong,{children:"enabled"})," by default and ",(0,r.jsx)(n.code,{children:"property2"}),"\n",(0,r.jsx)(n.strong,{children:"won't be"})," audited."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Notice:"})," ",(0,r.jsx)(n.a,{href:"auditing.html#ignoring-properties-globally",children:"globally ignored properties"}),"\ndo not have to have an ",(0,r.jsx)(n.code,{children:"#Ignore"})," attribute."]}),"\n",(0,r.jsx)(n.h3,{id:"security",children:"#Security"}),"\n",(0,r.jsx)(n.p,{children:"This attribute rules the audit viewer and lets you specify which role(s) is(are) required to allow\nthe viewer to display audits of an entity. It has to be included in the entity class docblock."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\n#[Audit\\Security(view: ['ROLE1', 'ROLE2'])]\nclass MyEntity\n{\n    public ?string $property1 = null;\n\n    //...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The above example makes the audit viewer allow access (viewing) to ",(0,r.jsx)(n.code,{children:"MyEntity"})," audits if\nthe logged in user is granted either ",(0,r.jsx)(n.code,{children:"ROLE1"})," or ",(0,r.jsx)(n.code,{children:"ROLE2"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"example-using-attributes",children:"Example using attributes"}),"\n",(0,r.jsx)(n.p,{children:"Below is an example entity configured using attributes."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Entity;\n\nuse DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[Audit\\Auditable]\n#[Audit\\Security(view: ['ROLE1', 'ROLE2'])]\nclass AuditedEntity\n{\n    public ?string $property1 = null;\n\n    #[Audit\\Ignore]\n    public ?string $property2 = null;\n\n    //...\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>o});var t=i(6540);const r={},d=t.createContext(r);function a(e){const n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);