{"searchDocs":[{"title":"What is auditor-bundle?","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x","content":"What is auditor-bundle? auditor-bundle integrates auditor library into your symfony application. This automatically wires the library to Symfony services and makes the configuration easier, everything can be configured from the dh_auditor.yaml file. Note Configuration reference is available here.","keywords":""},{"title":"Storage configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/configuration/storage","content":"","keywords":""},{"title":"Audit tables naming formatâ€‹","type":1,"pageTitle":"Storage configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/storage#audit-tables-naming-format","content":" doctrine-provider  Audit table names are composed of a prefix, a name and a suffix. By default, the prefix is empty and the suffix is _audit. Though, they can be customized.  dh_auditor: providers: doctrine: table_prefix: ~ table_suffix: '_audit'   ","tagName":"h2"},{"title":"Storage servicesâ€‹","type":1,"pageTitle":"Storage configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/storage#storage-services","content":" doctrine-provider  By default, auditor-bundle stores audits using Doctrine's default entity manager doctrine.orm.default_entity_manager. However, auditor-bundle lets you store audits using several entity managers by adding them to the storage_services list.  Note if one of the current audited entity operation fails, audit data is still persisted to the secondary database which is very bad (reference to entity data which doesn't exist in the main database or reference to entity data in main database which doesn't reflect changes logged in audit data)if one of the current audited entity operation succeed, audit data persistence in the secondary database still can fail which is bad but can be acceptable in some use cases (depending on how critical audit data is for your application/business, missing audit data could be acceptable)  ","tagName":"h2"},{"title":"Storage mapperâ€‹","type":1,"pageTitle":"Storage configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/storage#storage-mapper","content":" doctrine-provider  A storage mapper is a callable that routes audit events to storage services. It's up to the storage mapper to choose which storage service should be used to persist audits logs for a given entity.  A storage mapper expects 2 parameters as arguments and returns an object implementing StorageServiceInterface  an entity FQCN (string)the list of registered storage services indexed by name (array)  ","tagName":"h2"},{"title":"Exampleâ€‹","type":1,"pageTitle":"Storage configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/storage#example","content":" Below is an example of a storage mapper MyStorageMapper routing audit logs from MyEntity1 and MyEntity2to a particular storage service, all other audit logs are persisted by another storage service.  &lt;?php namespace App; use App\\Entity\\MyEntity1; use App\\Entity\\MyEntity2; use App\\Entity\\MyEntity3; use DH\\Auditor\\Provider\\Service\\StorageServiceInterface; /** * MyStorageMapper is an invokable service */ class MyStorageMapper { // the service expects 2 parameters and should return an object // implementing StorageServiceInterface public function __invoke(string $entity, array $storageServices): StorageServiceInterface { return \\in_array($entity, [MyEntity1::class, MyEntity2::class], true) ? $storageServices['db1'] : $storageServices['db2']; } }   # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: # Invokable service that maps audit events to storage services storage_mapper: my_storage_mapper.map_storage  ","tagName":"h3"},{"title":"General configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/configuration/general","content":"","keywords":""},{"title":"Timezoneâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#timezone","content":" auditor  You can configure the timezone the audit created_at is generated in. This by default is UTC.  dh_auditor: timezone: 'Europe/London'   ","tagName":"h2"},{"title":"Enabling/Disabling auditing (globally)â€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#enablingdisabling-auditing-globally","content":" auditor  By default, auditor-bundle audits every entity declared auditable.  It is however possible to disable audits by default. In this case, nothing is auditeduntil auditing is enabled at runtime.  dh_auditor: enabled: false   You can also enable or disable the auditing of entities per entity and at runtime if you use the built-in Doctrine provider.  ","tagName":"h2"},{"title":"User providerâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#user-provider","content":" auditor  A user provider is a service which goal is to return information about current user. auditor then invokes the user provider any time it receives an audit event.  dh_auditor: # Invokable service (callable) that provides user information user_provider: ~   ","tagName":"h2"},{"title":"Security providerâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#security-provider","content":" auditor  A security provider is a service which goal is to return security information such as current client IP, etc. auditor then invokes the security provider any time it receives an audit event.  dh_auditor: # Invokable service (callable) that provides security information (IP, firewall name, etc) security_provider: ~   ","tagName":"h2"},{"title":"Role checkerâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#role-checker","content":" auditor  A role checker is a service which goal is to return a boolean indicating whether permission to access an entity's audit logs is granted for the current user.  dh_auditor: # Invokable service (callable) that checks roles roles_checker: ~   ","tagName":"h2"},{"title":"Doctrine provider settingsâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#doctrine-provider-settings","content":" ","tagName":"h2"},{"title":"Enabling/Disabling auditing (per entity)â€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#enablingdisabling-auditing-per-entity","content":" doctrine-provider  This lets you disable audit logging for an entity by default and only enable auditing when needed for example. Per entity enabling/disabling is done in the configuration file.  dh_auditor: enabled: true # auditing is globally enabled providers: doctrine: entities: App\\Entity\\MyEntity1: enabled: false # auditing of this entity is disabled App\\Entity\\MyEntity2: ~ # auditing of this entity is enabled   In the above example, an audit table will be created for MyAuditedEntity1, but audit entries will only be saved when auditing is explicitly enabled at runtime.  ","tagName":"h3"},{"title":"Enabling/Disabling audit viewerâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#enablingdisabling-audit-viewer","content":" doctrine-provider  auditor-bundle provides an audit viewer letting you review the full history of any audited entity. This viewer is disabled by default but can easily be enabled in the configuration file as shown below and can be accessed at /audit.  dh_auditor: providers: doctrine: viewer: true   If you're using flex, you are done, routes are automatically added to your application's routing configuration (see config/routes/dh_auditor.yaml).  Otherwise, you have to manually add the following routes to the routing configuration of your application (config/routes/dh_auditor.yaml).  dh_auditor: resource: &quot;@DHAuditorBundle/Controller/&quot; type: auditor   ","tagName":"h3"},{"title":"Inheritanceâ€‹","type":1,"pageTitle":"General configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/general#inheritance","content":" doctrine-provider  This bundle supports all of Doctrine inheritance types:  mapped superclass inheritancesingle table inheritanceclass table inheritance  Note Configuring the root table to be audited does not suffice to get all child tables audited in a single table inheritance context. You have to configure every child table that needs to be audited as well. ","tagName":"h3"},{"title":"Configuration reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/configuration/reference","content":"Configuration reference # config/packages/dh_auditor.yaml dh_auditor: enabled: true timezone: 'UTC' # Invokable service (callable) that checks roles role_checker: 'dh_auditor.role_checker' # Invokable service (callable) that provides user information user_provider: 'dh_auditor.user_provider' # Invokable service (callable) that provides security information (IP, firewall name, etc) security_provider: 'dh_auditor.security_provider' providers: doctrine: table_prefix: ~ table_suffix: '_audit' # columns ignored from auditing ignored_columns: - 'createdAt' - 'updatedAt' # audited entities entities: App\\Entity\\Author: roles: view: - 'ROLE1' - 'ROLE2' App\\Entity\\Post: ~ App\\Entity\\Comment: ~ App\\Entity\\Tag: ~ # storage entity managers (storage services) storage_services: - '@doctrine.orm.default_entity_manager' # auditing entity managers (auditing services) auditing_services: - '@doctrine.orm.default_entity_manager' # Switch to enable/disable the audit viewer viewer: true # Invokable service (callable) that maps audit events to storage services storage_mapper: ~ ","keywords":""},{"title":"Contributing","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/contributing","content":"","keywords":""},{"title":"Requirementsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#requirements","content":" Before starting to contribute, you first need to install dev dependencies:  composer install --dev   You also have to install external dev tools:  composer reinstall damienharper/auditor --prefer-install=source composer install --working-dir=tools/php-cs-fixer composer install --working-dir=tools/phpstan   Also, in an effort to maintain an homogeneous code base, we strongly encourage contributors to run PHP-CS-Fixer and PHPStanbefore submitting a Pull Request.  ","tagName":"h2"},{"title":"Coding standardsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#coding-standards","content":" Coding standards are enforced using PHP-CS-Fixer  composer csfixer   ","tagName":"h2"},{"title":"Static code analysisâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#static-code-analysis","content":" Static code analysis can be achieved using PHPStan  composer phpstan   ","tagName":"h2"},{"title":"Building assetsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#building-assets","content":" As the audit viewer relies on Tailwind CSS, you need to rebuild the assets as soon as you reference new classes in templates before release.  Building assets for release (production mode -- assets are minified).  yarn encore production   Building assets for development (development mode -- assets are NOT minified).  yarn encore dev   ","tagName":"h2"},{"title":"Running Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#running-tests","content":" The test suite is configured to use an SQLite in-memory database and generates a code coverage report in tests/coverage folder.  ","tagName":"h2"},{"title":"Default configuration (SQLite)â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/6.x/contributing#default-configuration-sqlite","content":" This configuration uses an in memory SQLite database and generates code coverage report in tests/coverage folder (requires PCOV extension).  composer test  ","tagName":"h3"},{"title":"Auditing configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing","content":"","keywords":""},{"title":"Auditing servicesâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#auditing-services","content":" doctrine-provider  By default, auditor-bundle audits operations coming from Doctrine's default entity manager doctrine.orm.default_entity_manager. Though, you can configure which entity managers are source of audit events by adding them to the auditing_services list.  dh_auditor: providers: doctrine: # auditing entity managers (auditing services) auditing_services: - '@doctrine.orm.default_entity_manager' - '@doctrine.orm.second_entity_manager' - '@doctrine.orm.third_entity_manager'   ","tagName":"h2"},{"title":"Audited entities and propertiesâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#audited-entities-and-properties","content":" doctrine-provider  By default, auditor-bundle won't audit any entity until you configure which ones have to be audited.  dh_auditor: providers: doctrine: entities: App\\Entity\\MyEntity1: ~ App\\Entity\\MyEntity2: ~   All MyEntity1 and MyEntity2 properties will be audited. Though it is possible to exclude some of them from the audit process.  dh_auditor: providers: doctrine: entities: App\\Entity\\MyEntity1: ~ # all MyAuditedEntity1 properties are audited App\\Entity\\MyEntity2: ignored_columns: # properties ignored by the audit process - createdAt - updatedAt   ","tagName":"h2"},{"title":"Ignoring properties globallyâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#ignoring-properties-globally","content":" doctrine-provider  By default, auditor-bundle audits every property of entities declared auditable. But, you can define some properties to be always ignored by the audit process.  dh_auditor: providers: doctrine: # columns ignored from auditing ignored_columns: - createdAt - updatedAt   ","tagName":"h2"},{"title":"Example configurationâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#example-configuration","content":" doctrine-provider  dh_auditor: timezone: 'Europe/London' providers: doctrine: table_prefix: '' table_suffix: '_audit' ignored_columns: - createdAt - updatedAt entities: MyBundle\\Entity\\MyAuditedEntity1: ~ MyBundle\\Entity\\MyAuditedEntity2: ignored_columns: - deletedAt     ","tagName":"h2"},{"title":"Attributesâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#attributes","content":" doctrine-provider  Several attributes are available and let you configure which entities are auditable, which properties should ignored and even the security requirements (roles) to view audits.  Note Attribute take precedence over configuration coming from dh_auditor.yaml file.  ","tagName":"h2"},{"title":"Auditableâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#auditable","content":" This attribute tells auditor-bundle to audit an entity. It has to be included in the entity class docblock.  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] class MyEntity { //... }   The above example makes MyEntity auditable, auditing is enabled by default.  You can pass an enabled (boolean) property to this attribute to instruct the bundle if auditing is enabled or not by default for this entity.  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable(enabled: false)] class MyEntity { //... }   The above example makes MyEntity auditable, auditing is disabled by default.  ","tagName":"h3"},{"title":"Ignoreâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#ignore","content":" This attribute tells auditor-bundle to ignore a property (its changes won't be audited). It has to be included in the property docblock.  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] class MyEntity { public ?string $property1 = null; #[Audit\\Ignore] public ?string $property2 = null; //... }   The above example makes MyEntity auditable, auditing is enabled by default and property2won't be audited.  Notice: globally ignored propertiesdo not have to have an #Ignore attribute.  ","tagName":"h3"},{"title":"Securityâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#security","content":" This attribute rules the audit viewer and lets you specify which role(s) is(are) required to allow the viewer to display audits of an entity. It has to be included in the entity class docblock.  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE1', 'ROLE2'])] class MyEntity { public ?string $property1 = null; //... }   The above example makes the audit viewer allow access (viewing) to MyEntity audits if the logged in user is granted either ROLE1 or ROLE2.  ","tagName":"h3"},{"title":"Example using attributesâ€‹","type":1,"pageTitle":"Auditing configuration","url":"/auditor-docs/auditor-bundle/6.x/configuration/auditing#example-using-attributes","content":" Below is an example entity configured using attributes.  &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE1', 'ROLE2'])] class AuditedEntity { public ?string $property1 = null; #[Audit\\Ignore] public ?string $property2 = null; //... }  ","tagName":"h3"},{"title":"User provider setup","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/customization/user-provider","content":"","keywords":""},{"title":"Built-in user providerâ€‹","type":1,"pageTitle":"User provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/user-provider#built-in-user-provider","content":" auditor  auditor-bundle provides a default built-in user provider based on Symfony's TokenStorage, but if you don't use TokenStorage, you can still provide a custom user provider.  ","tagName":"h2"},{"title":"Custom user providerâ€‹","type":1,"pageTitle":"User provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/user-provider#custom-user-provider","content":" auditor  First you need to provide a service implementing the UserProviderInterface interface and reference it in the dh_auditor.yaml. This service has to be a callable and returns user information as an object implementing DH\\Auditor\\User\\UserInterface.  ","tagName":"h2"},{"title":"Exampleâ€‹","type":1,"pageTitle":"User provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/user-provider#example","content":" &lt;?php namespace App\\Audit\\User; use DH\\Auditor\\User\\UserInterface; use DH\\Auditor\\User\\UserProviderInterface; class UserProvider implements UserProviderInterface { public function __invoke(): ?UserInterface { // ... do your stuff here to get current user // then return an object implementing `DH\\Auditor\\User\\UserInterface` ... } }   # config/services.yaml services: dh_auditor.user_provider: '@App\\Audit\\UserProvider'   And finally, reference it in the bundle's configuration file dh_auditor.yaml.  # config/packages/dh_auditor.yaml dh_auditor: # Invokable service (callable) that provides user information user_provider: 'dh_auditor.user_provider'  ","tagName":"h3"},{"title":"Role checker setup","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/customization/role-checker","content":"","keywords":""},{"title":"Built-in role checkerâ€‹","type":1,"pageTitle":"Role checker setup","url":"/auditor-docs/auditor-bundle/6.x/customization/role-checker#built-in-role-checker","content":" auditor  auditor-bundle provides a default built-in role checker based on Symfony's Security, but if you don't use this component, you can still provide a custom role checker.  ","tagName":"h2"},{"title":"Custom role checkerâ€‹","type":1,"pageTitle":"Role checker setup","url":"/auditor-docs/auditor-bundle/6.x/customization/role-checker#custom-role-checker","content":" auditor  First you need to provide a service implementing the RoleCheckerInterface interface and reference it in the dh_auditor.yaml. This service has to be a callable and returns a boolean.  ","tagName":"h2"},{"title":"Exampleâ€‹","type":1,"pageTitle":"Role checker setup","url":"/auditor-docs/auditor-bundle/6.x/customization/role-checker#example","content":" &lt;?php namespace App\\Audit\\Security; use DH\\Auditor\\Security\\RoleCheckerInterface; class RoleChecker implements RoleCheckerInterface { public function __invoke(string $entity, string $scope): bool { // ... do your stuff here to check if access (scope) is granted // then return it as `bool` ... } }   # config/services.yaml services: dh_auditor.role_checker: '@App\\Audit\\RoleChecker'   And finally, reference it in the bundle's configuration file dh_auditor.yaml.  # config/packages/dh_auditor.yaml dh_auditor: # Invokable service (callable) that checks roles role_checker: 'dh_auditor.role_checker'  ","tagName":"h3"},{"title":"Installation","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/installation","content":"","keywords":""},{"title":"Requirementsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/6.x/installation#requirements","content":" Version\tStatus\tRequirements5.x\tActive development ðŸš€\tPHP &gt;= 7.4, Symfony &gt;= 4.4 4.x\tActive support\tPHP &gt;= 7.2, Symfony &gt;= 3.4 3.x\tEnd of life\tPHP &gt;= 7.1, Symfony &gt;= 3.4 2.x\tEnd of life\tPHP &gt;= 7.1, Symfony &gt;= 3.4 1.x\tEnd of life\tPHP &gt;= 7.1, Symfony &gt;= 3.4  ","tagName":"h2"},{"title":"1. Applications that use Symfony Flexâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/6.x/installation#1-applications-that-use-symfony-flex","content":" Open a command console, enter your project directory and execute:  composer require damienharper/auditor-bundle   ","tagName":"h2"},{"title":"2. Applications that don't use Symfony Flexâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/6.x/installation#2-applications-that-dont-use-symfony-flex","content":" ","tagName":"h2"},{"title":"2.1 Download the Bundleâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/6.x/installation#21-download-the-bundle","content":" Open a command console, enter your project directory and execute the following command to download the latest stable version of this bundle:  composer require damienharper/auditor-bundle   ","tagName":"h3"},{"title":"2.2 Enable the Bundleâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/6.x/installation#22-enable-the-bundle","content":" Then, enable the bundle by adding it to the list of registered bundles in the app/AppKernel.php file of your project:  &lt;?php // app/AppKernel.php // ... class AppKernel extends Kernel { public function registerBundles() { $bundles = array( // ... new DH\\AuditorBundle\\DHAuditorBundle(), ); // ... } // ... }  ","tagName":"h3"},{"title":"Security provider setup","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/customization/security-provider","content":"","keywords":""},{"title":"Built-in security providerâ€‹","type":1,"pageTitle":"Security provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/security-provider#built-in-security-provider","content":" auditor  auditor-bundle provides a default built-in security provider based on Symfony's RequestStack and FirewallMap, but if you don't use those components, you can still provide a custom security provider.  ","tagName":"h2"},{"title":"Custom security providerâ€‹","type":1,"pageTitle":"Security provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/security-provider#custom-security-provider","content":" auditor  First you need to provide a service implementing the SecurityProviderInterface interface and reference it in the dh_auditor.yaml. This service has to be a callable and returns security information as an array of client IP and firewall name.  ","tagName":"h2"},{"title":"Exampleâ€‹","type":1,"pageTitle":"Security provider setup","url":"/auditor-docs/auditor-bundle/6.x/customization/security-provider#example","content":" &lt;?php namespace App\\Audit\\Security; use DH\\Auditor\\Security\\SecurityProviderInterface; class SecurityProvider implements SecurityProviderInterface { public function __invoke(): array { // ... do your stuff here to get current client IP and firewall name // then return them in an `array` ... } }   # config/services.yaml services: dh_auditor.security_provider: '@App\\Audit\\SecurityProvider'   And finally, reference it in the bundle's configuration file dh_auditor.yaml.  # config/packages/dh_auditor.yaml dh_auditor: # Invokable service (callable) that provides security information (IP, firewall name, etc) security_provider: 'dh_auditor.security_provider'  ","tagName":"h3"},{"title":"Upgrading","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/upgrading","content":"","keywords":""},{"title":"Upgrading from DoctrineAuditBundleâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#upgrading-from-doctrineauditbundle","content":" DoctrineAuditBundle is now deprecated since it has been split into two separate packages  auditor the core libraryauditor-bundle a Symfony bundle providing auditor integration into Symfony applications  So, upgrading from DoctrineAuditBundle to auditor + auditor-bundle requires a few steps  ","tagName":"h2"},{"title":"1. Configuration fileâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#1-configuration-file","content":" Create a new configuration file dh_auditor.yaml(full configuration reference available here)  Minimal config file:  dh_auditor: enabled: true providers: doctrine: table_prefix: ~ table_suffix: '_audit'   ","tagName":"h3"},{"title":"2. Add auditor-bundle as a dependencyâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#2-add-auditor-bundle-as-a-dependency","content":" Run the following command in a console  composer require damienharper/auditor-bundle ^4.0   ","tagName":"h3"},{"title":"3. Fix annotation namespace changesâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#3-fix-annotation-namespace-changes","content":" Replace the use statement related to Audit annotation to reference the new namespace in your entities.  - use DH\\DoctrineAuditBundle\\Annotation as Audit; + use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;   ","tagName":"h3"},{"title":"4. Fix route name changesâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#4-fix-route-name-changes","content":" Reference the new routes in the config/routes.yaml  - dh_doctrine_audit: - resource: &quot;@DHDoctrineAuditBundle/Controller/&quot; - type: annotation + dh_auditor: + resource: &quot;@DHAuditorBundle/Controller/&quot; + type: annotation   Route names have been renamed, change them accordingly in your code. You'll find below a summary of route name changes.  Before (DoctrineAuditBundle route name)\tAfter (auditor-bundle route name)dh_doctrine_audit_list_audits\tdh_auditor_list_audits dh_doctrine_audit_show_transaction\tdh_auditor_show_transaction dh_doctrine_audit_show_entity_history\tdh_auditor_show_entity_history  ","tagName":"h3"},{"title":"5. AuditReader deprecationâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#5-auditreader-deprecation","content":" AuditReader has been replaced by Reader and Query objects, so if you used it to query the audit logs, dive into the Querying audits section  ","tagName":"h3"},{"title":"6. Remove DoctrineAuditBundleâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#6-remove-doctrineauditbundle","content":" Run the following command in a console  composer remove damienharper/doctrine-audit-bundle   ","tagName":"h3"},{"title":"7. Ensure your schema is up to dateâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#7-ensure-your-schema-is-up-to-date","content":" Check the Upgrading from a previous versionbelow to ensure your schema is up to date.    ","tagName":"h3"},{"title":"Upgrading from a previous versionâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor-bundle/6.x/upgrading#upgrading-from-a-previous-version","content":" Once you upgraded the bundle to a newer version, you first have to be sure your current schema is up to date and upgrade it if necessary.  The following command does all of this for you:  # symfony &lt; 3.4 app/console audit:schema:update --force   # symfony &gt;= 3.4 bin/console audit:schema:update --force  ","tagName":"h2"},{"title":"Events","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/events","content":"","keywords":""},{"title":"Subscribing to audit eventsâ€‹","type":1,"pageTitle":"Events","url":"/auditor-docs/auditor-bundle/6.x/usage/events#subscribing-to-audit-events","content":" auditor  First you have to create an event subscriber that listens to LifecycleEvent events.  &lt;?php namespace App\\Event; use DH\\Auditor\\Event\\LifecycleEvent; use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface; class MySubscriber implements EventSubscriberInterface { public static function getSubscribedEvents(): array { return [ LifecycleEvent::class =&gt; 'onAuditEvent', ]; } public function onAuditEvent(LifecycleEvent $event): LifecycleEvent { // do your stuff here... return $event; } }   Then, any time a LifecycleEvent is fired, the MySubscriber::onAuditEvent() method will be run with the event as an argument. ","tagName":"h2"},{"title":"Enabling and disabling auditor at runtime","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/enabling-disabling-at-runtime","content":"","keywords":""},{"title":"Enabling/Disabling at runtimeâ€‹","type":1,"pageTitle":"Enabling and disabling auditor at runtime","url":"/auditor-docs/auditor-bundle/6.x/usage/enabling-disabling-at-runtime#enablingdisabling-at-runtime","content":" doctrine-provider  You can disable audit logging at runtime by calling DH\\Auditor\\Provider\\Doctrine\\Configuration::disableAuditFor(string $entity). This will prevent the system from logging changes applied to $entity objects.  You can then re-enable audit logging at runtime by calling DH\\Auditor\\Provider\\Doctrine\\Configuration::enableAuditFor(string $entity).  To disable auditing for an entity, you first have to inject the dh_auditor.provider.doctrineservice in your class, then use:  $provider-&gt;getConfiguration()-&gt;disableAuditFor(MyEntity1::class);   To enable auditing afterwards, use:  $provider-&gt;getConfiguration()-&gt;enableAuditFor(MyEntity1::class);  ","tagName":"h2"},{"title":"Cleaning up audit entries","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/maintenance","content":"Cleaning up audit entries auditor provides a convenient command that helps you cleaning audit tables. Open a command console, enter your project directory and execute: # symfony &lt; 3.4 app/console audit:clean # symfony &gt;= 3.4 bin/console audit:clean By default it cleans audit entries older than 12 months. You can override this by providing the number of months you want to keep in the audit tables. For example, to keep 18 months: # symfony &lt; 3.4 app/console audit:clean 18 # symfony &gt;= 3.4 bin/console audit:clean 18 It is also possible to bypass the confirmation and make the command non-interactive if you plan to schedule it (ie. cron) # symfony &lt; 3.4 app/console audit:clean --no-confirm # symfony &gt;= 3.4 bin/console audit:clean --no-confirm ","keywords":""},{"title":"Audit viewer","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/viewer","content":"Audit viewer auditor-bundle provides a built in viewer letting you review the full history of any audited entity. It is disabled by default but can easily be enabled in the configuration file and can be accessed by browsing to /audit.","keywords":""},{"title":"Release Notes","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/release-notes","content":"","keywords":""},{"title":"Version 5.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#version-5x","content":" ","tagName":"h2"},{"title":"auditor-bundle v5.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v500","content":" Not yet released  Changesâ€‹  Drop PHP 7.2 support.Drop Symfony 3.4 support.    ","tagName":"h3"},{"title":"Version 4.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#version-4x","content":" ","tagName":"h2"},{"title":"auditor-bundle v4.2.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v420","content":" 2021-09-27  Fixesâ€‹  #261 - Fixes multiple storage services setup#273 - Fix deprecation notice regarding twig usage from controller#274 - Attempt to fix dependabot alert (CVE-2019-10909)  Changesâ€‹  #252 - Added dutch translations#255 - Viewer is disabled by default#262 - Move the translation domain to auditor    ","tagName":"h3"},{"title":"auditor-bundle v4.1.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v410","content":" 2021-02-10  Changesâ€‹  #242 - Incompatible symfony/doctrine-bridge    ","tagName":"h3"},{"title":"auditor-bundle v4.0.4â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v404","content":" 2021-01-25  Changesâ€‹  #238 - Symfony 3.4 compatibility#239, #241- Add estonian (ET) translation#240 - Improved german translationsFixed link tag    ","tagName":"h3"},{"title":"auditor-bundle v4.0.3â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v403","content":" 2020-12-11  Changesâ€‹  Updated CI to ensure proper Symfony versions are installed during tests (3.4, 4.4 and 5.x are tested)    ","tagName":"h3"},{"title":"auditor-bundle v4.0.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v402","content":" 2020-12-08  Changesâ€‹  Fixed a BC break with Symfony 4.3/4.4    ","tagName":"h3"},{"title":"auditor-bundle v4.0.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v401","content":" 2020-12-07  Changesâ€‹  #224 - Changed auditor requirement from dev-master to ^1.0    ","tagName":"h3"},{"title":"auditor-bundle v4.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#auditor-bundle-v40","content":" 2020-12-06  What's newâ€‹  DoctrineAuditBundle has been split into two different packages: auditor the core libraryauditor-bundle a Symfony bundle providing auditor integration into Symfony applications PHP 7.1 is not supported anymore.  Breaking changesâ€‹  Pretty much everything has been rewritten so public API and namespaces have changed.  How to upgrade?â€‹  You'll find a detailed upgrade guide here.    ","tagName":"h3"},{"title":"Version 3.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#version-3x","content":" ","tagName":"h2"},{"title":"DoctrineAuditBundle v3.4.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v342","content":" 2020-11-26  Fixesâ€‹  #200 - Template static datetime fix#221 - Remove the ROLE_PREVIOUS_ADMIN deprecation warning from Symfony 5.1#214 - Handle TableNotFoundException#204 - Migration postUp    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.4.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v341","content":" 2020-04-27  Changesâ€‹  Add operation type constantsAudit operations were stored in reverse order in a transaction    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.4.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v340","content":" 2020-03-29  Starting today (2020-03-29), 4.x development begins in master branch. A 3.x branch has also been created and will host any 3.x related development.  Note that 4.x will drop PHP 7.1 support.  What's newâ€‹  Added support for reading audits by date range (thanks to @McAnix)Cleanup command accepts an ISO 8601 date interval (thanks to @patrickmatsumura)  Changesâ€‹  Added audited entity FQCN to event payloadAvoid proxy references in audit entries  Fixesâ€‹  #144 - Let the cleanup command accept an ISO 8601 duration#169 - why DH\\DoctrineAuditBundle\\User\\UserInterface::getId() must return int|string|null?#171 - Add class name of the audited entity to the data array#177 - Delete operations save the proxy discriminator    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.3.3â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v333","content":" 2020-02-07  Changesâ€‹  Fixed PHP 7.1 BC break    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.3.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v332","content":" 2020-02-07  Changesâ€‹  Fixed a BC break with Symfony 4.3/4.4    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.3.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v331","content":" 2020-02-07  Changesâ€‹  Fixed a deprecation warning with Symfony 4.3+Adjusted PHPStan rulesUpdated CHANGELOG.md    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.3.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v330","content":" 2020-02-06  What's newâ€‹  Add a configuration option for enabling/disabling audit viewer (thanks to @p365labs)Add french, english, spanish, italian and german translations (thanks to @p365labs)  Changesâ€‹  Fixed some Doctrine deprecationsFixed pager when viewing a entity history with lots of entriesFixed display of boolean values in the audit viewerPHPStan fixes (thanks to @patrickmatsumura, @DamienHarper)Documentation updates (thanks to @Jonathan-Lathiere, @DamienHarper)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.2.3â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v323","content":" 2019-12-05  Changesâ€‹  Updated twig dependenciesFix a BC break introduced in 3.2.2 (#142)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.2.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v322","content":" 2019-12-03  Changesâ€‹  Fixed pagination when the pager has a lot of pagesFixed documentation related to @Security annotation (thanks to @jean-gui)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.2.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v321","content":" 2019-12-02  Changesâ€‹  Restored AuditReader::getAuditsCount() which was removed by error in 3.2.0    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.2.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v320","content":" 2019-12-02  Changesâ€‹  Symfony 5 supportPHP 7.4 supportFixed audit not capturing some entity mutation coming from other Doctrine linteners/subscribers (fixes #122)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.1.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v310","content":" 2019-11-21  Changesâ€‹  Fixed Doctrine deprecationsEnsure compatibility with doctrine/dbal &lt;2.10.0Fixed table layout in the timeline (thanks to @Jonathan-Lathiere)Allow to filter audits using multiple filter values in AuditReader::filterBy()    ","tagName":"h3"},{"title":"DoctrineAuditBundle v3.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v300","content":" 2019-11-01  What's newâ€‹  Annotation support: audit configuration (audited entities, ignored columns, etc) can be done mostly using annotations in entities.Audit events: an audit event is dispatched for every audit entry opening the doors to add custom behavior on audit entry creation.Security controls: audit access can be now restricted to specific roles.The bundle now supports non numeric IDs for the User objects (thanks to @Gonzalo1987).A transaction hash is now stored in audit tables and makes it easier to identify all operations performed in the same transaction. The timeline now displays a transaction hash for each element. By clicking a transaction hash, you get a complete overview of all the operations included into the transaction.AuditReader::getAudits() now accepts a transaction hash as fifth parameter to return audits logged in the given transaction for the given entity.AuditReader::getAuditsByTransactionHash() accepts a transaction hash as parameter and returns all the audits logged in the given transaction. Better single table (SINGLE_TABLE) inheritance support. AuditReader::getAudits() now accepts a boolean as sixth parameter to return either audits for the given entity only or audits for the given entity hierarchy. Add class table (JOINED) inheritance support (thanks to @versh23).Performance enhancements when saving a lot of entities at once (thanks to @acanicatti).Removed deprecation messages (thanks to @maxhelias).Fixed an issue with audit:schema:update command when run against a database with no audit table.A few icons have been added in the timeline.Revamped documentation.  Breaking changesâ€‹  The structure of audit tables has changed so you have to run the migration command right after updatingAuditEntry::getUserId() now return a string or null instead of an int.When using a secondary database Doctrine's doctrine:schema:update command do not create audit tables automatically anymore (this command cannot work with multiple databases simultaneously), use the bundled migration command instead which supports the same options as Doctrine's command. bin/console audit:schema:update --dump-sql prints SQL queries that need be executed.bin/console audit:schema:update --force executes relevant SQL queries. Configuration has changed to use a secondary database: you now only need to declare the dedicated entity manager in configuration file as described here.The bundle requires mbstring extension (cf. https://www.php.net/manual/en/mbstring.installation.php).  How to upgrade?â€‹  Either update your composer.json file manually to include &quot;damienharper/doctrine-audit-bundle&quot;: &quot;^3.0&quot;or run  composer require damienharper/doctrine-audit-bundle ^3.0   Due to internal changes requiring new columns and blame_id column type change, run the migration command after updating the bundle to update the structure of your current audit tables.  bin/console audit:schema:update --force     ","tagName":"h3"},{"title":"Version 2.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#version-2x","content":" ","tagName":"h2"},{"title":"DoctrineAuditBundle v2.5.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v250","content":" 2019-09-04  Changesâ€‹  Add an option to globally enable/disable auditing from configuration file (thanks to @MylesKingsnorth01)Allow to use a custom entity manager/secondary database for audits (thanks to @pawello92)Warning: Using a custom entity manager/secondary database breaks atomicity because audited entity operation and audit storage are performed into different transactions.    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.4.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v240","content":" 2019-08-19  Changesâ€‹  Fix deprecated usage of spaceless tag (thanks to @maxhelias)Timezone can be set from configuration file. It affects audit entries creation date and defaults to UTC (thanks to @MylesKingsnorth01)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.3.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v232","content":" 2019-07-29  Changesâ€‹  Add a new AuditReader:getEntityTableAuditName() method allowing to retrieve the audit table name for an entity (#68)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.3.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v231","content":" 2019-06-13  Changesâ€‹  Fix Unknown &quot;spaceless&quot; filter encountered in some configurations (#65)Updated README.md regarding Symfony 3.4 configuration and Unknown &quot;pagerfanta&quot; function error (#64)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.3.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v230","content":" 2019-04-18  Changesâ€‹  Add a way to globally enable and disable audit at runtime (#61 thanks to @webmasterMeyers)Fixed a Windows compatibility issue regarding URLs including backslashes (fixes #62)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.2.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v220","content":" 2019-04-15  Changesâ€‹  Performance improvements in audit viewerPaginated timelinelistAuditsAction() now also include disabled entities (fixes #58)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.1.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v210","content":" 2019-04-12  Changesâ€‹  Reworked default templates to display audit entries in a timeline instead of a simple tabular view.Fixed some deprecated referencesAuditReader::getAudits() and AuditController::showEntityHistoryAction() do not return the first 50 history items anymore but the full history. Though, it is still possible to get only a few items by specifying $pageSize and $page argumentsREADME.md adjustments  Breaking changesâ€‹  Some default templates have been renamed    ","tagName":"h3"},{"title":"DoctrineAuditBundle v2.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v200","content":" 2019-03-25  Changesâ€‹  Complete rewrite of many internal parts to improve testability and lessen complexity.Migration command allowing to change structure of concrete (currently used) audit tables.Tables with non numeric primary keys auditing support (closes #37)Firewall name and user object's Fully Qualified Domain Name are now stored in audit table (cf. #14)Improved unit testsNew design of included audit viewer templates (now Bootstrap 4 based)demo app showing off included audit viewer templates  Breaking changesâ€‹  The structure of audit tables has changed so you have to run the migration command right after updatingAuditReader and AuditEntry have been moved from DH\\DoctrineAuditBundle namespace to DH\\DoctrineAuditBundle\\Reader namespace.AuditEntry::getUserId() and AuditEntry::getUsername() now return null (instead of &quot;Unknown&quot;) when user is undefined  How to upgrade?â€‹  Either update your composer.json file manually to include &quot;damienharper/doctrine-audit-bundle&quot;: &quot;^2.0&quot;or run  composer require damienharper/doctrine-audit-bundle ^2.0   Due to internal changes requiring new columns and object_id column type change, run the migration command after updating the bundle to update the structure of your current audit tables.  bin/console audit:schema:update     ","tagName":"h3"},{"title":"Version 1.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#version-1x","content":" ","tagName":"h2"},{"title":"DoctrineAuditBundle v1.6.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v160","content":" 2019-03-04  Changesâ€‹  Unit tests and code coverageTravis CI integrationAdd support to Identity through foreign Entities (fixes #40)Better handling of Proxy objects (fixes #44)  Breaking changesâ€‹  table key in diffs (understand join table) is now present only when auditing associate/dissociate operations regarding ManyToMany relationships    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.5.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v150","content":" 2019-02-06  Changesâ€‹  Tracking of impersonator in blame_user column (@webmasterMeyers)Add aliases for @dh_doctrine_audit.configuration and dh_doctrine_audit.reader services (fixes #36)README.md adjustments    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.4.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v140","content":" 2019-01-28  Changesâ€‹  Schema support (fixes #32, thanks to @DrummerKH)Do not consider an entity as audited if its parent is (fixes #34)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.3.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v130","content":" 2019-01-21  Changesâ€‹  Add a way to enable/disable auditing for an entity at runtime (@eduardoweiland)    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.2.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v120","content":" 2018-12-13  Changesâ€‹  Custom user provider support (thanks @eduardoweiland)Small FAQ update    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.1.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v110","content":" 2018-12-05  Changesâ€‹  Added a way to filter audit entries by type in the bundled controller (thanks @kl3sk)Added an FAQ section to the README (thanks @kl3sk)Removed unneeded dependency to SensioFrameworkExtraBundle (fixes #22)  Breaking changesâ€‹  Entries of type AuditReader::DISSOCIATE now refers to owning side ID in object_id field (fixes #4)Creation date of audit entries are now in UTC timezone    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.8â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v108","content":" 2018-07-19    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.7â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v107","content":" 2018-06-22    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.6â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v106","content":" 2018-05-04    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.5â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v105","content":" 2018-03-22    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.4â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v104","content":" 2018-03-17    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.3â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v103","content":" 2018-03-12    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.2â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v102","content":" 2018-03-08    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v101","content":" 2018-02-10    ","tagName":"h3"},{"title":"DoctrineAuditBundle v1.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor-bundle/6.x/release-notes#doctrineauditbundle-v100","content":" 2018-02-08  Initial release ","tagName":"h3"},{"title":"Schema","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation","content":"","keywords":""},{"title":"Creating audit tablesâ€‹","type":1,"pageTitle":"Schema","url":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation#creating-audit-tables","content":" doctrine-provider  The process of audit table creation differs depending on your current setup:  single storage service setup: audit tables are stored in the same database than audited ones (most common use case)multiple storage services setup: audit tables are stored in a multiple databases  ","tagName":"h2"},{"title":"Single storage service setup (most common use case)â€‹","type":1,"pageTitle":"Schema","url":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation#single-storage-service-setup-most-common-use-case","content":" Open a command console, enter your project directory and execute the following command to review the new audit tables in the update schema queue.  # symfony &lt; 3.4 app/console doctrine:schema:update --dump-sql   # symfony &gt;= 3.4 bin/console doctrine:schema:update --dump-sql   Using DoctrineMigrationsBundleâ€‹  see DoctrineMigrationsBundle  # symfony &lt; 3.4 app/console doctrine:migrations:diff app/console doctrine:migrations:migrate   # symfony &gt;= 3.4 bin/console doctrine:migrations:diff bin/console doctrine:migrations:migrate   Using Doctrine Schemaâ€‹  # symfony &lt; 3.4 app/console doctrine:schema:update --force   # symfony &gt;= 3.4 bin/console doctrine:schema:update --force   ","tagName":"h3"},{"title":"Multiple storage services setupâ€‹","type":1,"pageTitle":"Schema","url":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation#multiple-storage-services-setup","content":" Doctrine Schema-Tool and DoctrineMigrationsBundle are not able to work with more than one database at once. To workaround that limitation, this bundle offers a migration command that focuses on audit schema manipulation.  Open a command console, enter your project directory and execute the following command to review the new audit tables in the update schema queue.  # symfony &lt; 3.4 app/console audit:schema:update --dump-sql   # symfony &gt;= 3.4 bin/console audit:schema:update --dump-sql   Once you're done, execute the following command to apply.  # symfony &lt; 3.4 app/console audit:schema:update --force   # symfony &gt;= 3.4 bin/console audit:schema:update --force     ","tagName":"h3"},{"title":"Updating the schemaâ€‹","type":1,"pageTitle":"Schema","url":"/auditor-docs/auditor-bundle/6.x/usage/schema-manipulation#updating-the-schema","content":" doctrine-provider  After updating auditor library of auditor-bundle, the schema might need to be updated, you can do so by using the audit:schema:update command.  This ensures that:  all audit tables are createdall audit tables have the expected structure and updates them if needed  Open a command console, enter your project directory and execute the following command to review the new audit tables in the update schema queue.  # symfony &lt; 3.4 app/console audit:schema:update --dump-sql   # symfony &gt;= 3.4 bin/console audit:schema:update --dump-sql   Once you're done, execute the following command to apply.  # symfony &lt; 3.4 app/console audit:schema:update --force   # symfony &gt;= 3.4 bin/console audit:schema:update --force  ","tagName":"h2"},{"title":"Querying audits","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/6.x/usage/querying","content":"","keywords":""},{"title":"Readerâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#reader","content":" doctrine-provider  The Reader makes it easy to query and retrieve audits from the storage. It heavily relies on the Query object and takes care of checking roles and auditable state of a given entity.  The Reader takes a provider as the only parameter of its constructor.  Example:  $reader = new Reader($provider);   ","tagName":"h2"},{"title":"Preparing a queryâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#preparing-a-query","content":" Querying the audits is done by preparing a query and running it. Creating a query is done by calling Reader::createQuery(string $entity, array $options = []): Query  Example:  $reader = new Reader($provider); // creates a query on Author audits without any option set // this would return all the author audits $query = $reader-&gt;createQuery(Author::class);   It is possible to specify filters to be applied to the created query using the $options parameter.  type add a filter on the audit type (INSERT, UPDATE, REMOVE, ASSOCIATE, DISSOCIATE)object_id add a filter on the audited element IDtransaction_hash add a filter on the transaction hashpage will select the given page of entriespage_size defines the page size  Examples:  $reader = new Reader($provider); // creates a query on Author audits with a filter on the object ID // audits of the author which ID is not 5 will be filtered out. $query = $reader-&gt;createQuery(Author::class, [ 'object_id' =&gt; 5, ]); // the above code could also be written like this use \\DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter; $query = $reader -&gt;createQuery(Author::class) -&gt;addFilter(new SimpleFilter(Query::OBJECT_ID, 5)); ;   ","tagName":"h3"},{"title":"Retrieving auditsâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#retrieving-audits","content":" Once a query has been created and prepared, it has to be executed to retrieve audits.  Example:  $reader = new Reader($provider); // creates a query on Author audits $query = $reader-&gt;createQuery(Author::class); // retrieves audit entries for Author entity /** @var DH\\Auditor\\Model\\Entry[] $audits */ $audits = $query-&gt;execute(); // retrieves audit entries for Author entity (oneliner) /** @var DH\\Auditor\\Model\\Entry[] $audits */ $audits = $reader-&gt;createQuery(Author::class)-&gt;execute();   Note Retrieving audits using the above method is scoped to a single entity. A transaction generally spans across multiple entities so retrieving audit entries belonging to a transaction could be tough.  To make it easier, a dedicated method is available: Reader::getAuditsByTransactionHash(string $transactionHash): array  Example:  $reader = new Reader($provider); // retrieves audit entries across all entities for the given transaction hash: '123abc' /** @var DH\\Auditor\\Model\\Entry[] $audits */ $audits = $reader-&gt;getAuditsByTransactionHash('123abc');     ","tagName":"h3"},{"title":"Queryâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#query","content":" doctrine-provider  The Query object is a thin wrapper on top of Doctrine's Doctrine\\DBAL\\Query\\QueryBuilder. It allows to query and retrieve audits from the storage.  The Query object takes both a table name and a connection (Doctrine) as parameters of its constructor.  Example:  // create a Query object to query/retrieve data from `author_audit` table. $query = new Query('author_audit', $connection);   ","tagName":"h2"},{"title":"Filtersâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#filters","content":" By default, a query object will return all the audit entries of the related table when executed. This can be a very expensive task (both time and memory consuming) and ultimately of little interest. But of course, you can refine the query by adding filters.  There are three types of filters:  standard filterrange filterdate range filter  You can get the list of available filters by calling Query::getSupportedFilters()  This method will return an array of available filters. They also are available as constants of the Query class.  Query::TYPE allows to filter by audit type (INSERT, UPDATE, REMOVE, ASSOCIATE, DISSOCIATE)Query::CREATED_AT allows to filter by audit creation date and timeQuery::TRANSACTION_HASH allows to filter by transaction hashQuery::OBJECT_ID allows to filter by audited element IDQuery::USER_ID allows to filter by userQuery::ID allows to filter by audit IDQuery::DISCRIMINATOR allows to filter by discriminator (cf. Doctrine inheritance)  Standard filterâ€‹  A standard filter is materialized by SimpleFilter class.  Since 1.2.0, method Query::addFilter(string $name, $value): self is deprecatedin favor of Query::addFilter(FilterInterface $filter): self  Examples:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter; // filtering audit entries whose transaction hash is exactly '123abc' $query = new Query('author_audit', $connection); $query-&gt;addFilter(new SimpleFilter(Query::TRANSACTION_HASH, '123abc')); // filtering audit entries whose transaction hash is either '123abc', '456def' or '789ghi' $query = new Query('author_audit', $connection); $query-&gt;addFilter(new SimpleFilter(Query::TRANSACTION_HASH, ['123abc', '456def', '789ghi']));   Range filterâ€‹  A range filter is materialized by RangeFilter class.  Since 1.2.0, method Query::addRangeFilter(string $name, $minValue = null, $maxValue = null): self is deprecatedin favor of Query::addFilter(FilterInterface $filter): self  Note Bounds ($minValue and $maxValue) can't be null simultaneously.  Examples:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter; // filtering audit entries whose object ID (author ID) is &gt;= 10 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new RangeFilter(Query::OBJECT_ID, 10)); // filtering audit entries whose object ID (author ID) is &lt;= 10 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new RangeFilter(Query::OBJECT_ID, null, 10)); // filtering audit entries whose object ID (author ID) is &gt;= 10 and &lt;= 25 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new RangeFilter(Query::OBJECT_ID, 10, 25));   Date range filterâ€‹  A date range filter is materialized by DateRangeFilter class.  Since 1.2.0, method Query::addDateRangeFilter(string $name, ?DateTime $minValue = null, ?DateTime $maxValue = null): self is deprecatedin favor of Query::addFilter(FilterInterface $filter): self  Note Bounds ($minValue and $maxValue) can't be null simultaneously.  Examples:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter; $min = DateTime::createFromFormat('Y-m-d', '2020-01-17'); $max = DateTime::createFromFormat('Y-m-d', '2020-01-19'); // filtering audit entries whose creation date is &gt;= 2020-01-17 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new DateRangeFilter(Query::CREATED_AT, $min)); // filtering audit entries whose creation date is &lt;= 2020-01-19 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new DateRangeFilter(Query::CREATED_AT, null, $max)); // filtering audit entries whose creation date is between 2020-01-17 and 2020-01-19 $query = new Query('author_audit', $connection); $query-&gt;addFilter(new DateRangeFilter(Query::CREATED_AT, $min, $max));   Multiple filtersâ€‹  When adding multiple filters, they are combined with an and logic.  ","tagName":"h3"},{"title":"Orderingâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#ordering","content":" Query results can be ordered by calling Query::addOrderBy(string $field, string $direction = 'DESC'): self  Example:  $query = new Query('author_audit', $connection); $query-&gt;addOrderBy(Query::CREATED_AT, 'ASC'); $entries = $query-&gt;execute(); // entries are ordered by ascendant creation date/time   ","tagName":"h3"},{"title":"Limit & offsetâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#limit--offset","content":" It is possible to extract only a portion of the results at a specific offset by calling Query::limit(int $limit, int $offset = 0): self  Note$offset starts at 0.  Example:  // only the first 10 results $query = new Query('author_audit', $connection); $query-&gt;limit(10); // 10 results starting at the 6th result (from the 6th to 15th) $query = new Query('author_audit', $connection); $query-&gt;limit(10, 5);   ","tagName":"h3"},{"title":"Executingâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#executing","content":" Queries are executed by calling Query::execute(): array  Example:  // filtering audit entries whose transaction hash is exactly '123abc' $query = new Query('author_audit', $connection); $query-&gt;addFilter(Query::TRANSACTION_HASH, '123abc'); $entries = $query-&gt;execute(); // $entries is populated   ","tagName":"h3"},{"title":"Countingâ€‹","type":1,"pageTitle":"Querying audits","url":"/auditor-docs/auditor-bundle/6.x/usage/querying#counting","content":" It is possible to count results without retrieving them by calling Query::count(): int  Example:  $query = new Query('author_audit', $connection); $query-&gt;addFilter(Query::TRANSACTION_HASH, '123abc'); $count = $query-&gt;count(); // $count holds the number of audit entries matching the applied filters  ","tagName":"h3"},{"title":"Configuration Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/configuration","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“ Configuration Fileâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-configuration-file","content":" All configuration is done in config/packages/dh_auditor.yaml.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Quick Referenceâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-quick-reference","content":" dh_auditor: enabled: true # Enable/disable auditing globally timezone: 'UTC' # Timezone for audit timestamps user_provider: 'dh_auditor.user_provider' security_provider: 'dh_auditor.security_provider' role_checker: 'dh_auditor.role_checker' providers: doctrine: table_prefix: '' table_suffix: '_audit' ignored_columns: [] entities: [] storage_services: ['@doctrine.orm.default_entity_manager'] auditing_services: ['@doctrine.orm.default_entity_manager'] storage_mapper: ~ utf8_convert: false # Re-enable legacy UTF-8 conversion (opt-in) viewer: false   ","version":"4.x","tagName":"h2"},{"title":"âš™ï¸ Global Optionsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#ï¸-global-options","content":" ","version":"4.x","tagName":"h2"},{"title":"enabledâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#enabled","content":" Type\tDefault\tDescriptionbool\ttrue\tEnable or disable all auditing  dh_auditor: enabled: true   When false, no changes are audited until re-enabled at runtime.  ","version":"4.x","tagName":"h3"},{"title":"timezoneâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#timezone","content":" Type\tDefault\tDescriptionstring\t'UTC'\tTimezone for audit timestamps  dh_auditor: timezone: 'Europe/Paris'   ","version":"4.x","tagName":"h3"},{"title":"user_providerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#user_provider","content":" Type\tDefault\tDescriptionstring\t'dh_auditor.user_provider'\tService ID for user provider  dh_auditor: user_provider: 'App\\Audit\\CustomUserProvider'   TIP See User Provider Customization for creating custom providers.  ","version":"4.x","tagName":"h3"},{"title":"security_providerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#security_provider","content":" Type\tDefault\tDescriptionstring\t'dh_auditor.security_provider'\tService ID for security provider  dh_auditor: security_provider: 'App\\Audit\\CustomSecurityProvider'   TIP See Security Provider Customization for creating custom providers.  ","version":"4.x","tagName":"h3"},{"title":"role_checkerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#role_checker","content":" Type\tDefault\tDescriptionstring\t'dh_auditor.role_checker'\tService ID for role checker  dh_auditor: role_checker: 'App\\Audit\\CustomRoleChecker'   TIP See Role Checker Customization for creating custom checkers.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ Doctrine Provider Optionsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#ï¸-doctrine-provider-options","content":" All options under providers.doctrine:  ","version":"4.x","tagName":"h2"},{"title":"table_prefix / table_suffixâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#table_prefix--table_suffix","content":" Option\tType\tDefault\tDescriptiontable_prefix\tstring\t''\tPrefix for audit table names table_suffix\tstring\t'_audit'\tSuffix for audit table names  dh_auditor: providers: doctrine: table_prefix: 'audit_' table_suffix: ''   Example: Entity table users â†’ Audit table audit_users  ","version":"4.x","tagName":"h3"},{"title":"ignored_columnsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#ignored_columns","content":" Type\tDefault\tDescriptionarray\t[]\tProperties to ignore globally across all entities  dh_auditor: providers: doctrine: ignored_columns: - createdAt - updatedAt - password   ","version":"4.x","tagName":"h3"},{"title":"entitiesâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#entities","content":" Type\tDefault\tDescriptionarray\t[]\tEntities to audit and options  dh_auditor: providers: doctrine: entities: # Simple: all defaults App\\Entity\\User: ~ # With options App\\Entity\\Post: enabled: true ignored_columns: - viewCount roles: view: - ROLE_ADMIN   Entity options:  Option\tType\tDefault\tDescriptionenabled\tbool\ttrue\tEnable/disable auditing for entity ignored_columns\tarray\t[]\tProperties to ignore for this entity roles.view\tarray\t[]\tRoles required to view audits  ","version":"4.x","tagName":"h3"},{"title":"storage_servicesâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#storage_services","content":" Type\tDefault\tDescriptionarray\t['@doctrine.orm.default_entity_manager']\tEntity managers for storage  dh_auditor: providers: doctrine: storage_services: - '@doctrine.orm.default_entity_manager' - '@doctrine.orm.audit_entity_manager'   NOTE See Multi-Database Setup for details on using multiple storage services.  ","version":"4.x","tagName":"h3"},{"title":"auditing_servicesâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#auditing_services","content":" Type\tDefault\tDescriptionarray\t['@doctrine.orm.default_entity_manager']\tEntity managers to monitor  dh_auditor: providers: doctrine: auditing_services: - '@doctrine.orm.default_entity_manager' - '@doctrine.orm.secondary_entity_manager'   ","version":"4.x","tagName":"h3"},{"title":"storage_mapperâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#storage_mapper","content":" Type\tDefault\tDescriptionstring|null\tnull\tService ID for routing audits to storage  Required when using multiple storage services.  dh_auditor: providers: doctrine: storage_mapper: 'App\\Audit\\StorageMapper'   NOTE See Multi-Database Setup for details.  ","version":"4.x","tagName":"h3"},{"title":"utf8_convertâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#utf8_convert","content":" Type\tDefault\tDescriptionbool\tfalse\tRe-enable the legacy UTF-8 conversion pass  dh_auditor: providers: doctrine: utf8_convert: false   In auditor 3.x, every audit entry value was passed through mb_convert_encoding() automatically. In auditor 4.0+ this implicit conversion is disabled by default because DBAL 4 enforces UTF-8 connections on PHP 8.4+, making the conversion a no-op for virtually all modern applications.  If your application reads data from legacy non-UTF-8 sources, you can re-enable the conversion explicitly:  dh_auditor: providers: doctrine: utf8_convert: true   NOTE Enabling this option has a small performance cost as every stored value is passed through mb_convert_encoding(). Leave it disabled unless you know your data sources may produce non-UTF-8 strings.  ","version":"4.x","tagName":"h3"},{"title":"viewerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#viewer","content":" Type\tDefault\tDescriptionbool|array\tfalse\tEnable/configure audit viewer  # Simple enable dh_auditor: providers: doctrine: viewer: true # With options dh_auditor: providers: doctrine: viewer: enabled: true page_size: 50   Viewer options:  Option\tType\tDefault\tDescriptionenabled\tbool\tfalse\tEnable the viewer page_size\tint\t50\tResults per page  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Complete Exampleâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-complete-example","content":" # config/packages/dh_auditor.yaml dh_auditor: enabled: true timezone: 'Europe/Paris' providers: doctrine: table_suffix: '_audit' ignored_columns: - createdAt - updatedAt entities: App\\Entity\\User: roles: view: [ROLE_ADMIN] App\\Entity\\Post: ignored_columns: - viewCount App\\Entity\\Comment: ~ viewer: enabled: true page_size: 100   ","version":"4.x","tagName":"h2"},{"title":"ðŸŒ Environment-Specific Configurationâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-environment-specific-configuration","content":" # config/packages/dev/dh_auditor.yaml dh_auditor: providers: doctrine: viewer: true # config/packages/prod/dh_auditor.yaml dh_auditor: providers: doctrine: viewer: enabled: true page_size: 50   ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Using Environment Variablesâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-using-environment-variables","content":" dh_auditor: enabled: '%env(bool:AUDITOR_ENABLED)%' timezone: '%env(AUDITOR_TIMEZONE)%'     ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor-bundle/configuration#-next-steps","content":" ðŸ·ï¸ Entity Attributes - Configure entities with PHP attributesðŸ—„ï¸ Storage Configuration - Multi-database setupðŸ”§ Customization - Custom providers ","version":"4.x","tagName":"h2"},{"title":"Entity Attributes","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/configuration/attributes","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Available Attributesâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-available-attributes","content":" Attribute\tTarget\tDescription#[Auditable]\tClass\tMarks an entity as auditable #[Ignore]\tProperty\tExcludes a property from auditing #[Security]\tClass\tDefines roles required to view audits  All attributes are in the DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute namespace.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ·ï¸ #[Auditable]â€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#ï¸-auditable","content":" Marks an entity class for auditing.  ","version":"4.x","tagName":"h2"},{"title":"Basic Usageâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#basic-usage","content":" &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] class User { #[ORM\\Id] #[ORM\\GeneratedValue] #[ORM\\Column] private ?int $id = null; #[ORM\\Column(length: 180)] private ?string $email = null; // ... }   ","version":"4.x","tagName":"h3"},{"title":"Disabled by Defaultâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#disabled-by-default","content":" Create an audit table but don't log until enabled at runtime:  #[ORM\\Entity] #[Audit\\Auditable(enabled: false)] class User { // Auditing is OFF by default // Can be enabled at runtime }   ","version":"4.x","tagName":"h3"},{"title":"ðŸš« #[Ignore]â€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-ignore","content":" Excludes a property from being audited.  &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] class User { #[ORM\\Column] private ?string $email = null; #[ORM\\Column] #[Audit\\Ignore] private ?string $password = null; // Not audited #[ORM\\Column] #[Audit\\Ignore] private ?\\DateTimeImmutable $lastLoginAt = null; // Not audited }   TIP Properties in the global ignored_columns configuration don't need #[Ignore].  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”’ #[Security]â€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-security","content":" Restricts access to view audit logs based on user roles.  &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE_ADMIN'])] class User { // Only users with ROLE_ADMIN can view User audits }   ","version":"4.x","tagName":"h2"},{"title":"Multiple Roles (OR Logic)â€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#multiple-roles-or-logic","content":" #[Audit\\Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR'])] class User { // Users with ROLE_ADMIN OR ROLE_AUDITOR can view }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Complete Exampleâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-complete-example","content":" &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR'])] class User { #[ORM\\Id] #[ORM\\GeneratedValue] #[ORM\\Column] private ?int $id = null; #[ORM\\Column(length: 180, unique: true)] private ?string $email = null; #[ORM\\Column] #[Audit\\Ignore] private ?string $password = null; #[ORM\\Column(length: 255)] private ?string $firstName = null; #[ORM\\Column(length: 255)] private ?string $lastName = null; #[ORM\\Column] #[Audit\\Ignore] private ?\\DateTimeImmutable $lastLoginAt = null; // Getters and setters... }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”€ Combining with YAMLâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-combining-with-yaml","content":" You can use both attributes and YAML configuration:  # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: ignored_columns: - createdAt - updatedAt entities: App\\Entity\\User: ~ # Declares entity is auditable App\\Entity\\Post: ~   // Entity uses attributes for fine-grained control #[ORM\\Entity] #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE_ADMIN'])] class User { #[Audit\\Ignore] private ?string $password = null; // createdAt and updatedAt are automatically ignored via YAML }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“Š Precedence Rulesâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-precedence-rules","content":"   Attribute\tBehavior#[Auditable]\tOverrides entities.*.enabled from YAML #[Ignore]\tAdds to ignored_columns (YAML + attribute) #[Security]\tOverrides entities.*.roles from YAML  ","version":"4.x","tagName":"h3"},{"title":"âš ï¸ Entity Not in YAMLâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#ï¸-entity-not-in-yaml","content":" CAUTION If an entity has #[Auditable] but isn't in YAML entities, it will not be audited.  # User is NOT listed here dh_auditor: providers: doctrine: entities: App\\Entity\\Post: ~   // This entity will NOT be audited (not in YAML) #[Audit\\Auditable] class User {}   Either:  âœ… Add to YAML: App\\Entity\\User: ~âœ… Or use YAML-only configuration    ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Entity Attributes","url":"/auditor-docs/auditor-bundle/configuration/attributes#-next-steps","content":" âš™ï¸ Configuration Reference - All YAML optionsðŸ—„ï¸ Storage Configuration - Multi-database setupðŸ›¡ï¸ Role Checker - Custom access control ","version":"4.x","tagName":"h2"},{"title":"Storage Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/configuration/storage","content":"","keywords":"","version":"4.x"},{"title":"ðŸ—„ï¸ Default Setupâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#ï¸-default-setup","content":" By default, audits are stored in the same database as your entities using the default entity manager:  dh_auditor: providers: doctrine: storage_services: - '@doctrine.orm.default_entity_manager'   This provides transactional integrity: audit entries are part of the same database transaction as entity changes.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“ Table Namingâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#-table-naming","content":" Audit tables are named: {prefix}{entity_table}{suffix}  Option\tDefault\tExample (entity: users)table_prefix\t''\tâ†’ users_audit table_suffix\t'_audit'\tâ†’ users_audit  dh_auditor: providers: doctrine: table_prefix: 'audit_' table_suffix: ''   Result: users â†’ audit_users  ","version":"4.x","tagName":"h2"},{"title":"ðŸ—ƒï¸ Multi-Database Setupâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#ï¸-multi-database-setup","content":" Store audits in a separate database from your entities.  CAUTION Warning: Atomicity Using separate databases breaks transactional integrity: Entity changes and audits are in different transactionsIf entity operation succeeds but audit fails â†’ missing auditIf entity operation fails but audit succeeds â†’ orphan audit Only use this when the trade-offs are acceptable.  ","version":"4.x","tagName":"h2"},{"title":"Configurationâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#configuration","content":" 1ï¸âƒ£ Configure Multiple Entity Managersâ€‹  # config/packages/doctrine.yaml doctrine: dbal: default_connection: default connections: default: url: '%env(DATABASE_URL)%' audit: url: '%env(AUDIT_DATABASE_URL)%' orm: default_entity_manager: default entity_managers: default: connection: default mappings: App: type: attribute dir: '%kernel.project_dir%/src/Entity' prefix: 'App\\Entity' audit: connection: audit # No mappings needed - audit tables are created dynamically   2ï¸âƒ£ Configure Storage Servicesâ€‹  # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: storage_services: - '@doctrine.orm.audit_entity_manager' auditing_services: - '@doctrine.orm.default_entity_manager' entities: App\\Entity\\User: ~   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—ºï¸ Storage Mapperâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#ï¸-storage-mapper","content":" When using multiple storage services, a storage mapper routes audits to the correct database.  Creating a Storage Mapperâ€‹  &lt;?php namespace App\\Audit; use DH\\Auditor\\Provider\\Service\\StorageServiceInterface; class StorageMapper { /** * @param string $entity The audited entity FQCN * @param array&lt;string, StorageServiceInterface&gt; $storageServices */ public function __invoke(string $entity, array $storageServices): StorageServiceInterface { // All audits go to the audit database return $storageServices['dh_auditor.provider.doctrine.storage_services.doctrine.orm.audit_entity_manager']; } }   Routing by Entityâ€‹  &lt;?php namespace App\\Audit; use App\\Entity\\HighSecurityEntity; use App\\Entity\\SensitiveData; use DH\\Auditor\\Provider\\Service\\StorageServiceInterface; class StorageMapper { private const SECURE_ENTITIES = [ HighSecurityEntity::class, SensitiveData::class, ]; public function __invoke(string $entity, array $storageServices): StorageServiceInterface { if (in_array($entity, self::SECURE_ENTITIES, true)) { return $storageServices['dh_auditor.provider.doctrine.storage_services.doctrine.orm.secure_entity_manager']; } return $storageServices['dh_auditor.provider.doctrine.storage_services.doctrine.orm.default_entity_manager']; } }   Configurationâ€‹  # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: storage_services: - '@doctrine.orm.default_entity_manager' - '@doctrine.orm.secure_entity_manager' storage_mapper: 'App\\Audit\\StorageMapper'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Schema Managementâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#-schema-management","content":" ","version":"4.x","tagName":"h2"},{"title":"Single Databaseâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#single-database","content":" Use standard Doctrine tools:  # With migrations (recommended) bin/console doctrine:migrations:diff bin/console doctrine:migrations:migrate # Or schema tool bin/console doctrine:schema:update --force   ","version":"4.x","tagName":"h3"},{"title":"Multiple Databasesâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#multiple-databases","content":" Use the audit schema command:  # Preview changes bin/console audit:schema:update --dump-sql # Apply changes bin/console audit:schema:update --force   This command handles all configured storage services.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—ï¸ Architecture Comparisonâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#ï¸-architecture-comparison","content":" ","version":"4.x","tagName":"h2"},{"title":"Single Database (Recommended)â€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#single-database-recommended","content":"   âœ… Same transaction = Data integrity  ","version":"4.x","tagName":"h3"},{"title":"Separate Databaseâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#separate-database","content":"   âš ï¸ Different transactions = Possible inconsistency    ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Storage Configuration","url":"/auditor-docs/auditor-bundle/configuration/storage#-next-steps","content":" âš™ï¸ Configuration Reference - All optionsâ¬†ï¸ Upgrade Guide - Managing audit tablesðŸ”§ Customization - Custom providers ","version":"4.x","tagName":"h2"},{"title":"Customization","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/customization","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Overviewâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#-overview","content":" The bundle uses three providers that can be customized:  Provider\tPurpose\tDefault ServiceUser Provider\tReturns current user information\tdh_auditor.user_provider Security Provider\tReturns IP address and firewall name\tdh_auditor.security_provider Role Checker\tChecks if user can view entity audits\tdh_auditor.role_checker    ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Built-in Providersâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#-built-in-providers","content":" ","version":"4.x","tagName":"h2"},{"title":"UserProviderâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#userprovider","content":" The default UserProvider:  âœ… Gets the current user from Symfony's TokenStorageâœ… Extracts user ID via getId() method (if exists)âœ… Extracts username via getUserIdentifier()âœ… Tracks impersonation (switch user)  ","version":"4.x","tagName":"h3"},{"title":"SecurityProviderâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#securityprovider","content":" The default SecurityProvider:  âœ… Gets client IP from the current Requestâœ… Gets firewall name from FirewallMap  ","version":"4.x","tagName":"h3"},{"title":"RoleCheckerâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#rolechecker","content":" The default RoleChecker:  âœ… Uses Symfony's AuthorizationCheckerâœ… Checks roles configured per entityâœ… Grants access if no roles configuredâœ… Grants access if no user authenticated  ","version":"4.x","tagName":"h3"},{"title":"ðŸ–¥ï¸ Console Commandsâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#ï¸-console-commands","content":" The bundle automatically switches to ConsoleUserProvider during console commands:  User ID: Command name (e.g., app:import-users)Username: Command name  This is handled by ConsoleEventSubscriber and requires no configuration.  TIP This allows you to filter audit entries by specific CLI command in the viewer.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ¤” When to Customizeâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#-when-to-customize","content":" ","version":"4.x","tagName":"h2"},{"title":"User Providerâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#user-provider","content":" âŒ You don't use Symfony's security componentðŸ”§ You need additional user informationðŸ” You have a custom authentication system  ","version":"4.x","tagName":"h3"},{"title":"Security Providerâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#security-provider","content":" ðŸŒ You're behind a proxy/load balancerðŸ“¡ You need custom headers for IP detectionðŸ“ You want to capture additional context  ","version":"4.x","tagName":"h3"},{"title":"Role Checkerâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#role-checker","content":" ðŸ”„ You need complex authorization logicðŸ”— You integrate with an external authorization serviceðŸŽ¯ You need entity-specific or context-aware access control    ","version":"4.x","tagName":"h3"},{"title":"ðŸ“š Customization Guidesâ€‹","type":1,"pageTitle":"Customization","url":"/auditor-docs/auditor-bundle/customization#-customization-guides","content":" ðŸ‘¤ User Provider - Custom user identificationðŸ”’ Security Provider - Custom IP/context detectionðŸ›¡ï¸ Role Checker - Custom access controlðŸ“¦ Extra Data - Attach additional data to audit entries ","version":"4.x","tagName":"h2"},{"title":"Contributing","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/contributing","content":"","keywords":"","version":"4.x"},{"title":"ðŸ¤ Ways to Contributeâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-ways-to-contribute","content":" ðŸ› Report bugs - Submit issues on GitHubðŸ’¡ Suggest features - Open a discussion or issueðŸ“– Improve documentation - Fix typos, add examples, clarify explanationsðŸ”§ Submit code - Fix bugs or implement new featuresâ­ Star the project - Show your support  ","version":"4.x","tagName":"h2"},{"title":"ðŸ’» Code Contributionsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-code-contributions","content":" All code contributions are made via Pull Requests (PR). Direct commits to the master branch are not allowed.  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Development Setupâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-development-setup","content":" Fork the repository on GitHubClone your fork locally:  git clone https://github.com/YOUR_USERNAME/auditor-bundle.git cd auditor-bundle   Install dependencies:  composer install   Create a branch for your changes:  git checkout -b feature/my-new-feature   ","version":"4.x","tagName":"h3"},{"title":"âœ… Running Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-running-tests","content":" Quick Tests (Local PHP)â€‹  # Run all tests composer test # Run tests with coverage composer test:coverage # Run tests with testdox output composer testdox   ðŸ³ Testing with Docker (Recommended)â€‹  The project includes a Makefile that allows you to test against different combinations of PHP versions and Symfony versions using Docker containers. This ensures your code works across all supported environments.  Prerequisites:  DockerDocker ComposeMake  Available Make Targets:  Target\tDescriptiontests\tRun the test suite using PHPUnit cs-fix\tRun PHP-CS-Fixer to fix coding standards phpstan\tRun PHPStan for static code analysis help\tDisplay available commands and options  Options:  Option\tValues\tDefault\tDescriptionphp\t8.4, 8.5\t8.5\tPHP version sf\t8.0\t8.0\tSymfony version args\tAny PHPUnit/tool arguments\t(varies)\tAdditional arguments  Valid PHP/Symfony Combinations:  PHP Version\tSymfony Versions8.4\t8.0 8.5\t8.0  Examples:  # Show all available commands and options make help # Run tests with defaults (PHP 8.5, Symfony 8.0) make tests # Run tests with specific PHP version make tests php=8.4 # Run specific test class make tests args='--filter=ViewerControllerTest' # Run tests with coverage make tests args='--coverage-html=coverage'   Testing Multiple Versions:  TIP Before submitting a pull request, it's recommended to test against multiple PHP versions:  # Test different PHP versions make tests php=8.4 make tests php=8.5   ","version":"4.x","tagName":"h3"},{"title":"ðŸ” Code Qualityâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-code-quality","content":" Before submitting, ensure your code passes all quality checks.  Using Composer (Local)â€‹  # Run all QA tools composer qa # Individual tools: composer cs-check # Check code style composer cs-fix # Fix code style composer phpstan # Static analysis composer rector # Automated refactoring suggestions   Using Make (Docker)â€‹  # Run PHP-CS-Fixer make cs-fix # Run PHPStan make phpstan # With specific PHP version make phpstan php=8.4 # With custom arguments make cs-fix args='fix --dry-run'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Commit Messagesâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-commit-messages","content":" Write clear, concise commit messages:  âœ… Use the present tense (&quot;Add feature&quot; not &quot;Added feature&quot;)âœ… Use the imperative mood (&quot;Move cursor to...&quot; not &quot;Moves cursor to...&quot;)âœ… Limit the first line to 72 charactersâœ… Reference issues and pull requests when relevant  Good examples:  Add support for custom viewer templatesFix RoleChecker when no user is authenticatedUpdate documentation for v7 migration  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¤ Pull Request Processâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-pull-request-process","content":" âœ… Ensure all tests pass (ideally on multiple PHP/Symfony combinations)âœ… Run code quality tools (make cs-fix, make phpstan)ðŸ“– Update documentation if neededðŸ“¤ Submit the pull requestðŸ’¬ Respond to review feedback  ","version":"4.x","tagName":"h3"},{"title":"ðŸ¤– Continuous Integration (CI)â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-continuous-integration-ci","content":" When you submit a Pull Request, GitHub Actions will automatically run:  PHPUnit tests across the full matrix: PHP versions: 8.4, 8.5Symfony version: 8.0 PHP-CS-Fixer for code style validationPHPStan for static analysisCode coverage report  IMPORTANT Your PR must pass all CI checks before it can be merged. If a check fails, review the logs to identify and fix the issue.  TIP Run make tests php=8.4 and make tests php=8.5 locally before pushing to catch compatibility issues early.  ","version":"4.x","tagName":"h3"},{"title":"âœï¸ Writing Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#ï¸-writing-tests","content":" Tests are highly encouraged and often required for new features or bug fixes:  ðŸ“ Place tests in the tests/ directory, mirroring the src/ structureðŸ“ Use meaningful test method names that describe the behavior being testedâœ… Include both positive and negative test casesðŸ” Test edge cases and error conditions  Test Structure Example:  namespace DH\\AuditorBundle\\Tests\\Controller; use Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase; final class ViewerControllerTest extends WebTestCase { public function testAuditListIsAccessible(): void { $client = static::createClient(); $client-&gt;request('GET', '/audit'); $this-&gt;assertResponseIsSuccessful(); } public function testAuditListRequiresAuthentication(): void { // ... } }   Running Your Tests:  # Run only your new tests make tests args='--filter=ViewerControllerTest' # Run with coverage to ensure good test coverage composer test:coverage   ","version":"4.x","tagName":"h3"},{"title":"ðŸ› Reporting Bugsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-reporting-bugs","content":" When reporting bugs, please include:  ðŸ“¦ auditor-bundle version - composer show damienharper/auditor-bundleðŸ“¦ auditor version - composer show damienharper/auditorðŸ˜ PHP version - php -vðŸŽµ Symfony version - composer show symfony/framework-bundleðŸ“‹ Steps to reproduce - Minimal code exampleâœ… Expected behavior - What should happenâŒ Actual behavior - What actually happensðŸ“ Error messages - Full stack trace if available  ","version":"4.x","tagName":"h2"},{"title":"ðŸ’¡ Feature Requestsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-feature-requests","content":" For feature requests:  ðŸ” Check existing issues to avoid duplicatesðŸ“ Describe the use caseðŸ’­ Explain why existing features don't meet your needsðŸ”§ Suggest a possible implementation if you have ideas  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“– Documentation Contributionsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-documentation-contributions","content":" Documentation lives in the docs/ directory and uses Markdown.  ","version":"4.x","tagName":"h2"},{"title":"Style Guideâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#style-guide","content":" âœ… Use clear, simple languageâœ… Include code examplesâœ… Add internal links to related contentâœ… Use standard Markdown tables with pipesâœ… Test all code examples  ","version":"4.x","tagName":"h3"},{"title":"â“ Questions?â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-questions","content":" Open a GitHub IssueCheck existing issues firstBe patient - maintainers are volunteers  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“œ Licenseâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor-bundle/contributing#-license","content":" By contributing, you agree that your contributions will be licensed under the MIT License. ","version":"4.x","tagName":"h2"},{"title":"Extra Data","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/customization/extra-data","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Overviewâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#-overview","content":" Each audit entry has a nullable JSON extra_data column. By default, it is NULL (zero overhead when not used).  There are two complementary approaches to populate it:  Approach\tScope\tUse forextra_data_provider\tGlobal â€” all entries\tRequest-level context: route, request ID, tenant LifecycleEvent listener\tPer-entity â€” fine-grained\tEntity-specific data: department, role, entity properties  Both can be used simultaneously. When they are, the provider runs first and the listener can enrich or override the result.  NOTE This feature is provided by the auditor library. This page shows Symfony-specific integration. For complete documentation, see the auditor extra-data documentation.    ","version":"4.x","tagName":"h2"},{"title":"Approach 1: extra_data_provider Config Optionâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#approach-1-extra_data_provider-config-option","content":" The bundle ships a ready-to-use ExtraDataProvider service that captures the current route name and stores it in every audit entry.  ","version":"4.x","tagName":"h2"},{"title":"Enable the Built-in Providerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#enable-the-built-in-provider","content":" # config/packages/dh_auditor.yaml dh_auditor: extra_data_provider: dh_auditor.extra_data_provider   This stores {&quot;route&quot;: &quot;app_order_edit&quot;} in extra_data for every audit entry produced during an HTTP request. Outside of an HTTP request (e.g. console commands), extra_data remains null.  ","version":"4.x","tagName":"h3"},{"title":"Use a Custom Providerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#use-a-custom-provider","content":" Create your own service that returns ?array:  &lt;?php namespace App\\Audit; use Symfony\\Component\\HttpFoundation\\RequestStack; use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface; final readonly class MyExtraDataProvider { public function __construct( private RequestStack $requestStack, private TokenStorageInterface $tokenStorage, ) {} public function __invoke(): ?array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (null === $request) { return null; } return [ 'route' =&gt; $request-&gt;attributes-&gt;get('_route'), 'request_id' =&gt; $request-&gt;headers-&gt;get('X-Request-ID'), 'user_agent' =&gt; $request-&gt;headers-&gt;get('User-Agent'), ]; } }   Then reference it in config:  dh_auditor: extra_data_provider: App\\Audit\\MyExtraDataProvider   Or register it programmatically (e.g. in a test or a non-Symfony context):  $auditor-&gt;getConfiguration()-&gt;setExtraDataProvider( static fn (): ?array =&gt; ['route' =&gt; 'app_order_edit'] );   ","version":"4.x","tagName":"h3"},{"title":"When to Use This Approachâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#when-to-use-this-approach","content":" Capture the same contextual information for every audit entry (route, tenant, environmentâ€¦)Simple, zero-boilerplate setupDoes not have access to the individual entity being audited    ","version":"4.x","tagName":"h3"},{"title":"Approach 2: LifecycleEvent Listenerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#approach-2-lifecycleevent-listener","content":" Create an event listener using Symfony's #[AsEventListener] attribute. The listener receives the full payload and the audited entity object, giving you full control.  &lt;?php namespace App\\EventListener; use App\\Entity\\User; use DH\\Auditor\\Event\\LifecycleEvent; use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener; #[AsEventListener(event: LifecycleEvent::class, priority: 10)] final class AuditExtraDataListener { public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); // Filter by entity class if ($payload['entity'] !== User::class || null === $event-&gt;entity) { return; } // Attach extra data as a JSON string $payload['extra_data'] = json_encode([ 'department' =&gt; $event-&gt;entity-&gt;getDepartment(), 'role' =&gt; $event-&gt;entity-&gt;getRole(), ], JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); } }   ","version":"4.x","tagName":"h2"},{"title":"With Service Injectionâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#with-service-injection","content":" Since the listener is a standard Symfony service, you can inject any dependency:  &lt;?php namespace App\\EventListener; use App\\Entity\\Order; use DH\\Auditor\\Event\\LifecycleEvent; use Symfony\\Bundle\\SecurityBundle\\Security; use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener; use Symfony\\Component\\HttpFoundation\\RequestStack; #[AsEventListener(event: LifecycleEvent::class, priority: 10)] final class OrderAuditExtraDataListener { public function __construct( private readonly Security $security, private readonly RequestStack $requestStack, ) {} public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); if ($payload['entity'] !== Order::class) { return; } $request = $this-&gt;requestStack-&gt;getCurrentRequest(); $payload['extra_data'] = json_encode([ 'admin_user' =&gt; $this-&gt;security-&gt;getUser()?-&gt;getUserIdentifier(), 'route' =&gt; $request?-&gt;attributes-&gt;get('_route'), 'reason' =&gt; $request?-&gt;headers-&gt;get('X-Audit-Reason'), ], JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); } }   ","version":"4.x","tagName":"h3"},{"title":"Merging Provider and Listener Dataâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#merging-provider-and-listener-data","content":" When a global provider is also configured, you can merge its result with entity-specific data in the listener:  public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); if ($payload['entity'] !== User::class) { return; } // Decode what the provider already set (if anything) $existing = null !== $payload['extra_data'] ? json_decode($payload['extra_data'], true, 512, JSON_THROW_ON_ERROR) : []; // Merge entity-specific data on top $merged = array_merge($existing, [ 'department' =&gt; $event-&gt;entity-&gt;getDepartment(), ]); $payload['extra_data'] = json_encode($merged, JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); }   ","version":"4.x","tagName":"h3"},{"title":"When to Use This Approachâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#when-to-use-this-approach-1","content":" Attach entity-specific data (e.g. $entity-&gt;getDepartment())Apply extra_data only to certain entity classesConditionally skip extra_data based on entity state    ","version":"4.x","tagName":"h3"},{"title":"ðŸ“– Reading Extra Dataâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#-reading-extra-data","content":" The Entry model provides access via the extraData property or the getExtraData() method:  $reader = new Reader($provider); $entries = $reader-&gt;createQuery(User::class)-&gt;execute(); foreach ($entries as $entry) { $extraData = $entry-&gt;extraData; // ?array (decoded JSON) if (null !== $extraData) { echo sprintf( &quot;Route: %s, Department: %s\\n&quot;, $extraData['route'] ?? 'N/A', $extraData['department'] ?? 'N/A', ); } }     ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Filtering by Extra Data (JsonFilter)â€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#-filtering-by-extra-data-jsonfilter","content":" You can filter audit entries by extra_data content using the JsonFilter class:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter; $reader = new Reader($provider); $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Filter by exact value $query-&gt;addFilter(new JsonFilter('extra_data', 'route', 'app_user_edit')); // Filter with LIKE pattern $query-&gt;addFilter(new JsonFilter('extra_data', 'department', 'IT%', 'LIKE')); // Filter by multiple values (IN) $query-&gt;addFilter(new JsonFilter('extra_data', 'status', ['active', 'pending'], 'IN')); // Nested JSON path $query-&gt;addFilter(new JsonFilter('extra_data', 'user.role', 'admin')); $entries = $query-&gt;execute();   ","version":"4.x","tagName":"h2"},{"title":"Supported Operatorsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#supported-operators","content":" Operator\tDescription\tExample=\tExact match (default)\tnew JsonFilter('extra_data', 'dept', 'IT') !=\tNot equal\tnew JsonFilter('extra_data', 'dept', 'IT', '!=') LIKE\tPattern matching\tnew JsonFilter('extra_data', 'dept', 'IT%', 'LIKE') NOT LIKE\tNegative pattern\tnew JsonFilter('extra_data', 'dept', '%temp%', 'NOT LIKE') IN\tMultiple values\tnew JsonFilter('extra_data', 'dept', ['IT', 'HR'], 'IN') NOT IN\tExclude values\tnew JsonFilter('extra_data', 'dept', ['IT'], 'NOT IN') IS NULL\tValue is null\tnew JsonFilter('extra_data', 'dept', null, 'IS NULL') IS NOT NULL\tValue exists\tnew JsonFilter('extra_data', 'dept', null, 'IS NOT NULL')    ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ Schema Updateâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#ï¸-schema-update","content":" The extra_data column is added automatically when you run the schema update command:  # Preview the SQL that will be executed php bin/console audit:schema:update --dump-sql # Apply the change php bin/console audit:schema:update --force     ","version":"4.x","tagName":"h2"},{"title":"âš ï¸ Important Caveatsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#ï¸-important-caveats","content":" ","version":"4.x","tagName":"h2"},{"title":"JSON Encoding (Listener Only)â€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#json-encoding-listener-only","content":" WARNING When setting extra_data in a listener, the value must be either null or a JSON-encoded string (not an array). Always use json_encode(): // âœ… Correct $payload['extra_data'] = json_encode(['key' =&gt; 'value'], JSON_THROW_ON_ERROR); // âŒ Incorrect - will not be stored properly $payload['extra_data'] = ['key' =&gt; 'value']; The extra_data_provider callable is exempt from this rule â€” return a plain ?array and encoding is handled automatically.  ","version":"4.x","tagName":"h3"},{"title":"Entity State in remove() Operationsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#entity-state-in-remove-operations","content":" WARNING During a remove operation, the entity object is still in memory but has been detached from the Unit of Work. Direct property access works (e.g., $entity-&gt;getName())Lazy-loaded associations may not be accessible If you need association data during deletions, ensure those associations are eagerly loaded or fetch the data before the flush.  ","version":"4.x","tagName":"h3"},{"title":"Do Not Write to the Audited EntityManagerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#do-not-write-to-the-audited-entitymanager","content":" CAUTION The LifecycleEvent is dispatched during a flush. The listener executes synchronously within the same database transaction. SELECTs are safe (reading from another entity manager or connection)INSERT/UPDATE/DELETE on the audited EntityManager will interfere with the ongoing flush If you need to perform write operations based on audit data, defer them (e.g., using Symfony Messenger).    ","version":"4.x","tagName":"h3"},{"title":"ðŸ“š Full Documentationâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor-bundle/customization/extra-data#-full-documentation","content":" For complete documentation including database-specific indexing strategies, performance considerations, and advanced filtering options, see the auditor extra-data documentation. ","version":"4.x","tagName":"h2"},{"title":"Security Provider","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/customization/security-provider","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“ Interfaceâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-interface","content":" namespace DH\\Auditor\\Security; interface SecurityProviderInterface { public function __invoke(): array; }   Returns an array with two elements:  return [ $clientIp, // string|null - Client IP address $firewallName, // string|null - Firewall or context name ];   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Built-in Providerâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-built-in-provider","content":" The default DH\\AuditorBundle\\Security\\SecurityProvider:  public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (!$request instanceof Request) { return [null, null]; } $firewallConfig = $this-&gt;firewallMap-&gt;getFirewallConfig($request); return [ $request-&gt;getClientIp(), $firewallConfig?-&gt;getName(), ]; }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Creating a Custom Providerâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-creating-a-custom-provider","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#basic-example","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\SecurityProviderInterface; use Symfony\\Component\\HttpFoundation\\RequestStack; class CustomSecurityProvider implements SecurityProviderInterface { public function __construct( private readonly RequestStack $requestStack, ) {} public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (null === $request) { return [null, null]; } return [ $request-&gt;getClientIp(), 'my-app', ]; } }   ","version":"4.x","tagName":"h3"},{"title":"Registrationâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#registration","content":" # config/packages/dh_auditor.yaml dh_auditor: security_provider: 'App\\Audit\\CustomSecurityProvider'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“š Examplesâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-examples","content":" ","version":"4.x","tagName":"h2"},{"title":"ðŸ”„ Behind a Proxy/Load Balancerâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-behind-a-proxyload-balancer","content":" IMPORTANT When behind a proxy, the client IP may be in forwarded headers rather than the direct connection IP.  &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\SecurityProviderInterface; use Symfony\\Bundle\\SecurityBundle\\Security\\FirewallMap; use Symfony\\Component\\HttpFoundation\\Request; use Symfony\\Component\\HttpFoundation\\RequestStack; class ProxyAwareSecurityProvider implements SecurityProviderInterface { public function __construct( private readonly RequestStack $requestStack, private readonly FirewallMap $firewallMap, ) {} public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (!$request instanceof Request) { return [null, null]; } // Check proxy headers in order of preference $clientIp = $request-&gt;headers-&gt;get('X-Real-IP') ?? $request-&gt;headers-&gt;get('X-Forwarded-For') ?? $request-&gt;getClientIp(); // Handle X-Forwarded-For with multiple IPs if (str_contains($clientIp ?? '', ',')) { $clientIp = trim(explode(',', $clientIp)[0]); } $firewallConfig = $this-&gt;firewallMap-&gt;getFirewallConfig($request); return [$clientIp, $firewallConfig?-&gt;getName()]; } }   ","version":"4.x","tagName":"h3"},{"title":"â˜ï¸ Cloudflareâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#ï¸-cloudflare","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\SecurityProviderInterface; use Symfony\\Bundle\\SecurityBundle\\Security\\FirewallMap; use Symfony\\Component\\HttpFoundation\\Request; use Symfony\\Component\\HttpFoundation\\RequestStack; class CloudflareSecurityProvider implements SecurityProviderInterface { public function __construct( private readonly RequestStack $requestStack, private readonly FirewallMap $firewallMap, ) {} public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (!$request instanceof Request) { return [null, null]; } // Cloudflare provides original IP in CF-Connecting-IP $clientIp = $request-&gt;headers-&gt;get('CF-Connecting-IP') ?? $request-&gt;getClientIp(); $firewallConfig = $this-&gt;firewallMap-&gt;getFirewallConfig($request); return [$clientIp, $firewallConfig?-&gt;getName()]; } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸŒ©ï¸ AWS ALB / API Gatewayâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#ï¸-aws-alb--api-gateway","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\SecurityProviderInterface; use Symfony\\Component\\HttpFoundation\\RequestStack; class AwsSecurityProvider implements SecurityProviderInterface { public function __construct( private readonly RequestStack $requestStack, ) {} public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (null === $request) { return [null, null]; } // AWS ALB/API Gateway headers $clientIp = $request-&gt;headers-&gt;get('X-Forwarded-For'); if (null !== $clientIp &amp;&amp; str_contains($clientIp, ',')) { // First IP is the original client $clientIp = trim(explode(',', $clientIp)[0]); } // Use API Gateway stage as context $context = $request-&gt;headers-&gt;get('X-Amzn-Api-Gateway-Stage', 'unknown'); return [$clientIp ?? $request-&gt;getClientIp(), $context]; } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ–¥ï¸ Console Context Awareâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#ï¸-console-context-aware","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\SecurityProviderInterface; use Symfony\\Component\\HttpFoundation\\RequestStack; class ConsoleAwareSecurityProvider implements SecurityProviderInterface { private ?string $consoleContext = null; public function __construct( private readonly RequestStack $requestStack, ) {} public function __invoke(): array { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); // HTTP context if (null !== $request) { return [$request-&gt;getClientIp(), 'http']; } // Console context return ['127.0.0.1', $this-&gt;consoleContext ?? 'console']; } public function setConsoleContext(?string $context): void { $this-&gt;consoleContext = $context; } }     ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Security Provider","url":"/auditor-docs/auditor-bundle/customization/security-provider#-next-steps","content":" ðŸ›¡ï¸ Role Checker - Customize access controlðŸ‘¤ User Provider - Customize user identification ","version":"4.x","tagName":"h2"},{"title":"Installation","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/getting-started/installation","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Requirementsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-requirements","content":" ","version":"4.x","tagName":"h2"},{"title":"Version 7.x (Current)â€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#version-7x-current","content":" Requirement\tVersionPHP\t&gt;= 8.4 Symfony\t&gt;= 8.0 Doctrine DBAL\t&gt;= 4.0 Doctrine ORM\t&gt;= 3.2 auditor\t&gt;= 4.0  ","version":"4.x","tagName":"h3"},{"title":"Previous Versionsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#previous-versions","content":" Version\tPHP\tSymfony\tauditor6.x\t&gt;= 8.2\t&gt;= 5.4\t&gt;= 3.0 5.x\t&gt;= 7.4\t&gt;= 4.4\t&gt;= 2.0  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ Install via Composerâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-install-via-composer","content":" composer require damienharper/auditor-bundle   This installs both the bundle and the auditor library.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”Œ Bundle Registrationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-bundle-registration","content":" ","version":"4.x","tagName":"h2"},{"title":"Symfony Flex (Automatic)â€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#symfony-flex-automatic","content":" With Symfony Flex, the bundle is automatically registered in config/bundles.php.  ","version":"4.x","tagName":"h3"},{"title":"Manual Registrationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#manual-registration","content":" Add to config/bundles.php:  &lt;?php return [ // ... DH\\AuditorBundle\\DHAuditorBundle::class =&gt; ['all' =&gt; true], ];   ","version":"4.x","tagName":"h3"},{"title":"âš™ï¸ Basic Configurationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#ï¸-basic-configuration","content":" Create config/packages/dh_auditor.yaml:  dh_auditor: providers: doctrine: entities: App\\Entity\\User: ~ App\\Entity\\Post: ~   This minimal configuration:  âœ… Enables auditing for User and Post entitiesâœ… Uses default settings for everything else  ","version":"4.x","tagName":"h2"},{"title":"ðŸ›¤ï¸ Route Configurationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#ï¸-route-configuration","content":" ","version":"4.x","tagName":"h2"},{"title":"Symfony Flex (Automatic)â€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#symfony-flex-automatic-1","content":" Routes are automatically added to config/routes/dh_auditor.yaml.  ","version":"4.x","tagName":"h3"},{"title":"Manual Configurationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#manual-configuration","content":" Create config/routes/dh_auditor.yaml:  dh_auditor: resource: &quot;@DHAuditorBundle/Controller/&quot; type: auditor   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ Database Schemaâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#ï¸-database-schema","content":" Create audit tables by updating your database schema:  ","version":"4.x","tagName":"h2"},{"title":"Using Doctrine Migrations (Recommended)â€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#using-doctrine-migrations-recommended","content":" bin/console doctrine:migrations:diff bin/console doctrine:migrations:migrate   ","version":"4.x","tagName":"h3"},{"title":"Using Schema Toolâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#using-schema-tool","content":" bin/console doctrine:schema:update --force   ","version":"4.x","tagName":"h3"},{"title":"ðŸŽ¨ Asset Installationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-asset-installation","content":" Install assets for the audit viewer:  bin/console assets:install   ","version":"4.x","tagName":"h2"},{"title":"âœ… Verificationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-verification","content":" Enable the viewer in your configuration: dh_auditor: providers: doctrine: viewer: true entities: App\\Entity\\User: ~ Clear cache: bin/console cache:clear Access the viewer at /audit Make a change to a User entity and verify it appears in the viewer  TIP If you don't see the viewer at /audit, make sure routes are properly configured and the cache has been cleared.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ What Gets Installedâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-what-gets-installed","content":" The bundle registers these services automatically:  Service\tPurposeDH\\Auditor\\Auditor\tMain auditor service DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider\tDoctrine provider DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader\tAudit reader dh_auditor.user_provider\tUser info for audit entries dh_auditor.security_provider\tSecurity info for audit entries dh_auditor.role_checker\tAccess control for viewer    ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor-bundle/getting-started/installation#-next-steps","content":" âš™ï¸ Configuration Reference - All configuration optionsðŸ‘ï¸ Audit Viewer - Using the web interfaceðŸ”§ Customization - Custom providers ","version":"4.x","tagName":"h2"},{"title":"auditor-bundle","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/intro","content":"","keywords":"","version":"4.x"},{"title":"What is auditor-bundle?â€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#what-is-auditor-bundle","content":" auditor-bundle integrates the auditor library into Symfony applications. It provides automatic service configuration, a web interface for browsing audits, and seamless integration with Symfony's security system.  ","version":"4.x","tagName":"h2"},{"title":"âœ¨ Key Featuresâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-key-features","content":" ðŸ”Œ Automatic wiring - Services are automatically configured via Symfony's DIðŸ”’ Security integration - Uses Symfony's security for user tracking and access controlðŸŒ Built-in viewer - Web interface to browse audit logs at /auditðŸ–¥ï¸ Console support - Tracks changes made via console commandsðŸŒ Internationalization - Translations for 9 languagesâš™ï¸ YAML configuration - Simple configuration via dh_auditor.yamlðŸ“¦ Extra Data - Attach custom contextual data to audit entries via event listeners  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—ï¸ Architecture Overviewâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#ï¸-architecture-overview","content":" The bundle bridges auditor with Symfony:    ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ What the Bundle Providesâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-what-the-bundle-provides","content":" Component\tService ID\tDescriptionUserProvider\tdh_auditor.user_provider\tGets current user from TokenStorage SecurityProvider\tdh_auditor.security_provider\tGets IP and firewall from Request RoleChecker\tdh_auditor.role_checker\tChecks access via Security component ConsoleUserProvider\t(internal)\tTracks console command as user ViewerController\t(internal)\tWeb UI for audit logs RoutingLoader\t(internal)\tLoads viewer routes  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Version Compatibilityâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-version-compatibility","content":" Version\tStatus\tRequirements7.x\tActive development ðŸš€\tPHP &gt;= 8.4, Symfony &gt;= 8.0, Doctrine DBAL &gt;= 4.0, Doctrine ORM &gt;= 3.2 6.x\tActive support\tPHP &gt;= 8.2, Symfony &gt;= 5.4 5.x\tEnd of Life\tPHP &gt;= 7.4, Symfony &gt;= 4.4  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Quick Linksâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-quick-links","content":" ðŸ“¥ Installation Guideâš™ï¸ Configuration ReferenceðŸ”§ CustomizationðŸ‘ï¸ Audit Viewerâ¬†ï¸ Upgrade Guides  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”— Related Projectsâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-related-projects","content":" auditor - The core audit library (required)  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“œ Licenseâ€‹","type":1,"pageTitle":"auditor-bundle","url":"/auditor-docs/auditor-bundle/intro#-license","content":" This bundle is released under the MIT License. ","version":"4.x","tagName":"h2"},{"title":"Role Checker","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/customization/role-checker","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“ Interfaceâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-interface","content":" namespace DH\\Auditor\\Security; interface RoleCheckerInterface { public function __invoke(string $entity, string $scope): bool; }   Parameters:  $entity: Entity FQCN (e.g., App\\Entity\\User)$scope: Access type (currently only 'view')  Returns: true to grant access, false to deny.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Built-in Checkerâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-built-in-checker","content":" The default DH\\AuditorBundle\\Security\\RoleChecker:  public function __invoke(string $entity, string $scope): bool { $user = $this-&gt;provider-&gt;getAuditor()-&gt;getConfiguration()-&gt;getUserProvider()(); if (!$user instanceof UserInterface) { return true; // No user = grant access } $entities = $this-&gt;provider-&gt;getConfiguration()-&gt;getEntities(); $entityConfig = $entities[$entity] ?? null; $roles = $entityConfig['roles'] ?? null; if (null === $roles || !array_key_exists($scope, $roles)) { return true; // No roles configured = grant access } // Check if user has any of the required roles return array_any($roles[$scope], fn($role) =&gt; $this-&gt;authorizationChecker-&gt;isGranted($role) ); }   ","version":"4.x","tagName":"h2"},{"title":"Default Behaviorâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#default-behavior","content":" Scenario\tAccessNo roles configured for entity\tâœ… Granted No user authenticated\tâœ… Granted User has required role\tâœ… Granted User lacks required role\tâŒ Denied  ","version":"4.x","tagName":"h3"},{"title":"âš™ï¸ Configuring Rolesâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#ï¸-configuring-roles","content":" ","version":"4.x","tagName":"h2"},{"title":"Via YAMLâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#via-yaml","content":" dh_auditor: providers: doctrine: entities: App\\Entity\\User: roles: view: - ROLE_ADMIN - ROLE_AUDITOR App\\Entity\\Post: roles: view: - ROLE_EDITOR App\\Entity\\Comment: ~ # No restrictions   ","version":"4.x","tagName":"h3"},{"title":"Via Attributesâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#via-attributes","content":" use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR'])] class User { // ... }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Creating a Custom Checkerâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-creating-a-custom-checker","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#basic-example","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\RoleCheckerInterface; use Symfony\\Bundle\\SecurityBundle\\Security; class CustomRoleChecker implements RoleCheckerInterface { public function __construct( private readonly Security $security, ) {} public function __invoke(string $entity, string $scope): bool { // Super admins can view everything if ($this-&gt;security-&gt;isGranted('ROLE_SUPER_ADMIN')) { return true; } // Require authentication for all audits if (null === $this-&gt;security-&gt;getUser()) { return false; } return $this-&gt;security-&gt;isGranted('ROLE_AUDIT_VIEWER'); } }   ","version":"4.x","tagName":"h3"},{"title":"Registrationâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#registration","content":" # config/packages/dh_auditor.yaml dh_auditor: role_checker: 'App\\Audit\\CustomRoleChecker'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“š Examplesâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-examples","content":" ","version":"4.x","tagName":"h2"},{"title":"ðŸŽ¯ Entity-Specific Rulesâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-entity-specific-rules","content":" &lt;?php namespace App\\Audit; use App\\Entity\\User; use App\\Entity\\Order; use App\\Entity\\Payment; use DH\\Auditor\\Security\\RoleCheckerInterface; use Symfony\\Bundle\\SecurityBundle\\Security; class EntityRoleChecker implements RoleCheckerInterface { private const ENTITY_ROLES = [ User::class =&gt; ['ROLE_USER_ADMIN'], Order::class =&gt; ['ROLE_ORDER_MANAGER', 'ROLE_ACCOUNTANT'], Payment::class =&gt; ['ROLE_ACCOUNTANT'], ]; public function __construct( private readonly Security $security, ) {} public function __invoke(string $entity, string $scope): bool { // Super admin bypass if ($this-&gt;security-&gt;isGranted('ROLE_SUPER_ADMIN')) { return true; } $requiredRoles = self::ENTITY_ROLES[$entity] ?? []; // No restriction for unlisted entities if (empty($requiredRoles)) { return true; } foreach ($requiredRoles as $role) { if ($this-&gt;security-&gt;isGranted($role)) { return true; } } return false; } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—³ï¸ Using Symfony Votersâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#ï¸-using-symfony-voters","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\RoleCheckerInterface; use Symfony\\Bundle\\SecurityBundle\\Security; class VoterRoleChecker implements RoleCheckerInterface { public function __construct( private readonly Security $security, ) {} public function __invoke(string $entity, string $scope): bool { // Delegate to a Symfony voter return $this-&gt;security-&gt;isGranted('AUDIT_VIEW', $entity); } }   With voter:  &lt;?php namespace App\\Security\\Voter; use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface; use Symfony\\Component\\Security\\Core\\Authorization\\Voter\\Voter; class AuditVoter extends Voter { protected function supports(string $attribute, mixed $subject): bool { return $attribute === 'AUDIT_VIEW' &amp;&amp; is_string($subject); } protected function voteOnAttribute(string $attribute, mixed $subject, TokenInterface $token): bool { $user = $token-&gt;getUser(); if (null === $user) { return false; } // Custom logic based on $subject (entity FQCN) // and $user return true; } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”— External Authorization Serviceâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-external-authorization-service","content":" &lt;?php namespace App\\Audit; use App\\Security\\AuthorizationService; use DH\\Auditor\\Security\\RoleCheckerInterface; use Symfony\\Bundle\\SecurityBundle\\Security; class ExternalRoleChecker implements RoleCheckerInterface { public function __construct( private readonly Security $security, private readonly AuthorizationService $authService, ) {} public function __invoke(string $entity, string $scope): bool { $user = $this-&gt;security-&gt;getUser(); if (null === $user) { return false; } return $this-&gt;authService-&gt;isAllowed( $user-&gt;getUserIdentifier(), 'audit', $entity, $scope ); } }   ","version":"4.x","tagName":"h3"},{"title":"â° Time-Based Accessâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-time-based-access","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\Security\\RoleCheckerInterface; use Symfony\\Bundle\\SecurityBundle\\Security; class TimeBasedRoleChecker implements RoleCheckerInterface { public function __construct( private readonly Security $security, ) {} public function __invoke(string $entity, string $scope): bool { // Admins always have access if ($this-&gt;security-&gt;isGranted('ROLE_ADMIN')) { return true; } // Others only during business hours $hour = (int) date('H'); $dayOfWeek = (int) date('N'); $isBusinessHours = $hour &gt;= 9 &amp;&amp; $hour &lt; 18; $isWeekday = $dayOfWeek &lt;= 5; return $isBusinessHours &amp;&amp; $isWeekday; } }     ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Role Checker","url":"/auditor-docs/auditor-bundle/customization/role-checker#-next-steps","content":" ðŸ‘ï¸ Audit Viewer - Web interface for browsing auditsðŸ‘¤ User Provider - Customize user identificationðŸ”’ Security Provider - Customize IP/context detection ","version":"4.x","tagName":"h2"},{"title":"Upgrade Guide","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/upgrade","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“š Upgrade Guidesâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor-bundle/upgrade#-upgrade-guides","content":" â¬†ï¸ Upgrading to 7.0 - From 6.x to 7.0  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“‹ Version Supportâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor-bundle/upgrade#-version-support","content":" Version\tStatus\tSupport Until7.x\tActive development ðŸš€\tCurrent 6.x\tActive support\tTBD 5.x\tEnd of Life\t-  ","version":"4.x","tagName":"h2"},{"title":"âœ… General Upgrade Processâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor-bundle/upgrade#-general-upgrade-process","content":" IMPORTANT Always follow these steps when upgrading:  ðŸ“– Read the upgrade guide for your target versionðŸ“¦ Update dependencies in composer.jsonðŸ”„ Run Composer updateðŸ—‘ï¸ Clear cacheâš™ï¸ Update configuration if neededâœ… Run tests  # Update dependencies composer update damienharper/auditor damienharper/auditor-bundle # Clear cache bin/console cache:clear # Run tests bin/phpunit   ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ Schema Updatesâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor-bundle/upgrade#ï¸-schema-updates","content":" After upgrading, check if audit tables need updates:  # Preview changes bin/console audit:schema:update --dump-sql # Apply changes bin/console audit:schema:update --force  ","version":"4.x","tagName":"h2"},{"title":"What is auditor?","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x","content":"","keywords":"","version":"3.x"},{"title":"Architectureâ€‹","type":1,"pageTitle":"What is auditor?","url":"/auditor-docs/auditor/3.x#architecture","content":" This library is architected around two concepts:  Auditing services responsible for collecting audit eventsStorage services responsible for persisting audit traces  Those two kind of services are offered by Providers.  ","version":"3.x","tagName":"h2"},{"title":"Default providerâ€‹","type":1,"pageTitle":"What is auditor?","url":"/auditor-docs/auditor/3.x#default-provider","content":" A default provider is included with this library: DoctrineProvider  DoctrineProvider offers both auditing services and storage services. It creates audit logs for all Doctrine ORM database related changes:  inserts and updates including their diffs and relation field diffs.many to many relation changes, association and dissociation actions.if available, the user responsible for these changes and his IP address are recorded.audit entries are inserted within the same transaction during flush event so that even if something fails the global state remains clean.  DoctrineProvider supports following RDBMS  MySQLMariaDBPostgreSQLSQLite  DoctrineProvider should work with any other database supported by Doctrine. Though, we can only really support the ones we can test with GitHub Actions.  Basically you can track any change of any entity from audit logs.  Note DoctrineProvider does not support composite primary keys.DoctrineProvider does not allow tracking changes resulting from direct DQL/SQL update or delete statements. ","version":"3.x","tagName":"h2"},{"title":"Contributing","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x/contributing","content":"","keywords":"","version":"3.x"},{"title":"Requirementsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#requirements","content":" Before starting to contribute, you first need to install dev dependencies:  composer install --dev   You also have to install external dev tools:  composer install --working-dir=tools/php-cs-fixer composer install --working-dir=tools/phpstan   Also, in an effort to maintain an homogeneous code base, we strongly encourage contributors to run PHP-CS-Fixer and PHPStanbefore submitting a Pull Request.  ","version":"3.x","tagName":"h2"},{"title":"Coding standardsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#coding-standards","content":" Coding standards are enforced using PHP-CS-Fixer  composer csfixer   ","version":"3.x","tagName":"h2"},{"title":"Static code analysisâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#static-code-analysis","content":" Static code analysis can be achieved using PHPStan  composer phpstan   ","version":"3.x","tagName":"h2"},{"title":"Running Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#running-tests","content":" By default, test suite is configured to use an SQLite in-memory database and generates a code coverage report in tests/coverage folder.  However, you can run the test suite using different configurations:  SQLiteMySQLPostgreSQLMariaDB  ","version":"3.x","tagName":"h2"},{"title":"Default configuration (SQLite)â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#default-configuration-sqlite","content":" This configuration uses an in memory SQLite database and generates code coverage report in tests/coverage folder (requires PCOV extension).  composer test   You can also run tests using an in memory SQLite database and without generating code coverage report, it's the fastest configuration.  ./vendor/bin/phpunit -c phpunit.sqlite.xml   ","version":"3.x","tagName":"h3"},{"title":"MySQL configurationâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#mysql-configuration","content":" This configuration expects to connect to a MySQL database.  ./vendor/bin/phpunit -c phpunit.mysql.xml   Note Connection parameters (username, password, host, port, etc) are set in phpunit.mysql.xml file.  Assuming you have docker installed, you can easily start a MySQL server with following command (MySQL 8)  docker run --name mysql_db -e MYSQL_DATABASE=auditor -e MYSQL_ALLOW_EMPTY_PASSWORD=1 -d -p 3306:3306 mysql --default-authentication-plugin=mysql_native_password   ","version":"3.x","tagName":"h3"},{"title":"PostgreSQL configurationâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#postgresql-configuration","content":" This configuration expects to connect to a PostgreSQL database.  ./vendor/bin/phpunit -c phpunit.pgsql.xml   Note Connection parameters (username, password, host, port, etc) are set in phpunit.pgsql.xml file.  Assuming you have docker installed, you can easily start a PostgreSQL server with following command (PostgreSQL 11)  docker run --name postgres_db -e POSTGRES_DB=auditor -e POSTGRES_HOST_AUTH_METHOD=trust -d -p 5432:5432 postgres   ","version":"3.x","tagName":"h3"},{"title":"MariaDB configurationâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/3.x/contributing#mariadb-configuration","content":" This configuration expects to connect to a MariaDB database.  ./vendor/bin/phpunit -c phpunit.mariadb.xml   Note Connection parameters (username, password, host, port, etc) are set in phpunit.mariadb.xml file.  Assuming you have docker installed, you can easily start a MariaDB server with following command  docker run --name mariadb_db -e MYSQL_DATABASE=auditor -e MYSQL_ALLOW_EMPTY_PASSWORD=1 -p 3306:3306 mariadb  ","version":"3.x","tagName":"h3"},{"title":"Upgrading to 7.0","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/upgrade/v7","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Requirements Changesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-requirements-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"PHPâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#php","content":" 6.x\t7.0&gt;= 8.2\t&gt;= 8.4  ","version":"4.x","tagName":"h3"},{"title":"Symfonyâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#symfony","content":" 6.x\t7.0&gt;= 5.4\t&gt;= 8.0  CAUTION Symfony 5.4, 6.x, and 7.x are no longer supported.  ","version":"4.x","tagName":"h3"},{"title":"Doctrineâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#doctrine","content":" Package\t6.x\t7.0DBAL\t&gt;= 3.2\t&gt;= 4.0 ORM\t&gt;= 2.13\t&gt;= 3.2 DoctrineBundle\t&gt;= 2.0\t&gt;= 3.0  ","version":"4.x","tagName":"h3"},{"title":"auditor Libraryâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#auditor-library","content":" 6.x\t7.0&gt;= 3.0\t&gt;= 4.0  TIP See auditor upgrade guide for library-specific changes.  ","version":"4.x","tagName":"h3"},{"title":"PHPUnitâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#phpunit","content":" 6.x\t7.0&gt;= 11.0\t&gt;= 12.0  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Bundle Changesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-bundle-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"AbstractBundle Migrationâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#abstractbundle-migration","content":" The bundle now extends Symfony\\Component\\HttpKernel\\Bundle\\AbstractBundle instead of Bundle.  This is an internal change and doesn't affect your configuration.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—‘ï¸ Removed Classesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#ï¸-removed-classes","content":" Removed Class\tReasonDH\\AuditorBundle\\DependencyInjection\\Configuration\tMerged into DHAuditorBundle::configure() DH\\AuditorBundle\\DependencyInjection\\DHAuditorExtension\tMerged into DHAuditorBundle::loadExtension() DH\\AuditorBundle\\DependencyInjection\\Compiler\\AddProviderCompilerPass\tNo longer needed with autowiring DH\\AuditorBundle\\DependencyInjection\\Compiler\\CustomConfigurationCompilerPass\tMerged into bundle DH\\AuditorBundle\\DependencyInjection\\Compiler\\DoctrineProviderConfigurationCompilerPass\tReplaced by DoctrineMiddlewareCompilerPass  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—‘ï¸ Removed Filesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#ï¸-removed-files","content":" src/Resources/config/services.yaml - Services defined programmatically  ","version":"4.x","tagName":"h3"},{"title":"Composer Scriptsâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#composer-scripts","content":" The following composer scripts have been removed:  setup5 (Symfony 5.4)setup6 (Symfony 6.4)setup7 (Symfony 7.x)setup8 (Symfony 8.0)  Use the new unified setup script instead:  composer setup   ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ Upgrade Stepsâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-upgrade-steps","content":" ","version":"4.x","tagName":"h2"},{"title":"1ï¸âƒ£ Update PHPâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#1ï¸âƒ£-update-php","content":" Ensure you have PHP 8.4+:  php -v # PHP 8.4.x ...   ","version":"4.x","tagName":"h3"},{"title":"2ï¸âƒ£ Update Symfonyâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#2ï¸âƒ£-update-symfony","content":" composer require symfony/framework-bundle:^8.0   ","version":"4.x","tagName":"h3"},{"title":"3ï¸âƒ£ Update Doctrineâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#3ï¸âƒ£-update-doctrine","content":" composer require \\ doctrine/dbal:^4.0 \\ doctrine/orm:^3.2 \\ doctrine/doctrine-bundle:^3.0   ","version":"4.x","tagName":"h3"},{"title":"4ï¸âƒ£ Update auditorâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#4ï¸âƒ£-update-auditor","content":" composer require damienharper/auditor:^4.0   ","version":"4.x","tagName":"h3"},{"title":"5ï¸âƒ£ Update auditor-bundleâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#5ï¸âƒ£-update-auditor-bundle","content":" composer require damienharper/auditor-bundle:^7.0   ","version":"4.x","tagName":"h3"},{"title":"6ï¸âƒ£ Clear Cacheâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#6ï¸âƒ£-clear-cache","content":" bin/console cache:clear   ","version":"4.x","tagName":"h3"},{"title":"7ï¸âƒ£ Check Schemaâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#7ï¸âƒ£-check-schema","content":" bin/console audit:schema:update --dump-sql   ","version":"4.x","tagName":"h3"},{"title":"8ï¸âƒ£ Run Testsâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#8ï¸âƒ£-run-tests","content":" bin/phpunit   ","version":"4.x","tagName":"h3"},{"title":"âš™ï¸ Configurationâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#ï¸-configuration","content":" No configuration changes required. Your dh_auditor.yaml should work as-is.  ","version":"4.x","tagName":"h2"},{"title":"âš ï¸ Breaking Changesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#ï¸-breaking-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"auditor Library Changesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#auditor-library-changes","content":" This bundle requires damienharper/auditor &gt;= 4.0 which introduces several breaking changes.  Namespace Rename: Annotation â†’ Attributeâ€‹  IMPORTANT The Annotation namespace has been renamed to Attribute to align with PHP 8+ terminology.  // Before (auditor 3.x) use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore; // After (auditor 4.0) use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore;   utf8_convert is now opt-inâ€‹  IMPORTANT The implicit mb_convert_encoding() pass that ran on every audit entry has been removed from the default path.  In auditor 3.x, UTF-8 conversion ran automatically. In auditor 4.0 it defaults to false because DBAL 4 enforces UTF-8 connections on PHP 8.4+, making the conversion a no-op for virtually all modern applications.  If your application handles data from legacy non-UTF-8 sources, re-enable it explicitly:  # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: utf8_convert: true   Entry Model - Property Hooks (PHP 8.4)â€‹  The Entry model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access:  // Before (auditor 3.x) $entry-&gt;getId(); $entry-&gt;getType(); $entry-&gt;getObjectId(); $entry-&gt;getUserId(); $entry-&gt;getUsername(); $entry-&gt;getCreatedAt(); // After (auditor 4.0) $entry-&gt;id; $entry-&gt;type; $entry-&gt;objectId; $entry-&gt;userId; $entry-&gt;username; $entry-&gt;createdAt;   TIP See auditor UPGRADE-4.0.md for the complete list of changes.  ","version":"4.x","tagName":"h3"},{"title":"Route Namesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#route-names","content":" The viewer route names have been updated for consistency:  Before (6.x)\tAfter (7.0)dh_auditor_show_entity_history\tdh_auditor_show_entity_stream dh_auditor_show_transaction\tdh_auditor_show_transaction_stream  Update any route references in your code:  // Before $url = $urlGenerator-&gt;generate('dh_auditor_show_entity_history', [...]); // After $url = $urlGenerator-&gt;generate('dh_auditor_show_entity_stream', [...]);   ","version":"4.x","tagName":"h3"},{"title":"ConsoleUserProviderâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#consoleuserprovider","content":" CLI commands now use the command name as the user identifier instead of a generic &quot;command&quot; string:  Before (6.x)\tAfter (7.0)id: &quot;command&quot;\tid: &quot;app:import-users&quot; username: &quot;app:import-users&quot;\tusername: &quot;app:import-users&quot;  This allows filtering audit entries by specific CLI command in the viewer.  NOTE Existing audit entries with blame_id = &quot;command&quot; will not be automatically migrated.  ","version":"4.x","tagName":"h3"},{"title":"Template Blocksâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#template-blocks","content":" The following Twig blocks have been removed from the base layout:  Removed Block\tReasonnavbar\tReplaced by built-in header breadcrumbs\tNo longer used  Available blocks in 7.0:  Block\tDescription\tAvailable intitle\tPage title\tAll pages stylesheets\tCSS includes\tAll pages dh_auditor_content\tMain content area\tAll pages dh_auditor_header\tSub-header with back link &amp; filters\tEntity stream, Transaction view dh_auditor_pager\tPagination\tEntity stream javascripts\tJavaScript includes\tAll pages  If you override layout.html.twig and use any of the removed blocks, update your template accordingly.  ","version":"4.x","tagName":"h3"},{"title":"UserProviderâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#userprovider","content":" The AnonymousToken handling was removed (deprecated in Symfony 6.0).  Before (6.x):  if ($token instanceof AnonymousToken) { return null; }   After (7.0):Anonymous tokens no longer exist in Symfony 8.0.  ","version":"4.x","tagName":"h3"},{"title":"Custom Providersâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#custom-providers","content":" If you have custom providers extending bundle classes, verify they still work.  The provider interfaces from the auditor library haven't changed:  UserProviderInterfaceSecurityProviderInterfaceRoleCheckerInterface  ","version":"4.x","tagName":"h3"},{"title":"PHP Attributes Migrationâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#php-attributes-migration","content":" The bundle now uses modern PHP 8.4+ and Symfony 8+ attributes for service auto-configuration:  Class\tChangeConsoleEventSubscriber\tUses #[AsEventListener] instead of EventSubscriberInterface ViewerEventSubscriber\tUses #[AsEventListener] instead of EventSubscriberInterface ViewerController\tUses #[AsController] attribute TimeAgoExtension\tUses #[AsTwigFilter] instead of extending AbstractExtension RoutingLoader\tUses #[AutoconfigureTag('routing.loader')] attribute  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”’ Final Classesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-final-classes","content":" CAUTION The following classes are now final and cannot be extended:  // These classes can no longer be extended DH\\AuditorBundle\\Event\\ConsoleEventSubscriber DH\\AuditorBundle\\Event\\ViewerEventSubscriber DH\\AuditorBundle\\Twig\\TimeAgoExtension DH\\AuditorBundle\\Routing\\RoutingLoader DH\\AuditorBundle\\User\\UserProvider DH\\AuditorBundle\\User\\ConsoleUserProvider DH\\AuditorBundle\\Security\\SecurityProvider DH\\AuditorBundle\\Security\\RoleChecker DH\\AuditorBundle\\Viewer\\ActivityGraphProvider   If you were extending any of these classes, you'll need to use composition instead of inheritance.  ","version":"4.x","tagName":"h3"},{"title":"ActivityGraphProvider API Changesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#activitygraphprovider-api-changes","content":" ActivityGraphProvider now uses PHP 8.4 property hooks with asymmetric visibility:  // Before (6.x) $days = $provider-&gt;getDays(); $layout = $provider-&gt;getLayout(); // After (7.0) $days = $provider-&gt;days; $layout = $provider-&gt;layout;   ","version":"4.x","tagName":"h3"},{"title":"SecurityProviderâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#securityprovider","content":" SecurityProvider now uses #[Autowire] attribute for dependency injection. This is an internal change but may affect you if you were manually constructing this service.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Troubleshootingâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-troubleshooting","content":" ","version":"4.x","tagName":"h2"},{"title":"Class Not Foundâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#class-not-found","content":" If you get class not found errors for removed classes, you may have code referencing internal bundle classes. Update to use public APIs only.  ","version":"4.x","tagName":"h3"},{"title":"Configuration Errorsâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#configuration-errors","content":" Clear cache and warmup:  bin/console cache:clear bin/console cache:warmup   ","version":"4.x","tagName":"h3"},{"title":"Schema Issuesâ€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#schema-issues","content":" Check and update audit tables:  bin/console audit:schema:update --dump-sql bin/console audit:schema:update --force   ","version":"4.x","tagName":"h3"},{"title":"â“ Need Help?â€‹","type":1,"pageTitle":"Upgrading to 7.0","url":"/auditor-docs/auditor-bundle/upgrade/v7#-need-help","content":" Check GitHub IssuesOpen a new issue with details about your error ","version":"4.x","tagName":"h2"},{"title":"Installation","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x/installation","content":"","keywords":"","version":"3.x"},{"title":"Requirementsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/3.x/installation#requirements","content":" Version\tStatus\tRequirements2.x\tActive development ðŸš€\tPHP &gt;= 7.4, Symfony &gt;= 4.4 1.x\tActive support\tPHP &gt;= 7.2, Symfony &gt;= 3.4  ","version":"3.x","tagName":"h2"},{"title":"Download the libraryâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/3.x/installation#download-the-library","content":" Open a command console, enter your project directory and execute the following command to download the latest stable version of this bundle:  composer require damienharper/auditor  ","version":"3.x","tagName":"h2"},{"title":"Providers","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x/providers","content":"Providers ... Work in progress ...","keywords":"","version":"3.x"},{"title":"Release Notes","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x/release-notes","content":"","keywords":"","version":"3.x"},{"title":"Version 2.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#version-2x","content":" ","version":"3.x","tagName":"h2"},{"title":"auditor v2.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v200","content":" Not yet released  BC changesâ€‹  Providing an integer value for the keep argument of the audit:clean command is no longer supported. Use the ISO 8601 duration format (e.g. P12M) instead.Passing name and value to the Query::addFilter() method is no longer supported. Pass it a FilterInterface object instead.Query::addRangeFilter() method has been removed, you should call Query::addFilter() instead and pass it a RangeFilter object.Query::addDateRangeFilter() method has been removed, you should call Query::addFilter() instead and pass it a DateRangeFilter object.  Changesâ€‹  Drop PHP 7.2 and 7.3 support.Drop Symfony 3.4 support.Audit relationship refs (#60)    ","version":"3.x","tagName":"h3"},{"title":"Version 1.xâ€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#version-1x","content":" ","version":"3.x","tagName":"h2"},{"title":"auditor v1.3.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v131","content":" 2021-10-26  Changesâ€‹  Blocks installation along with doctrine/dbal 3.x    ","version":"3.x","tagName":"h3"},{"title":"auditor v1.3.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v130","content":" 2021-09-27  Fixesâ€‹  #35 - Fixes storage mapper callable handling#41 - Remove flusher callback from logger on rollback#46 - Resets transaction once processed by the onFlush event subscriber#50 - Fix an edge case where annotations where not loaded if audited entities were set in configuration  Changesâ€‹  #40 - Add support to php 8 attributes#31 - Add audit event's database ID on LifecycleEvent payload in DoctrineProviderProperly handle (unsupported) composite primary keys: throw a dedicated exception when such an entity is audited.    ","version":"3.x","tagName":"h3"},{"title":"auditor v1.2.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v120","content":" 2021-03-04  Fixesâ€‹  #11 - Is auditor using the database during a cache:clear?#29 - reader-&gt;createQuery-&gt;addFilter by array of object_ids#243 (auditor-bundle) - How to store audit tables in other database ?#244 (auditor-bundle) - AuditReader-&gt;getAudits by array of ids#245 (auditor-bundle) - Doctrine Migrations not managing audit table#249 (auditor-bundle) - Doctrine migrations wants to drop tables  Changesâ€‹  #26 - Fixed multiple entity manager setups#30 - Annotations lazy loading#28 - Enhanced query filters  Query::addFilter(string $name, $value) Query::addRangeFilter(string $name, $minValue, $maxValue) Query::addDateRangeFilter(string $name, $minValue, $maxValue)   are now deprecated in favor of  Query::addFilter(FilterInterface $filter)   There are several kinds of filters:  SimpleFilter lets you filter by a specific value or set of valuesRangeFilter lets you filter by a range of valuesDateRangeFilter lets you filter by a range of dates  More details in the documentation    ","version":"3.x","tagName":"h3"},{"title":"auditor v1.1.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v110","content":" 2021-02-10  Changesâ€‹  #19 - Better handling of binary data#20 - UID support (Ramsey UUID/Symfony ULID)#21 - Fixed a Query bug using multiple filters#24 - Fixed a bug related to storage entity managers    ","version":"3.x","tagName":"h3"},{"title":"auditor v1.0.1â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v101","content":" 2020-12-10  Changesâ€‹  Updated CI to ensure proper Symfony versions are installed during tests (3.4, 4.4 and 5.x are tested)Fixed a failing test with Symfony 3.4    ","version":"3.x","tagName":"h3"},{"title":"auditor v1.0.0â€‹","type":1,"pageTitle":"Release Notes","url":"/auditor-docs/auditor/3.x/release-notes#auditor-v100","content":" 2020-12-06  Initial release.  The purpose of auditor is to provide an easy and standardized way to collect audit logs.  This library is architected around two concepts:  Auditing services responsible for collecting audit eventsStorage services responsible for persisting audit traces  Those two kind of services are offered by Providers and a default one is included with this library: DoctrineProvider  DoctrineProvider offers both auditing services and storage services and creates audit logs for all Doctrine ORM database related changes. ","version":"3.x","tagName":"h3"},{"title":"User Provider","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/customization/user-provider","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“ Interfaceâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-interface","content":" namespace DH\\Auditor\\User; interface UserProviderInterface { public function __invoke(): ?UserInterface; }   The provider must return a UserInterface or null:  namespace DH\\Auditor\\User; interface UserInterface { public function getIdentifier(): ?string; public function getUsername(): ?string; }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Built-in Providerâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-built-in-provider","content":" The default DH\\AuditorBundle\\User\\UserProvider:  public function __invoke(): ?UserInterface { $tokenUser = $this-&gt;getTokenUser(); $impersonatorUser = $this-&gt;getImpersonatorUser(); // Get identifier if getId() method exists $identifier = null; if ($tokenUser instanceof SymfonyUserInterface) { if (method_exists($tokenUser, 'getId')) { $identifier = $tokenUser-&gt;getId(); } $username = $tokenUser-&gt;getUserIdentifier(); } // Track impersonation if ($impersonatorUser instanceof SymfonyUserInterface) { $username .= '[impersonator '.$impersonatorUser-&gt;getUserIdentifier().']'; } if (null === $identifier &amp;&amp; null === $username) { return null; } return new User((string) $identifier, $username); }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ–¥ï¸ Console Commandsâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#ï¸-console-commands","content":" For CLI commands, the bundle provides DH\\AuditorBundle\\User\\ConsoleUserProvider which automatically tracks the command name:  public function __invoke(): ?UserInterface { if (null === $this-&gt;currentCommand) { return null; } // Command name is used as both ID and username return new User( $this-&gt;currentCommand, // e.g., 'app:import-users' $this-&gt;currentCommand ); }   TIP This allows you to: ðŸ” Identify which command made specific changesðŸ”Ž Filter audit entries by command in the viewerðŸ“Š Track automated processes separately from user actions  Example audit entries:  app:import-users - Import commanddoctrine:fixtures:load - Fixtures loadingapp:sync-products - Sync command  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Creating a Custom Providerâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-creating-a-custom-provider","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#basic-example","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\User\\User; use DH\\Auditor\\User\\UserInterface; use DH\\Auditor\\User\\UserProviderInterface; class CustomUserProvider implements UserProviderInterface { public function __construct( private readonly MyAuthService $authService, ) {} public function __invoke(): ?UserInterface { $user = $this-&gt;authService-&gt;getCurrentUser(); if (null === $user) { return null; } return new User( (string) $user-&gt;getId(), $user-&gt;getEmail() ); } }   ","version":"4.x","tagName":"h3"},{"title":"Registrationâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#registration","content":" # config/packages/dh_auditor.yaml dh_auditor: user_provider: 'App\\Audit\\CustomUserProvider'   The service is auto-wired. If you need explicit configuration:  # config/services.yaml services: App\\Audit\\CustomUserProvider: arguments: - '@App\\Security\\MyAuthService'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“š Examplesâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-examples","content":" ","version":"4.x","tagName":"h2"},{"title":"ðŸ”‘ API Token Authenticationâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-api-token-authentication","content":" &lt;?php namespace App\\Audit; use App\\Security\\ApiTokenManager; use DH\\Auditor\\User\\User; use DH\\Auditor\\User\\UserInterface; use DH\\Auditor\\User\\UserProviderInterface; class ApiUserProvider implements UserProviderInterface { public function __construct( private readonly ApiTokenManager $tokenManager, ) {} public function __invoke(): ?UserInterface { $token = $this-&gt;tokenManager-&gt;getCurrentToken(); if (null === $token) { return null; } return new User( $token-&gt;getClientId(), sprintf('API: %s', $token-&gt;getClientName()) ); } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸŒ External OAuth/SSOâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-external-oauthsso","content":" &lt;?php namespace App\\Audit; use DH\\Auditor\\User\\User; use DH\\Auditor\\User\\UserInterface; use DH\\Auditor\\User\\UserProviderInterface; use Symfony\\Component\\HttpFoundation\\RequestStack; class OAuthUserProvider implements UserProviderInterface { public function __construct( private readonly RequestStack $requestStack, ) {} public function __invoke(): ?UserInterface { $request = $this-&gt;requestStack-&gt;getCurrentRequest(); if (null === $request) { return null; } // User info from OAuth headers $userId = $request-&gt;headers-&gt;get('X-User-Id'); $userName = $request-&gt;headers-&gt;get('X-User-Email'); if (null === $userId) { return null; } return new User($userId, $userName ?? 'unknown'); } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”€ Combining Multiple Sourcesâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-combining-multiple-sources","content":" &lt;?php namespace App\\Audit; use App\\Security\\ApiTokenManager; use DH\\Auditor\\User\\User; use DH\\Auditor\\User\\UserInterface; use DH\\Auditor\\User\\UserProviderInterface; use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface; class CompositeUserProvider implements UserProviderInterface { public function __construct( private readonly TokenStorageInterface $tokenStorage, private readonly ApiTokenManager $apiTokenManager, ) {} public function __invoke(): ?UserInterface { // Try Symfony security first $token = $this-&gt;tokenStorage-&gt;getToken(); if (null !== $token &amp;&amp; null !== $token-&gt;getUser()) { $user = $token-&gt;getUser(); return new User( method_exists($user, 'getId') ? (string) $user-&gt;getId() : '', $user-&gt;getUserIdentifier() ); } // Fall back to API token $apiToken = $this-&gt;apiTokenManager-&gt;getCurrentToken(); if (null !== $apiToken) { return new User( $apiToken-&gt;getClientId(), 'API: ' . $apiToken-&gt;getClientName() ); } return null; } }     ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"User Provider","url":"/auditor-docs/auditor-bundle/customization/user-provider#-next-steps","content":" ðŸ”’ Security Provider - Customize IP/context detectionðŸ›¡ï¸ Role Checker - Customize access control ","version":"4.x","tagName":"h2"},{"title":"Upgrading","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/3.x/upgrading","content":"","keywords":"","version":"3.x"},{"title":"Upgrading from DoctrineAuditBundleâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#upgrading-from-doctrineauditbundle","content":" DoctrineAuditBundle is now deprecated since it has been split into two separate packages  auditor the core libraryauditor-bundle a Symfony bundle providing auditor integration into Symfony applications  So, upgrading from DoctrineAuditBundle to auditor + auditor-bundle requires a few steps  ","version":"3.x","tagName":"h2"},{"title":"1. Configuration fileâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#1-configuration-file","content":" Create a new configuration file dh_auditor.yaml(full configuration reference available here)  Minimal config file:  dh_auditor: enabled: true providers: doctrine: table_prefix: ~ table_suffix: '_audit'   ","version":"3.x","tagName":"h3"},{"title":"2. Add auditor-bundle as a dependencyâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#2-add-auditor-bundle-as-a-dependency","content":" Run the following command in a console  composer require damienharper/auditor-bundle ^4.0   ","version":"3.x","tagName":"h3"},{"title":"3. Fix annotation namespace changesâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#3-fix-annotation-namespace-changes","content":" Replace the use statement related to Audit annotation to reference the new namespace in your entities.  - use DH\\DoctrineAuditBundle\\Annotation as Audit; + use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit;   ","version":"3.x","tagName":"h3"},{"title":"4. Fix route name changesâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#4-fix-route-name-changes","content":" Reference the new routes in the config/routes.yaml  - dh_doctrine_audit: - resource: &quot;@DHDoctrineAuditBundle/Controller/&quot; - type: annotation + dh_auditor: + resource: &quot;@DHAuditorBundle/Controller/&quot; + type: annotation   Route names have been renamed, change them accordingly in your code. You'll find below a summary of route name changes.  Before (DoctrineAuditBundle route name)\tAfter (auditor-bundle route name)dh_doctrine_audit_list_audits\tdh_auditor_list_audits dh_doctrine_audit_show_transaction\tdh_auditor_show_transaction dh_doctrine_audit_show_entity_history\tdh_auditor_show_entity_history  ","version":"3.x","tagName":"h3"},{"title":"5. AuditReader deprecationâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#5-auditreader-deprecation","content":" AuditReader has been replaced by Reader and Query objects, so if you used it to query the audit logs, dive into the Querying audits section  ","version":"3.x","tagName":"h3"},{"title":"6. Remove DoctrineAuditBundleâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#6-remove-doctrineauditbundle","content":" Run the following command in a console  composer remove damienharper/doctrine-audit-bundle   ","version":"3.x","tagName":"h3"},{"title":"7. Ensure your schema is up to dateâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#7-ensure-your-schema-is-up-to-date","content":" Check the Upgrading from a previous versionbelow to ensure your schema is up to date.    ","version":"3.x","tagName":"h3"},{"title":"Upgrading from a previous versionâ€‹","type":1,"pageTitle":"Upgrading","url":"/auditor-docs/auditor/3.x/upgrading#upgrading-from-a-previous-version","content":" Once you upgraded the bundle to a newer version, you first have to be sure your current schema is up to date and upgrade it if necessary.  The following command does all of this for you:  # symfony &lt; 3.4 app/console audit:schema:update --force   # symfony &gt;= 3.4 bin/console audit:schema:update --force  ","version":"3.x","tagName":"h2"},{"title":"Audit Viewer","type":0,"sectionRef":"#","url":"/auditor-docs/auditor-bundle/viewer","content":"","keywords":"","version":"4.x"},{"title":"âœ¨ Enabling the Viewerâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-enabling-the-viewer","content":" # config/packages/dh_auditor.yaml dh_auditor: providers: doctrine: viewer: true   Or with options:  dh_auditor: providers: doctrine: viewer: enabled: true page_size: 50   ","version":"4.x","tagName":"h2"},{"title":"ðŸ›¤ï¸ Routesâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#ï¸-routes","content":" The viewer registers three routes:  Route\tURL\tDescriptiondh_auditor_list_audits\t/audit\tList all audited entities dh_auditor_show_entity_stream\t/audit/{entity}/{id?}\tEntity audit stream dh_auditor_show_transaction_stream\t/audit/transaction/{hash}\tTransaction details  ","version":"4.x","tagName":"h2"},{"title":"Route Configurationâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#route-configuration","content":" With Symfony Flex, routes are auto-configured. Otherwise, create config/routes/dh_auditor.yaml:  dh_auditor: resource: &quot;@DHAuditorBundle/Controller/&quot; type: auditor   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“„ Pagesâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-pages","content":" ","version":"4.x","tagName":"h2"},{"title":"Entity List (/audit)â€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#entity-list-audit","content":" Displays all audited entities with:  ðŸ“‹ Entity class nameðŸ—„ï¸ Audit table nameðŸ”¢ Number of audit entriesðŸ”— Link to view history  ","version":"4.x","tagName":"h3"},{"title":"Entity Stream (/audit/{entity})â€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#entity-stream-auditentity","content":" Shows audit entries for an entity:  ðŸ“… Chronological list (newest first)ðŸ·ï¸ Operation type (insert/update/remove/associate/dissociate)ðŸ‘¤ User and timestampðŸ“ Changed properties (diff)  Filter by specific entity ID:  /audit/App-Entity-User/42   ðŸ” Filtersâ€‹  The entity stream page includes filters to narrow down audit entries:  Action Type FilterFilter by operation type:  insert - Record createdupdate - Record updatedremove - Record deletedassociate - Relation addeddissociate - Relation removed  User FilterFilter by the user who performed the action:  All registered users who have made changesAnonymous (for actions without user attribution)CLI commands (each command is tracked by its name, e.g., app:import-users)  TIP Filters can be combined and are preserved during pagination.  URL parameters:  /audit/App-Entity-User?type=update&amp;user=42 /audit/App-Entity-User?type=insert&amp;user=__anonymous__   ","version":"4.x","tagName":"h3"},{"title":"Transaction View (/audit/transaction/{hash})â€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#transaction-view-audittransactionhash","content":" Groups all changes from a single database transaction across all entities.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“Š Activity Graphâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-activity-graph","content":" Each entity card displays a visual sparkline graph showing audit activity over time.  ","version":"4.x","tagName":"h2"},{"title":"Configurationâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#configuration","content":" dh_auditor: providers: doctrine: viewer: enabled: true activity_graph: enabled: true # Show/hide the graph (default: true) days: 30 # Number of days to display (default: 30, max: 30) layout: 'bottom' # Graph layout: 'bottom' or 'inline' (default: 'bottom') cache: enabled: true # Enable caching (default: true) pool: 'cache.app' # Cache pool service ID ttl: 300 # Cache TTL in seconds (default: 300)   ","version":"4.x","tagName":"h3"},{"title":"Layout Optionsâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#layout-options","content":" Layout\tDescriptionbottom\tSparkline displayed below the entity info, full width (default) inline\tCompact sparkline displayed in the header row, next to event count  ","version":"4.x","tagName":"h3"},{"title":"Cachingâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#caching","content":" The activity graph uses caching to improve performance on large audit tables.  NOTE Caching requires symfony/cache: composer require symfony/cache If symfony/cache is not installed, the graph will still work but without caching.  Cache with Tagsâ€‹  If your cache pool supports tags (TagAwareCacheInterface), the bundle uses the tag dh_auditor.activity for efficient cache invalidation.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—‘ï¸ Clear Cache Commandâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#ï¸-clear-cache-command","content":" Clear the activity graph cache manually:  # Clear all activity graph cache php bin/console audit:cache:clear # Clear cache for a specific entity php bin/console audit:cache:clear --entity=&quot;App\\Entity\\User&quot;   IMPORTANT Clearing all cache requires a cache pool that supports tags. If your cache pool doesn't support tags, you can only clear cache for specific entities.  ","version":"4.x","tagName":"h3"},{"title":"Display Behaviorâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#display-behavior","content":" State\tBehaviorGraph disabled (enabled: false)\tActivity graph section is completely hidden Graph enabled, no data\tPlaceholder with &quot;No recent activity&quot; message Graph enabled, with data\tBars are normalized (tallest bar = 100%)  ","version":"4.x","tagName":"h3"},{"title":"ðŸŒ™ Dark Modeâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-dark-mode","content":" The viewer includes a dark/light mode toggle button in the header.  ","version":"4.x","tagName":"h2"},{"title":"Behaviorâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#behavior","content":" Default: Follows system preference (prefers-color-scheme)Manual toggle: Click the sun/moon icon in the headerPersistence: User preference is saved in localStorage  The toggle works without page reload and persists across sessions.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”’ Access Controlâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-access-control","content":" ","version":"4.x","tagName":"h2"},{"title":"Via Configurationâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#via-configuration","content":" dh_auditor: providers: doctrine: entities: App\\Entity\\User: roles: view: - ROLE_ADMIN   ","version":"4.x","tagName":"h3"},{"title":"Via Attributesâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#via-attributes","content":" #[Audit\\Auditable] #[Audit\\Security(view: ['ROLE_ADMIN'])] class User {}   ","version":"4.x","tagName":"h3"},{"title":"Via Symfony Securityâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#via-symfony-security","content":" # config/packages/security.yaml security: access_control: - { path: ^/audit, roles: ROLE_ADMIN }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”— URL Formatâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-url-format","content":" Entity namespaces use dashes instead of backslashes:  App\\Entity\\User â†’ App-Entity-User   Helper methods:  use DH\\AuditorBundle\\Helper\\UrlHelper; // Namespace to URL parameter $param = UrlHelper::namespaceToParam('App\\Entity\\User'); // Returns: 'App-Entity-User' // URL parameter to namespace $namespace = UrlHelper::paramToNamespace('App-Entity-User'); // Returns: 'App\\Entity\\User'   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Generating URLsâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-generating-urls","content":" use Symfony\\Component\\Routing\\Generator\\UrlGeneratorInterface; // Entity list $url = $urlGenerator-&gt;generate('dh_auditor_list_audits'); // Entity stream $url = $urlGenerator-&gt;generate('dh_auditor_show_entity_stream', [ 'entity' =&gt; 'App-Entity-User', ]); // Specific entity $url = $urlGenerator-&gt;generate('dh_auditor_show_entity_stream', [ 'entity' =&gt; 'App-Entity-User', 'id' =&gt; 42, ]); // With filters $url = $urlGenerator-&gt;generate('dh_auditor_show_entity_stream', [ 'entity' =&gt; 'App-Entity-User', 'type' =&gt; 'update', 'user' =&gt; '42', ]); // Transaction $url = $urlGenerator-&gt;generate('dh_auditor_show_transaction_stream', [ 'hash' =&gt; $transactionHash, ]);   ","version":"4.x","tagName":"h2"},{"title":"ðŸŽ¨ Customizationâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-customization","content":" ","version":"4.x","tagName":"h2"},{"title":"Override Templatesâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#override-templates","content":" Create files in templates/bundles/DHAuditorBundle/:  templates/bundles/DHAuditorBundle/ â”œâ”€â”€ Audit/ â”‚ â”œâ”€â”€ audits.html.twig # Entity list â”‚ â”œâ”€â”€ entity_stream.html.twig # Entity audit stream â”‚ â”œâ”€â”€ transaction_stream.html.twig # Transaction view â”‚ â”œâ”€â”€ entry.html.twig # Single entry â”‚ â””â”€â”€ helpers/ â”‚ â”œâ”€â”€ helper.html.twig # Helper macros â”‚ â””â”€â”€ pager.html.twig # Pagination â””â”€â”€ layout.html.twig # Base layout   ","version":"4.x","tagName":"h3"},{"title":"Custom Layoutâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#custom-layout","content":" {# templates/bundles/DHAuditorBundle/layout.html.twig #} {% extends 'base.html.twig' %} {% block stylesheets %} {{ parent() }} &lt;link rel=&quot;stylesheet&quot; href=&quot;{{ asset('bundles/dhauditor/app.css') }}&quot;&gt; {% endblock %} {% block body %} &lt;div class=&quot;container&quot;&gt; {% block dh_auditor_content %}{% endblock %} &lt;/div&gt; {% endblock %}   ","version":"4.x","tagName":"h3"},{"title":"Template Blocksâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#template-blocks","content":" Block\tDescription\tAvailable intitle\tPage title\tAll pages stylesheets\tCSS includes\tAll pages dh_auditor_content\tMain content area\tAll pages dh_auditor_header\tSub-header with back link &amp; filters\tEntity stream, Transaction view dh_auditor_pager\tPagination\tEntity stream javascripts\tJavaScript includes\tAll pages  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ Assetsâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-assets","content":" Install assets:  bin/console assets:install   Assets are installed to public/bundles/dhauditor/.  ","version":"4.x","tagName":"h2"},{"title":"ðŸŒ Translationsâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-translations","content":" Available translations:  Language\tCodeEnglish\ten French\tfr German\tde Spanish\tes Italian\tit Dutch\tnl Russian\tru Ukrainian\tuk Estonian\tet  The viewer uses your application's locale automatically.  ","version":"4.x","tagName":"h2"},{"title":"ðŸš« Disabling the Viewerâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-disabling-the-viewer","content":" dh_auditor: providers: doctrine: viewer: false   Routes are not registered, /audit returns 404.    ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Next Stepsâ€‹","type":1,"pageTitle":"Audit Viewer","url":"/auditor-docs/auditor-bundle/viewer#-next-steps","content":" ðŸ›¡ï¸ Role Checker - Access controlâš™ï¸ Configuration - All options ","version":"4.x","tagName":"h2"},{"title":"Configuration Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/configuration","content":"","keywords":"","version":"4.x"},{"title":"âš™ï¸ Auditor Configurationâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#ï¸-auditor-configuration","content":" The main Configuration class accepts the following options:  &lt;?php use DH\\Auditor\\Configuration; $configuration = new Configuration([ 'enabled' =&gt; true, 'timezone' =&gt; 'UTC', 'user_provider' =&gt; null, 'security_provider' =&gt; null, 'role_checker' =&gt; null, ]);   ","version":"4.x","tagName":"h2"},{"title":"Options Referenceâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#options-reference","content":" Option\tType\tDefault\tDescriptionenabled\tbool\ttrue\tEnable or disable auditing globally timezone\tstring\t'UTC'\tTimezone used for audit timestamps user_provider\tcallable|null\tnull\tCallback that returns the current user security_provider\tcallable|null\tnull\tCallback that returns security context info role_checker\tcallable|null\tnull\tCallback that checks if user can view entity audits  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Configuration Methodsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#-configuration-methods","content":" ","version":"4.x","tagName":"h2"},{"title":"Enable/Disable Auditingâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#enabledisable-auditing","content":" // Disable auditing $configuration-&gt;disable(); // Re-enable auditing $configuration-&gt;enable(); // Check if auditing is enabled if ($configuration-&gt;isEnabled()) { // ... }   ","version":"4.x","tagName":"h3"},{"title":"Get Timezoneâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#get-timezone","content":" $timezone = $configuration-&gt;getTimezone();   ","version":"4.x","tagName":"h3"},{"title":"ðŸ‘¤ User Providerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#-user-provider","content":" The user provider is a callable that returns information about the current user. This is used to record who made each change.  use DH\\Auditor\\User\\User; $configuration-&gt;setUserProvider(function (): ?User { // Return null if no user is authenticated $currentUser = $this-&gt;security-&gt;getUser(); if (null === $currentUser) { return null; } return new User( (string) $currentUser-&gt;getId(), // User identifier $currentUser-&gt;getUsername() // Username for display ); });   The User class implements UserInterface:  namespace DH\\Auditor\\User; interface UserInterface { public function getIdentifier(): ?string; public function getUsername(): ?string; }   See User Provider Configuration for more details.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Security Providerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#-security-provider","content":" The security provider returns contextual security information to be stored with audit entries:  $configuration-&gt;setSecurityProvider(function (): array { return [ 'client_ip' =&gt; $_SERVER['REMOTE_ADDR'] ?? null, 'user_fqdn' =&gt; $this-&gt;security-&gt;getUser()?::class, 'user_firewall' =&gt; $this-&gt;getFirewallName(), ]; });   See Security Provider Configuration for more details.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ›¡ï¸ Role Checkerâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#ï¸-role-checker","content":" The role checker determines whether a user can view audits for a specific entity:  $configuration-&gt;setRoleChecker(function (string $entity, string $scope): bool { // $entity is the FQCN of the audited entity // $scope is the action (e.g., 'view') // Example: Only admins can view User audits if ($entity === User::class) { return $this-&gt;security-&gt;isGranted('ROLE_ADMIN'); } // Allow everyone to view other audits return true; });   See Role Checker Configuration for more details.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ DoctrineProvider Configurationâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#ï¸-doctrineprovider-configuration","content":" The DoctrineProvider has its own configuration. See DoctrineProvider Configuration for details.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“ Configuration Summaryâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#-configuration-summary","content":" &lt;?php use DH\\Auditor\\Auditor; use DH\\Auditor\\Configuration; use DH\\Auditor\\User\\User; use Symfony\\Component\\EventDispatcher\\EventDispatcher; $configuration = new Configuration([ 'enabled' =&gt; true, 'timezone' =&gt; 'Europe/Paris', ]); // Set user provider $configuration-&gt;setUserProvider(function (): ?User { $user = $securityContext-&gt;getUser(); if (null === $user) { return null; } return new User((string) $user-&gt;getId(), $user-&gt;getUsername()); }); // Set security provider $configuration-&gt;setSecurityProvider(function (): array { return [ 'client_ip' =&gt; $_SERVER['REMOTE_ADDR'] ?? null, ]; }); // Set role checker $configuration-&gt;setRoleChecker(function (string $entity, string $scope): bool { return $this-&gt;authorizationChecker-&gt;isGranted('ROLE_AUDIT_VIEWER'); }); $auditor = new Auditor($configuration, new EventDispatcher());     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Configuration Reference","url":"/auditor-docs/auditor/configuration#next-steps","content":" ðŸ‘¤ User Provider ConfigurationðŸ” Security Provider ConfigurationðŸ›¡ï¸ Role Checker ConfigurationðŸ—„ï¸ DoctrineProvider Configuration ","version":"4.x","tagName":"h2"},{"title":"Console Commands","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/commands","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Available Commandsâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-available-commands","content":" Command\tDescriptionaudit:schema:update\tCreate or update audit table schemas audit:clean\tRemove old audit entries  ","version":"4.x","tagName":"h2"},{"title":"ðŸ› ï¸ audit:schema:updateâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#ï¸-auditschema","content":" Creates new audit tables and updates existing ones to match the current schema.  ","version":"4.x","tagName":"h2"},{"title":"Usageâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#usage","content":" php bin/console audit:schema:update [options]   ","version":"4.x","tagName":"h3"},{"title":"Optionsâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#options","content":" Option\tShort\tDescription--dump-sql Show SQL statements without executing them --force\t-f\tExecute the SQL statements  ","version":"4.x","tagName":"h3"},{"title":"Examplesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#examples","content":" # Preview the SQL that would be executed php bin/console audit:schema:update --dump-sql # Output: # The following SQL statements will be executed: # # CREATE TABLE users_audit (...); # CREATE INDEX idx_type_xxx ON users_audit (type); # ... # Execute the changes php bin/console audit:schema:update --force # Both: show SQL and execute php bin/console audit:schema:update --dump-sql --force   ","version":"4.x","tagName":"h3"},{"title":"When to Runâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#when-to-run","content":" Run this command:  After adding #[Auditable] to a new entityAfter updating auditor to a new versionDuring deployment to ensure schema is up-to-date  TIP The command is safe to run multiple times. Existing tables are updated (not recreated), existing data is preserved, and only necessary changes are applied.  ","version":"4.x","tagName":"h3"},{"title":"Exit Codesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#exit-codes","content":" Code\tMeaning0\tSuccess (including &quot;nothing to update&quot;) 1\tError or missing required options  ","version":"4.x","tagName":"h3"},{"title":"ðŸ§¹ audit:cleanâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-audit","content":" Removes audit entries older than a specified retention period.  ","version":"4.x","tagName":"h2"},{"title":"Usageâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#usage-1","content":" php bin/console audit:clean [options] [keep]   ","version":"4.x","tagName":"h3"},{"title":"Argumentsâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#arguments","content":" Argument\tDefault\tDescriptionkeep\tP12M\tRetention period as ISO 8601 duration  ","version":"4.x","tagName":"h3"},{"title":"Optionsâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#options-1","content":" Option\tShort\tDescription--no-confirm Skip confirmation prompt --dry-run Show what would be deleted without executing --dump-sql Show the SQL statements --date\t-d\tClean audits before a specific date --exclude\t-x\tExclude specific entities (can be used multiple times) --include\t-i\tInclude only specific entities (can be used multiple times)  ","version":"4.x","tagName":"h3"},{"title":"Retention Period Formatâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#retention-period-format","content":" The keep argument uses ISO 8601 duration format:  Format\tMeaningP12M\t12 months P1Y\t1 year P6M\t6 months P30D\t30 days P7D\t7 days P1D\t1 day PT12H\t12 hours  ","version":"4.x","tagName":"h3"},{"title":"Examplesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#examples-1","content":" Basic Cleanupâ€‹  # Keep last 12 months (default) php bin/console audit:clean # Keep last 6 months php bin/console audit:clean P6M # Keep last 30 days php bin/console audit:clean P30D   Preview Modeâ€‹  # See what would be deleted without actually deleting php bin/console audit:clean P6M --dry-run # See the SQL statements php bin/console audit:clean P6M --dump-sql   Non-Interactiveâ€‹  # Skip confirmation (useful for cron jobs) php bin/console audit:clean P12M --no-confirm   Custom Dateâ€‹  # Delete audits before a specific date php bin/console audit:clean --date=2024-01-01 # Combine with no-confirm for scripts php bin/console audit:clean --date=2023-12-31 --no-confirm   Entity Filteringâ€‹  # Exclude specific entities from cleanup php bin/console audit:clean -x App\\\\Entity\\\\User -x App\\\\Entity\\\\Payment # Include only specific entities php bin/console audit:clean -i App\\\\Entity\\\\Log -i App\\\\Entity\\\\Session # Long form php bin/console audit:clean --exclude=App\\\\Entity\\\\User --include=App\\\\Entity\\\\Post   ","version":"4.x","tagName":"h3"},{"title":"Outputâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#output","content":" You are about to clean audits created before 2024-01-15 14:30:45: 12 classes involved. Do you want to proceed? (yes/no) [no]: &gt; yes Starting... Cleaning audit tables... (users_audit) 12/12 [============================] 100% Cleaning audit tables... (done) [OK] Success.   ","version":"4.x","tagName":"h3"},{"title":"Schedulingâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#scheduling","content":" For automated cleanup, add to your crontab:  # Clean up audits older than 12 months, daily at 2 AM 0 2 * * * /path/to/php /path/to/bin/console audit:clean P12M --no-confirm &gt;&gt; /var/log/audit-clean.log 2&gt;&amp;1   TIP Use Symfony Messenger Scheduler if available for more robust scheduling.  ","version":"4.x","tagName":"h3"},{"title":"Exit Codesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#exit-codes-1","content":" Code\tMeaning0\tSuccess or cancelled by user 1\tError  ","version":"4.x","tagName":"h3"},{"title":"ðŸ’» Programmatic Usageâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-programmatic-usage","content":" Both commands can be used programmatically:  ","version":"4.x","tagName":"h2"},{"title":"Schema Updateâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#schema-update","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Schema\\SchemaManager; $schemaManager = new SchemaManager($provider); // Get SQL $sqls = $schemaManager-&gt;getUpdateAuditSchemaSql(); // Execute $schemaManager-&gt;updateAuditSchema(); // With progress callback $schemaManager-&gt;updateAuditSchema(null, function (array $progress) { // Handle progress });   ","version":"4.x","tagName":"h3"},{"title":"Cleaning Auditsâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#cleaning-audits","content":" use Doctrine\\DBAL\\Connection; /** @var Connection $connection */ $connection = $storageService-&gt;getEntityManager()-&gt;getConnection(); $queryBuilder = $connection-&gt;createQueryBuilder(); $queryBuilder -&gt;delete('users_audit') -&gt;where('created_at &lt; :until') -&gt;setParameter('until', (new \\DateTime('-12 months'))-&gt;format('Y-m-d H:i:s')) ; $deleted = $queryBuilder-&gt;executeStatement();   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”’ Command Lockingâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-command-locking","content":" Both commands use Symfony's Lock component to prevent concurrent execution:  The command is already running in another process.   NOTE This ensures data integrity when running commands in parallel or from cron jobs.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Registering Commands (Standalone)â€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-registering-commands-standalone","content":" When not using auditor-bundle, register commands manually:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Command\\CleanAuditLogsCommand; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Command\\UpdateSchemaCommand; use Symfony\\Component\\Console\\Application; $application = new Application(); // Schema update command $updateCommand = new UpdateSchemaCommand(); $updateCommand-&gt;setAuditor($auditor); $application-&gt;add($updateCommand); // Clean command $cleanCommand = new CleanAuditLogsCommand(); $cleanCommand-&gt;setAuditor($auditor); $application-&gt;add($cleanCommand); $application-&gt;run();   ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-best-practices","content":" Always preview first - Use --dump-sql and --dry-run before executingBackup before cleanup - Especially for large deletionsSchedule regular cleanups - Prevent unlimited growthMonitor disk space - Audit tables can grow quicklyConsider retention policies - Different entities may need different retentionTest in staging - Verify commands work as expected before production  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Troubleshootingâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#-troubleshooting","content":" ","version":"4.x","tagName":"h2"},{"title":"\"The command is already running\"â€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#the-command-is-already-running","content":" WARNING Wait for the other instance to finish, or check for stuck processes.  ","version":"4.x","tagName":"h3"},{"title":"Schema update has no changesâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#schema-update-has-no-changes","content":" NOTE This means your audit tables are already up-to-date.  ","version":"4.x","tagName":"h3"},{"title":"Permission deniedâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#permission-denied","content":" IMPORTANT Ensure the database user has CREATE TABLE and ALTER TABLE permissions.  ","version":"4.x","tagName":"h3"},{"title":"Timeout during large cleanupâ€‹","type":1,"pageTitle":"Console Commands","url":"/auditor-docs/auditor/commands#timeout-during-large-cleanup","content":" For very large tables, consider:  Running during off-peak hoursIncreasing PHP timeoutBreaking into smaller date ranges ","version":"4.x","tagName":"h3"},{"title":"Security Provider Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/configuration/security-provider","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-overview","content":" When an audit entry is created, the security provider can supply:  ip - The client's IP addressblame_user_fqdn - The fully qualified class name of the userblame_user_firewall - The Symfony firewall name (if applicable)  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Setting Up a Security Providerâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-setting-up-a-security-provider","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#basic-example","content":" &lt;?php use DH\\Auditor\\Configuration; $configuration = new Configuration(['enabled' =&gt; true]); $configuration-&gt;setSecurityProvider(function (): array { return [ 'client_ip' =&gt; $_SERVER['REMOTE_ADDR'] ?? null, 'user_fqdn' =&gt; null, 'user_firewall' =&gt; null, ]; });   ","version":"4.x","tagName":"h3"},{"title":"Complete Symfony Exampleâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#complete-symfony-example","content":" &lt;?php use DH\\Auditor\\Configuration; use Symfony\\Component\\HttpFoundation\\RequestStack; use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface; use Symfony\\Bundle\\SecurityBundle\\Security\\FirewallMap; $configuration-&gt;setSecurityProvider( function () use ($requestStack, $tokenStorage, $firewallMap): array { $request = $requestStack-&gt;getCurrentRequest(); $token = $tokenStorage-&gt;getToken(); return [ 'client_ip' =&gt; $request?-&gt;getClientIp(), 'user_fqdn' =&gt; $token?-&gt;getUser()?::class, 'user_firewall' =&gt; $this-&gt;getFirewallName($request, $firewallMap), ]; } ); // Helper method to get firewall name function getFirewallName(?Request $request, FirewallMap $firewallMap): ?string { if (null === $request) { return null; } $firewallConfig = $firewallMap-&gt;getFirewallConfig($request); return $firewallConfig?-&gt;getName(); }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Return Value Structureâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-return-value-structure","content":" The security provider must return an array with these keys:  Key\tType\tDescriptionclient_ip\tstring|null\tThe IP address of the client making the request user_fqdn\tstring|null\tThe fully qualified class name of the user object user_firewall\tstring|null\tThe name of the security firewall used  ","version":"4.x","tagName":"h2"},{"title":"ðŸŒ Handling Different Contextsâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-handling-different-contexts","content":" ","version":"4.x","tagName":"h2"},{"title":"Web Requestsâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#web-requests","content":" $configuration-&gt;setSecurityProvider(function () use ($requestStack): array { $request = $requestStack-&gt;getCurrentRequest(); return [ 'client_ip' =&gt; $request?-&gt;getClientIp(), 'user_fqdn' =&gt; $this-&gt;security-&gt;getUser()?::class, 'user_firewall' =&gt; $this-&gt;getFirewallName($request), ]; });   ","version":"4.x","tagName":"h3"},{"title":"Behind a Proxyâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#behind-a-proxy","content":" TIP When behind a load balancer or reverse proxy, ensure trusted proxies are configured in Symfony. The getClientIp() method will automatically handle X-Forwarded-For.  $configuration-&gt;setSecurityProvider(function () use ($requestStack): array { $request = $requestStack-&gt;getCurrentRequest(); // Ensure trusted proxies are configured in Symfony // The getClientIp() method will automatically handle X-Forwarded-For $clientIp = $request?-&gt;getClientIp(); return [ 'client_ip' =&gt; $clientIp, 'user_fqdn' =&gt; null, 'user_firewall' =&gt; null, ]; });   ","version":"4.x","tagName":"h3"},{"title":"CLI Commandsâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#cli-commands","content":" $configuration-&gt;setSecurityProvider(function (): array { if (PHP_SAPI === 'cli') { return [ 'client_ip' =&gt; gethostbyname(gethostname()) ?: '127.0.0.1', 'user_fqdn' =&gt; 'CLI', 'user_firewall' =&gt; null, ]; } // Regular web handling... return [ 'client_ip' =&gt; $_SERVER['REMOTE_ADDR'] ?? null, 'user_fqdn' =&gt; null, 'user_firewall' =&gt; null, ]; });   ","version":"4.x","tagName":"h3"},{"title":"API Requestsâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#api-requests","content":" $configuration-&gt;setSecurityProvider(function () use ($requestStack): array { $request = $requestStack-&gt;getCurrentRequest(); // Check if this is an API request $isApi = str_starts_with($request?-&gt;getPathInfo() ?? '', '/api'); return [ 'client_ip' =&gt; $request?-&gt;getClientIp(), 'user_fqdn' =&gt; $this-&gt;security-&gt;getUser()?::class, 'user_firewall' =&gt; $isApi ? 'api' : 'main', ]; });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ” Accessing Security Info from Audit Entriesâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-accessing-security-info-from-audit-entries","content":" When reading audit entries:  &lt;?php $reader = new Reader($provider); $audits = $reader-&gt;createQuery(Post::class)-&gt;execute(); foreach ($audits as $entry) { echo &quot;IP Address: &quot; . $entry-&gt;getIp(); echo &quot;User Class: &quot; . $entry-&gt;getUserFqdn(); echo &quot;Firewall: &quot; . $entry-&gt;getUserFirewall(); }   ","version":"4.x","tagName":"h2"},{"title":"ðŸŒ IP Address Formatâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-ip-address-format","content":" The ip column supports both IPv4 and IPv6 addresses (max 45 characters):  IPv4: 192.168.1.1IPv6: 2001:0db8:85a3:0000:0000:8a2e:0370:7334  ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#-best-practices","content":" Always handle null request - The request may not be available (CLI, async jobs)Configure trusted proxies - When behind a reverse proxyReturn consistent data types - Always return an array with all three keysConsider privacy regulations - IP logging may be subject to GDPR or similar laws  NOTE Remember to comply with privacy regulations when storing IP addresses. Consider implementing data retention policies.    ","version":"4.x","tagName":"h2"},{"title":"Relatedâ€‹","type":1,"pageTitle":"Security Provider Configuration","url":"/auditor-docs/auditor/configuration/security-provider#related","content":" ðŸ‘¤ User Provider ConfigurationðŸ›¡ï¸ Role Checker Configuration ","version":"4.x","tagName":"h2"},{"title":"Role Checker Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/configuration/role-checker","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-overview","content":" The role checker is a callback that is invoked when someone attempts to read audit entries. It determines whether the current user has permission to view the requested audits.  WARNING If access is denied, an AccessDeniedException is thrown.  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Setting Up a Role Checkerâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-setting-up-a-role-checker","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#basic-example","content":" &lt;?php use DH\\Auditor\\Configuration; $configuration = new Configuration(['enabled' =&gt; true]); $configuration-&gt;setRoleChecker(function (string $entity, string $scope): bool { // $entity - The fully qualified class name of the entity being audited // $scope - The action being performed (e.g., 'view') // Return true to allow access, false to deny return true; });   ","version":"4.x","tagName":"h3"},{"title":"Symfony Security Integrationâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#symfony-security-integration","content":" &lt;?php use App\\Entity\\User; use App\\Entity\\Payment; use Symfony\\Component\\Security\\Core\\Security; $configuration-&gt;setRoleChecker(function (string $entity, string $scope) use ($security): bool { // Admins can view all audits if ($security-&gt;isGranted('ROLE_ADMIN')) { return true; } // Managers can view most audits if ($security-&gt;isGranted('ROLE_MANAGER')) { // But not User audits (sensitive) return $entity !== User::class; } // Accountants can only view Payment audits if ($security-&gt;isGranted('ROLE_ACCOUNTANT')) { return $entity === Payment::class; } // Deny all other users return false; });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Parametersâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-parameters","content":" The role checker receives two parameters:  Parameter\tType\tDescription$entity\tstring\tThe FQCN of the entity being queried $scope\tstring\tThe action scope (currently only 'view')  ","version":"4.x","tagName":"h2"},{"title":"Available Scopesâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#available-scopes","content":" Scope\tConstant\tDescriptionview\tSecurity::VIEW_SCOPE\tViewing audit entries  ","version":"4.x","tagName":"h3"},{"title":"ðŸ·ï¸ Using Entity-Level Security Attributesâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#ï¸-using-entity-level-security-attributes","content":" You can also define view permissions directly on entities using the #[Security] attribute:  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Auditable] #[Security(view: ['ROLE_ADMIN', 'ROLE_AUDIT_VIEWER'])] class SensitiveEntity { // ... }   The role checker should then verify these roles:  &lt;?php $configuration-&gt;setRoleChecker(function (string $entity, string $scope) use ($security, $provider): bool { // Get entity configuration (including security roles from attributes) $configuration = $provider-&gt;getConfiguration(); $entities = $configuration-&gt;getEntities(); if (!isset($entities[$entity]['roles'][$scope])) { // No specific roles defined, allow access return true; } $requiredRoles = $entities[$entity]['roles'][$scope]; // Check if user has any of the required roles foreach ($requiredRoles as $role) { if ($security-&gt;isGranted($role)) { return true; } } return false; });   ","version":"4.x","tagName":"h2"},{"title":"ðŸ§© Complex Authorization Logicâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-complex-authorization-logic","content":" ","version":"4.x","tagName":"h2"},{"title":"Per-Entity Custom Rulesâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#per-entity-custom-rules","content":" &lt;?php $configuration-&gt;setRoleChecker(function (string $entity, string $scope) use ($security, $em): bool { $user = $security-&gt;getUser(); if (null === $user) { return false; } // Check ownership-based access for certain entities switch ($entity) { case Order::class: // Users can view their own orders' audits // Admins can view all if ($security-&gt;isGranted('ROLE_ADMIN')) { return true; } // This would need additional context about which order is being queried return $security-&gt;isGranted('ROLE_ORDER_AUDITOR'); case User::class: // Only super admins can view user audits return $security-&gt;isGranted('ROLE_SUPER_ADMIN'); default: // Default: allow managers and above return $security-&gt;isGranted('ROLE_MANAGER'); } });   ","version":"4.x","tagName":"h3"},{"title":"Time-Based Restrictionsâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#time-based-restrictions","content":" &lt;?php $configuration-&gt;setRoleChecker(function (string $entity, string $scope) use ($security): bool { // Only allow audit viewing during business hours for non-admins if (!$security-&gt;isGranted('ROLE_ADMIN')) { $hour = (int) date('H'); if ($hour &lt; 9 || $hour &gt; 17) { return false; } } return $security-&gt;isGranted('ROLE_AUDITOR'); });   ","version":"4.x","tagName":"h3"},{"title":"âš ï¸ Error Handlingâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#ï¸-error-handling","content":" When the role checker returns false, an AccessDeniedException is thrown:  &lt;?php use DH\\Auditor\\Exception\\AccessDeniedException; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader; $reader = new Reader($provider); try { $query = $reader-&gt;createQuery(SensitiveEntity::class); $audits = $query-&gt;execute(); } catch (AccessDeniedException $e) { // Handle access denied // $e-&gt;getMessage() contains details about the denial }   ","version":"4.x","tagName":"h2"},{"title":"ðŸš« No Role Checkerâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-no-role-checker","content":" CAUTION If no role checker is configured (null), all users have access to all audit logs. This is not recommended for production environments.  // This allows everyone to view all audits $configuration = new Configuration([ 'role_checker' =&gt; null, // No access control ]);   ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#-best-practices","content":" Always implement a role checker in production - Don't leave audits open to everyoneLog access attempts - Consider logging who accesses audit dataUse the principle of least privilege - Only grant access where necessaryConsider data sensitivity - Some entities may contain sensitive informationTest your rules - Ensure your authorization logic works as expected    ","version":"4.x","tagName":"h2"},{"title":"Relatedâ€‹","type":1,"pageTitle":"Role Checker Configuration","url":"/auditor-docs/auditor/configuration/role-checker#related","content":" ðŸ·ï¸ Security AttributeðŸ‘¤ User Provider ConfigurationðŸ” Security Provider Configuration ","version":"4.x","tagName":"h2"},{"title":"API Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/api","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“š Core Classesâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-core-classes","content":" ","version":"4.x","tagName":"h2"},{"title":"Auditorâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#auditor","content":" The main entry point for the library.  namespace DH\\Auditor; final class Auditor { public function __construct(Configuration $configuration, EventDispatcherInterface $dispatcher); public function getEventDispatcher(): EventDispatcherInterface; public function getConfiguration(): Configuration; // Provider management public function getProviders(): array; public function getProvider(string $name): ProviderInterface; public function hasProvider(string $name): bool; public function registerProvider(ProviderInterface $provider): self; // Storage control public function enableStorage(ProviderInterface $provider): self; public function disableStorage(ProviderInterface $provider): self; public function isStorageEnabled(ProviderInterface $provider): bool; // Auditing control public function enableAuditing(ProviderInterface $provider): self; public function disableAuditing(ProviderInterface $provider): self; public function isAuditingEnabled(ProviderInterface $provider): bool; }   ","version":"4.x","tagName":"h3"},{"title":"Configurationâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#configuration","content":" Global auditor configuration.  namespace DH\\Auditor; final class Configuration { public function __construct(array $options); public function enable(): self; public function disable(): self; public function isEnabled(): bool; public function getTimezone(): string; public function setUserProvider(callable $userProvider): self; public function getUserProvider(): ?callable; public function setSecurityProvider(callable $securityProvider): self; public function getSecurityProvider(): ?callable; public function setRoleChecker(callable $roleChecker): self; public function getRoleChecker(): ?callable; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”Œ Provider Interfacesâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-provider-interfaces","content":" ","version":"4.x","tagName":"h2"},{"title":"ProviderInterfaceâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#providerinterface","content":" namespace DH\\Auditor\\Provider; interface ProviderInterface { public function setAuditor(Auditor $auditor): self; public function getAuditor(): Auditor; public function getConfiguration(): ConfigurationInterface; public function isRegistered(): bool; public function registerStorageService(StorageServiceInterface $service): self; public function registerAuditingService(AuditingServiceInterface $service): self; public function persist(LifecycleEvent $event): void; public function getStorageServices(): array; public function getAuditingServices(): array; public function supportsStorage(): bool; public function supportsAuditing(): bool; }   ","version":"4.x","tagName":"h3"},{"title":"ConfigurationInterfaceâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#configurationinterface","content":" namespace DH\\Auditor\\Provider; interface ConfigurationInterface { // Marker interface }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ DoctrineProviderâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-doctrineprovider","content":" ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ DoctrineProviderâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-doctrineprovider-1","content":" namespace DH\\Auditor\\Provider\\Doctrine; final class DoctrineProvider extends AbstractProvider { public function __construct(ConfigurationInterface $configuration); public function getTransactionManager(): TransactionManager; public function isStorageMapperRequired(): bool; public function getAuditingServiceForEntity(string $entity): AuditingService; public function getStorageServiceForEntity(string $entity): StorageService; public function isAuditable(object|string $entity): bool; public function isAudited(object|string $entity): bool; public function isAuditedField(object|string $entity, string $field): bool; public function setStorageMapper(callable $storageMapper): void; public function loadAnnotations(EntityManagerInterface $em, array $entities): self; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ DoctrineProvider Configurationâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-doctrineprovider-configuration","content":" namespace DH\\Auditor\\Provider\\Doctrine; final class Configuration implements ConfigurationInterface { public function __construct(array $options); // Entities public function setEntities(array $entities): self; public function getEntities(): array; public function enableAuditFor(string $entity): self; public function disableAuditFor(string $entity): self; // Viewer public function enableViewer(): self; public function disableViewer(): self; public function isViewerEnabled(): bool; public function setViewerPageSize(int $pageSize): self; public function getViewerPageSize(): int; // Table naming public function getTablePrefix(): string; public function getTableSuffix(): string; // Ignored columns public function getIgnoredColumns(): array; // Storage mapper public function setStorageMapper(callable $mapper): self; public function getStorageMapper(): mixed; // Provider reference public function getProvider(): ?DoctrineProvider; public function setProvider(DoctrineProvider $provider): void; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ” Reader & Queryâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-reader--query","content":" ","version":"4.x","tagName":"h2"},{"title":"Readerâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#reader","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader; final readonly class Reader implements ReaderInterface { public const int PAGE_SIZE = 50; public function __construct(DoctrineProvider $provider); public function getProvider(): DoctrineProvider; public function createQuery(string $entity, array $options = []): Query; public function getAuditsByTransactionHash(string $transactionHash): array; public function paginate(Query $query, int $page = 1, ?int $pageSize = null): array; public function getEntityTableName(string $entity): string; public function getEntityAuditTableName(string $entity): string; }   ","version":"4.x","tagName":"h3"},{"title":"Queryâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#query","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader; final class Query implements QueryInterface { public const string TYPE = 'type'; public const string CREATED_AT = 'created_at'; public const string TRANSACTION_HASH = 'transaction_hash'; public const string OBJECT_ID = 'object_id'; public const string USER_ID = 'blame_id'; public const string ID = 'id'; public const string DISCRIMINATOR = 'discriminator'; public function __construct(string $table, Connection $connection, string $timezone); public function execute(): array; public function count(): int; public function addFilter(FilterInterface $filter): self; public function addOrderBy(string $field, string $direction = 'DESC'): self; public function resetOrderBy(): self; public function limit(int $limit, int $offset = 0): self; public function getSupportedFilters(): array; public function getFilters(): array; public function getOrderBy(): array; public function getLimit(): array; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸŽ¯ Filtersâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-filters","content":" ","version":"4.x","tagName":"h2"},{"title":"FilterInterfaceâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#filterinterface","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter; interface FilterInterface { public function getName(): string; public function getSQL(): array; }   ","version":"4.x","tagName":"h3"},{"title":"SimpleFilterâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#simplefilter","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter; final class SimpleFilter implements FilterInterface { public function __construct(string $name, mixed $value); public function getName(): string; public function getValue(): mixed; public function getSQL(): array; }   ","version":"4.x","tagName":"h3"},{"title":"DateRangeFilterâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#daterangefilter","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter; final readonly class DateRangeFilter implements FilterInterface { public function __construct( string $name, ?\\DateTimeInterface $minValue, ?\\DateTimeInterface $maxValue = null ); public function getName(): string; public function getMinValue(): ?\\DateTimeInterface; public function getMaxValue(): ?\\DateTimeInterface; public function getSQL(): array; }   ","version":"4.x","tagName":"h3"},{"title":"RangeFilterâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#rangefilter","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter; final readonly class RangeFilter implements FilterInterface { public function __construct(string $name, mixed $minValue, mixed $maxValue = null); public function getName(): string; public function getMinValue(): mixed; public function getMaxValue(): mixed; public function getSQL(): array; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ Modelsâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-models","content":" ","version":"4.x","tagName":"h2"},{"title":"Entryâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#entry","content":" namespace DH\\Auditor\\Model; final class Entry { public static function fromArray(array $row): self; public function getId(): ?int; public function getType(): string; public function getObjectId(): string; public function getDiscriminator(): ?string; public function getTransactionHash(): ?string; public function getDiffs(bool $includeMetadata = false): array; public function getUserId(): int|string|null; public function getUsername(): ?string; public function getUserFqdn(): ?string; public function getUserFirewall(): ?string; public function getIp(): ?string; public function getCreatedAt(): ?\\DateTimeImmutable; }   ","version":"4.x","tagName":"h3"},{"title":"Userâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#user","content":" namespace DH\\Auditor\\User; interface UserInterface { public function getIdentifier(): ?string; public function getUsername(): ?string; } class User implements UserInterface { public function __construct(?string $identifier, ?string $username); public function getIdentifier(): ?string; public function getUsername(): ?string; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ·ï¸ Attributesâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-attributes","content":" ","version":"4.x","tagName":"h2"},{"title":"Auditableâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#auditable","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute; #[\\Attribute(\\Attribute::TARGET_CLASS)] final class Auditable { public function __construct(public bool $enabled = true); }   ","version":"4.x","tagName":"h3"},{"title":"Ignoreâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ignore","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute; #[\\Attribute(\\Attribute::TARGET_PROPERTY)] final class Ignore {}   ","version":"4.x","tagName":"h3"},{"title":"Securityâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#security","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute; #[\\Attribute(\\Attribute::TARGET_CLASS)] final class Security { public const string VIEW_SCOPE = 'view'; public function __construct(public array $view); }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ› ï¸ Schema Managementâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-schema-management","content":" ","version":"4.x","tagName":"h2"},{"title":"SchemaManagerâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#schemamanager","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Schema; final readonly class SchemaManager { public function __construct(DoctrineProvider $provider); public function updateAuditSchema(?array $sqls = null, ?callable $callback = null): void; public function getAuditableTableNames(EntityManagerInterface $em): array; public function collectAuditableEntities(): array; public function getUpdateAuditSchemaSql(): array; public function createAuditTable(string $entity, ?Schema $schema = null): Schema; public function updateAuditTable(string $entity, ?Schema $schema = null): Schema; public function resolveTableName(string $tableName, string $namespaceName, AbstractPlatform $platform): string; public function resolveAuditTableName(string $entity, Configuration $config, AbstractPlatform $platform): ?string; public function computeAuditTablename(string $entityTableName, Configuration $config): ?string; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“£ Eventsâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#-events","content":" ","version":"4.x","tagName":"h2"},{"title":"LifecycleEventâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#lifecycleevent","content":" namespace DH\\Auditor\\Event; final class LifecycleEvent extends AuditEvent { public function __construct(array $payload); public function setPayload(array $payload): self; public function getPayload(): array; }   ","version":"4.x","tagName":"h3"},{"title":"âš ï¸ Exceptionsâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-exceptions","content":" ","version":"4.x","tagName":"h2"},{"title":"Exception Classesâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#exception-classes","content":" namespace DH\\Auditor\\Exception; class AccessDeniedException extends \\Exception {} class InvalidArgumentException extends \\Exception {} class MappingException extends \\Exception {} class ProviderException extends \\Exception {}   ","version":"4.x","tagName":"h3"},{"title":"âš™ï¸ Servicesâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#ï¸-services","content":" ","version":"4.x","tagName":"h2"},{"title":"AuditingServiceâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#auditingservice","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Service; final class AuditingService extends DoctrineService implements AuditingServiceInterface { public function __construct(string $name, EntityManagerInterface $entityManager); public function getName(): string; public function getEntityManager(): EntityManagerInterface; }   ","version":"4.x","tagName":"h3"},{"title":"StorageServiceâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#storageservice","content":" namespace DH\\Auditor\\Provider\\Doctrine\\Service; final class StorageService extends DoctrineService implements StorageServiceInterface { public function __construct(string $name, EntityManagerInterface $entityManager); public function getName(): string; public function getEntityManager(): EntityManagerInterface; }     ","version":"4.x","tagName":"h3"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"API Reference","url":"/auditor-docs/auditor/api#next-steps","content":" ðŸš€ Getting Started GuideðŸ—„ï¸ DoctrineProvider ReferenceðŸ” Querying Audits ","version":"4.x","tagName":"h2"},{"title":"Contributing","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/contributing","content":"","keywords":"","version":"4.x"},{"title":"ðŸ¤ Ways to Contributeâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-ways-to-contribute","content":" ðŸ› Report bugs - Submit issues on GitHubðŸ’¡ Suggest features - Open a discussion or issueðŸ“– Improve documentation - Fix typos, add examples, clarify explanationsðŸ”§ Submit code - Fix bugs or implement new featuresâ­ Star the project - Show your support  ","version":"4.x","tagName":"h2"},{"title":"ðŸ’» Code Contributionsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-code-contributions","content":" All code contributions are made via Pull Requests (PR). Direct commits to the master branch are not allowed.  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Development Setupâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-development-setup","content":" Fork the repository on GitHubClone your fork locally:  git clone https://github.com/YOUR_USERNAME/auditor.git cd auditor   Install dependencies:  composer install   Create a branch for your changes:  git checkout -b feature/my-new-feature   ","version":"4.x","tagName":"h3"},{"title":"ðŸ§ª Running Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-running-tests","content":" Quick Tests (Local PHP)â€‹  # Run all tests composer test # Run tests with coverage composer test:coverage # Run tests with testdox output composer testdox   ðŸ³ Testing with Docker (Recommended)â€‹  The project includes a Makefile that allows you to test against different combinations of PHP versions, Symfony versions, and databases using Docker containers.  TIP This ensures your code works across all supported environments before submitting a PR.  Prerequisites:  DockerDocker ComposeMake  Available Make Targets:  Target\tDescriptiontests\tRun the test suite using PHPUnit cs-fix\tRun PHP-CS-Fixer to fix coding standards phpstan\tRun PHPStan for static code analysis bench\tRun PHPBench benchmarks (statistical, reproducible) profile\tProfile with Blackfire (requires BLACKFIRE_* env vars) help\tDisplay available commands and options  Options:  Option\tValues\tDefault\tDescriptionphp\t8.4, 8.5\t8.4\tPHP version sf\t8.0\t8.0\tSymfony version db\tsqlite, mysql, pgsql, mariadb\tsqlite\tDatabase type args\tAny PHPUnit/tool arguments\t(varies)\tAdditional arguments  Valid PHP/Symfony Combinations:  PHP Version\tSymfony Versions8.4\t8.0 8.5\t8.0  Examples:  # Show all available commands and options make help # Run tests with defaults (PHP 8.4, Symfony 8.0, SQLite) make tests # Run tests with specific PHP version make tests php=8.5 # Run tests with MySQL make tests db=mysql # Run tests with PostgreSQL make tests db=pgsql # Run tests with MariaDB make tests db=mariadb # Full specification make tests php=8.4 sf=8.0 db=mysql # Run specific test class make tests args='--filter=ReaderTest' # Run tests with coverage make tests args='--coverage-html=coverage'   Testing the Full Matrix:  IMPORTANT Before submitting a pull request, it's recommended to test against multiple database types.  # Test all databases with PHP 8.4 make tests php=8.4 db=sqlite make tests php=8.4 db=mysql make tests php=8.4 db=pgsql make tests php=8.4 db=mariadb   How It Works:  The Makefile uses Docker Compose to spin up containers with the specified PHP version and database. The configuration files are located in tools/docker/:  tools/docker/ â”œâ”€â”€ compose.yaml # Base configuration â”œâ”€â”€ compose.mysql.yaml # MySQL service â”œâ”€â”€ compose.pgsql.yaml # PostgreSQL service â”œâ”€â”€ compose.mariadb.yaml # MariaDB service â”œâ”€â”€ compose.blackfire.yaml # Blackfire agent sidecar (profiling) â””â”€â”€ Dockerfile # PHP CLI image (+ auditor-blackfire stage)   ","version":"4.x","tagName":"h3"},{"title":"âš¡ Benchmarkingâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-benchmarking","content":" The project ships with a PHPBench benchmark suite and a Blackfire profiling script to measure the performance impact of changes on the Doctrine flush pipeline (audit entry generation + persistence).  Benchmark files live in benchmarks/:  benchmarks/ â”œâ”€â”€ AuditBench.php # PHPBench suite â€” 6 statistical scenarios â””â”€â”€ profile.php # Standalone Blackfire profiling script   Composer Scripts (Recommended)â€‹  The quickest way to run benchmarks locally. All scripts honour the BENCH_N environment variable (default: 50) to control the number of entities per flush.  Script\tDescriptioncomposer bench\tRun all benchmarks (aggregate report) composer bench:baseline\tStore a baseline tagged before composer bench:compare\tCompare current code against the before baseline composer bench:html\tGenerate benchmark-report.html vs baseline composer profile\tRun the Blackfire profiling script (dry run without the CLI)  # Simple run BENCH_N=1000 composer bench # Take a baseline (on master) BENCH_N=1000 XDEBUG_MODE=off composer bench:baseline # Compare (on your branch) BENCH_N=1000 XDEBUG_MODE=off composer bench:compare # Generate HTML artifact BENCH_N=1000 XDEBUG_MODE=off composer bench:html # â†’ benchmark-report.html   TIP Pass XDEBUG_MODE=off to disable the xdebug overhead and get production-representative timings.  Extra PHPBench arguments can be appended after --:  # Custom tag BENCH_N=1000 composer bench -- --tag=my_tag --store BENCH_N=1000 composer bench -- --ref=my_tag --progress=plain # Run a single scenario BENCH_N=1000 composer bench -- --filter=benchInsert   Running Benchmarks via Dockerâ€‹  Use make bench to run against a specific PHP version inside the same containerised environment used for the test suite. Results are comparable across machines and CI runs.  # Run with defaults (N=50, PHP 8.4) make bench # Run with 1 000 entities, xdebug disabled BENCH_N=1000 XDEBUG_MODE=off make bench # Run on PHP 8.5 BENCH_N=1000 make bench php=8.5 # Pass extra PHPBench arguments make bench args='--filter=benchInsert'   Before/After Comparisonâ€‹  This workflow quantifies the performance impact of a branch against master.  PHPBench stores runs as XML files in .phpbench/ (gitignored). --tag names a stored run; --ref replays it alongside the current run. Both branches must use the same BENCH_N and the same environment (same PHP version, same xdebug mode) for a valid comparison.  Via Composer (local PHP, recommended):  # 1. On master â€” store the baseline git checkout master BENCH_N=1000 XDEBUG_MODE=off composer bench:baseline # 2. On your branch â€” compare git checkout my-branch BENCH_N=1000 XDEBUG_MODE=off composer bench:compare   Via Docker (reproducible environment):  git checkout master BENCH_N=1000 XDEBUG_MODE=off make bench php=8.4 args='--tag=before --store' git checkout my-branch BENCH_N=1000 XDEBUG_MODE=off make bench php=8.4 args='--ref=before --progress=plain'   With --ref=before, each subject line in the progress output shows the inline comparison:  benchInsert I5 [Mo850Î¼s (actual) vs. Mo1.2ms (before)] -29.17% (Â±1.8%) benchUpdate I5 [Mo9.2ms (actual) vs. Mo12.1ms (before)] -23.97% (Â±2.1%) ...   A negative percentage means the current branch is faster. The result is statistically meaningful when |gain| &gt; rstdev.  Capturing Results for a PR Descriptionâ€‹  BENCH_N=1000 XDEBUG_MODE=off composer bench:compare 2&gt;&amp;1 \\ | grep -E &quot;bench[A-Z]&quot; &gt; benchmark-summary.txt   Paste the content of benchmark-summary.txt into the PR body inside a fenced code block.  Blackfire Profiling (Flame Graphs)â€‹  For deep-dive profiling (call graph, function-level hotspots), use the Blackfire script.  Prerequisites: A Blackfire.io account (free tier works). Set the following environment variables:  export BLACKFIRE_SERVER_ID=&lt;your-server-id&gt; export BLACKFIRE_SERVER_TOKEN=&lt;your-server-token&gt; export BLACKFIRE_CLIENT_ID=&lt;your-client-id&gt; export BLACKFIRE_CLIENT_TOKEN=&lt;your-client-token&gt;   Dry run (no Blackfire account needed):  BENCH_N=100 composer profile   Full Blackfire profile:  # With the Blackfire CLI installed locally BENCH_N=100 blackfire run php benchmarks/profile.php # Via Docker (Blackfire agent sidecar) BENCH_N=100 make profile   The make profile target spins up a Blackfire agent container alongside php-cli using compose.blackfire.yaml. The resulting profile URL is printed in the terminal and opens in your Blackfire dashboard.  Benchmark Scenariosâ€‹  Subject\tWhat is measuredbenchInsert\tN Author inserts â†’ N audit INSERT entries benchUpdate\tN Post updates (title + body + created_at) â†’ N audit UPDATE entries benchRemove\tN Author removals â†’ N audit REMOVE entries benchAssociate\tN Postâ†’Tag ManyToMany links â†’ N audit ASSOCIATE entries benchDissociate\tN Postâ†’Tag ManyToMany unlinks â†’ N audit DISSOCIATE entries benchMixed\tRealistic flush: N/2 inserts + N/4 updates (2 fields) + N/4 removes  All scenarios use an in-memory SQLite database so results are environment-independent. The BENCH_N env var (default 50) controls the number of entities per flush.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ§¹ Code Qualityâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-code-quality","content":" Before submitting, ensure your code passes all quality checks.  Using Composer (Local)â€‹  # Run all QA tools composer qa # Individual tools: composer cs-check # Check code style composer cs-fix # Fix code style composer phpstan # Static analysis composer rector # Automated refactoring suggestions   Using Make (Docker)â€‹  # Run PHP-CS-Fixer make cs-fix # Run PHPStan make phpstan # With specific PHP version make phpstan php=8.5 # With custom arguments make phpstan args='analyse src --level=9' make cs-fix args='fix --dry-run'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Commit Messagesâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-commit-messages","content":" Write clear, concise commit messages:  Use the present tense (&quot;Add feature&quot; not &quot;Added feature&quot;)Use the imperative mood (&quot;Move cursor to...&quot; not &quot;Moves cursor to...&quot;)Limit the first line to 72 charactersReference issues and pull requests when relevant  Good examples:  Add support for composite primary keysFix Reader pagination when page_size is nullUpdate documentation for v4 migration  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”„ Pull Request Processâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-pull-request-process","content":" Ensure all tests pass (ideally on multiple databases)Run code quality tools (make cs-fix, make phpstan)Update documentation if neededAdd a changelog entry if significantSubmit the pull requestRespond to review feedback  ","version":"4.x","tagName":"h3"},{"title":"ðŸ¤– Continuous Integration (CI)â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-continuous-integration-ci","content":" When you submit a Pull Request, GitHub Actions will automatically run:  PHPUnit tests across the full matrix: PHP versions: 8.4, 8.5Symfony versions: 8.0Databases: SQLite, MySQL, PostgreSQL, MariaDB PHP-CS-Fixer for code style validationPHPStan for static analysisCode coverage report  WARNING Your PR must pass all CI checks before it can be merged. If a check fails, review the logs to identify and fix the issue.  TIP Run make tests db=mysql and make tests db=pgsql locally before pushing to catch database-specific issues early.  ","version":"4.x","tagName":"h3"},{"title":"âœï¸ Writing Testsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#ï¸-writing-tests","content":" Tests are highly encouraged and often required for new features or bug fixes:  Place tests in the tests/ directory, mirroring the src/ structureUse meaningful test method names that describe the behavior being testedInclude both positive and negative test casesTest edge cases and error conditionsFor database-related features, ensure tests work with all supported databases  Test Structure Example:  namespace DH\\Auditor\\Tests\\Provider\\Doctrine; use PHPUnit\\Framework\\TestCase; final class MyFeatureTest extends TestCase { public function testFeatureWorksAsExpected(): void { // Arrange // Act // Assert } public function testFeatureThrowsExceptionOnInvalidInput(): void { $this-&gt;expectException(\\InvalidArgumentException::class); // ... } }   Running Your Tests:  # Run only your new tests make tests args='--filter=MyFeatureTest' # Run with coverage to ensure good test coverage composer test:coverage   ","version":"4.x","tagName":"h3"},{"title":"ðŸ› Reporting Bugsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-reporting-bugs","content":" When reporting bugs, please include:  auditor version - composer show damienharper/auditorPHP version - php -vSymfony version - composer show symfony/framework-bundleDatabase - MySQL, PostgreSQL, SQLite, MariaDB, etc.Steps to reproduce - Minimal code exampleExpected behavior - What should happenActual behavior - What actually happensError messages - Full stack trace if available  ","version":"4.x","tagName":"h2"},{"title":"ðŸ’¡ Feature Requestsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-feature-requests","content":" For feature requests:  Check existing issues to avoid duplicatesDescribe the use caseExplain why existing features don't meet your needsSuggest a possible implementation if you have ideas  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“– Documentation Contributionsâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-documentation-contributions","content":" Documentation lives in the docs/ directory and uses Markdown.  ","version":"4.x","tagName":"h2"},{"title":"Adding a New Pageâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#adding-a-new-page","content":" Create a new .md file in the appropriate directoryAdd frontmatter if neededUpdate sidebars.js to include the new pageAdd links from related pages  ","version":"4.x","tagName":"h3"},{"title":"Style Guideâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#style-guide","content":" Use clear, simple languageInclude code examplesAdd internal links to related contentUse tables for structured dataTest all code examples  ","version":"4.x","tagName":"h3"},{"title":"ðŸ’¬ Code of Conductâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-code-of-conduct","content":" Be respectful and inclusiveWelcome newcomersProvide constructive feedbackFocus on what is best for the community  ","version":"4.x","tagName":"h2"},{"title":"â“ Questions?â€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-questions","content":" Open a GitHub DiscussionCheck existing issues and discussions firstBe patient - maintainers are volunteers  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“œ Licenseâ€‹","type":1,"pageTitle":"Contributing","url":"/auditor-docs/auditor/contributing#-license","content":" By contributing, you agree that your contributions will be licensed under the MIT License. ","version":"4.x","tagName":"h2"},{"title":"User Provider Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/configuration/user-provider","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-overview","content":" When an audit entry is created, auditor can record:  blame_id - The unique identifier of the userblame_user - The username or display name  This information comes from the user provider callback.  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Setting Up a User Providerâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-setting-up-a-user-provider","content":" ","version":"4.x","tagName":"h2"},{"title":"Basic Exampleâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#basic-example","content":" &lt;?php use DH\\Auditor\\Configuration; use DH\\Auditor\\User\\User; $configuration = new Configuration([ 'enabled' =&gt; true, ]); $configuration-&gt;setUserProvider(function (): ?User { // Get the currently authenticated user from your application $currentUser = $this-&gt;getAuthenticatedUser(); if (null === $currentUser) { return null; // No user authenticated } return new User( (string) $currentUser-&gt;getId(), // User ID (stored as blame_id) $currentUser-&gt;getUsername() // Username (stored as blame_user) ); });   ","version":"4.x","tagName":"h3"},{"title":"Symfony Security Integrationâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#symfony-security-integration","content":" &lt;?php use DH\\Auditor\\User\\User; use Symfony\\Component\\Security\\Core\\Security; // In a service or controller $configuration-&gt;setUserProvider(function () use ($security): ?User { $user = $security-&gt;getUser(); if (null === $user) { return null; } return new User( $user-&gt;getUserIdentifier(), $user-&gt;getUserIdentifier() ); });   ","version":"4.x","tagName":"h3"},{"title":"With User Entity IDâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#with-user-entity-id","content":" If your user has a database ID:  &lt;?php use DH\\Auditor\\User\\User; $configuration-&gt;setUserProvider(function () use ($security, $entityManager): ?User { $user = $security-&gt;getUser(); if (null === $user) { return null; } // Get the user ID from the database entity $userId = $entityManager -&gt;getRepository(User::class) -&gt;findOneBy(['email' =&gt; $user-&gt;getUserIdentifier()]) ?-&gt;getId(); return new User( (string) ($userId ?? $user-&gt;getUserIdentifier()), $user-&gt;getUserIdentifier() ); });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ The User Classâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-the-user-class","content":" The built-in User class is a simple value object:  &lt;?php namespace DH\\Auditor\\User; class User implements UserInterface { public function __construct( private ?string $identifier, private ?string $username ) {} public function getIdentifier(): ?string { return $this-&gt;identifier; } public function getUsername(): ?string { return $this-&gt;username; } }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ§© Custom User Implementationâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-custom-user-implementation","content":" You can create your own user class by implementing UserInterface:  &lt;?php namespace App\\Audit; use DH\\Auditor\\User\\UserInterface; class CustomUser implements UserInterface { public function __construct( private string $id, private string $username, private string $email, private array $roles ) {} public function getIdentifier(): ?string { return $this-&gt;id; } public function getUsername(): ?string { return sprintf('%s (%s)', $this-&gt;username, $this-&gt;email); } // Additional methods for your needs public function getEmail(): string { return $this-&gt;email; } public function getRoles(): array { return $this-&gt;roles; } }   ","version":"4.x","tagName":"h2"},{"title":"ðŸŒ API/CLI Contextâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-apicli-context","content":" TIP For API requests or CLI commands, consider identifying the context (API token, CLI user) rather than leaving it empty.  &lt;?php $configuration-&gt;setUserProvider(function (): ?User { // Check for CLI context if (PHP_SAPI === 'cli') { return new User('CLI', 'System (CLI)'); } // Check for API token $apiToken = $_SERVER['HTTP_X_API_TOKEN'] ?? null; if ($apiToken) { $apiUser = $this-&gt;apiUserRepository-&gt;findByToken($apiToken); if ($apiUser) { return new User( (string) $apiUser-&gt;getId(), sprintf('API: %s', $apiUser-&gt;getName()) ); } } // Regular web user $user = $this-&gt;security-&gt;getUser(); if ($user) { return new User( $user-&gt;getUserIdentifier(), $user-&gt;getUserIdentifier() ); } return null; });   ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Accessing User Info from Audit Entriesâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-accessing-user-info-from-audit-entries","content":" When reading audit entries, you can access the recorded user information:  &lt;?php $reader = new Reader($provider); $query = $reader-&gt;createQuery(Post::class, ['object_id' =&gt; 123]); $audits = $query-&gt;execute(); foreach ($audits as $entry) { echo &quot;User ID: &quot; . $entry-&gt;getUserId(); // blame_id echo &quot;Username: &quot; . $entry-&gt;getUsername(); // blame_user echo &quot;User FQDN: &quot; . $entry-&gt;getUserFqdn(); // blame_user_fqdn }   ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#-best-practices","content":" Always return null when no user is available - Don't create fake usersUse meaningful identifiers - Use the actual user ID, not just the usernameInclude useful context in the username - Consider including role or context infoHandle all authentication methods - Consider API tokens, CLI, impersonation, etc.  IMPORTANT Always return null when there's no authenticated user. Don't create placeholder users as this can lead to confusing audit trails.    ","version":"4.x","tagName":"h2"},{"title":"Relatedâ€‹","type":1,"pageTitle":"User Provider Configuration","url":"/auditor-docs/auditor/configuration/user-provider#related","content":" ðŸ” Security Provider ConfigurationðŸ›¡ï¸ Role Checker Configuration ","version":"4.x","tagName":"h2"},{"title":"Installation","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/getting-started/installation","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Requirementsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#-requirements","content":" ","version":"4.x","tagName":"h2"},{"title":"Version 4.x (Current)â€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#version-4x-current","content":" Requirement\tVersionPHP\t&gt;= 8.4 Symfony\t&gt;= 8.0 Doctrine DBAL\t&gt;= 4.0 Doctrine ORM\t&gt;= 3.2  ","version":"4.x","tagName":"h3"},{"title":"Previous Versionsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#previous-versions","content":" Version\tPHP\tSymfony\tDoctrine DBAL\tDoctrine ORM3.x\t&gt;= 8.2\t&gt;= 5.4\t&gt;= 3.2\t&gt;= 2.13 2.x\t&gt;= 7.4\t&gt;= 4.4\t-\t- 1.x\t&gt;= 7.2\t&gt;= 3.4\t-\t-  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ Install via Composerâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#-install-via-composer","content":" Open a terminal in your project directory and run:  composer require damienharper/auditor   This will install the latest stable version compatible with your PHP and dependency requirements.  ","version":"4.x","tagName":"h2"},{"title":"Installing a Specific Versionâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#installing-a-specific-version","content":" To install a specific version:  # Install the latest 4.x version composer require damienharper/auditor:^4.0 # Install the latest 3.x version composer require damienharper/auditor:^3.0   ","version":"4.x","tagName":"h3"},{"title":"ðŸŽµ Symfony Integrationâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#-symfony-integration","content":" For Symfony applications, we recommend using the auditor-bundle which provides:  âœ… Automatic service configurationâœ… Web interface for browsing auditsâœ… Console commandsâœ… Twig extensions  composer require damienharper/auditor-bundle   TIP See the auditor-bundle documentation for more details.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Standalone Usageâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#-standalone-usage","content":" The library can be used without Symfony. You'll need to manually configure the Auditor and register providers.  See the Quick Start Guide for a complete setup example.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“š Dependenciesâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#-dependencies","content":" The library automatically installs the following dependencies:  Package\tPurposedoctrine/dbal\tDatabase abstraction layer doctrine/orm\tObject-Relational Mapping symfony/event-dispatcher\tEvent handling symfony/options-resolver\tConfiguration handling symfony/cache\tMetadata caching symfony/lock\tCommand locking    ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Installation","url":"/auditor-docs/auditor/getting-started/installation#next-steps","content":" ðŸš€ Quick Start Guide - Set up auditing in your projectâš™ï¸ Configuration - Configure auditor for your needsðŸ—„ï¸ DoctrineProvider - Learn about the Doctrine provider ","version":"4.x","tagName":"h2"},{"title":"Extra Data","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/extra-data","content":"","keywords":"","version":"4.x"},{"title":"How It Worksâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#how-it-works","content":" Each audit entry has a nullable JSON extra_data column. By default, it is NULL (zero overhead when not used).  There are two complementary ways to populate it â€” you can use either or both:  extra_data_provider callable (global): configured once on Configuration, automatically applied to every audit entry. Ideal for request-level context such as the current route name, request ID, or tenant identifier.LifecycleEvent listener (per-entity): an event listener that intercepts each audit entry just before it is persisted and sets (or enriches) extra_data based on the entity class or its properties.  ","version":"4.x","tagName":"h2"},{"title":"Data Flowâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#data-flow","content":"   NOTE When both a provider and a listener are configured, the listener takes precedence because it fires after the provider. You can use the listener to enrich or override data set by the provider.    ","version":"4.x","tagName":"h3"},{"title":"Approach 1: extra_data_provider Callableâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#approach-1-extra_data_provider-callable","content":" Register a callable on the Configuration object. It is invoked for every audit entry in every transaction. The callable must return ?array â€” return null to leave extra_data empty.  $auditor-&gt;getConfiguration()-&gt;setExtraDataProvider( static fn (): ?array =&gt; ['route' =&gt; 'app_order_edit', 'env' =&gt; 'prod'] );   The returned array is automatically JSON-encoded and stored in extra_data. If the callable returns null, extra_data is stored as NULL.  ","version":"4.x","tagName":"h2"},{"title":"When to use this approachâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#when-to-use-this-approach","content":" Use case\tSuitable?Capture the current route name for every entry\tâœ… Attach a request ID / correlation ID\tâœ… Attach tenant / organisation context\tâœ… Attach entity-specific data (e.g. $entity-&gt;getDepartment())\tâŒ Use a listener instead    ","version":"4.x","tagName":"h3"},{"title":"Approach 2: LifecycleEvent Listenerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#approach-2-lifecycleevent-listener","content":" Create an event listener that listens to LifecycleEvent. The event provides access to both the payload and the original entity object.  &lt;?php namespace App\\EventListener; use App\\Entity\\User; use DH\\Auditor\\Event\\LifecycleEvent; use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener; #[AsEventListener(event: LifecycleEvent::class, priority: 10)] final class AuditExtraDataListener { public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); // Filter by entity class if ($payload['entity'] !== User::class || null === $event-&gt;entity) { return; } // Attach extra data as a JSON string $payload['extra_data'] = json_encode([ 'department' =&gt; $event-&gt;entity-&gt;getDepartment(), 'role' =&gt; $event-&gt;entity-&gt;getRole(), ], JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); } }   ","version":"4.x","tagName":"h2"},{"title":"With Service Injectionâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#with-service-injection","content":" Since the listener is a standard Symfony service, you can inject any dependency:  &lt;?php namespace App\\EventListener; use App\\Entity\\Order; use DH\\Auditor\\Event\\LifecycleEvent; use Symfony\\Bundle\\SecurityBundle\\Security; use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener; use Symfony\\Component\\HttpFoundation\\RequestStack; #[AsEventListener(event: LifecycleEvent::class, priority: 10)] final class OrderAuditExtraDataListener { public function __construct( private readonly Security $security, private readonly RequestStack $requestStack, ) {} public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); if ($payload['entity'] !== Order::class) { return; } $request = $this-&gt;requestStack-&gt;getCurrentRequest(); $payload['extra_data'] = json_encode([ 'admin_user' =&gt; $this-&gt;security-&gt;getUser()?-&gt;getUserIdentifier(), 'route' =&gt; $request?-&gt;attributes-&gt;get('_route'), 'reason' =&gt; $request?-&gt;headers-&gt;get('X-Audit-Reason'), ], JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); } }   ","version":"4.x","tagName":"h3"},{"title":"Merging Provider and Listener Dataâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#merging-provider-and-listener-data","content":" When both a provider and a listener are active, you can merge their contributions in the listener:  public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); if ($payload['entity'] !== User::class) { return; } // Decode what the provider already set (if anything) $existing = null !== $payload['extra_data'] ? json_decode($payload['extra_data'], true, 512, JSON_THROW_ON_ERROR) : []; // Merge entity-specific data $merged = array_merge($existing, [ 'department' =&gt; $event-&gt;entity-&gt;getDepartment(), ]); $payload['extra_data'] = json_encode($merged, JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); }   ","version":"4.x","tagName":"h3"},{"title":"When to use this approachâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#when-to-use-this-approach-1","content":" Use case\tSuitable?Attach entity-specific data (e.g. $entity-&gt;getDepartment())\tâœ… Filter by entity class\tâœ… Conditionally skip extra_data for certain entities\tâœ… Apply the same data to every entity without conditions\tâŒ Use a provider instead    ","version":"4.x","tagName":"h3"},{"title":"Reading Extra Dataâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#reading-extra-data","content":" The Entry model provides access via the extraData property or the getExtraData() method:  $reader = new Reader($provider); $entries = $reader-&gt;createQuery(User::class)-&gt;execute(); foreach ($entries as $entry) { $extraData = $entry-&gt;extraData; // ?array (decoded JSON) if (null !== $extraData) { echo sprintf( &quot;Department: %s, Role: %s\\n&quot;, $extraData['department'] ?? 'N/A', $extraData['role'] ?? 'N/A', ); } }   Both $entry-&gt;extraData and $entry-&gt;getExtraData() return:  null if no extra data was setAn associative array (decoded from JSON) otherwise    ","version":"4.x","tagName":"h2"},{"title":"Schema Updateâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#schema-update","content":" The extra_data column is added automatically when you run the schema update command:  # Preview the SQL that will be executed php bin/console audit:schema:update --dump-sql # Apply the change php bin/console audit:schema:update --force   TIP No manual migration is needed. The column uses the same JSON type as diffs (with automatic TEXT fallback on platforms that don't support native JSON).    ","version":"4.x","tagName":"h2"},{"title":"Important Caveatsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#important-caveats","content":" ","version":"4.x","tagName":"h2"},{"title":"Entity State in remove() Operationsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#entity-state-in-remove-operations","content":" WARNING During a remove operation, the entity object is still in memory but has been detached from the Unit of Work. Direct property access works (e.g., $entity-&gt;getName())Lazy-loaded associations may not be accessible (they will throw or return null) If you need association data during deletions, ensure those associations are eagerly loaded or fetch the data before the flush.  ","version":"4.x","tagName":"h3"},{"title":"Do Not Write to the Audited EntityManagerâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#do-not-write-to-the-audited-entitymanager","content":" CAUTION The LifecycleEvent is dispatched during a flush. The listener executes synchronously between notify() and persist(), within the same database transaction. SELECTs are safe (reading from another entity manager or connection)INSERT/UPDATE/DELETE on the audited EntityManager will interfere with the ongoing flush and may cause unexpected behavior If you need to perform write operations based on audit data, defer them (e.g., using a Symfony Messenger message).  ","version":"4.x","tagName":"h3"},{"title":"JSON Encodingâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#json-encoding","content":" WARNING The extra_data value in the payload must be either null or a JSON-encoded string (not an array). Always use json_encode() when setting it in a listener: // Correct $payload['extra_data'] = json_encode(['key' =&gt; 'value'], JSON_THROW_ON_ERROR); // Incorrect - will not be stored properly $payload['extra_data'] = ['key' =&gt; 'value']; The extra_data_provider callable is exempt from this â€” it must return ?array and the encoding is done automatically.  ","version":"4.x","tagName":"h3"},{"title":"Performanceâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#performance","content":" Aspect\tImpactWrite\tNegligible (+1 column in INSERT) Read\tNegligible (+1 column in SELECT, lazy decoding) Storage\tNULL when neither provider nor listener is active (zero overhead)    ","version":"4.x","tagName":"h3"},{"title":"Filtering by Extra Dataâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#filtering-by-extra-data","content":" You can filter audit entries by extra_data content using the JsonFilter class. This generates platform-specific SQL for optimal performance.  ","version":"4.x","tagName":"h2"},{"title":"Basic Usageâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#basic-usage","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; $reader = new Reader($provider); $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Filter by exact value $query-&gt;addFilter(new JsonFilter('extra_data', 'department', 'IT')); // Filter with LIKE pattern $query-&gt;addFilter(new JsonFilter('extra_data', 'department', 'IT%', 'LIKE')); // Filter by multiple values (IN) $query-&gt;addFilter(new JsonFilter('extra_data', 'status', ['active', 'pending'], 'IN')); // Filter where value is NULL $query-&gt;addFilter(new JsonFilter('extra_data', 'deleted_by', null, 'IS NULL')); // Nested JSON path $query-&gt;addFilter(new JsonFilter('extra_data', 'user.role', 'admin')); $entries = $query-&gt;execute();   ","version":"4.x","tagName":"h3"},{"title":"Supported Operatorsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#supported-operators","content":" Operator\tDescription\tExample=\tExact match (default)\tnew JsonFilter('extra_data', 'dept', 'IT') != or &lt;&gt;\tNot equal\tnew JsonFilter('extra_data', 'dept', 'IT', '!=') LIKE\tPattern matching\tnew JsonFilter('extra_data', 'dept', 'IT%', 'LIKE') NOT LIKE\tNegative pattern\tnew JsonFilter('extra_data', 'dept', '%temp%', 'NOT LIKE') IN\tMultiple values\tnew JsonFilter('extra_data', 'dept', ['IT', 'HR'], 'IN') NOT IN\tExclude values\tnew JsonFilter('extra_data', 'dept', ['IT'], 'NOT IN') IS NULL\tValue is null\tnew JsonFilter('extra_data', 'dept', null, 'IS NULL') IS NOT NULL\tValue exists\tnew JsonFilter('extra_data', 'dept', null, 'IS NOT NULL')  ","version":"4.x","tagName":"h3"},{"title":"Supported Databasesâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#supported-databases","content":" Database\tMinimum Version\tJSON Function UsedMySQL\t5.7.0\tJSON_UNQUOTE(JSON_EXTRACT()) MariaDB\t10.2.3\tJSON_UNQUOTE(JSON_EXTRACT()) PostgreSQL\t9.4.0\t-&gt;&gt; operator SQLite\t3.38.0\tjson_extract()  ","version":"4.x","tagName":"h3"},{"title":"Strict Modeâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#strict-mode","content":" By default, if the database doesn't support JSON functions, the filter falls back to LIKE pattern matching with a warning. This fallback may produce inaccurate results.  To enforce JSON support and throw an exception instead:  // Enable strict mode (5th parameter) $filter = new JsonFilter('extra_data', 'department', 'IT', '=', strict: true); // Throws InvalidArgumentException if JSON is not supported $query-&gt;addFilter($filter);   ","version":"4.x","tagName":"h3"},{"title":"Limitationsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#limitations","content":" NOTE This version only supports scalar value extraction from JSON. Nested array/object comparisons (e.g., JSON_CONTAINS) are not yet implemented.  // âœ… Supported: scalar values new JsonFilter('extra_data', 'department', 'IT'); new JsonFilter('extra_data', 'user.role', 'admin'); // âŒ Not supported: array contains // new JsonFilter('extra_data', 'tags', ['php', 'symfony'], 'CONTAINS');     ","version":"4.x","tagName":"h3"},{"title":"JSON Indexing for Performanceâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#json-indexing-for-performance","content":" For frequently queried JSON paths, consider adding database indexes to improve performance.  ","version":"4.x","tagName":"h2"},{"title":"MySQL 8.0+â€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#mysql-80","content":" -- Functional index on a JSON path ALTER TABLE user_audit ADD INDEX idx_extra_department (( CAST(extra_data-&gt;&gt;'$.department' AS CHAR(50) COLLATE utf8mb4_bin) )); -- For nested paths ALTER TABLE user_audit ADD INDEX idx_extra_user_role (( CAST(extra_data-&gt;&gt;'$.user.role' AS CHAR(50) COLLATE utf8mb4_bin) ));   ","version":"4.x","tagName":"h3"},{"title":"MariaDB 10.2+â€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#mariadb-102","content":" -- Virtual column with index ALTER TABLE user_audit ADD COLUMN extra_department VARCHAR(50) AS (JSON_VALUE(extra_data, '$.department')) VIRTUAL, ADD INDEX idx_extra_department (extra_department);   ","version":"4.x","tagName":"h3"},{"title":"PostgreSQLâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#postgresql","content":" -- GIN index for general JSON queries CREATE INDEX idx_extra_data_gin ON user_audit USING GIN (extra_data jsonb_path_ops); -- B-tree index for specific path (equality queries) CREATE INDEX idx_extra_department ON user_audit ((extra_data-&gt;&gt;'department'));   ","version":"4.x","tagName":"h3"},{"title":"SQLiteâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#sqlite","content":" WARNING SQLite does not support indexes on JSON expressions. For high-volume audit tables, consider using a different database or denormalizing frequently queried values into separate columns.    ","version":"4.x","tagName":"h3"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Extra Data","url":"/auditor-docs/auditor/extra-data#next-steps","content":" Entry Model ReferenceQuerying OverviewFilters ReferenceUpgrade Guide ","version":"4.x","tagName":"h2"},{"title":"auditor","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/intro","content":"","keywords":"","version":"4.x"},{"title":"What is auditor?â€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#what-is-auditor","content":" auditor is a PHP library that provides an easy and standardized way to collect audit logs. It is designed to track changes made to your entities and persist them as audit trails.  ","version":"4.x","tagName":"h2"},{"title":"Key Featuresâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#key-features","content":" ðŸ“ Automatic change tracking - Captures inserts, updates, and deletes automaticallyðŸ”— Relationship tracking - Records many-to-many associations and dissociationsðŸ‘¤ User attribution - Records who made the changes and their IP addressðŸ”’ Transactional integrity - Audit entries are inserted within the same database transactionðŸŽ¯ Flexible configuration - Choose which entities and fields to auditðŸ” Security controls - Define who can view audit logsðŸ—„ï¸ Multi-database support - Store audits in separate databases if needed  ","version":"4.x","tagName":"h3"},{"title":"Architecture Overviewâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#architecture-overview","content":" The library is architected around two core concepts:  Auditing Services - Responsible for collecting audit events when changes occurStorage Services - Responsible for persisting audit traces to the database  These services are provided by Providers. The library ships with a default provider for Doctrine ORM.    ","version":"4.x","tagName":"h2"},{"title":"Data Flowâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#data-flow","content":" Entity Change â†’ Your application modifies an entity via DoctrineDetection â†’ AuditingService detects the change through Doctrine eventsProcessing â†’ TransactionProcessor computes diffs and prepares audit data (with extra_data = null)Event â†’ A LifecycleEvent is dispatched with the audit payload and the entity objectEnrichment (optional) â†’ Your listener(s) inspect the entity and populate extra_data in the payloadPersistence â†’ StorageService persists the audit entry to the database  ","version":"4.x","tagName":"h3"},{"title":"Supported Databasesâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#supported-databases","content":" The DoctrineProvider supports the following RDBMS:  Database\tSupport LevelMySQL\tâœ… Full MariaDB\tâœ… Full PostgreSQL\tâœ… Full SQLite\tâœ… Full  NOTE The DoctrineProvider should work with any database supported by Doctrine, though only the above are actively tested.  ","version":"4.x","tagName":"h2"},{"title":"Version Compatibilityâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#version-compatibility","content":" Version\tStatus\tRequirements4.x\tActive development ðŸš€\tPHP &gt;= 8.4, Symfony &gt;= 8.0, Doctrine DBAL &gt;= 4.0, Doctrine ORM &gt;= 3.2 3.x\tActive support\tPHP &gt;= 8.2, Symfony &gt;= 5.4 2.x\tEnd of Life\tPHP &gt;= 7.4, Symfony &gt;= 4.4 1.x\tEnd of Life\tPHP &gt;= 7.2, Symfony &gt;= 3.4  ","version":"4.x","tagName":"h2"},{"title":"Quick Linksâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#quick-links","content":" Installation GuideQuick StartConfiguration ReferenceDoctrineProviderQuerying AuditsExtra DataAPI Reference  ","version":"4.x","tagName":"h2"},{"title":"Related Projectsâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#related-projects","content":" auditor-bundle - Symfony bundle for seamless integration  ","version":"4.x","tagName":"h2"},{"title":"Licenseâ€‹","type":1,"pageTitle":"auditor","url":"/auditor-docs/auditor/intro#license","content":" This library is released under the MIT License. ","version":"4.x","tagName":"h2"},{"title":"DoctrineProvider","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#-overview","content":" The DoctrineProvider:  ðŸ“ Tracks entity changes - Inserts, updates, and deletesðŸ”— Tracks relationships - Many-to-many associations and dissociationsðŸ’¾ Persists audit logs - Stores audits in dedicated audit tablesðŸ”„ Transactional integrity - Audit entries are part of the same transaction as your changes  ","version":"4.x","tagName":"h2"},{"title":"âœ¨ Key Featuresâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#-key-features","content":" ","version":"4.x","tagName":"h2"},{"title":"Automatic Change Detectionâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#automatic-change-detection","content":" The provider hooks into Doctrine's event system to automatically detect:  Insertions - New entities being persistedUpdates - Changes to existing entities with full diffDeletions - Entities being removedAssociations - Relationships being createdDissociations - Relationships being removed  ","version":"4.x","tagName":"h3"},{"title":"Audit Table Structureâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#audit-table-structure","content":" For each audited entity, a corresponding audit table is created:  Column\tType\tDescriptionid\tinteger\tAuto-increment primary key type\tstring(10)\tAction type (insert/update/remove/etc) object_id\tstring(255)\tID of the audited entity discriminator\tstring(255)\tEntity class (for inheritance) transaction_hash\tstring(40)\tHash grouping related changes diffs\tjson/text\tThe actual changes (JSON) blame_id\tstring(255)\tUser identifier blame_user\tstring(255)\tUsername blame_user_fqdn\tstring(255)\tUser class name blame_user_firewall\tstring(100)\tFirewall name ip\tstring(45)\tClient IP address created_at\tdatetime\tWhen the audit was created  ","version":"4.x","tagName":"h3"},{"title":"Action Typesâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#action-types","content":" Type\tDescriptioninsert\tA new entity was created update\tAn existing entity was modified remove\tAn entity was deleted associate\tA many-to-many relationship was created dissociate\tA many-to-many relationship was removed  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—ï¸ Architectureâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#ï¸-architecture","content":"   ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ Supported Databasesâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#ï¸-supported-databases","content":" Database\tSupport\tNotesMySQL\tâœ…\tFull support with JSON column type MariaDB\tâœ…\tFull support with JSON column type PostgreSQL\tâœ…\tFull support with JSON column type SQLite\tâœ…\tJSON stored as TEXT  ","version":"4.x","tagName":"h2"},{"title":"âš ï¸ Limitationsâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#ï¸-limitations","content":" CAUTION Important limitations to be aware of:  Composite primary keys are not supportedDQL/SQL direct queries are not tracked - Only changes through EntityManagerBulk operations are not tracked - Use EntityManager::flush() after each entity  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“š Sectionsâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#-sections","content":" Configuration - Configure the DoctrineProviderAttributes - Mark entities and fields for auditingServices - Auditing and storage servicesSchema Management - Audit table managementMulti-Database - Store audits in separate databases  ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Basic Usageâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#-basic-usage","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Configuration; use DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider; use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; // Create configuration $configuration = new Configuration([ 'table_suffix' =&gt; '_audit', 'entities' =&gt; [ App\\Entity\\User::class =&gt; ['enabled' =&gt; true], App\\Entity\\Post::class =&gt; ['enabled' =&gt; true], ], ]); // Create provider $provider = new DoctrineProvider($configuration); // Register services $provider-&gt;registerAuditingService(new AuditingService('default', $entityManager)); $provider-&gt;registerStorageService(new StorageService('default', $entityManager)); // Register with auditor $auditor-&gt;registerProvider($provider);     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"DoctrineProvider","url":"/auditor-docs/auditor/providers/doctrine#next-steps","content":" âš™ï¸ Configuration ReferenceðŸ·ï¸ Attributes ReferenceðŸ” Querying Audits ","version":"4.x","tagName":"h2"},{"title":"Quick Start Guide","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/getting-started/quick-start","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#-overview","content":" Setting up auditor involves three main steps:    Configure the Auditor - Set up global optionsConfigure the DoctrineProvider - Define which entities to auditMark entities as auditable - Use attributes or configuration  ","version":"4.x","tagName":"h2"},{"title":"1ï¸âƒ£ Step 1: Create the Auditorâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#1ï¸âƒ£-step-1-create-the-auditor","content":" &lt;?php use DH\\Auditor\\Auditor; use DH\\Auditor\\Configuration; use Symfony\\Component\\EventDispatcher\\EventDispatcher; // Create the event dispatcher $eventDispatcher = new EventDispatcher(); // Create the auditor configuration $configuration = new Configuration([ 'enabled' =&gt; true, 'timezone' =&gt; 'UTC', 'user_provider' =&gt; null, // Optional: callable to get current user 'security_provider' =&gt; null, // Optional: callable for security context 'role_checker' =&gt; null, // Optional: callable to check viewing permissions ]); // Create the Auditor instance $auditor = new Auditor($configuration, $eventDispatcher);   ","version":"4.x","tagName":"h2"},{"title":"2ï¸âƒ£ Step 2: Configure the DoctrineProviderâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#2ï¸âƒ£-step-2-configure-the-doctrineprovider","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Configuration as DoctrineConfiguration; use DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider; use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; // Create provider configuration $providerConfiguration = new DoctrineConfiguration([ 'table_prefix' =&gt; '', 'table_suffix' =&gt; '_audit', 'ignored_columns' =&gt; [], // Columns to ignore globally 'entities' =&gt; [ // Entities configuration (alternative to attributes) App\\Entity\\User::class =&gt; [ 'enabled' =&gt; true, 'ignored_columns' =&gt; ['password'], // Entity-specific ignored columns ], App\\Entity\\Post::class =&gt; [ 'enabled' =&gt; true, ], ], ]); // Create the DoctrineProvider $provider = new DoctrineProvider($providerConfiguration); // Register auditing and storage services // (typically you use the same EntityManager for both) $auditingService = new AuditingService('default', $entityManager); $storageService = new StorageService('default', $entityManager); $provider-&gt;registerAuditingService($auditingService); $provider-&gt;registerStorageService($storageService); // Register the provider with the Auditor $auditor-&gt;registerProvider($provider);   ","version":"4.x","tagName":"h2"},{"title":"3ï¸âƒ£ Step 3: Mark Entities as Auditableâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#3ï¸âƒ£-step-3-mark-entities-as-auditable","content":" ","version":"4.x","tagName":"h2"},{"title":"Using PHP Attributes (Recommended)â€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#using-php-attributes-recommended","content":" &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Auditable] #[Security(view: ['ROLE_ADMIN'])] // Optional: restrict who can view audits class User { #[ORM\\Id] #[ORM\\GeneratedValue] #[ORM\\Column] private ?int $id = null; #[ORM\\Column(length: 255)] private string $email; #[ORM\\Column(length: 255)] #[Ignore] // This field won't be audited private string $password; #[ORM\\Column(length: 100)] private string $name; // ... getters and setters }   ","version":"4.x","tagName":"h3"},{"title":"Available Attributesâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#available-attributes","content":" Attribute\tTarget\tPurpose#[Auditable]\tClass\tMarks an entity as auditable #[Ignore]\tProperty\tExcludes a field from audit tracking #[Security]\tClass\tDefines roles allowed to view audits  ","version":"4.x","tagName":"h3"},{"title":"4ï¸âƒ£ Step 4: Create Audit Tablesâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#4ï¸âƒ£-step-4-create-audit-tables","content":" IMPORTANT Before auditing can work, you need to create the audit tables in your database.  # Using the provided command (with auditor-bundle) php bin/console audit:schema:update --force # Or programmatically $schemaManager = new SchemaManager($provider); $schemaManager-&gt;updateAuditSchema();   ","version":"4.x","tagName":"h2"},{"title":"5ï¸âƒ£ Step 5: Start Auditingâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#5ï¸âƒ£-step-5-start-auditing","content":" Once configured, the library automatically tracks changes when you persist entities:  NOTE Audit entries are created automatically on EntityManager::flush().  &lt;?php // Create a new user $user = new User(); $user-&gt;setEmail('john@example.com'); $user-&gt;setName('John Doe'); $entityManager-&gt;persist($user); $entityManager-&gt;flush(); // â† Audit entry is created here // Update the user $user-&gt;setName('Jane Doe'); $entityManager-&gt;flush(); // â† Update audit entry is created // Delete the user $entityManager-&gt;remove($user); $entityManager-&gt;flush(); // â† Delete audit entry is created   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“– Reading Audit Logsâ€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#-reading-audit-logs","content":" Use the Reader class to query audit entries:  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader; $reader = new Reader($provider); // Get all audits for the User entity $query = $reader-&gt;createQuery(User::class); $audits = $query-&gt;execute(); // Get audits for a specific user ID $query = $reader-&gt;createQuery(User::class, [ 'object_id' =&gt; 123, ]); $audits = $query-&gt;execute(); // Get audits with pagination $query = $reader-&gt;createQuery(User::class, [ 'page' =&gt; 1, 'page_size' =&gt; 20, ]); $result = $reader-&gt;paginate($query);     ","version":"4.x","tagName":"h2"},{"title":"What's Next?â€‹","type":1,"pageTitle":"Quick Start Guide","url":"/auditor-docs/auditor/getting-started/quick-start#whats-next","content":" âš™ï¸ Configuration Reference - Detailed configuration optionsðŸ·ï¸ Attributes Reference - Complete attributes documentationðŸ” Querying Audits - Advanced query techniquesðŸ‘¤ User Attribution - Track who made changes ","version":"4.x","tagName":"h2"},{"title":"DoctrineProvider Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine/configuration","content":"","keywords":"","version":"4.x"},{"title":"âš™ï¸ Configuration Optionsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#ï¸-configuration-options","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Configuration; $configuration = new Configuration([ 'table_prefix' =&gt; '', 'table_suffix' =&gt; '_audit', 'ignored_columns' =&gt; [], 'entities' =&gt; [], 'viewer' =&gt; true, 'storage_mapper' =&gt; null, 'utf8_convert' =&gt; false, ]);   ","version":"4.x","tagName":"h2"},{"title":"Options Referenceâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#options-reference","content":" Option\tType\tDefault\tDescriptiontable_prefix\tstring\t''\tPrefix for audit table names table_suffix\tstring\t'_audit'\tSuffix for audit table names ignored_columns\tarray\t[]\tColumns to ignore globally across all entities entities\tarray\t[]\tEntity-specific configuration viewer\tbool|array\ttrue\tEnable/configure the audit viewer storage_mapper\tcallable|null\tnull\tCallback to route audits to storage services utf8_convert\tbool\tfalse\tRe-encode diff strings to UTF-8 before persisting. Enable only if your data may contain non-UTF-8 strings (legacy encodings).  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“› Table Namingâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-table-naming","content":" Audit tables are named based on the original entity table name with optional prefix and suffix:  [table_prefix] + [original_table_name] + [table_suffix]   ","version":"4.x","tagName":"h2"},{"title":"Examplesâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#examples","content":" // Default: users â†’ users_audit $configuration = new Configuration([ 'table_suffix' =&gt; '_audit', ]); // Custom prefix: users â†’ audit_users $configuration = new Configuration([ 'table_prefix' =&gt; 'audit_', 'table_suffix' =&gt; '', ]); // Both: users â†’ audit_users_log $configuration = new Configuration([ 'table_prefix' =&gt; 'audit_', 'table_suffix' =&gt; '_log', ]);   ","version":"4.x","tagName":"h3"},{"title":"ðŸš« Ignored Columnsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-ignored-columns","content":" ","version":"4.x","tagName":"h2"},{"title":"Global Ignored Columnsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#global-ignored-columns","content":" Columns that should never be audited across all entities:  $configuration = new Configuration([ 'ignored_columns' =&gt; [ 'createdAt', 'updatedAt', 'deletedAt', // Useful with soft delete ], ]);   ","version":"4.x","tagName":"h3"},{"title":"Per-Entity Ignored Columnsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#per-entity-ignored-columns","content":" Override ignored columns for specific entities:  $configuration = new Configuration([ 'entities' =&gt; [ App\\Entity\\User::class =&gt; [ 'ignored_columns' =&gt; ['password', 'salt', 'resetToken'], ], ], ]);   ","version":"4.x","tagName":"h3"},{"title":"ðŸ·ï¸ Entity Configurationâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#ï¸-entity-configuration","content":" Configure entities programmatically instead of (or in addition to) using attributes:  $configuration = new Configuration([ 'entities' =&gt; [ App\\Entity\\User::class =&gt; [ 'enabled' =&gt; true, 'ignored_columns' =&gt; ['password'], 'roles' =&gt; [ 'view' =&gt; ['ROLE_ADMIN'], // Who can view these audits ], ], App\\Entity\\Post::class =&gt; [ 'enabled' =&gt; true, ], App\\Entity\\Comment::class =&gt; [ 'enabled' =&gt; false, // Disabled, even if has #[Auditable] ], ], ]);   ","version":"4.x","tagName":"h2"},{"title":"Entity Optionsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#entity-options","content":" Option\tType\tDefault\tDescriptionenabled\tbool\ttrue\tWhether auditing is enabled for this entity ignored_columns\tarray\t[]\tColumns to ignore for this entity roles\tarray\tnull\tView permissions (['view' =&gt; ['ROLE_X']])  ","version":"4.x","tagName":"h3"},{"title":"ðŸ‘ï¸ Viewer Configurationâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#ï¸-viewer-configuration","content":" The viewer option controls the built-in audit viewer (when using auditor-bundle):  // Enable with defaults $configuration = new Configuration([ 'viewer' =&gt; true, ]); // Disable $configuration = new Configuration([ 'viewer' =&gt; false, ]); // Custom page size $configuration = new Configuration([ 'viewer' =&gt; [ 'enabled' =&gt; true, 'page_size' =&gt; 25, // Default is 50 ], ]);   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”¡ UTF-8 Conversionâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-utf-8-conversion","content":" By default, auditor does not re-encode diff values to UTF-8. Since DBAL 4 requires PHP 8.4+ and modern database connections are always UTF-8, this conversion is unnecessary for most applications.  If your application stores data from legacy sources that may contain non-UTF-8 byte sequences, enable this option:  $configuration = new Configuration([ 'utf8_convert' =&gt; true, ]);   WARNING Enabling utf8_convert traverses the entire diff array recursively on every audit entry and may have a noticeable performance impact on entities with large changesets.  NOTE Upgrading from a version that predates this option? The conversion was previously always applied. If your data relies on this behavior, set 'utf8_convert' =&gt; true to restore it.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ Storage Mapperâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#ï¸-storage-mapper","content":" When using multiple storage databases, the storage mapper determines where to store audits for each entity.  NOTE See Multi-Database Configuration for detailed information.  $configuration = new Configuration([ 'storage_mapper' =&gt; function (string $entity, array $storageServices) { // Route User audits to a dedicated storage if ($entity === App\\Entity\\User::class) { return $storageServices['users_audit_storage']; } // Default storage for everything else return $storageServices['default']; }, ]);   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”„ Runtime Configurationâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-runtime-configuration","content":" ","version":"4.x","tagName":"h2"},{"title":"Enable/Disable Auditing for an Entityâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#enabledisable-auditing-for-an-entity","content":" // Disable auditing for User $configuration-&gt;disableAuditFor(App\\Entity\\User::class); // Re-enable auditing for User $configuration-&gt;enableAuditFor(App\\Entity\\User::class);   ","version":"4.x","tagName":"h3"},{"title":"Enable/Disable Viewerâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#enabledisable-viewer","content":" // Disable the viewer $configuration-&gt;disableViewer(); // Enable the viewer $configuration-&gt;enableViewer(); // Check if viewer is enabled if ($configuration-&gt;isViewerEnabled()) { // ... }   ","version":"4.x","tagName":"h3"},{"title":"Change Viewer Page Sizeâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#change-viewer-page-size","content":" $configuration-&gt;setViewerPageSize(100); $pageSize = $configuration-&gt;getViewerPageSize();   ","version":"4.x","tagName":"h3"},{"title":"Set Storage Mapperâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#set-storage-mapper","content":" $configuration-&gt;setStorageMapper(function (string $entity, array $services) { // Custom routing logic return $services['default']; });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ” Checking Audit Statusâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-checking-audit-status","content":" The provider offers methods to check entity audit status:  // Check if an entity class is configured for auditing $provider-&gt;isAuditable(App\\Entity\\User::class); // bool // Check if an entity is currently being audited (respects enabled flag) $provider-&gt;isAudited(App\\Entity\\User::class); // bool // Check if a specific field is being audited $provider-&gt;isAuditedField(App\\Entity\\User::class, 'email'); // bool $provider-&gt;isAuditedField(App\\Entity\\User::class, 'password'); // false (if ignored)   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”€ Configuration Mergingâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-configuration-merging","content":" TIP Configuration from attributes and programmatic config are merged intelligently.  Attributes on entities are loaded firstProgrammatic configuration overrides attribute settingsGlobal ignored columns are combined with entity-specific ones  // Given this entity with attributes #[Auditable] #[Security(view: ['ROLE_USER'])] class User { #[Ignore] private string $password; } // And this programmatic config $configuration = new Configuration([ 'ignored_columns' =&gt; ['updatedAt'], 'entities' =&gt; [ User::class =&gt; [ 'ignored_columns' =&gt; ['salt'], 'roles' =&gt; ['view' =&gt; ['ROLE_ADMIN']], // Overrides attribute ], ], ]); // Final configuration for User: // - ignored_columns: ['password', 'salt', 'updatedAt'] // - roles: ['view' =&gt; ['ROLE_ADMIN']]   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“„ Complete Exampleâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#-complete-example","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Configuration; use App\\Entity\\{User, Post, Comment, Order, Payment}; $configuration = new Configuration([ 'table_prefix' =&gt; '', 'table_suffix' =&gt; '_audit', 'ignored_columns' =&gt; [ 'createdAt', 'updatedAt', ], 'entities' =&gt; [ User::class =&gt; [ 'enabled' =&gt; true, 'ignored_columns' =&gt; ['password', 'salt', 'resetToken'], 'roles' =&gt; ['view' =&gt; ['ROLE_ADMIN']], ], Post::class =&gt; [ 'enabled' =&gt; true, ], Comment::class =&gt; [ 'enabled' =&gt; true, 'roles' =&gt; ['view' =&gt; ['ROLE_MODERATOR', 'ROLE_ADMIN']], ], Order::class =&gt; [ 'enabled' =&gt; true, ], Payment::class =&gt; [ 'enabled' =&gt; true, 'roles' =&gt; ['view' =&gt; ['ROLE_ACCOUNTANT', 'ROLE_ADMIN']], ], ], 'viewer' =&gt; [ 'enabled' =&gt; true, 'page_size' =&gt; 50, ], 'storage_mapper' =&gt; null, // Single database, no mapper needed 'utf8_convert' =&gt; false, // Set to true only for legacy non-UTF-8 data sources ]);     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"DoctrineProvider Configuration","url":"/auditor-docs/auditor/providers/doctrine/configuration#next-steps","content":" ðŸ·ï¸ Attributes ReferenceðŸ—„ï¸ Multi-Database SetupðŸ› ï¸ Schema Management ","version":"4.x","tagName":"h2"},{"title":"Multi-Database Configuration","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine/multi-database","content":"","keywords":"","version":"4.x"},{"title":"ðŸŽ¯ Use Casesâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-use-cases","content":" Storing audits in a separate database can be beneficial for:  Performance - Audit writes don't compete with application queriesCompliance - Separate storage for regulatory requirementsSecurity - Different access controls for audit dataScalability - Independent scaling of audit storageRetention - Different backup/retention policies  ","version":"4.x","tagName":"h2"},{"title":"ðŸ—ï¸ Architecture Overviewâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#ï¸-architecture-overview","content":"   ","version":"4.x","tagName":"h2"},{"title":"ðŸš€ Basic Setupâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-basic-setup","content":" ","version":"4.x","tagName":"h2"},{"title":"1. Configure Database Connectionsâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#1-configure-database-connections","content":" In your Symfony configuration:  # config/packages/doctrine.yaml doctrine: dbal: default_connection: default connections: default: url: '%env(DATABASE_URL)%' audit: url: '%env(AUDIT_DATABASE_URL)%' orm: default_entity_manager: default entity_managers: default: connection: default mappings: App: is_bundle: false dir: '%kernel.project_dir%/src/Entity' prefix: 'App\\Entity' alias: App audit: connection: audit # No entity mappings - only stores audit tables   ","version":"4.x","tagName":"h3"},{"title":"2. Configure the Providerâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#2-configure-the-provider","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Configuration; use DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider; use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; // Create provider configuration $configuration = new Configuration([ 'table_suffix' =&gt; '_audit', ]); $provider = new DoctrineProvider($configuration); // Auditing service watches the application EntityManager $provider-&gt;registerAuditingService( new AuditingService('default', $appEntityManager) ); // Storage service uses the dedicated audit EntityManager $provider-&gt;registerStorageService( new StorageService('audit', $auditEntityManager) );   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”€ Multiple Source Databasesâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-multiple-source-databases","content":" If you have multiple application databases:  &lt;?php $provider = new DoctrineProvider(new Configuration([ 'table_suffix' =&gt; '_audit', ])); // Watch multiple application databases $provider-&gt;registerAuditingService( new AuditingService('app', $appEntityManager) ); $provider-&gt;registerAuditingService( new AuditingService('crm', $crmEntityManager) ); $provider-&gt;registerAuditingService( new AuditingService('legacy', $legacyEntityManager) ); // Single audit storage $provider-&gt;registerStorageService( new StorageService('audit', $auditEntityManager) );   ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ Multiple Storage Databases with Routingâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#ï¸-multiple-storage-databases-with-routing","content":" For complex scenarios, use a storage mapper to route audits:  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; $configuration = new Configuration([ 'table_suffix' =&gt; '_audit', 'storage_mapper' =&gt; function (string $entity, array $storageServices): StorageService { // Route based on entity type if (str_starts_with($entity, 'App\\\\Entity\\\\Financial\\\\')) { return $storageServices['financial_audit']; } if (str_starts_with($entity, 'App\\\\Entity\\\\User\\\\')) { return $storageServices['user_audit']; } // Default storage return $storageServices['default_audit']; }, ]); $provider = new DoctrineProvider($configuration); // Register auditing services $provider-&gt;registerAuditingService(new AuditingService('app', $appEntityManager)); // Register multiple storage services $provider-&gt;registerStorageService(new StorageService('default_audit', $defaultAuditEM)); $provider-&gt;registerStorageService(new StorageService('financial_audit', $financialAuditEM)); $provider-&gt;registerStorageService(new StorageService('user_audit', $userAuditEM));   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“ Storage Mapper Examplesâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-storage-mapper-examples","content":" ","version":"4.x","tagName":"h2"},{"title":"Route by Entity Classâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#route-by-entity-class","content":" 'storage_mapper' =&gt; function (string $entity, array $storageServices): StorageService { return match ($entity) { User::class, Profile::class =&gt; $storageServices['sensitive'], Payment::class, Invoice::class =&gt; $storageServices['financial'], default =&gt; $storageServices['default'], }; }   ","version":"4.x","tagName":"h3"},{"title":"Route by Namespaceâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#route-by-namespace","content":" 'storage_mapper' =&gt; function (string $entity, array $storageServices): StorageService { $namespace = substr($entity, 0, strrpos($entity, '\\\\')); return match ($namespace) { 'App\\\\Entity\\\\Admin' =&gt; $storageServices['admin_audit'], 'App\\\\Entity\\\\Api' =&gt; $storageServices['api_audit'], default =&gt; $storageServices['default'], }; }   ","version":"4.x","tagName":"h3"},{"title":"Route by Custom Logicâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#route-by-custom-logic","content":" 'storage_mapper' =&gt; function (string $entity, array $storageServices) use ($sensitiveEntities): StorageService { // Check if entity is in the sensitive list if (in_array($entity, $sensitiveEntities, true)) { return $storageServices['secure']; } // Check for specific interface if (is_subclass_of($entity, FinancialEntityInterface::class)) { return $storageServices['financial']; } return $storageServices['default']; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ› ï¸ Schema Managementâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#ï¸-schema-management","content":" When using multiple storage databases, the schema manager handles each one:  # Preview SQL for all storage databases php bin/console audit:schema:update --dump-sql # Update all storage databases php bin/console audit:schema:update --force   Or programmatically:  $schemaManager = new SchemaManager($provider); // Get SQL grouped by storage service $sqls = $schemaManager-&gt;getUpdateAuditSchemaSql(); // Returns: ['storage_name' =&gt; ['SQL1', 'SQL2', ...], ...] // Update all $schemaManager-&gt;updateAuditSchema();   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“– Reading Auditsâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-reading-audits","content":" When reading audits, the Reader automatically uses the correct storage:  $reader = new Reader($provider); // This automatically queries the correct audit database $query = $reader-&gt;createQuery(User::class); $audits = $query-&gt;execute();   ","version":"4.x","tagName":"h2"},{"title":"âš ï¸ Transaction Considerationsâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#ï¸-transaction-considerations","content":" ","version":"4.x","tagName":"h2"},{"title":"Same Transaction (Not Possible)â€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#same-transaction-not-possible","content":" IMPORTANT When using separate databases, audit entries cannot be in the same transaction as entity changes.  This means:  âœ… Audit entries are written after successful entity changesâš ï¸ If audit write fails, entity changes are still committedâš ï¸ No automatic rollback of entity changes on audit failure  ","version":"4.x","tagName":"h3"},{"title":"ðŸ›¡ï¸ Handling Failuresâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#ï¸-handling-failures","content":" Consider implementing:  Retry mechanism for failed audit writesFallback storage (e.g., file-based logging)Monitoring for audit write failures  // Example: Custom event listener for audit failures $dispatcher-&gt;addListener(LifecycleEvent::class, function (LifecycleEvent $event) use ($logger) { try { // Audit write happens here... } catch (\\Exception $e) { $logger-&gt;critical('Audit write failed', [ 'entity' =&gt; $event-&gt;getPayload()['entity'], 'error' =&gt; $e-&gt;getMessage(), ]); // Write to fallback storage $this-&gt;fallbackStorage-&gt;store($event-&gt;getPayload()); } });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Configuration Summaryâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-configuration-summary","content":" &lt;?php use DH\\Auditor\\Auditor; use DH\\Auditor\\Configuration as AuditorConfiguration; use DH\\Auditor\\Provider\\Doctrine\\Configuration as DoctrineConfiguration; use DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider; use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; // Main auditor config $auditorConfig = new AuditorConfiguration([ 'enabled' =&gt; true, 'timezone' =&gt; 'UTC', ]); $auditor = new Auditor($auditorConfig, $eventDispatcher); // Provider config with storage mapper $providerConfig = new DoctrineConfiguration([ 'table_suffix' =&gt; '_audit', 'storage_mapper' =&gt; function (string $entity, array $services): StorageService { // Your routing logic here return $services['default']; }, ]); $provider = new DoctrineProvider($providerConfig); // Register services $provider-&gt;registerAuditingService(new AuditingService('app', $appEM)); $provider-&gt;registerStorageService(new StorageService('default', $auditEM)); $provider-&gt;registerStorageService(new StorageService('sensitive', $sensitiveAuditEM)); // Register provider $auditor-&gt;registerProvider($provider);   ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#-best-practices","content":" Use connection pooling - Multiple databases mean more connectionsMonitor both databases - Ensure audit DB has adequate resourcesSeparate backups - Audit data may have different retention needsTest failover scenarios - What happens when audit DB is unavailable?Document your setup - Complex routing logic should be well-documented  TIP Consider using a message queue (like Symfony Messenger) for audit persistence to improve application response times and handle failures gracefully.    ","version":"4.x","tagName":"h2"},{"title":"Relatedâ€‹","type":1,"pageTitle":"Multi-Database Configuration","url":"/auditor-docs/auditor/providers/doctrine/multi-database#related","content":" âš™ï¸ Services ReferenceðŸ› ï¸ Schema ManagementðŸ“‹ Configuration Reference ","version":"4.x","tagName":"h2"},{"title":"Attributes Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine/attributes","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Overviewâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-overview","content":" Attribute\tTarget\tDescription#[Auditable]\tClass\tMarks an entity for auditing #[Ignore]\tProperty\tExcludes a property from auditing #[Security]\tClass\tDefines who can view entity audits  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“ #[Auditable]â€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-auditable","content":" Marks a Doctrine entity as auditable.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#namespace","content":" use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable;   ","version":"4.x","tagName":"h3"},{"title":"Usageâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#usage","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Auditable] class Post { // Entity will be audited }   ","version":"4.x","tagName":"h3"},{"title":"Parametersâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#parameters","content":" Parameter\tType\tDefault\tDescriptionenabled\tbool\ttrue\tWhether auditing is enabled  ","version":"4.x","tagName":"h3"},{"title":"Examplesâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#examples","content":" // Auditing enabled (default) #[Auditable] class Post {} // Explicitly enabled #[Auditable(enabled: true)] class Post {} // Disabled by default (can be enabled at runtime) #[Auditable(enabled: false)] class DraftPost {}   ","version":"4.x","tagName":"h3"},{"title":"Enabling/Disabling at Runtimeâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#enablingdisabling-at-runtime","content":" // Get the provider configuration $configuration = $provider-&gt;getConfiguration(); // Disable auditing for an entity $configuration-&gt;disableAuditFor(Post::class); // Re-enable auditing $configuration-&gt;enableAuditFor(Post::class);   ","version":"4.x","tagName":"h3"},{"title":"ðŸš« #[Ignore]â€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-ignore","content":" Excludes a property from being tracked in audits.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#namespace-1","content":" use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore;   ","version":"4.x","tagName":"h3"},{"title":"Usageâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#usage-1","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Auditable] class User { #[ORM\\Id] #[ORM\\GeneratedValue] #[ORM\\Column] private ?int $id = null; #[ORM\\Column(length: 255)] private string $email; #[ORM\\Column(length: 255)] #[Ignore] // Password changes won't be logged private string $password; #[ORM\\Column(length: 255, nullable: true)] #[Ignore] // Tokens shouldn't be in audit logs private ?string $resetToken = null; }   ","version":"4.x","tagName":"h3"},{"title":"Parametersâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#parameters-1","content":" The #[Ignore] attribute has no parameters.  ","version":"4.x","tagName":"h3"},{"title":"Common Use Casesâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#common-use-cases","content":" #[ORM\\Entity] #[Auditable] class User { // Security-sensitive fields #[Ignore] private string $password; #[Ignore] private ?string $salt = null; #[Ignore] private ?string $resetToken = null; #[Ignore] private ?string $confirmationToken = null; // Technical/metadata fields #[Ignore] private ?int $loginCount = null; #[Ignore] private ?\\DateTimeInterface $lastLogin = null; // Frequently changing but unimportant fields #[Ignore] private ?\\DateTimeInterface $lastActivity = null; }   ","version":"4.x","tagName":"h3"},{"title":"Inheritanceâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#inheritance","content":" The #[Ignore] attribute is inherited. Properties marked in a parent class will also be ignored in child classes:  #[ORM\\Entity] #[Auditable] #[ORM\\InheritanceType('SINGLE_TABLE')] class BaseEntity { #[Ignore] private ?\\DateTimeInterface $updatedAt = null; } #[ORM\\Entity] class Post extends BaseEntity { // updatedAt is also ignored here }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ” #[Security]â€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-security","content":" Defines which roles are allowed to view audits for an entity.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#namespace-2","content":" use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security;   ","version":"4.x","tagName":"h3"},{"title":"Usageâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#usage-2","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity] #[Auditable] #[Security(view: ['ROLE_ADMIN'])] class User { // Only users with ROLE_ADMIN can view User audits }   ","version":"4.x","tagName":"h3"},{"title":"Parametersâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#parameters-2","content":" Parameter\tType\tRequired\tDescriptionview\tarray&lt;string&gt;\tYes\tArray of roles allowed to view audits  ","version":"4.x","tagName":"h3"},{"title":"Examplesâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#examples-1","content":" // Single role #[Security(view: ['ROLE_ADMIN'])] class User {} // Multiple roles (any of them grants access) #[Security(view: ['ROLE_ADMIN', 'ROLE_AUDITOR', 'ROLE_COMPLIANCE'])] class Order {} // Different entities, different access levels #[Security(view: ['ROLE_USER'])] // Less restricted class Comment {} #[Security(view: ['ROLE_SUPER_ADMIN'])] // Most restricted class Payment {}   ","version":"4.x","tagName":"h3"},{"title":"How It Worksâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#how-it-works","content":" When you query audits using the Reader, it checks the role checker callback against the entity's security configuration:  Reader creates a query for an entityRole checker is invoked with the entity class and scopeIf the role checker returns false, an AccessDeniedException is thrown  // In your role checker configuration $configuration-&gt;setRoleChecker(function (string $entity, string $scope) use ($security, $provider): bool { $entities = $provider-&gt;getConfiguration()-&gt;getEntities(); // Check if entity has security roles defined if (isset($entities[$entity]['roles'][$scope])) { $requiredRoles = $entities[$entity]['roles'][$scope]; // User must have at least one of the required roles foreach ($requiredRoles as $role) { if ($security-&gt;isGranted($role)) { return true; } } return false; } // No security defined, allow access (or deny, depending on your policy) return true; });   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“„ Complete Exampleâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-complete-example","content":" &lt;?php namespace App\\Entity; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security; use Doctrine\\Common\\Collections\\ArrayCollection; use Doctrine\\Common\\Collections\\Collection; use Doctrine\\ORM\\Mapping as ORM; #[ORM\\Entity(repositoryClass: UserRepository::class)] #[Auditable] #[Security(view: ['ROLE_ADMIN', 'ROLE_USER_AUDITOR'])] class User { #[ORM\\Id] #[ORM\\GeneratedValue] #[ORM\\Column] private ?int $id = null; #[ORM\\Column(length: 180, unique: true)] private string $email; #[ORM\\Column(length: 100)] private string $firstName; #[ORM\\Column(length: 100)] private string $lastName; #[ORM\\Column(type: 'json')] private array $roles = []; #[ORM\\Column(length: 255)] #[Ignore] // Don't audit password changes (security) private string $password; #[ORM\\Column(length: 255, nullable: true)] #[Ignore] // Don't audit tokens private ?string $resetToken = null; #[ORM\\Column(type: 'datetime_immutable', nullable: true)] #[Ignore] // Frequent updates, low audit value private ?\\DateTimeImmutable $lastLoginAt = null; #[ORM\\Column(type: 'datetime_immutable')] #[Ignore] // Metadata, usually audited separately private \\DateTimeImmutable $createdAt; #[ORM\\Column(type: 'datetime_immutable')] #[Ignore] // Metadata private \\DateTimeImmutable $updatedAt; #[ORM\\OneToMany(targetEntity: Post::class, mappedBy: 'author')] private Collection $posts; public function __construct() { $this-&gt;posts = new ArrayCollection(); $this-&gt;createdAt = new \\DateTimeImmutable(); $this-&gt;updatedAt = new \\DateTimeImmutable(); } // Getters and setters... }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ”€ Combining with Programmatic Configurationâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-combining-with-programmatic-configuration","content":" TIP Attributes can be combined with or overridden by programmatic configuration.  use DH\\Auditor\\Provider\\Doctrine\\Configuration; $configuration = new Configuration([ 'entities' =&gt; [ // Override the Security attribute User::class =&gt; [ 'roles' =&gt; ['view' =&gt; ['ROLE_SUPER_ADMIN']], // More restrictive ], // Add additional ignored columns Post::class =&gt; [ 'ignored_columns' =&gt; ['viewCount'], // Added to attribute-defined ignores ], // Completely disable auditing despite #[Auditable] DraftPost::class =&gt; [ 'enabled' =&gt; false, ], ], ]);   ","version":"4.x","tagName":"h2"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#-best-practices","content":" Always ignore sensitive data - Passwords, tokens, secretsUse Security attribute for sensitive entities - Users, payments, etc.Consider ignoring metadata fields - createdAt, updatedAt, deletedAtApply principle of least privilege - Start restrictive, relax as neededUse descriptive role names - ROLE_AUDIT_VIEWER instead of generic ROLE_USER  WARNING Never audit password fields or authentication tokens. Use #[Ignore] on all security-sensitive properties.    ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Attributes Reference","url":"/auditor-docs/auditor/providers/doctrine/attributes#next-steps","content":" âš™ï¸ Configuration ReferenceðŸ” Querying AuditsðŸ›¡ï¸ Role Checker Configuration ","version":"4.x","tagName":"h2"},{"title":"Schema Management","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine/schema","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-overview","content":" For each audited entity, auditor creates a corresponding audit table to store the change history. The SchemaManager class handles all schema operations.  ","version":"4.x","tagName":"h2"},{"title":"ðŸ—ï¸ Audit Table Structureâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#ï¸-audit-table-structure","content":" Each audit table has the following structure:  CREATE TABLE users_audit ( id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, type VARCHAR(10) NOT NULL, object_id VARCHAR(255) NOT NULL, discriminator VARCHAR(255) NULL, transaction_hash VARCHAR(40) NULL, diffs JSON NULL, blame_id VARCHAR(255) NULL, blame_user VARCHAR(255) NULL, blame_user_fqdn VARCHAR(255) NULL, blame_user_firewall VARCHAR(100) NULL, ip VARCHAR(45) NULL, created_at DATETIME(6) NOT NULL, INDEX idx_type_xxx (type), INDEX idx_object_id_xxx (object_id), INDEX idx_discriminator_xxx (discriminator), INDEX idx_transaction_xxx (transaction_hash), INDEX idx_blame_id_xxx (blame_id), INDEX idx_created_at_xxx (created_at) );   ","version":"4.x","tagName":"h2"},{"title":"Column Detailsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#column-details","content":" Column\tType\tDescriptionid\tINT (PK)\tAuto-increment primary key type\tVARCHAR(10)\tAction type: insert, update, remove, associate, dissociate object_id\tVARCHAR(255)\tThe ID of the audited entity discriminator\tVARCHAR(255)\tEntity class for single-table inheritance transaction_hash\tVARCHAR(40)\tGroups changes from the same flush() diffs\tJSON/TEXT\tJSON-encoded change data blame_id\tVARCHAR(255)\tUser identifier who made the change blame_user\tVARCHAR(255)\tUsername/display name blame_user_fqdn\tVARCHAR(255)\tFull class name of the user object blame_user_firewall\tVARCHAR(100)\tSymfony firewall name ip\tVARCHAR(45)\tClient IP address (IPv4 or IPv6) created_at\tDATETIME\tWhen the audit entry was created  ","version":"4.x","tagName":"h3"},{"title":"ðŸ› ï¸ Using SchemaManagerâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#ï¸-using-schemamanager","content":" ","version":"4.x","tagName":"h2"},{"title":"Creating the Schema Managerâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#creating-the-schema-manager","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Schema\\SchemaManager; $schemaManager = new SchemaManager($provider);   ","version":"4.x","tagName":"h3"},{"title":"Getting SQL Statementsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#getting-sql-statements","content":" Preview the SQL that would be executed:  // Get all SQL statements needed to create/update audit tables $sqls = $schemaManager-&gt;getUpdateAuditSchemaSql(); // Returns: ['storage_name' =&gt; ['CREATE TABLE...', 'CREATE INDEX...', ...], ...] foreach ($sqls as $storageName =&gt; $queries) { echo &quot;Storage: $storageName\\n&quot;; foreach ($queries as $sql) { echo &quot; $sql\\n&quot;; } }   ","version":"4.x","tagName":"h3"},{"title":"Updating the Schemaâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#updating-the-schema","content":" Execute the SQL statements:  // Update all audit tables $schemaManager-&gt;updateAuditSchema(); // With progress callback $schemaManager-&gt;updateAuditSchema(null, function (array $progress) { echo sprintf(&quot;Progress: %d/%d\\n&quot;, $progress['current'], $progress['total']); }); // With custom SQL (preview first, then execute) $sqls = $schemaManager-&gt;getUpdateAuditSchemaSql(); // ... review SQLs ... $schemaManager-&gt;updateAuditSchema($sqls);   ","version":"4.x","tagName":"h3"},{"title":"ðŸ’» Console Commandsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-console-commands","content":" When using auditor-bundle, two commands are available:  ","version":"4.x","tagName":"h2"},{"title":"Update Schema Commandâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#update-schema-command","content":" Creates or updates audit tables:  # Preview SQL statements (no changes) php bin/console audit:schema:update --dump-sql # Execute the changes php bin/console audit:schema:update --force # Both: show SQL and execute php bin/console audit:schema:update --dump-sql --force   ","version":"4.x","tagName":"h3"},{"title":"Clean Audit Logs Commandâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#clean-audit-logs-command","content":" Removes old audit entries:  # Remove audits older than 12 months (default) php bin/console audit:clean # Remove audits older than 6 months php bin/console audit:clean P6M # Remove audits older than 30 days php bin/console audit:clean P30D # Remove audits before a specific date php bin/console audit:clean --date=2024-01-01 # Preview only (dry run) php bin/console audit:clean --dry-run # Skip confirmation php bin/console audit:clean --no-confirm # Show SQL statements php bin/console audit:clean --dump-sql # Include/exclude specific entities php bin/console audit:clean --include=App\\\\Entity\\\\Post php bin/console audit:clean --exclude=App\\\\Entity\\\\User   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“› Table Namingâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-table-naming","content":" ","version":"4.x","tagName":"h2"},{"title":"Default Namingâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#default-naming","content":" By default, audit tables are named: {entity_table}_audit  Entity Table\tAudit Tableusers\tusers_audit blog_posts\tblog_posts_audit  ","version":"4.x","tagName":"h3"},{"title":"Custom Prefix/Suffixâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#custom-prefixsuffix","content":" use DH\\Auditor\\Provider\\Doctrine\\Configuration; // Prefix only: audit_users $config = new Configuration([ 'table_prefix' =&gt; 'audit_', 'table_suffix' =&gt; '', ]); // Suffix only: users_history $config = new Configuration([ 'table_prefix' =&gt; '', 'table_suffix' =&gt; '_history', ]); // Both: audit_users_log $config = new Configuration([ 'table_prefix' =&gt; 'audit_', 'table_suffix' =&gt; '_log', ]);   ","version":"4.x","tagName":"h3"},{"title":"Schema/Namespace Supportâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#schemanamespace-support","content":" For databases with schema support (PostgreSQL):  // Entity in schema: myschema.users // Audit table: myschema.users_audit   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”„ Schema Changesâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-schema-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"Adding New Audited Entityâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#adding-new-audited-entity","content":" When you add #[Auditable] to a new entity:  Run audit:schema:update --dump-sql to previewRun audit:schema:update --force to create the table  ","version":"4.x","tagName":"h3"},{"title":"Removing Audited Entityâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#removing-audited-entity","content":" NOTE When you remove #[Auditable] from an entity, the audit table is not automatically deleted. Historical data is preserved. Manually drop the table if needed.  ","version":"4.x","tagName":"h3"},{"title":"Modifying Entity Fieldsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#modifying-entity-fields","content":" TIP Adding or removing fields from an entity requires no schema changes. Diffs are stored as JSON, so new fields will appear in future audits and removed fields won't appear in new audits. Historical audits retain their original data.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ’» Programmatic Schema Operationsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-programmatic-schema-operations","content":" ","version":"4.x","tagName":"h2"},{"title":"Create a Single Audit Tableâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#create-a-single-audit-table","content":" use Doctrine\\DBAL\\Schema\\Schema; // Create audit table for a specific entity $schema = $schemaManager-&gt;createAuditTable(User::class); // Or with an existing schema $existingSchema = $connection-&gt;createSchemaManager()-&gt;introspectSchema(); $schema = $schemaManager-&gt;createAuditTable(User::class, $existingSchema);   ","version":"4.x","tagName":"h3"},{"title":"Update a Single Audit Tableâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#update-a-single-audit-table","content":" // Ensure an existing audit table has the correct structure $schema = $schemaManager-&gt;updateAuditTable(User::class);   ","version":"4.x","tagName":"h3"},{"title":"Get Auditable Tablesâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#get-auditable-tables","content":" // Get all auditable entity tables for an EntityManager $tables = $schemaManager-&gt;getAuditableTableNames($entityManager); // Returns: ['App\\Entity\\User' =&gt; 'users', 'App\\Entity\\Post' =&gt; 'posts', ...]   ","version":"4.x","tagName":"h3"},{"title":"Collect Auditable Entitiesâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#collect-auditable-entities","content":" // Group auditable entities by storage service $repository = $schemaManager-&gt;collectAuditableEntities(); // Returns: ['storage_name' =&gt; ['App\\Entity\\User' =&gt; 'users', ...], ...]   ","version":"4.x","tagName":"h3"},{"title":"ðŸ—„ï¸ Database-Specific Notesâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#ï¸-database-specific-notes","content":" ","version":"4.x","tagName":"h2"},{"title":"MySQL/MariaDBâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#mysqlmariadb","content":" JSON column type used for diffsInnoDB engine recommended for transactionsConsider ROW_FORMAT=DYNAMIC for large diffs  ","version":"4.x","tagName":"h3"},{"title":"PostgreSQLâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#postgresql","content":" Native JSON/JSONB supportSchema (namespace) supportConsider using JSONB for better performance  ","version":"4.x","tagName":"h3"},{"title":"SQLiteâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#sqlite","content":" WARNING SQLite stores diffs as TEXT (no native JSON). It's useful for development/testing but not recommended for production with high audit volume.  ","version":"4.x","tagName":"h3"},{"title":"âš¡ Performance Considerationsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-performance-considerations","content":" Index usage - All common query columns are indexedJSON storage - Use native JSON types when availablePartitioning - Consider table partitioning for very large audit logsArchiving - Use audit:clean or implement custom archivingSeparate database - Consider storing audits in a dedicated database  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”§ Troubleshootingâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#-troubleshooting","content":" ","version":"4.x","tagName":"h2"},{"title":"\"Table already exists\"â€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#table-already-exists","content":" NOTE The schema manager checks for existing tables before creating. If you get conflicts, drop the audit table manually, then run audit:schema:update --force.  ","version":"4.x","tagName":"h3"},{"title":"Column Type Mismatchâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#column-type-mismatch","content":" If column types don't match (e.g., TEXT vs JSON):  Back up your dataRun audit:schema:update --force to update column types  ","version":"4.x","tagName":"h3"},{"title":"Missing Indicesâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#missing-indices","content":" Run audit:schema:update --force to add missing indices.    ","version":"4.x","tagName":"h3"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Schema Management","url":"/auditor-docs/auditor/providers/doctrine/schema#next-steps","content":" ðŸ” Querying AuditsðŸ’» Console CommandsðŸ—„ï¸ Multi-Database Setup ","version":"4.x","tagName":"h2"},{"title":"Auditing and Storage Services","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/providers/doctrine/services","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-overview","content":"   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“ Auditing Serviceâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-auditing-service","content":" The AuditingService wraps a Doctrine EntityManager and is responsible for:  Listening to entity changes (via Doctrine events)Collecting change data (inserts, updates, deletes, associations)Passing changes to the storage layer  ","version":"4.x","tagName":"h2"},{"title":"Creating an Auditing Serviceâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#creating-an-auditing-service","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; $auditingService = new AuditingService( 'default', // Service name (unique identifier) $entityManager // The EntityManager to watch );   ","version":"4.x","tagName":"h3"},{"title":"Registering with the Providerâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#registering-with-the-provider","content":" $provider-&gt;registerAuditingService($auditingService);   ","version":"4.x","tagName":"h3"},{"title":"ðŸ’¾ Storage Serviceâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-storage-service","content":" The StorageService wraps a Doctrine EntityManager and is responsible for:  Storing audit entries in the databaseManaging audit table schemas  ","version":"4.x","tagName":"h2"},{"title":"Creating a Storage Serviceâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#creating-a-storage-service","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; $storageService = new StorageService( 'default', // Service name (unique identifier) $entityManager // The EntityManager for audit storage );   ","version":"4.x","tagName":"h3"},{"title":"Registering with the Providerâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#registering-with-the-provider-1","content":" $provider-&gt;registerStorageService($storageService);   ","version":"4.x","tagName":"h3"},{"title":"ðŸ  Common Setup: Single Databaseâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-common-setup-single-database","content":" Most applications store audits in the same database as the entities:  &lt;?php use DH\\Auditor\\Provider\\Doctrine\\DoctrineProvider; use DH\\Auditor\\Provider\\Doctrine\\Configuration; use DH\\Auditor\\Provider\\Doctrine\\Service\\AuditingService; use DH\\Auditor\\Provider\\Doctrine\\Service\\StorageService; // Create provider $provider = new DoctrineProvider(new Configuration([ 'table_suffix' =&gt; '_audit', ])); // Use the same EntityManager for both $provider-&gt;registerAuditingService(new AuditingService('default', $entityManager)); $provider-&gt;registerStorageService(new StorageService('default', $entityManager));   ","version":"4.x","tagName":"h2"},{"title":"ðŸ—„ï¸ Multi-Database Setupâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#ï¸-multi-database-setup","content":" TIP For performance or compliance reasons, you might want to store audits in a separate database.  ","version":"4.x","tagName":"h2"},{"title":"Separate Audit Databaseâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#separate-audit-database","content":" &lt;?php // Main application EntityManager $appEntityManager = $this-&gt;getDoctrine()-&gt;getManager('default'); // Dedicated audit database EntityManager $auditEntityManager = $this-&gt;getDoctrine()-&gt;getManager('audit'); $provider = new DoctrineProvider(new Configuration([ 'table_suffix' =&gt; '_audit', ])); // Watch entities in the main database $provider-&gt;registerAuditingService(new AuditingService('default', $appEntityManager)); // Store audits in the audit database $provider-&gt;registerStorageService(new StorageService('audit', $auditEntityManager));   ","version":"4.x","tagName":"h3"},{"title":"Multiple Databases with Routerâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#multiple-databases-with-router","content":" When you have multiple EntityManagers and want to route audits dynamically:  &lt;?php $provider = new DoctrineProvider(new Configuration([ 'table_suffix' =&gt; '_audit', 'storage_mapper' =&gt; function (string $entity, array $storageServices) { // Route based on entity namespace if (str_starts_with($entity, 'App\\\\Entity\\\\Core\\\\')) { return $storageServices['core_audit']; } if (str_starts_with($entity, 'App\\\\Entity\\\\Finance\\\\')) { return $storageServices['finance_audit']; } return $storageServices['default']; }, ])); // Register auditing services (where changes are detected) $provider-&gt;registerAuditingService(new AuditingService('core', $coreEntityManager)); $provider-&gt;registerAuditingService(new AuditingService('finance', $financeEntityManager)); // Register storage services (where audits are stored) $provider-&gt;registerStorageService(new StorageService('default', $defaultAuditEntityManager)); $provider-&gt;registerStorageService(new StorageService('core_audit', $coreAuditEntityManager)); $provider-&gt;registerStorageService(new StorageService('finance_audit', $financeAuditEntityManager));   See Multi-Database Configuration for more details.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ” Getting Services from Providerâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-getting-services-from-provider","content":" ","version":"4.x","tagName":"h2"},{"title":"Get All Auditing Servicesâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#get-all-auditing-services","content":" $auditingServices = $provider-&gt;getAuditingServices(); // Returns: ['service_name' =&gt; AuditingService, ...]   ","version":"4.x","tagName":"h3"},{"title":"Get All Storage Servicesâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#get-all-storage-services","content":" $storageServices = $provider-&gt;getStorageServices(); // Returns: ['service_name' =&gt; StorageService, ...]   ","version":"4.x","tagName":"h3"},{"title":"Get Service for Specific Entityâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#get-service-for-specific-entity","content":" // Get the auditing service that manages this entity $auditingService = $provider-&gt;getAuditingServiceForEntity(User::class); // Get the storage service where this entity's audits are stored $storageService = $provider-&gt;getStorageServiceForEntity(User::class);   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“› Service Namesâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-service-names","content":" IMPORTANT Service names must be unique within their type (auditing or storage).  They're used for:  Identifying services in logs and debuggingMapping entities to storage servicesConfiguration and reference  // Bad: Non-descriptive names new AuditingService('a', $em); // Good: Descriptive names new AuditingService('app_default', $appEm); new AuditingService('legacy_crm', $crmEm); new StorageService('primary_audit_storage', $auditEm);   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Base Service Classâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-base-service-class","content":" Both AuditingService and StorageService extend DoctrineService:  namespace DH\\Auditor\\Provider\\Doctrine\\Service; abstract class DoctrineService extends AbstractService { public function __construct(string $name, EntityManagerInterface $entityManager); public function getEntityManager(): EntityManagerInterface; }   ","version":"4.x","tagName":"h2"},{"title":"âš ï¸ Error Handlingâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#ï¸-error-handling","content":" ","version":"4.x","tagName":"h2"},{"title":"Duplicate Service Namesâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#duplicate-service-names","content":" WARNING Registering services with the same name will throw an exception.  $provider-&gt;registerAuditingService(new AuditingService('default', $em1)); $provider-&gt;registerAuditingService(new AuditingService('default', $em2)); // Throws: ProviderException - 'An auditing service named &quot;default&quot; is already registered.'   ","version":"4.x","tagName":"h3"},{"title":"Missing Storage Mapperâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#missing-storage-mapper","content":" CAUTION If you have multiple storage services but no mapper, an exception will be thrown when storing an audit.  // If you have multiple storage services but no mapper $provider-&gt;registerStorageService(new StorageService('storage1', $em1)); $provider-&gt;registerStorageService(new StorageService('storage2', $em2)); // And no storage_mapper configured // When storing an audit: // Throws: ProviderException - 'You must provide a mapper callback to map audits to storage.'   ","version":"4.x","tagName":"h3"},{"title":"âœ… Best Practicesâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#-best-practices","content":" Use descriptive service names - Makes debugging easierKeep it simple when possible - Single database is often sufficientConsider read replicas - Use replicas for reading audits to reduce loadTest your multi-database setup - Ensure transactions work correctlyDocument your architecture - Especially with multiple services    ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Auditing and Storage Services","url":"/auditor-docs/auditor/providers/doctrine/services#next-steps","content":" ðŸ—„ï¸ Multi-Database ConfigurationðŸ› ï¸ Schema ManagementðŸ” Querying Audits ","version":"4.x","tagName":"h2"},{"title":"Upgrade Guide","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/upgrade","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“š Upgrade Pathsâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor/upgrade#-upgrade-paths","content":" â¬†ï¸ Upgrading to 4.x from 3.xâ¬†ï¸ Upgrading to 3.x from 2.x  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“‹ Version Supportâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor/upgrade#-version-support","content":" Version\tStatus\tPHP\tSymfony4.x\tActive development ðŸš€\t&gt;= 8.4\t&gt;= 8.0 3.x\tActive support\t&gt;= 8.2\t&gt;= 5.4 2.x\tEnd of Life\t&gt;= 7.4\t&gt;= 4.4 1.x\tEnd of Life\t&gt;= 7.2\t&gt;= 3.4  ","version":"4.x","tagName":"h2"},{"title":"âœ… General Upgrade Tipsâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor/upgrade#-general-upgrade-tips","content":" IMPORTANT Always follow these steps when upgrading:  Read the full changelog before upgradingBackup your database including audit tablesTest in staging before productionUpdate dependencies first - Symfony, Doctrine, PHPRun tests after upgradingCheck for deprecations before the major version  ","version":"4.x","tagName":"h2"},{"title":"ðŸ” Checking Your Versionâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor/upgrade#-checking-your-version","content":" composer show damienharper/auditor   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ Updatingâ€‹","type":1,"pageTitle":"Upgrade Guide","url":"/auditor-docs/auditor/upgrade#-updating","content":" # Update to latest 4.x composer require damienharper/auditor:^4.0 # Update to latest 3.x (if on 3.x) composer require damienharper/auditor:^3.0  ","version":"4.x","tagName":"h2"},{"title":"Querying Audits","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/querying","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-overview","content":" The DoctrineProvider includes a powerful querying system:    Reader - Factory for creating queries and utilitiesQuery - Builds and executes audit queriesFilters - Filter results by various criteriaEntry - Represents a single audit log entry  ","version":"4.x","tagName":"h2"},{"title":"ðŸ“– The Reader Classâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-the-reader-class","content":" ","version":"4.x","tagName":"h2"},{"title":"Creating a Readerâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#creating-a-reader","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader; $reader = new Reader($doctrineProvider);   ","version":"4.x","tagName":"h3"},{"title":"Creating a Queryâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#creating-a-query","content":" // Simple query for all audits of an entity $query = $reader-&gt;createQuery(User::class); $audits = $query-&gt;execute(); // Query with options $query = $reader-&gt;createQuery(User::class, [ 'object_id' =&gt; 123, // Specific entity ID 'type' =&gt; 'update', // Action type 'page' =&gt; 1, // Pagination 'page_size' =&gt; 20, ]);   ","version":"4.x","tagName":"h3"},{"title":"Query Optionsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#query-options","content":" Option\tType\tDefault\tDescriptionobject_id\tint|string|array\tnull\tFilter by entity ID(s) type\tstring|array\tnull\tFilter by action type(s) blame_id\tint|string|array\tnull\tFilter by user ID(s) who made changes user_id\tint|string|array\tnull\tAlias for blame_id transaction_hash\tstring|array\tnull\tFilter by transaction hash(es) page\tint|null\t1\tPage number (1-based) page_size\tint|null\t50\tResults per page strict\tbool\ttrue\tUse discriminator for inheritance  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“ Basic Queriesâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-basic-queries","content":" ","version":"4.x","tagName":"h2"},{"title":"Get All Audits for an Entityâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-all-audits-for-an-entity","content":" $query = $reader-&gt;createQuery(User::class); $audits = $query-&gt;execute(); foreach ($audits as $entry) { echo sprintf( &quot;[%s] %s on User #%s by %s\\n&quot;, $entry-&gt;getCreatedAt()-&gt;format('Y-m-d H:i:s'), $entry-&gt;getType(), $entry-&gt;getObjectId(), $entry-&gt;getUsername() ?? 'unknown' ); }   ","version":"4.x","tagName":"h3"},{"title":"Get Audits for a Specific Entityâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-audits-for-a-specific-entity","content":" $query = $reader-&gt;createQuery(User::class, [ 'object_id' =&gt; 123, ]); $audits = $query-&gt;execute();   ","version":"4.x","tagName":"h3"},{"title":"Get Audits by Typeâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-audits-by-type","content":" // Only updates $query = $reader-&gt;createQuery(User::class, [ 'type' =&gt; 'update', ]); // Multiple types $query = $reader-&gt;createQuery(User::class, [ 'type' =&gt; ['insert', 'update'], ]);   ","version":"4.x","tagName":"h3"},{"title":"Get Audits by Userâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-audits-by-user","content":" // Changes made by a specific user $query = $reader-&gt;createQuery(User::class, [ 'blame_id' =&gt; 42, ]); // Changes by multiple users $query = $reader-&gt;createQuery(User::class, [ 'blame_id' =&gt; [42, 43, 44], ]);   ","version":"4.x","tagName":"h3"},{"title":"Get Audits by Transactionâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-audits-by-transaction","content":" // All changes from a single transaction $query = $reader-&gt;createQuery(User::class, [ 'transaction_hash' =&gt; 'abc123def456...', ]); // Or across all entities $audits = $reader-&gt;getAuditsByTransactionHash('abc123def456...'); // Returns: ['App\\Entity\\User' =&gt; [...], 'App\\Entity\\Post' =&gt; [...]]   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ The Query Classâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-the-query-class","content":" For more control, work directly with the Query object:  $query = $reader-&gt;createQuery(User::class); // Add custom ordering $query-&gt;resetOrderBy(); $query-&gt;addOrderBy(Query::CREATED_AT, 'ASC'); $query-&gt;addOrderBy(Query::ID, 'ASC'); // Add custom limit $query-&gt;limit(100, 0); // limit, offset $audits = $query-&gt;execute();   ","version":"4.x","tagName":"h2"},{"title":"Resetting Query Partsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#resetting-query-parts","content":" You can reset specific parts of a query using resetQueryPart():  $query = $reader-&gt;createQuery(User::class); // Reset order by clauses $query-&gt;resetQueryPart('orderBy'); // Reset limit and offset $query-&gt;resetQueryPart('limit'); // Reset all filters $query-&gt;resetQueryPart('filters');   Part\tDescriptionorderBy\tResets all ORDER BY clauses limit\tResets LIMIT and OFFSET to 0 filters\tResets all filters to empty arrays  TIP You can also use the shorthand resetOrderBy() method which is equivalent to resetQueryPart('orderBy').  ","version":"4.x","tagName":"h3"},{"title":"Query Constantsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#query-constants","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; Query::TYPE // 'type' Query::OBJECT_ID // 'object_id' Query::DISCRIMINATOR // 'discriminator' Query::TRANSACTION_HASH // 'transaction_hash' Query::USER_ID // 'blame_id' Query::CREATED_AT // 'created_at' Query::ID // 'id'   ","version":"4.x","tagName":"h3"},{"title":"ðŸŽ¯ Filtersâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-filters","content":" ","version":"4.x","tagName":"h2"},{"title":"SimpleFilterâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#simplefilter","content":" For exact value matching:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter; $query = $reader-&gt;createQuery(User::class); // Single value $query-&gt;addFilter(new SimpleFilter(Query::TYPE, 'update')); // Multiple values (OR condition) $query-&gt;addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));   ","version":"4.x","tagName":"h3"},{"title":"DateRangeFilterâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#daterangefilter","content":" For filtering by date range:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Audits from the last 30 days $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('-30 days'), new \\DateTime('now') )); // Audits since a specific date $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('2024-01-01'), null // No upper bound )); // Audits until a specific date $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, null, // No lower bound new \\DateTime('2024-06-30') ));   ","version":"4.x","tagName":"h3"},{"title":"RangeFilterâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#rangefilter","content":" For numeric ranges:  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Audits for IDs between 100 and 200 $query-&gt;addFilter(new RangeFilter(Query::ID, 100, 200)); // Audits with ID &gt;= 500 $query-&gt;addFilter(new RangeFilter(Query::ID, 500, null));   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“„ Paginationâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-pagination","content":" ","version":"4.x","tagName":"h2"},{"title":"Using Query Optionsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#using-query-options","content":" $query = $reader-&gt;createQuery(User::class, [ 'page' =&gt; 1, 'page_size' =&gt; 20, ]); $audits = $query-&gt;execute();   ","version":"4.x","tagName":"h3"},{"title":"Using the Paginate Methodâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#using-the-paginate-method","content":" $query = $reader-&gt;createQuery(User::class); $result = $reader-&gt;paginate($query, $page = 1, $pageSize = 20); // Result structure [ 'results' =&gt; ArrayIterator, // The audit entries 'currentPage' =&gt; 1, 'hasPreviousPage' =&gt; false, 'hasNextPage' =&gt; true, 'previousPage' =&gt; null, 'nextPage' =&gt; 2, 'numPages' =&gt; 5, 'haveToPaginate' =&gt; true, 'numResults' =&gt; 100, 'pageSize' =&gt; 20, ]   ","version":"4.x","tagName":"h3"},{"title":"Disable Paginationâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#disable-pagination","content":" TIP Set both page and page_size to null to get all results without pagination.  // Get all results without pagination $query = $reader-&gt;createQuery(User::class, [ 'page' =&gt; null, 'page_size' =&gt; null, ]); $allAudits = $query-&gt;execute();   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”¢ Counting Resultsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-counting-results","content":" $query = $reader-&gt;createQuery(User::class); $count = $query-&gt;count();   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“¦ The Entry Modelâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-the-entry-model","content":" Each audit result is an Entry object:  /** @var Entry $entry */ foreach ($audits as $entry) { // Basic info $entry-&gt;getId(); // int - Audit entry ID $entry-&gt;getType(); // string - insert, update, remove, etc. $entry-&gt;getObjectId(); // string - Entity ID $entry-&gt;getCreatedAt(); // DateTimeImmutable // Transaction $entry-&gt;getTransactionHash(); // string|null $entry-&gt;getDiscriminator(); // string|null - For inheritance // Changes $entry-&gt;getDiffs(); // array - The actual changes $entry-&gt;getDiffs(true); // array - Including @source metadata // User attribution $entry-&gt;getUserId(); // int|string|null - blame_id $entry-&gt;getUsername(); // string|null - blame_user $entry-&gt;getUserFqdn(); // string|null - User class $entry-&gt;getUserFirewall(); // string|null - Firewall name $entry-&gt;getIp(); // string|null - Client IP }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“Š Reading Diffsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-reading-diffs","content":" The getDiffs() method returns the changes:  ","version":"4.x","tagName":"h2"},{"title":"Insert Diffsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#insert-diffs","content":" // For insert operations: [ 'email' =&gt; [ 'new' =&gt; 'john@example.com', 'old' =&gt; null, ], 'name' =&gt; [ 'new' =&gt; 'John Doe', 'old' =&gt; null, ], ]   ","version":"4.x","tagName":"h3"},{"title":"Update Diffsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#update-diffs","content":" // For update operations: [ 'email' =&gt; [ 'new' =&gt; 'jane@example.com', 'old' =&gt; 'john@example.com', ], ]   ","version":"4.x","tagName":"h3"},{"title":"Association Diffsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#association-diffs","content":" // For associate/dissociate operations: [ 'source' =&gt; [ 'class' =&gt; 'App\\\\Entity\\\\Post', 'id' =&gt; 1, 'label' =&gt; 'My Post', 'field' =&gt; 'tags', ], 'target' =&gt; [ 'class' =&gt; 'App\\\\Entity\\\\Tag', 'id' =&gt; 5, 'label' =&gt; 'PHP', 'field' =&gt; 'posts', ], 'is_owning_side' =&gt; true, 'table' =&gt; 'post_tag', // Join table ]   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Utility Methodsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-utility-methods","content":" ","version":"4.x","tagName":"h2"},{"title":"Get Entity Table Namesâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#get-entity-table-names","content":" // Get the source entity table name $tableName = $reader-&gt;getEntityTableName(User::class); // Returns: 'users' // Get the audit table name $auditTableName = $reader-&gt;getEntityAuditTableName(User::class); // Returns: 'users_audit'   ","version":"4.x","tagName":"h3"},{"title":"âš ï¸ Error Handlingâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#ï¸-error-handling","content":" ","version":"4.x","tagName":"h2"},{"title":"AccessDeniedExceptionâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#accessdeniedexception","content":" WARNING Thrown when the role checker denies access to view audits for an entity.  use DH\\Auditor\\Exception\\AccessDeniedException; try { $query = $reader-&gt;createQuery(SensitiveEntity::class); $audits = $query-&gt;execute(); } catch (AccessDeniedException $e) { // Handle access denied }   ","version":"4.x","tagName":"h3"},{"title":"InvalidArgumentExceptionâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#invalidargumentexception","content":" CAUTION Thrown when querying non-auditable entities.  use DH\\Auditor\\Exception\\InvalidArgumentException; try { $query = $reader-&gt;createQuery(NonAuditableEntity::class); } catch (InvalidArgumentException $e) { // Entity App\\Entity\\NonAuditableEntity is not auditable. }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“„ Complete Exampleâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#-complete-example","content":" &lt;?php use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Reader; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter; $reader = new Reader($provider); // Build a complex query $query = $reader-&gt;createQuery(User::class, [ 'page' =&gt; null, 'page_size' =&gt; null, ]); // Add filters $query-&gt;addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update'])); $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('-7 days'), new \\DateTime('now') )); // Custom ordering $query-&gt;resetOrderBy(); $query-&gt;addOrderBy(Query::CREATED_AT, 'DESC'); // Limit results $query-&gt;limit(100); // Execute and process $audits = $query-&gt;execute(); foreach ($audits as $entry) { $diffs = $entry-&gt;getDiffs(); echo sprintf( &quot;[%s] %s #%s by %s from %s\\n&quot;, $entry-&gt;getCreatedAt()-&gt;format('Y-m-d H:i:s'), $entry-&gt;getType(), $entry-&gt;getObjectId(), $entry-&gt;getUsername() ?? 'system', $entry-&gt;getIp() ?? 'unknown' ); foreach ($diffs as $field =&gt; $change) { echo sprintf(&quot; - %s: %s â†’ %s\\n&quot;, $field, json_encode($change['old'] ?? null), json_encode($change['new'] ?? null) ); } }     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Querying Audits","url":"/auditor-docs/auditor/querying#next-steps","content":" ðŸŽ¯ Filters ReferenceðŸ“¦ Entry Model ReferenceðŸ›¡ï¸ Security &amp; Access Control ","version":"4.x","tagName":"h2"},{"title":"Entry Model Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/querying/entry","content":"","keywords":"","version":"4.x"},{"title":"ðŸ” Overviewâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#-overview","content":" namespace DH\\Auditor\\Model; final class Entry { // Created from database row public static function fromArray(array $row): self; // Accessors for all properties public function getId(): ?int; public function getType(): string; public function getObjectId(): string; // ... etc }   ","version":"4.x","tagName":"h2"},{"title":"ðŸ—ï¸ Creating Entriesâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#ï¸-creating-entries","content":" Entries are typically created by the Reader when executing queries:  $reader = new Reader($provider); $query = $reader-&gt;createQuery(User::class); $entries = $query-&gt;execute(); // Returns Entry[]   You can also create entries manually (useful for testing):  use DH\\Auditor\\Model\\Entry; $entry = Entry::fromArray([ 'id' =&gt; 1, 'type' =&gt; 'update', 'object_id' =&gt; '123', 'discriminator' =&gt; null, 'transaction_hash' =&gt; 'abc123', 'diffs' =&gt; '{&quot;name&quot;:{&quot;old&quot;:&quot;John&quot;,&quot;new&quot;:&quot;Jane&quot;}}', 'extra_data' =&gt; '{&quot;department&quot;:&quot;IT&quot;,&quot;role&quot;:&quot;admin&quot;}', // or null 'blame_id' =&gt; '42', 'blame_user' =&gt; 'admin', 'blame_user_fqdn' =&gt; 'App\\\\Entity\\\\User', 'blame_user_firewall' =&gt; 'main', 'ip' =&gt; '192.168.1.1', 'created_at' =&gt; new \\DateTimeImmutable(), ]);   ","version":"4.x","tagName":"h2"},{"title":"ðŸ“‹ Properties & Methodsâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#-properties--methods","content":" ","version":"4.x","tagName":"h2"},{"title":"getId()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getid","content":" public function getId(): ?int   Returns the unique identifier of the audit entry (auto-increment primary key).  $entryId = $entry-&gt;getId(); // Returns: 12345   ","version":"4.x","tagName":"h3"},{"title":"getType()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#gettype","content":" public function getType(): string   Returns the type of action that was audited.  $type = $entry-&gt;getType(); // Returns: 'insert', 'update', 'remove', 'associate', or 'dissociate'   Type\tDescriptioninsert\tA new entity was created update\tAn existing entity was modified remove\tAn entity was deleted associate\tA many-to-many relationship was created dissociate\tA many-to-many relationship was removed  ","version":"4.x","tagName":"h3"},{"title":"getObjectId()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getobjectid","content":" public function getObjectId(): string   Returns the ID of the audited entity.  $entityId = $entry-&gt;getObjectId(); // Returns: '123' (always string)   ","version":"4.x","tagName":"h3"},{"title":"getDiscriminator()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getdiscriminator","content":" public function getDiscriminator(): ?string   Returns the entity class name for single-table inheritance entities.  $discriminator = $entry-&gt;getDiscriminator(); // Returns: 'App\\Entity\\Admin' or null   This is used when auditing entities with SINGLE_TABLE inheritance to identify the actual entity class.  ","version":"4.x","tagName":"h3"},{"title":"getTransactionHash()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#gettransactionhash","content":" public function getTransactionHash(): ?string   Returns the transaction hash that groups related changes.  $hash = $entry-&gt;getTransactionHash(); // Returns: 'a1b2c3d4e5f6...' (40 character hash)   All changes made in a single EntityManager::flush() share the same transaction hash.  ","version":"4.x","tagName":"h3"},{"title":"getDiffs()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getdiffs","content":" public function getDiffs(bool $includeMetadata = false): array   Returns the actual changes recorded for this audit entry.  // Basic usage $diffs = $entry-&gt;getDiffs(); // Include @source metadata $diffs = $entry-&gt;getDiffs(true);   Insert Diffsâ€‹  // When type = 'insert' [ 'email' =&gt; [ 'new' =&gt; 'john@example.com', 'old' =&gt; null, ], 'name' =&gt; [ 'new' =&gt; 'John Doe', 'old' =&gt; null, ], 'roles' =&gt; [ 'new' =&gt; ['ROLE_USER'], 'old' =&gt; null, ], ]   Update Diffsâ€‹  // When type = 'update' [ 'name' =&gt; [ 'new' =&gt; 'Jane Doe', 'old' =&gt; 'John Doe', ], 'email' =&gt; [ 'new' =&gt; 'jane@example.com', 'old' =&gt; 'john@example.com', ], ]   Remove Diffsâ€‹  // When type = 'remove' // Contains a summary of the deleted entity [ 'id' =&gt; 123, 'label' =&gt; 'John Doe', // Generated from entity's __toString or ID 'class' =&gt; 'App\\\\Entity\\\\User', ]   Association Diffsâ€‹  // When type = 'associate' or 'dissociate' [ 'source' =&gt; [ 'class' =&gt; 'App\\\\Entity\\\\Post', 'id' =&gt; 1, 'label' =&gt; 'My Blog Post', 'field' =&gt; 'tags', ], 'target' =&gt; [ 'class' =&gt; 'App\\\\Entity\\\\Tag', 'id' =&gt; 5, 'label' =&gt; 'PHP', 'field' =&gt; 'posts', ], 'is_owning_side' =&gt; true, 'table' =&gt; 'post_tag', // The join table ]   With Metadataâ€‹  $diffs = $entry-&gt;getDiffs(true); // Includes @source key with additional metadata [ '@source' =&gt; [ // Source information ], 'name' =&gt; [ 'new' =&gt; 'Jane', 'old' =&gt; 'John', ], ]   ","version":"4.x","tagName":"h3"},{"title":"getExtraData()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getextradata","content":" public function getExtraData(): ?array   Returns any supplementary data attached to this audit entry, or null if none was set.  TIP Extra data is populated via a LifecycleEvent listener. See the Extra Data guide for setup instructions and examples.  $extraData = $entry-&gt;getExtraData(); // Returns: ['department' =&gt; 'IT', 'role' =&gt; 'admin'] or null // Also available as a virtual property $extraData = $entry-&gt;extraData;   Extra data is populated via a LifecycleEvent listener. See the Extra Data guide for setup instructions and examples.  ","version":"4.x","tagName":"h3"},{"title":"getUserId()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getuserid","content":" public function getUserId(): int|string|null   Returns the identifier of the user who made the change.  $userId = $entry-&gt;getUserId(); // Returns: 42 or '42' or 'user-uuid-123' or null   Returns null if no user was identified (e.g., system process, CLI command without user context).  ","version":"4.x","tagName":"h3"},{"title":"getUsername()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getusername","content":" public function getUsername(): ?string   Returns the username/display name of the user.  $username = $entry-&gt;getUsername(); // Returns: 'admin' or 'John Doe' or null   ","version":"4.x","tagName":"h3"},{"title":"getUserFqdn()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getuserfqdn","content":" public function getUserFqdn(): ?string   Returns the fully qualified class name of the user object.  $userClass = $entry-&gt;getUserFqdn(); // Returns: 'App\\Entity\\User' or null   ","version":"4.x","tagName":"h3"},{"title":"getUserFirewall()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getuserfirewall","content":" public function getUserFirewall(): ?string   Returns the Symfony security firewall name.  $firewall = $entry-&gt;getUserFirewall(); // Returns: 'main' or 'api' or null   ","version":"4.x","tagName":"h3"},{"title":"getIp()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getip","content":" public function getIp(): ?string   Returns the client IP address.  $ip = $entry-&gt;getIp(); // Returns: '192.168.1.1' or '2001:db8::1' (IPv6) or null   ","version":"4.x","tagName":"h3"},{"title":"getCreatedAt()â€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#getcreatedat","content":" public function getCreatedAt(): ?\\DateTimeImmutable   Returns when the audit entry was created.  $createdAt = $entry-&gt;getCreatedAt(); // Returns: DateTimeImmutable echo $createdAt-&gt;format('Y-m-d H:i:s'); // Output: 2024-01-15 14:30:45   The timestamp uses the timezone configured in the Auditor configuration.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ’¡ Working with Entriesâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#-working-with-entries","content":" ","version":"4.x","tagName":"h2"},{"title":"Display Audit Logâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#display-audit-log","content":" $entries = $query-&gt;execute(); foreach ($entries as $entry) { printf( &quot;[%s] %s %s #%s by %s (%s)\\n&quot;, $entry-&gt;getCreatedAt()-&gt;format('Y-m-d H:i:s'), ucfirst($entry-&gt;getType()), $entry-&gt;getDiscriminator() ?? 'Entity', $entry-&gt;getObjectId(), $entry-&gt;getUsername() ?? 'System', $entry-&gt;getIp() ?? 'N/A' ); foreach ($entry-&gt;getDiffs() as $field =&gt; $change) { if (isset($change['old'], $change['new'])) { printf( &quot; - %s: %s â†’ %s\\n&quot;, $field, json_encode($change['old']), json_encode($change['new']) ); } } echo &quot;\\n&quot;; }   ","version":"4.x","tagName":"h3"},{"title":"Check Change Typeâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#check-change-type","content":" if ($entry-&gt;getType() === 'update') { $changes = $entry-&gt;getDiffs(); // Check if specific field changed if (isset($changes['email'])) { echo sprintf( &quot;Email changed from %s to %s\\n&quot;, $changes['email']['old'], $changes['email']['new'] ); } }   ","version":"4.x","tagName":"h3"},{"title":"Group by Transactionâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#group-by-transaction","content":" $entries = $query-&gt;execute(); $grouped = []; foreach ($entries as $entry) { $hash = $entry-&gt;getTransactionHash(); if (!isset($grouped[$hash])) { $grouped[$hash] = []; } $grouped[$hash][] = $entry; } // Now $grouped contains all changes per transaction foreach ($grouped as $hash =&gt; $transactionEntries) { echo &quot;Transaction: $hash\\n&quot;; foreach ($transactionEntries as $entry) { echo &quot; - &quot; . $entry-&gt;getType() . &quot; on #&quot; . $entry-&gt;getObjectId() . &quot;\\n&quot;; } }   ","version":"4.x","tagName":"h3"},{"title":"Filter Changes by Fieldâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#filter-changes-by-field","content":" // Find all entries where 'status' field changed $statusChanges = array_filter($entries, function (Entry $entry) { return isset($entry-&gt;getDiffs()['status']); }); foreach ($statusChanges as $entry) { $diffs = $entry-&gt;getDiffs(); echo sprintf( &quot;Status changed from '%s' to '%s' at %s\\n&quot;, $diffs['status']['old'], $diffs['status']['new'], $entry-&gt;getCreatedAt()-&gt;format('Y-m-d H:i:s') ); }   ","version":"4.x","tagName":"h3"},{"title":"Build Timelineâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#build-timeline","content":" // Build a timeline of changes for an entity $query = $reader-&gt;createQuery(User::class, [ 'object_id' =&gt; 123, 'page_size' =&gt; null, ]); $query-&gt;resetOrderBy(); $query-&gt;addOrderBy(Query::CREATED_AT, 'ASC'); $timeline = []; foreach ($query-&gt;execute() as $entry) { $timeline[] = [ 'date' =&gt; $entry-&gt;getCreatedAt(), 'type' =&gt; $entry-&gt;getType(), 'user' =&gt; $entry-&gt;getUsername(), 'changes' =&gt; $entry-&gt;getDiffs(), ]; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“„ JSON Serializationâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#-json-serialization","content":" NOTE The diffs are stored as JSON and automatically decoded - no need to call json_decode().  // Diffs are returned as arrays, not JSON strings $diffs = $entry-&gt;getDiffs(); // This is already an array, no need to json_decode() // To get JSON for API response: $json = json_encode([ 'id' =&gt; $entry-&gt;getId(), 'type' =&gt; $entry-&gt;getType(), 'object_id' =&gt; $entry-&gt;getObjectId(), 'diffs' =&gt; $entry-&gt;getDiffs(), 'extra_data' =&gt; $entry-&gt;getExtraData(), 'created_at' =&gt; $entry-&gt;getCreatedAt()?-&gt;format('c'), 'user' =&gt; $entry-&gt;getUsername(), ]);     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Entry Model Reference","url":"/auditor-docs/auditor/querying/entry#next-steps","content":" ðŸ“Š Extra Data GuideðŸ” Querying OverviewðŸŽ¯ Filters Reference ","version":"4.x","tagName":"h2"},{"title":"Upgrading to 3.x from 2.x","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/upgrade/v3","content":"","keywords":"","version":"4.x"},{"title":"âš ï¸ Requirements Changesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#ï¸-requirements-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"PHP Versionâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#php-version","content":" IMPORTANT Minimum PHP version is 8.2 (was 7.4 in 2.x)  ","version":"4.x","tagName":"h3"},{"title":"Symfony Versionâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#symfony-version","content":" Minimum Symfony version is 5.4 (was 4.4 in 2.x)  Symfony 6.x and 7.x are also supported.  ","version":"4.x","tagName":"h3"},{"title":"Doctrine Versionsâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#doctrine-versions","content":" Package\t2.x Version\t3.x VersionDoctrine DBAL\tMixed\t&gt;= 3.2 Doctrine ORM\tMixed\t&gt;= 2.13  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”‘ Key Changesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#-key-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"PHP 8 Attributesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#php-8-attributes","content":" TIP 3.x uses native PHP 8 attributes instead of Doctrine annotations.  Before (2.x with annotations):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; /** * @Audit\\Auditable * @Audit\\Security(view={&quot;ROLE_ADMIN&quot;}) */ class User { /** * @Audit\\Ignore */ private string $password; }   After (3.x with attributes):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security; #[Auditable] #[Security(view: ['ROLE_ADMIN'])] class User { #[Ignore] private string $password; }   ","version":"4.x","tagName":"h3"},{"title":"Type Declarationsâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#type-declarations","content":" All classes now use strict type declarations:  declare(strict_types=1);   Method signatures have return types and parameter types.  ","version":"4.x","tagName":"h3"},{"title":"Read-Only Propertiesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#read-only-properties","content":" Many classes now use PHP 8.1+ readonly properties:  final readonly class Reader implements ReaderInterface { public function __construct(private DoctrineProvider $provider) {} }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Migration Stepsâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#-migration-steps","content":" ","version":"4.x","tagName":"h2"},{"title":"1ï¸âƒ£ Update PHP Versionâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#1ï¸âƒ£-update-php-version","content":" Ensure you're running PHP 8.2 or higher:  php -v # PHP 8.2.x ...   ","version":"4.x","tagName":"h3"},{"title":"2ï¸âƒ£ Update Dependenciesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#2ï¸âƒ£-update-dependencies","content":" composer require damienharper/auditor:^3.0   ","version":"4.x","tagName":"h3"},{"title":"3ï¸âƒ£ Convert Annotations to Attributesâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#3ï¸âƒ£-convert-annotations-to-attributes","content":" Replace all Doctrine annotations with PHP 8 attributes:  # Find files with old annotations grep -r &quot;@Audit\\\\\\\\&quot; src/Entity/   WARNING Then update each entity to use the new attribute syntax.  ","version":"4.x","tagName":"h3"},{"title":"4ï¸âƒ£ Update Configurationâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#4ï¸âƒ£-update-configuration","content":" If you have any configuration arrays, ensure they use the current option names.  ","version":"4.x","tagName":"h3"},{"title":"5ï¸âƒ£ Run Testsâ€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#5ï¸âƒ£-run-tests","content":" ./vendor/bin/phpunit   ","version":"4.x","tagName":"h3"},{"title":"â“ Need Help?â€‹","type":1,"pageTitle":"Upgrading to 3.x from 2.x","url":"/auditor-docs/auditor/upgrade/v3#-need-help","content":" Check the GitHub repository for:  Release notesOpen issuesDiscussions ","version":"4.x","tagName":"h2"},{"title":"Filters Reference","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/querying/filters","content":"","keywords":"","version":"4.x"},{"title":"ðŸ“‹ Overviewâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-overview","content":" Filter\tPurpose\tExample Use CaseSimpleFilter\tExact value matching\tFilter by type, user, entity ID DateRangeFilter\tDate/time range\tAudits from last week RangeFilter\tNumeric range\tAudits with ID &gt;= 1000 NullFilter\tNULL value matching\tAudits by anonymous users JsonFilter\tJSON column content\tFilter by extra_data values  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”Œ Filter Interfaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-filter-interface","content":" All filters implement FilterInterface:  namespace DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter; interface FilterInterface { public function getName(): string; public function getSQL(): array; }   ","version":"4.x","tagName":"h2"},{"title":"ðŸŽ¯ SimpleFilterâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-simplefilter","content":" The most common filter for exact value matching.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#namespace","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter;   ","version":"4.x","tagName":"h3"},{"title":"Constructorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#constructor","content":" public function __construct( private readonly string $name, // Column name private mixed $value // Value or array of values )   ","version":"4.x","tagName":"h3"},{"title":"Single Valueâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#single-value","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\SimpleFilter; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Filter by type $query-&gt;addFilter(new SimpleFilter(Query::TYPE, 'update')); // Filter by object ID $query-&gt;addFilter(new SimpleFilter(Query::OBJECT_ID, '123')); // Filter by user ID $query-&gt;addFilter(new SimpleFilter(Query::USER_ID, 42)); // Filter by transaction hash $query-&gt;addFilter(new SimpleFilter(Query::TRANSACTION_HASH, 'abc123...'));   ","version":"4.x","tagName":"h3"},{"title":"Multiple Values (OR)â€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#multiple-values-or","content":" When providing an array, it generates an IN clause:  // type IN ('insert', 'update') $query-&gt;addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update'])); // object_id IN ('1', '2', '3') $query-&gt;addFilter(new SimpleFilter(Query::OBJECT_ID, ['1', '2', '3'])); // blame_id IN (10, 20, 30) $query-&gt;addFilter(new SimpleFilter(Query::USER_ID, [10, 20, 30]));   ","version":"4.x","tagName":"h3"},{"title":"Generated SQLâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#generated-sql","content":" $filter = new SimpleFilter('type', 'update'); $sql = $filter-&gt;getSQL(); // Returns: ['sql' =&gt; 'type = :type', 'params' =&gt; ['type' =&gt; 'update']] $filter = new SimpleFilter('type', ['insert', 'update']); $sql = $filter-&gt;getSQL(); // Returns: ['sql' =&gt; 'type IN (:type)', 'params' =&gt; ['type' =&gt; ['insert', 'update']]]   ","version":"4.x","tagName":"h3"},{"title":"Methodsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#methods","content":" $filter = new SimpleFilter(Query::TYPE, 'update'); $filter-&gt;getName(); // 'type' $filter-&gt;getValue(); // 'update' or ['insert', 'update']   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“… DateRangeFilterâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-daterangefilter","content":" Filter by date/time range.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#namespace-1","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter;   ","version":"4.x","tagName":"h3"},{"title":"Constructorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#constructor-1","content":" public function __construct( private string $name, // Column name ?\\DateTimeInterface $minValue, // Lower bound (inclusive) ?\\DateTimeInterface $maxValue = null // Upper bound (inclusive) )   ","version":"4.x","tagName":"h3"},{"title":"Both Boundsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#both-bounds","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\DateRangeFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Audits between two dates $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('2024-01-01'), new \\DateTime('2024-12-31') ));   ","version":"4.x","tagName":"h3"},{"title":"Lower Bound Onlyâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#lower-bound-only","content":" // Audits since January 1st $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('2024-01-01'), null ));   ","version":"4.x","tagName":"h3"},{"title":"Upper Bound Onlyâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#upper-bound-only","content":" // Audits before July 1st $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, null, new \\DateTime('2024-07-01') ));   ","version":"4.x","tagName":"h3"},{"title":"Common Patternsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#common-patterns","content":" // Last 24 hours $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('-24 hours'), new \\DateTime('now') )); // Last 7 days $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('-7 days'), new \\DateTime('now') )); // This month $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('first day of this month'), new \\DateTime('last day of this month') )); // Specific business hours $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('2024-01-15 09:00:00'), new \\DateTime('2024-01-15 17:00:00') ));   ","version":"4.x","tagName":"h3"},{"title":"Generated SQLâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#generated-sql-1","content":" $filter = new DateRangeFilter( 'created_at', new \\DateTime('2024-01-01'), new \\DateTime('2024-12-31') ); $sql = $filter-&gt;getSQL(); // Returns: // [ // 'sql' =&gt; 'created_at &gt;= :min_created_at AND created_at &lt;= :max_created_at', // 'params' =&gt; [ // 'min_created_at' =&gt; '2024-01-01 00:00:00', // 'max_created_at' =&gt; '2024-12-31 00:00:00' // ] // ]   ","version":"4.x","tagName":"h3"},{"title":"Validationâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#validation","content":" WARNING The filter validates that minValue is not after maxValue. Providing an invalid range will throw an InvalidArgumentException.  // This throws InvalidArgumentException new DateRangeFilter( Query::CREATED_AT, new \\DateTime('2024-12-31'), // Later date as min new \\DateTime('2024-01-01') // Earlier date as max ); // Error: Max bound has to be later than min bound.   ","version":"4.x","tagName":"h3"},{"title":"Methodsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#methods-1","content":" $filter = new DateRangeFilter(Query::CREATED_AT, $min, $max); $filter-&gt;getName(); // 'created_at' $filter-&gt;getMinValue(); // DateTimeInterface|null $filter-&gt;getMaxValue(); // DateTimeInterface|null   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”¢ RangeFilterâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-rangefilter","content":" Filter by numeric range.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#namespace-2","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter;   ","version":"4.x","tagName":"h3"},{"title":"Constructorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#constructor-2","content":" public function __construct( private string $name, // Column name mixed $minValue, // Lower bound (inclusive) mixed $maxValue = null // Upper bound (inclusive) )   ","version":"4.x","tagName":"h3"},{"title":"Both Boundsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#both-bounds-1","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\RangeFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Audits with ID between 100 and 200 $query-&gt;addFilter(new RangeFilter(Query::ID, 100, 200));   ","version":"4.x","tagName":"h3"},{"title":"Lower Bound Onlyâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#lower-bound-only-1","content":" // Audits with ID &gt;= 1000 $query-&gt;addFilter(new RangeFilter(Query::ID, 1000, null));   ","version":"4.x","tagName":"h3"},{"title":"Upper Bound Onlyâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#upper-bound-only-1","content":" // Audits with ID &lt;= 500 $query-&gt;addFilter(new RangeFilter(Query::ID, null, 500));   ","version":"4.x","tagName":"h3"},{"title":"Validationâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#validation-1","content":" IMPORTANT At least one bound must be provided. Providing neither will throw an InvalidArgumentException.  // This throws InvalidArgumentException new RangeFilter(Query::ID, null, null); // Error: You must provide at least one of the two range bounds.   ","version":"4.x","tagName":"h3"},{"title":"Generated SQLâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#generated-sql-2","content":" $filter = new RangeFilter('id', 100, 200); $sql = $filter-&gt;getSQL(); // Returns: // [ // 'sql' =&gt; 'id &gt;= :min_id AND id &lt;= :max_id', // 'params' =&gt; ['min_id' =&gt; 100, 'max_id' =&gt; 200] // ]   ","version":"4.x","tagName":"h3"},{"title":"Methodsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#methods-2","content":" $filter = new RangeFilter(Query::ID, 100, 200); $filter-&gt;getName(); // 'id' $filter-&gt;getMinValue(); // 100 $filter-&gt;getMaxValue(); // 200   ","version":"4.x","tagName":"h3"},{"title":"ðŸš« NullFilterâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-nullfilter","content":" Filter for NULL values.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#namespace-3","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\NullFilter;   ","version":"4.x","tagName":"h3"},{"title":"Constructorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#constructor-3","content":" public function __construct( private readonly string $name // Column name )   ","version":"4.x","tagName":"h3"},{"title":"Usageâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#usage","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\NullFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Filter audits made by anonymous users (no blame_id) $query-&gt;addFilter(new NullFilter(Query::USER_ID)); // Filter audits without discriminator $query-&gt;addFilter(new NullFilter(Query::DISCRIMINATOR));   ","version":"4.x","tagName":"h3"},{"title":"Generated SQLâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#generated-sql-3","content":" $filter = new NullFilter('blame_id'); $sql = $filter-&gt;getSQL(); // Returns: ['sql' =&gt; 'blame_id IS NULL', 'params' =&gt; []]   ","version":"4.x","tagName":"h3"},{"title":"Methodsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#methods-3","content":" $filter = new NullFilter(Query::USER_ID); $filter-&gt;getName(); // 'blame_id'   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”€ Combining Filtersâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-combining-filters","content":" TIP You can add multiple filters to a query. Filters are combined with AND.  $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Type is 'update' AND user is 42 AND in date range $query-&gt;addFilter(new SimpleFilter(Query::TYPE, 'update')); $query-&gt;addFilter(new SimpleFilter(Query::USER_ID, 42)); $query-&gt;addFilter(new DateRangeFilter( Query::CREATED_AT, new \\DateTime('-7 days'), new \\DateTime('now') ));   ","version":"4.x","tagName":"h2"},{"title":"Same Column Multiple Filtersâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#same-column-multiple-filters","content":" Multiple filters on the same column are merged:  // These are equivalent: $query-&gt;addFilter(new SimpleFilter(Query::TYPE, 'insert')); $query-&gt;addFilter(new SimpleFilter(Query::TYPE, 'update')); // Becomes: type IN ('insert', 'update') // Same as: $query-&gt;addFilter(new SimpleFilter(Query::TYPE, ['insert', 'update']));   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Supported Filter Columnsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-supported-filter-columns","content":" The following columns can be filtered:  Column\tConstant\tDescriptionid\tQuery::ID\tAudit entry primary key type\tQuery::TYPE\tAction type object_id\tQuery::OBJECT_ID\tAudited entity ID discriminator\tQuery::DISCRIMINATOR\tEntity class for inheritance transaction_hash\tQuery::TRANSACTION_HASH\tTransaction identifier blame_id\tQuery::USER_ID\tUser ID who made the change created_at\tQuery::CREATED_AT\tWhen the audit was created json\tQuery::JSON\tJSON column content (extra_data)  ","version":"4.x","tagName":"h2"},{"title":"ðŸ”Ž JsonFilterâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-jsonfilter","content":" Filter by JSON column content. Generates platform-specific SQL for optimal performance.  ","version":"4.x","tagName":"h2"},{"title":"Namespaceâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#namespace-4","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter;   ","version":"4.x","tagName":"h3"},{"title":"Constructorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#constructor-4","content":" public function __construct( private readonly string $column, // JSON column name (e.g., 'extra_data') private readonly string $path, // JSON path (e.g., 'department' or 'user.role') private readonly mixed $value, // Value to match private readonly string $operator = '=', // Comparison operator private readonly bool $strict = false // Throw exception if JSON not supported )   ","version":"4.x","tagName":"h3"},{"title":"Basic Usageâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#basic-usage","content":" use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\JsonFilter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Query; $query = $reader-&gt;createQuery(User::class, ['page_size' =&gt; null]); // Filter by exact value $query-&gt;addFilter(new JsonFilter('extra_data', 'department', 'IT')); $entries = $query-&gt;execute();   ","version":"4.x","tagName":"h3"},{"title":"Supported Operatorsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#supported-operators","content":" // Exact match (default) new JsonFilter('extra_data', 'department', 'IT'); new JsonFilter('extra_data', 'department', 'IT', '='); // Not equal new JsonFilter('extra_data', 'department', 'IT', '!='); new JsonFilter('extra_data', 'department', 'IT', '&lt;&gt;'); // Pattern matching new JsonFilter('extra_data', 'department', 'IT%', 'LIKE'); new JsonFilter('extra_data', 'department', '%temp%', 'NOT LIKE'); // Multiple values new JsonFilter('extra_data', 'status', ['active', 'pending'], 'IN'); new JsonFilter('extra_data', 'status', ['deleted', 'archived'], 'NOT IN'); // NULL checking new JsonFilter('extra_data', 'deleted_by', null, 'IS NULL'); new JsonFilter('extra_data', 'department', null, 'IS NOT NULL');   ","version":"4.x","tagName":"h3"},{"title":"Nested JSON Pathsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#nested-json-paths","content":" // Access nested values using dot notation $query-&gt;addFilter(new JsonFilter('extra_data', 'user.role', 'admin')); $query-&gt;addFilter(new JsonFilter('extra_data', 'metadata.source.ip', '192.168.1.1'));   ","version":"4.x","tagName":"h3"},{"title":"Database Supportâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#database-support","content":" Database\tMinimum Version\tJSON FunctionMySQL\t5.7.0\tJSON_UNQUOTE(JSON_EXTRACT()) MariaDB\t10.2.3\tJSON_UNQUOTE(JSON_EXTRACT()) PostgreSQL\t9.4.0\t-&gt;&gt; operator SQLite\t3.38.0\tjson_extract()  ","version":"4.x","tagName":"h3"},{"title":"Fallback Behaviorâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#fallback-behavior","content":" When the database doesn't support JSON functions, the filter falls back to LIKE pattern matching:  // On unsupported database, this: new JsonFilter('extra_data', 'department', 'IT'); // Becomes approximately: // WHERE extra_data LIKE '%&quot;department&quot;:&quot;IT&quot;%'   WARNING The LIKE fallback may produce inaccurate results (false positives). A E_USER_WARNING is triggered when this occurs.  ","version":"4.x","tagName":"h3"},{"title":"Strict Modeâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#strict-mode","content":" Enable strict mode to throw an exception instead of falling back to LIKE:  // Throws InvalidArgumentException if JSON is not supported $filter = new JsonFilter('extra_data', 'department', 'IT', '=', strict: true);   ","version":"4.x","tagName":"h3"},{"title":"Limitationsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#limitations","content":" NOTE Only scalar value extraction is supported in this version. Array/object comparisons (e.g., JSON_CONTAINS) are not yet implemented.  ","version":"4.x","tagName":"h3"},{"title":"Generated SQL Examplesâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#generated-sql-examples","content":" // MySQL/MariaDB $filter = new JsonFilter('extra_data', 'department', 'IT'); // SQL: JSON_UNQUOTE(JSON_EXTRACT(extra_data, '$.department')) = :json_department // PostgreSQL // SQL: extra_data-&gt;&gt;'department' = :json_department // SQLite // SQL: json_extract(extra_data, '$.department') = :json_department   ","version":"4.x","tagName":"h3"},{"title":"ðŸ§© Custom Filter Exampleâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#-custom-filter-example","content":" NOTE You can create custom filters by implementing FilterInterface. For NULL value filtering, use the built-in NullFilter class.  &lt;?php namespace App\\Audit\\Filter; use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Reader\\Filter\\FilterInterface; final class NotNullFilter implements FilterInterface { public function __construct( private readonly string $name ) {} public function getName(): string { return $this-&gt;name; } public function getSQL(): array { return [ 'sql' =&gt; sprintf('%s IS NOT NULL', $this-&gt;name), 'params' =&gt; [], ]; } } // Usage $query-&gt;addFilter(new NotNullFilter('blame_id'));     ","version":"4.x","tagName":"h2"},{"title":"Next Stepsâ€‹","type":1,"pageTitle":"Filters Reference","url":"/auditor-docs/auditor/querying/filters#next-steps","content":" ðŸ” Querying OverviewðŸ“¦ Entry Model Reference ","version":"4.x","tagName":"h2"},{"title":"Upgrading to 4.x from 3.x","type":0,"sectionRef":"#","url":"/auditor-docs/auditor/upgrade/v4","content":"","keywords":"","version":"4.x"},{"title":"âš ï¸ Requirements Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#ï¸-requirements-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"PHP Versionâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#php-version","content":" IMPORTANT Minimum PHP version is now 8.4 (was 8.2 in 3.x)  This is required by Symfony 8.0 and leverages PHP 8.4 features.  ","version":"4.x","tagName":"h3"},{"title":"Symfony Versionâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#symfony-version","content":" IMPORTANT Minimum Symfony version is now 8.0 (was 5.4 in 3.x)  Support for Symfony 5.4, 6.4, and 7.x has been dropped.  ","version":"4.x","tagName":"h3"},{"title":"Doctrine Versionsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#doctrine-versions","content":" Package\t3.x Version\t4.x VersionDoctrine DBAL\t&gt;= 3.2\t&gt;= 4.0 Doctrine ORM\t&gt;= 2.13\t&gt;= 3.2  ","version":"4.x","tagName":"h3"},{"title":"PHPUnit Versionâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#phpunit-version","content":" PHPUnit minimum version is now 12.0 (was 11.0 in 3.x)  ","version":"4.x","tagName":"h3"},{"title":"ðŸ—‘ï¸ Removed Methodsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#ï¸-removed-methods","content":" ","version":"4.x","tagName":"h2"},{"title":"DoctrineHelperâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#doctrinehelper","content":" The following methods have been removed from DH\\Auditor\\Provider\\Doctrine\\Persistence\\Helper\\DoctrineHelper:  Removed Method\tReplacementDoctrineHelper::createSchemaManager()\t$connection-&gt;createSchemaManager() DoctrineHelper::introspectSchema()\t$schemaManager-&gt;introspectSchema() DoctrineHelper::getMigrateToSql()\tSee migration example below  These methods were compatibility shims for older Doctrine DBAL versions that are no longer needed.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ“¦ Namespace Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-namespace-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"Annotation â†’ Attributeâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#annotation--attribute","content":" TIP The Annotation namespace has been renamed to Attribute to align with PHP 8+ terminology.  Before (3.x)\tAfter (4.0)DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable\tDH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore\tDH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security\tDH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\AnnotationLoader\tDH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\AttributeLoader  Before (3.x):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation as Audit; #[Audit\\Auditable] class MyEntity { #[Audit\\Ignore] private string $ignoredField; }   After (4.0):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute as Audit; #[Audit\\Auditable] class MyEntity { #[Audit\\Ignore] private string $ignoredField; }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“Š Model Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-model-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"Entry Model - Property Hooks (PHP 8.4+)â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#entry-model---property-hooks-php-84","content":" NOTE The Entry model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access.  Before (3.x)\tAfter (4.0)$entry-&gt;getId()\t$entry-&gt;id $entry-&gt;getType()\t$entry-&gt;type $entry-&gt;getObjectId()\t$entry-&gt;objectId $entry-&gt;getDiscriminator()\t$entry-&gt;discriminator $entry-&gt;getTransactionHash()\t$entry-&gt;transactionHash $entry-&gt;getUserId()\t$entry-&gt;userId $entry-&gt;getUsername()\t$entry-&gt;username $entry-&gt;getUserFqdn()\t$entry-&gt;userFqdn $entry-&gt;getUserFirewall()\t$entry-&gt;userFirewall $entry-&gt;getIp()\t$entry-&gt;ip $entry-&gt;getCreatedAt()\t$entry-&gt;createdAt (new)\t$entry-&gt;extraData  Note: getDiffs() and getExtraData() methods remain as they contain business logic. extraData is also available as a virtual property.  ","version":"4.x","tagName":"h3"},{"title":"Configuration - Asymmetric Visibility (PHP 8.4+)â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#configuration---asymmetric-visibility-php-84","content":" The Configuration class now uses PHP 8.4 asymmetric visibility:  Before (3.x)\tAfter (4.0)$config-&gt;isEnabled()\t$config-&gt;enabled $config-&gt;getTimezone()\t$config-&gt;timezone  ","version":"4.x","tagName":"h3"},{"title":"User Model - Property Hooks (PHP 8.4+)â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#user-model---property-hooks-php-84","content":" The UserInterface now uses PHP 8.4 property hooks:  Before (3.x)\tAfter (4.0)$user-&gt;getIdentifier()\t$user-&gt;identifier $user-&gt;getUsername()\t$user-&gt;username  If you have custom UserInterface implementations, update them:  Before (3.x):  use DH\\Auditor\\User\\UserInterface; class MyUser implements UserInterface { public function getIdentifier(): ?string { return $this-&gt;id; } public function getUsername(): ?string { return $this-&gt;name; } }   After (4.0):  use DH\\Auditor\\User\\UserInterface; class MyUser implements UserInterface { public ?string $identifier { get =&gt; $this-&gt;id; } public ?string $username { get =&gt; $this-&gt;name; } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”¡ UTF-8 Conversion Now Opt-Inâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-utf-8-conversion-now-opt-in","content":" IMPORTANT The automatic UTF-8 re-encoding of audit diffs has been removed from the default path.  ","version":"4.x","tagName":"h2"},{"title":"What Changedâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#what-changed","content":" Previously, auditor always called mb_convert_encoding() recursively on the entire diff array before persisting each audit entry. This guaranteed that any non-UTF-8 byte sequence in entity field values would be sanitized before being stored.  This pass now only runs when the utf8_convert option is explicitly enabled.  ","version":"4.x","tagName":"h3"},{"title":"Who Is Affectedâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#who-is-affected","content":" You are affected if your application:  Uses a database connection that was not explicitly configured as UTF-8, andPersists entity fields that may contain non-UTF-8 strings (e.g. data imported from ISO-8859-1 sources, legacy BLOBs, etc.)  Applications running on a modern stack (DBAL 4 + PHP 8.4 + UTF-8 database charset) are not affected â€” the conversion was already a no-op for them.  ","version":"4.x","tagName":"h3"},{"title":"How to Fixâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#how-to-fix","content":" Add 'utf8_convert' =&gt; true to your DoctrineProvider configuration:  use DH\\Auditor\\Provider\\Doctrine\\Configuration; $configuration = new Configuration([ // ... other options ... 'utf8_convert' =&gt; true, ]);   ","version":"4.x","tagName":"h3"},{"title":"Why the Default Is falseâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#why-the-default-is-false","content":" DBAL 4 mandates PHP 8.4+ and enforces UTF-8 database connections. Traversing and re-encoding every diff array on every flush was unnecessary overhead for the vast majority of users. The option is preserved for applications that still process legacy non-UTF-8 data.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ†• New extra_data Columnâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-new-extra_data-column","content":" ","version":"4.x","tagName":"h2"},{"title":"Schema Changeâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#schema-change","content":" IMPORTANT A new nullable JSON column extra_data has been added to all audit tables. Run the schema update command after upgrading.  php bin/console audit:schema:update --dump-sql # Preview php bin/console audit:schema:update --force # Apply   ","version":"4.x","tagName":"h3"},{"title":"Two ways to populate extra_dataâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#two-ways-to-populate-extra_data","content":" Option 1 â€” Global provider (new in 4.0): set a callable on Configuration once and it runs automatically for every audit entry produced during a flush:  $configuration-&gt;setExtraDataProvider(function (): ?array { return [ 'ip' =&gt; $this-&gt;requestStack-&gt;getCurrentRequest()?-&gt;getClientIp(), 'role' =&gt; $this-&gt;security-&gt;getUser()?-&gt;getRoles(), ]; });   Option 2 â€” Per-entity listener: LifecycleEvent now exposes $event-&gt;entity (the audited object), allowing listeners to add entity-specific context:  #[AsEventListener(event: LifecycleEvent::class, priority: 10)] final class AuditExtraDataListener { public function __invoke(LifecycleEvent $event): void { $payload = $event-&gt;getPayload(); if ($payload['entity'] === User::class &amp;&amp; null !== $event-&gt;entity) { $payload['extra_data'] = json_encode([ 'department' =&gt; $event-&gt;entity-&gt;getDepartment(), ], JSON_THROW_ON_ERROR); $event-&gt;setPayload($payload); } } }   The provider runs first; the listener can override or extend its output. See the Extra Data guide for precedence rules, merging strategies, and caveats.  ","version":"4.x","tagName":"h3"},{"title":"ðŸ”¢ TransactionType Enumâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-transactiontype-enum","content":" TIP Transaction type constants have been replaced by a backed enum for better type safety.  Before (3.x)\tAfter (4.0)Transaction::INSERT\tTransactionType::Insert-&gt;value Transaction::UPDATE\tTransactionType::Update-&gt;value Transaction::REMOVE\tTransactionType::Remove-&gt;value Transaction::ASSOCIATE\tTransactionType::Associate-&gt;value Transaction::DISSOCIATE\tTransactionType::Dissociate-&gt;value  Before (3.x):  use DH\\Auditor\\Model\\Transaction; if ($entry-&gt;getType() === Transaction::INSERT) { // ... }   After (4.0):  use DH\\Auditor\\Model\\TransactionType; if ($entry-&gt;type === TransactionType::Insert-&gt;value) { // ... }   ","version":"4.x","tagName":"h2"},{"title":"ðŸŽµ Symfony Attributesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-symfony-attributes","content":" ","version":"4.x","tagName":"h2"},{"title":"Commandsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#commands","content":" Console commands now use #[AsCommand] attribute:  #[AsCommand( name: 'audit:schema:update', description: 'Update audit tables structure', )] final class UpdateSchemaCommand extends Command   ","version":"4.x","tagName":"h3"},{"title":"Event Listenersâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#event-listeners","content":" Event subscriber has been replaced by event listeners using #[AsEventListener]:  Before (3.x):  class AuditEventSubscriber implements EventSubscriberInterface { public static function getSubscribedEvents(): array { return [LifecycleEvent::class =&gt; 'onAuditEvent']; } }   After (4.0):  #[AsEventListener(event: LifecycleEvent::class, method: 'onAuditEvent')] final class AuditEventSubscriber { public function onAuditEvent(LifecycleEvent $event): void { } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”„ Migration Example: getMigrateToSqlâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-migration-example-getmigratetosql","content":" Before (3.x):  use DH\\Auditor\\Provider\\Doctrine\\Persistence\\Helper\\DoctrineHelper; $sqls = DoctrineHelper::getMigrateToSql($connection, $fromSchema, $toSchema);   After (4.0):  use Doctrine\\DBAL\\Schema\\Comparator; $platform = $connection-&gt;getDatabasePlatform(); $sqls = $platform-&gt;getAlterSchemaSQL( (new Comparator($platform))-&gt;compareSchemas($fromSchema, $toSchema) );   ","version":"4.x","tagName":"h2"},{"title":"DoctrineHelper::getRealClassName()â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#doctrinehelpergetrealclassname","content":" This method now only handles __CG__ proxies (Doctrine Common Gateway marker).  With PHP 8.4+, Doctrine ORM uses native lazy objects instead of proxy classes, so the previous proxy handling logic has been simplified.  ","version":"4.x","tagName":"h3"},{"title":"Composer Scripts Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#composer-scripts-changes","content":" The following composer scripts have been removed:  Removed Script\tPurposesetup5\tSymfony 5.4 setup setup6\tSymfony 6.4 setup setup7\tSymfony 7.x setup  Use the new unified setup script instead:  composer setup   ","version":"4.x","tagName":"h2"},{"title":"Internal Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#internal-changes","content":" These changes are internal and should not affect most users, but are documented for completeness:  ","version":"4.x","tagName":"h2"},{"title":"DoctrineHelper::setPrimaryKey()â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#doctrinehelpersetprimarykey","content":" Now uses PrimaryKeyConstraint directly without fallback to deprecated setPrimaryKey() method.  ","version":"4.x","tagName":"h3"},{"title":"DoctrineHelper::getReflectionPropertyValue()â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#doctrinehelpergetreflectionpropertyvalue","content":" Now uses getPropertyAccessor() directly without fallback to deprecated getReflectionProperty() method.  ","version":"4.x","tagName":"h3"},{"title":"PlatformHelper::getServerVersion()â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#platformhelpergetserverversion","content":" Simplified to use getNativeConnection() directly. The getWrappedConnection() fallback has been removed.  ","version":"4.x","tagName":"h3"},{"title":"ðŸš€ PHP 8.4+ Modernization Changesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-php-84-modernization-changes","content":" ","version":"4.x","tagName":"h2"},{"title":"TransactionType Enumâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#transactiontype-enum","content":" NOTE Transaction type constants have been moved from Transaction model to a native PHP enum TransactionType.  Before (3.x):  use DH\\Auditor\\Model\\Transaction; $type = Transaction::INSERT; $type = Transaction::UPDATE; $type = Transaction::REMOVE; $type = Transaction::ASSOCIATE; $type = Transaction::DISSOCIATE;   After (4.0):  use DH\\Auditor\\Model\\TransactionType; // Using constants (recommended - backward compatible syntax) $type = TransactionType::INSERT; $type = TransactionType::UPDATE; $type = TransactionType::REMOVE; $type = TransactionType::ASSOCIATE; $type = TransactionType::DISSOCIATE; // Or using enum cases (when you need the enum instance) $type = TransactionType::Insert; $type = TransactionType::Update; // etc.   ","version":"4.x","tagName":"h3"},{"title":"Entry Model - Property Hooksâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#entry-model---property-hooks","content":" The Entry model now uses PHP 8.4 property hooks. Getter methods have been replaced by direct property access.  Before (3.x)\tAfter (4.0)$entry-&gt;getId()\t$entry-&gt;id $entry-&gt;getType()\t$entry-&gt;type $entry-&gt;getObjectId()\t$entry-&gt;objectId $entry-&gt;getDiscriminator()\t$entry-&gt;discriminator $entry-&gt;getTransactionHash()\t$entry-&gt;transactionHash $entry-&gt;getUserId()\t$entry-&gt;userId $entry-&gt;getUsername()\t$entry-&gt;username $entry-&gt;getUserFqdn()\t$entry-&gt;userFqdn $entry-&gt;getUserFirewall()\t$entry-&gt;userFirewall $entry-&gt;getIp()\t$entry-&gt;ip $entry-&gt;getCreatedAt()\t$entry-&gt;createdAt  Note: getDiffs() method is preserved as it contains business logic.  ","version":"4.x","tagName":"h3"},{"title":"User Interface - Property Hooksâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#user-interface---property-hooks","content":" The UserInterface now uses PHP 8.4 interface properties.  Before (3.x):  interface UserInterface { public function getIdentifier(): ?string; public function getUsername(): ?string; } // Usage $user-&gt;getIdentifier(); $user-&gt;getUsername();   After (4.0):  interface UserInterface { public ?string $identifier { get; } public ?string $username { get; } } // Usage $user-&gt;identifier; $user-&gt;username;   ","version":"4.x","tagName":"h3"},{"title":"Configuration - Asymmetric Visibilityâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#configuration---asymmetric-visibility","content":" The Configuration class now uses asymmetric visibility for some properties.  Before (3.x)\tAfter (4.0)$config-&gt;isEnabled()\t$config-&gt;enabled $config-&gt;getTimezone()\t$config-&gt;timezone  Note: getUserProvider(), getSecurityProvider(), and getRoleChecker() methods are preserved.  ","version":"4.x","tagName":"h3"},{"title":"Attribute Namespace Renameâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#attribute-namespace-rename","content":" The Annotation namespace has been renamed to Attribute to better reflect PHP 8+ native attributes.  Before (3.x):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Ignore; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\Security; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Annotation\\AnnotationLoader;   After (4.0):  use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Auditable; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Ignore; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\Security; use DH\\Auditor\\Provider\\Doctrine\\Auditing\\Attribute\\AttributeLoader;   ","version":"4.x","tagName":"h3"},{"title":"Event Subscribers â†’ Event Listenersâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#event-subscribers--event-listeners","content":" Event subscribers now use Symfony's #[AsEventListener] attribute instead of EventSubscriberInterface.  Before (3.x):  use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface; class AuditEventSubscriber implements EventSubscriberInterface { public static function getSubscribedEvents(): array { return [LifecycleEvent::class =&gt; ['onAuditEvent', -1000000]]; } public function onAuditEvent(LifecycleEvent $event): LifecycleEvent { /* ... */ } }   After (4.0):  use Symfony\\Component\\EventDispatcher\\Attribute\\AsEventListener; #[AsEventListener(event: LifecycleEvent::class, priority: -1_000_000)] class AuditEventSubscriber { public function __invoke(LifecycleEvent $event): LifecycleEvent { /* ... */ } }   ","version":"4.x","tagName":"h3"},{"title":"Console Commands with #[AsCommand]â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#console-commands-with-ascommand","content":" Console commands now use the #[AsCommand] attribute for metadata.  Before (3.x):  class CleanAuditLogsCommand extends Command { protected function configure(): void { $this -&gt;setName('audit:clean') -&gt;setDescription('Cleans audit tables') // ... } }   After (4.0):  #[AsCommand(name: 'audit:clean', description: 'Cleans audit tables')] class CleanAuditLogsCommand extends Command { protected function configure(): void { // Only options and arguments, no setName/setDescription } }   ","version":"4.x","tagName":"h3"},{"title":"ðŸ“‹ Migration Stepsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-migration-steps","content":" ","version":"4.x","tagName":"h2"},{"title":"1ï¸âƒ£ Update PHP Versionâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#1ï¸âƒ£-update-php-version","content":" Ensure you're running PHP 8.4 or higher:  php -v # PHP 8.4.x ...   ","version":"4.x","tagName":"h3"},{"title":"2ï¸âƒ£ Update Symfony Dependenciesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#2ï¸âƒ£-update-symfony-dependencies","content":" Update your composer.json:  { &quot;require&quot;: { &quot;symfony/framework-bundle&quot;: &quot;^8.0&quot; } }   ","version":"4.x","tagName":"h3"},{"title":"3ï¸âƒ£ Update Doctrine Dependenciesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#3ï¸âƒ£-update-doctrine-dependencies","content":" { &quot;require&quot;: { &quot;doctrine/dbal&quot;: &quot;^4.0&quot;, &quot;doctrine/orm&quot;: &quot;^3.2&quot; } }   ","version":"4.x","tagName":"h3"},{"title":"4ï¸âƒ£ Update auditorâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#4ï¸âƒ£-update-auditor","content":" composer require damienharper/auditor:^4.0   ","version":"4.x","tagName":"h3"},{"title":"5ï¸âƒ£ Update Your Codeâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#5ï¸âƒ£-update-your-code","content":" Replace any removed method calls:  // Before $schemaManager = DoctrineHelper::createSchemaManager($connection); $schema = DoctrineHelper::introspectSchema($schemaManager); // After $schemaManager = $connection-&gt;createSchemaManager(); $schema = $schemaManager-&gt;introspectSchema();   ","version":"4.x","tagName":"h3"},{"title":"6ï¸âƒ£ Run Testsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#6ï¸âƒ£-run-tests","content":" ./vendor/bin/phpunit   ","version":"4.x","tagName":"h3"},{"title":"7ï¸âƒ£ Update Audit Schemaâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#7ï¸âƒ£-update-audit-schema","content":" IMPORTANT After upgrading, ensure your audit tables are up to date.  php bin/console audit:schema:update --dump-sql php bin/console audit:schema:update --force   ","version":"4.x","tagName":"h3"},{"title":"ðŸ”§ Troubleshootingâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-troubleshooting","content":" ","version":"4.x","tagName":"h2"},{"title":"\"Class not found\" errorsâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#class-not-found-errors","content":" TIP Ensure all dependencies are updated by running composer update.  ","version":"4.x","tagName":"h3"},{"title":"Schema issuesâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#schema-issues","content":" NOTE Run the schema update command: php bin/console audit:schema:update --force  ","version":"4.x","tagName":"h3"},{"title":"Test failuresâ€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#test-failures","content":" If tests fail after upgrading:  Check PHPUnit version compatibilityReview any mocked classes for API changesCheck for deprecated method usage  ","version":"4.x","tagName":"h3"},{"title":"â“ Need Help?â€‹","type":1,"pageTitle":"Upgrading to 4.x from 3.x","url":"/auditor-docs/auditor/upgrade/v4#-need-help","content":" If you encounter issues during the upgrade:  Check the GitHub IssuesReview the Release NotesOpen a new issue with: PHP versionSymfony versionError messagesSteps to reproduce ","version":"4.x","tagName":"h2"}],"options":{"languages":["en"],"highlightResult":true,"maxHits":10,"id":"default"}}